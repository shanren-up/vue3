!function(t,e){function n(t,e,i){null!=t&&("number"==typeof t?this.fromNumber(t,e,i):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}function o(){return new n(null)}function s(t,e,i,n,o,s){for(;--s>=0;){var a=e*this[t++]+i[n]+o;o=Math.floor(a/67108864),i[n++]=67108863&a}return o}function a(t,e,i,n,o,s){for(var a=32767&e,r=e>>15;--s>=0;){var h=32767&this[t],l=this[t++]>>15,c=r*h+l*a;h=a*h+((32767&c)<<15)+i[n]+(1073741823&o),o=(h>>>30)+(c>>>15)+r*l+(o>>>30),i[n++]=1073741823&h}return o}function r(t,e,i,n,o,s){for(var a=16383&e,r=e>>14;--s>=0;){var h=16383&this[t],l=this[t++]>>14,c=r*h+l*a;h=a*h+((16383&c)<<14)+i[n]+o,o=(h>>28)+(c>>14)+r*l,i[n++]=268435455&h}return o}function h(t){return ni.charAt(t)}function l(t,e){var i=oi[t.charCodeAt(e)];return null==i?-1:i}function c(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s}function d(t){this.t=1,this.s=0>t?-1:0,t>0?this[0]=t:-1>t?this[0]=t+DV:this.t=0}function u(t){var e=o();return e.fromInt(t),e}function _(t,e){var i;if(16==e)i=4;else if(8==e)i=3;else if(256==e)i=8;else if(2==e)i=1;else if(32==e)i=5;else{if(4!=e)return void this.fromRadix(t,e);i=2}this.t=0,this.s=0;for(var o=t.length,s=!1,a=0;--o>=0;){var r=8==i?255&t[o]:l(t,o);0>r?"-"==t.charAt(o)&&(s=!0):(s=!1,0==a?this[this.t++]=r:a+i>this.DB?(this[this.t-1]|=(r&(1<<this.DB-a)-1)<<a,this[this.t++]=r>>this.DB-a):this[this.t-1]|=r<<a,a+=i,a>=this.DB&&(a-=this.DB))}8==i&&0!=(128&t[0])&&(this.s=-1,a>0&&(this[this.t-1]|=(1<<this.DB-a)-1<<a)),this.clamp(),s&&n.ZERO.subTo(this,this)}function g(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t}function f(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var i,n=(1<<e)-1,o=!1,s="",a=this.t,r=this.DB-a*this.DB%e;if(a-- >0)for(r<this.DB&&(i=this[a]>>r)>0&&(o=!0,s=h(i));a>=0;)e>r?(i=(this[a]&(1<<r)-1)<<e-r,i|=this[--a]>>(r+=this.DB-e)):(i=this[a]>>(r-=e)&n,0>=r&&(r+=this.DB,--a)),i>0&&(o=!0),o&&(s+=h(i));return o?s:"0"}function v(){var t=o();return n.ZERO.subTo(this,t),t}function m(){return this.s<0?this.negate():this}function p(t){var e=this.s-t.s;if(0!=e)return e;var i=this.t;if(e=i-t.t,0!=e)return e;for(;--i>=0;)if(0!=(e=this[i]-t[i]))return e;return 0}function y(t){var e,i=1;return 0!=(e=t>>>16)&&(t=e,i+=16),0!=(e=t>>8)&&(t=e,i+=8),0!=(e=t>>4)&&(t=e,i+=4),0!=(e=t>>2)&&(t=e,i+=2),0!=(e=t>>1)&&(t=e,i+=1),i}function w(){return this.t<=0?0:this.DB*(this.t-1)+y(this[this.t-1]^this.s&this.DM)}function A(t,e){var i;for(i=this.t-1;i>=0;--i)e[i+t]=this[i];for(i=t-1;i>=0;--i)e[i]=0;e.t=this.t+t,e.s=this.s}function x(t,e){for(var i=t;i<this.t;++i)e[i-t]=this[i];e.t=Math.max(this.t-t,0),e.s=this.s}function E(t,e){var i,n=t%this.DB,o=this.DB-n,s=(1<<o)-1,a=Math.floor(t/this.DB),r=this.s<<n&this.DM;for(i=this.t-1;i>=0;--i)e[i+a+1]=this[i]>>o|r,r=(this[i]&s)<<n;for(i=a-1;i>=0;--i)e[i]=0;e[a]=r,e.t=this.t+a+1,e.s=this.s,e.clamp()}function T(t,e){e.s=this.s;var i=Math.floor(t/this.DB);if(i>=this.t)return void(e.t=0);var n=t%this.DB,o=this.DB-n,s=(1<<n)-1;e[0]=this[i]>>n;for(var a=i+1;a<this.t;++a)e[a-i-1]|=(this[a]&s)<<o,e[a-i]=this[a]>>n;n>0&&(e[this.t-i-1]|=(this.s&s)<<o),e.t=this.t-i,e.clamp()}function C(t,e){for(var i=0,n=0,o=Math.min(t.t,this.t);o>i;)n+=this[i]-t[i],e[i++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n-=t.s;i<this.t;)n+=this[i],e[i++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;i<t.t;)n-=t[i],e[i++]=n&this.DM,n>>=this.DB;n-=t.s}e.s=0>n?-1:0,-1>n?e[i++]=this.DV+n:n>0&&(e[i++]=n),e.t=i,e.clamp()}function b(t,e){var i=this.abs(),o=t.abs(),s=i.t;for(e.t=s+o.t;--s>=0;)e[s]=0;for(s=0;s<o.t;++s)e[s+i.t]=i.am(0,o[s],e,s,0,i.t);e.s=0,e.clamp(),this.s!=t.s&&n.ZERO.subTo(e,e)}function k(t){for(var e=this.abs(),i=t.t=2*e.t;--i>=0;)t[i]=0;for(i=0;i<e.t-1;++i){var n=e.am(i,e[i],t,2*i,0,1);(t[i+e.t]+=e.am(i+1,2*e[i],t,2*i+1,n,e.t-i-1))>=e.DV&&(t[i+e.t]-=e.DV,t[i+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(i,e[i],t,2*i,0,1)),t.s=0,t.clamp()}function S(t,e,i){var s=t.abs();if(!(s.t<=0)){var a=this.abs();if(a.t<s.t)return null!=e&&e.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=o());var r=o(),h=this.s,l=t.s,c=this.DB-y(s[s.t-1]);c>0?(s.lShiftTo(c,r),a.lShiftTo(c,i)):(s.copyTo(r),a.copyTo(i));var d=r.t,u=r[d-1];if(0!=u){var _=u*(1<<this.F1)+(d>1?r[d-2]>>this.F2:0),g=this.FV/_,f=(1<<this.F1)/_,v=1<<this.F2,m=i.t,p=m-d,w=null==e?o():e;for(r.dlShiftTo(p,w),i.compareTo(w)>=0&&(i[i.t++]=1,i.subTo(w,i)),n.ONE.dlShiftTo(d,w),w.subTo(r,r);r.t<d;)r[r.t++]=0;for(;--p>=0;){var A=i[--m]==u?this.DM:Math.floor(i[m]*g+(i[m-1]+v)*f);if((i[m]+=r.am(0,A,i,p,0,d))<A)for(r.dlShiftTo(p,w),i.subTo(w,i);i[m]<--A;)i.subTo(w,i)}null!=e&&(i.drShiftTo(d,e),h!=l&&n.ZERO.subTo(e,e)),i.t=d,i.clamp(),c>0&&i.rShiftTo(c,i),0>h&&n.ZERO.subTo(i,i)}}}function I(t){var e=o();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(n.ZERO)>0&&t.subTo(e,e),e}function L(t){this.m=t}function P(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function R(t){return t}function D(t){t.divRemTo(this.m,null,t)}function M(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function O(t,e){t.squareTo(e),this.reduce(e)}function B(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return e=e*(2-(15&t)*e)&15,e=e*(2-(255&t)*e)&255,e=e*(2-((65535&t)*e&65535))&65535,e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function N(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function z(t){var e=o();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(n.ZERO)>0&&this.m.subTo(e,e),e}function F(t){var e=o();return t.copyTo(e),this.reduce(e),e}function V(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var i=32767&t[e],n=i*this.mpl+((i*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(i=e+this.m.t,t[i]+=this.m.am(0,n,t,e,0,this.m.t);t[i]>=t.DV;)t[i]-=t.DV,t[++i]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function U(t,e){t.squareTo(e),this.reduce(e)}function H(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function W(){return 0==(this.t>0?1&this[0]:this.s)}function Y(t,e){if(t>4294967295||1>t)return n.ONE;var i=o(),s=o(),a=e.convert(this),r=y(t)-1;for(a.copyTo(i);--r>=0;)if(e.sqrTo(i,s),(t&1<<r)>0)e.mulTo(s,a,i);else{var h=i;i=s,s=h}return e.revert(i)}function Z(t,e){var i;return i=256>t||e.isEven()?new L(e):new N(e),this.exp(t,i)}function G(){var t=o();return this.copyTo(t),t}function X(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function j(){return 0==this.t?this.s:this[0]<<24>>24}function K(){return 0==this.t?this.s:this[0]<<16>>16}function J(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function q(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function Q(t){if(null==t&&(t=10),0==this.signum()||2>t||t>36)return"0";var e=this.chunkSize(t),i=Math.pow(t,e),n=u(i),s=o(),a=o(),r="";for(this.divRemTo(n,s,a);s.signum()>0;)r=(i+a.intValue()).toString(t).substr(1)+r,s.divRemTo(n,s,a);return a.intValue().toString(t)+r}function $(t,e){this.fromInt(0),null==e&&(e=10);for(var i=this.chunkSize(e),o=Math.pow(e,i),s=!1,a=0,r=0,h=0;h<t.length;++h){var c=l(t,h);0>c?"-"==t.charAt(h)&&0==this.signum()&&(s=!0):(r=e*r+c,++a>=i&&(this.dMultiply(o),this.dAddOffset(r,0),a=0,r=0))}a>0&&(this.dMultiply(Math.pow(e,a)),this.dAddOffset(r,0)),s&&n.ZERO.subTo(this,this)}function tt(t,e,i){if("number"==typeof e)if(2>t)this.fromInt(1);else for(this.fromNumber(t,i),this.testBit(t-1)||this.bitwiseTo(n.ONE.shiftLeft(t-1),ht,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(n.ONE.shiftLeft(t-1),this);else{var o=new Array,s=7&t;o.length=(t>>3)+1,e.nextBytes(o),s>0?o[0]&=(1<<s)-1:o[0]=0,this.fromString(o,256)}}function et(){var t=this.t,e=new Array;e[0]=this.s;var i,n=this.DB-t*this.DB%8,o=0;if(t-- >0)for(n<this.DB&&(i=this[t]>>n)!=(this.s&this.DM)>>n&&(e[o++]=i|this.s<<this.DB-n);t>=0;)8>n?(i=(this[t]&(1<<n)-1)<<8-n,i|=this[--t]>>(n+=this.DB-8)):(i=this[t]>>(n-=8)&255,0>=n&&(n+=this.DB,--t)),0!=(128&i)&&(i|=-256),0==o&&(128&this.s)!=(128&i)&&++o,(o>0||i!=this.s)&&(e[o++]=i);return e}function it(t){return 0==this.compareTo(t)}function nt(t){return this.compareTo(t)<0?this:t}function ot(t){return this.compareTo(t)>0?this:t}function st(t,e,i){var n,o,s=Math.min(t.t,this.t);for(n=0;s>n;++n)i[n]=e(this[n],t[n]);if(t.t<this.t){for(o=t.s&this.DM,n=s;n<this.t;++n)i[n]=e(this[n],o);i.t=this.t}else{for(o=this.s&this.DM,n=s;n<t.t;++n)i[n]=e(o,t[n]);i.t=t.t}i.s=e(this.s,t.s),i.clamp()}function at(t,e){return t&e}function rt(t){var e=o();return this.bitwiseTo(t,at,e),e}function ht(t,e){return t|e}function lt(t){var e=o();return this.bitwiseTo(t,ht,e),e}function ct(t,e){return t^e}function dt(t){var e=o();return this.bitwiseTo(t,ct,e),e}function ut(t,e){return t&~e}function _t(t){var e=o();return this.bitwiseTo(t,ut,e),e}function gt(){for(var t=o(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t}function ft(t){var e=o();return 0>t?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}function vt(t){var e=o();return 0>t?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}function mt(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}function pt(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+mt(this[t]);return this.s<0?this.t*this.DB:-1}function yt(t){for(var e=0;0!=t;)t&=t-1,++e;return e}function wt(){for(var t=0,e=this.s&this.DM,i=0;i<this.t;++i)t+=yt(this[i]^e);return t}function At(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)}function xt(t,e){var i=n.ONE.shiftLeft(t);return this.bitwiseTo(i,e,i),i}function Et(t){return this.changeBit(t,ht)}function Tt(t){return this.changeBit(t,ut)}function Ct(t){return this.changeBit(t,ct)}function bt(t,e){for(var i=0,n=0,o=Math.min(t.t,this.t);o>i;)n+=this[i]+t[i],e[i++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n+=t.s;i<this.t;)n+=this[i],e[i++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;i<t.t;)n+=t[i],e[i++]=n&this.DM,n>>=this.DB;n+=t.s}e.s=0>n?-1:0,n>0?e[i++]=n:-1>n&&(e[i++]=this.DV+n),e.t=i,e.clamp()}function kt(t){var e=o();return this.addTo(t,e),e}function St(t){var e=o();return this.subTo(t,e),e}function It(t){var e=o();return this.multiplyTo(t,e),e}function Lt(){var t=o();return this.squareTo(t),t}function Pt(t){var e=o();return this.divRemTo(t,e,null),e}function Rt(t){var e=o();return this.divRemTo(t,null,e),e}function Dt(t){var e=o(),i=o();return this.divRemTo(t,e,i),new Array(e,i)}function Mt(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function Ot(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}}function Bt(){}function Nt(t){return t}function zt(t,e,i){t.multiplyTo(e,i)}function Ft(t,e){t.squareTo(e)}function Vt(t){return this.exp(t,new Bt)}function Ut(t,e,i){var n=Math.min(this.t+t.t,e);for(i.s=0,i.t=n;n>0;)i[--n]=0;var o;for(o=i.t-this.t;o>n;++n)i[n+this.t]=this.am(0,t[n],i,n,0,this.t);for(o=Math.min(t.t,e);o>n;++n)this.am(0,t[n],i,n,0,e-n);i.clamp()}function Ht(t,e,i){--e;var n=i.t=this.t+t.t-e;for(i.s=0;--n>=0;)i[n]=0;for(n=Math.max(e-this.t,0);n<t.t;++n)i[this.t+n-e]=this.am(e-n,t[n],i,0,0,this.t+n-e);i.clamp(),i.drShiftTo(1,i)}function Wt(t){this.r2=o(),this.q3=o(),n.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function Yt(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=o();return t.copyTo(e),this.reduce(e),e}function Zt(t){return t}function Gt(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)}function Xt(t,e){t.squareTo(e),this.reduce(e)}function jt(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function Kt(t,e){var i,n,s=t.bitLength(),a=u(1);if(0>=s)return a;i=18>s?1:48>s?3:144>s?4:768>s?5:6,n=8>s?new L(e):e.isEven()?new Wt(e):new N(e);var r=new Array,h=3,l=i-1,c=(1<<i)-1;if(r[1]=n.convert(this),i>1){var d=o();for(n.sqrTo(r[1],d);c>=h;)r[h]=o(),n.mulTo(d,r[h-2],r[h]),h+=2}var _,g,f=t.t-1,v=!0,m=o();for(s=y(t[f])-1;f>=0;){for(s>=l?_=t[f]>>s-l&c:(_=(t[f]&(1<<s+1)-1)<<l-s,f>0&&(_|=t[f-1]>>this.DB+s-l)),h=i;0==(1&_);)_>>=1,--h;if((s-=h)<0&&(s+=this.DB,--f),v)r[_].copyTo(a),v=!1;else{for(;h>1;)n.sqrTo(a,m),n.sqrTo(m,a),h-=2;h>0?n.sqrTo(a,m):(g=a,a=m,m=g),n.mulTo(m,r[_],a)}for(;f>=0&&0==(t[f]&1<<s);)n.sqrTo(a,m),g=a,a=m,m=g,--s<0&&(s=this.DB-1,--f)}return n.revert(a)}function Jt(t){var e=this.s<0?this.negate():this.clone(),i=t.s<0?t.negate():t.clone();if(e.compareTo(i)<0){var n=e;e=i,i=n}var o=e.getLowestSetBit(),s=i.getLowestSetBit();if(0>s)return e;for(s>o&&(s=o),s>0&&(e.rShiftTo(s,e),i.rShiftTo(s,i));e.signum()>0;)(o=e.getLowestSetBit())>0&&e.rShiftTo(o,e),(o=i.getLowestSetBit())>0&&i.rShiftTo(o,i),e.compareTo(i)>=0?(e.subTo(i,e),e.rShiftTo(1,e)):(i.subTo(e,i),i.rShiftTo(1,i));return s>0&&i.lShiftTo(s,i),i}function qt(t){if(0>=t)return 0;var e=this.DV%t,i=this.s<0?t-1:0;if(this.t>0)if(0==e)i=this[0]%t;else for(var n=this.t-1;n>=0;--n)i=(e*i+this[n])%t;return i}function Qt(t){var e=t.isEven();if(this.isEven()&&e||0==t.signum())return n.ZERO;for(var i=t.clone(),o=this.clone(),s=u(1),a=u(0),r=u(0),h=u(1);0!=i.signum();){for(;i.isEven();)i.rShiftTo(1,i),e?(s.isEven()&&a.isEven()||(s.addTo(this,s),a.subTo(t,a)),s.rShiftTo(1,s)):a.isEven()||a.subTo(t,a),a.rShiftTo(1,a);for(;o.isEven();)o.rShiftTo(1,o),e?(r.isEven()&&h.isEven()||(r.addTo(this,r),h.subTo(t,h)),r.rShiftTo(1,r)):h.isEven()||h.subTo(t,h),h.rShiftTo(1,h);i.compareTo(o)>=0?(i.subTo(o,i),e&&s.subTo(r,s),a.subTo(h,a)):(o.subTo(i,o),e&&r.subTo(s,r),h.subTo(a,h))}return 0!=o.compareTo(n.ONE)?n.ZERO:h.compareTo(t)>=0?h.subtract(t):h.signum()<0?(h.addTo(t,h),h.signum()<0?h.add(t):h):h}function $t(t){var e,i=this.abs();if(1==i.t&&i[0]<=si[si.length-1]){for(e=0;e<si.length;++e)if(i[0]==si[e])return!0;return!1}if(i.isEven())return!1;for(e=1;e<si.length;){for(var n=si[e],o=e+1;o<si.length&&ai>n;)n*=si[o++];for(n=i.modInt(n);o>e;)if(n%si[e++]==0)return!1}return i.millerRabin(t)}function te(t){var e=this.subtract(n.ONE),i=e.getLowestSetBit();if(0>=i)return!1;var s=e.shiftRight(i);t=t+1>>1,t>si.length&&(t=si.length);for(var a=o(),r=0;t>r;++r){a.fromInt(si[Math.floor(Me.Util.random()*si.length)]);var h=a.modPow(s,this);if(0!=h.compareTo(n.ONE)&&0!=h.compareTo(e)){for(var l=1;l++<i&&0!=h.compareTo(e);)if(h=h.modPowInt(2,this),0==h.compareTo(n.ONE))return!1;if(0!=h.compareTo(e))return!1}}return!0}function ee(){this.i=0,this.j=0,this.S=new Array}function ie(t){var e,i,n;for(e=0;256>e;++e)this.S[e]=e;for(i=0,e=0;256>e;++e)i=i+this.S[e]+t[e%t.length]&255,n=this.S[e],this.S[e]=this.S[i],this.S[i]=n;this.i=0,this.j=0}function ne(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]}function oe(){return new ee}function se(t){hi[li++]^=255&t,hi[li++]^=t>>8&255,hi[li++]^=t>>16&255,hi[li++]^=t>>24&255,li>=ci&&(li-=ci)}function ae(){se((new Date).getTime())}function re(){if(null==ri){for(ae(),ri=oe(),ri.init(hi),li=0;li<hi.length;++li)hi[li]=0;li=0}return ri.next()}function he(t){var e;for(e=0;e<t.length;++e)t[e]=re()}function le(){}function ce(t,e){return new n(t,e)}function de(t,e){if(e<t.length+11)return null;for(var i=new Array,o=t.length-1;o>=0&&e>0;){var s=t.charCodeAt(o--);128>s?i[--e]=s:s>127&&2048>s?(i[--e]=63&s|128,i[--e]=s>>6|192):(i[--e]=63&s|128,i[--e]=s>>6&63|128,i[--e]=s>>12|224)}i[--e]=0;for(var a=new le,r=new Array;e>2;){for(r[0]=0;0==r[0];)a.nextBytes(r);i[--e]=r[0]}return i[--e]=2,i[--e]=0,new n(i)}function ue(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function _e(t,e){this.n=ce(t,16),this.e=parseInt(e,16)}function ge(t){return t.modPowInt(this.e,this.n)}function fe(t){var e=de(t,this.n.bitLength()+7>>3);if(null==e)return null;var i=this.doPrivate(e);if(null==i)return null;var n=i.toString(16);return 0==(1&n.length)?n:"0"+n}function ve(t,e){for(var i=t.toByteArray(),n=0;n<i.length&&0==i[n];)++n;if(i.length-n!=e-1||2!=i[n])return null;for(++n;0!=i[n];)if(++n>=i.length)return null;for(var o="";++n<i.length;){var s=255&i[n];128>s?o+=String.fromCharCode(s):s>191&&224>s?(o+=String.fromCharCode((31&s)<<6|63&i[n+1]),++n):(o+=String.fromCharCode((15&s)<<12|(63&i[n+1])<<6|63&i[n+2]),n+=2)}return o}function me(t,e,i){this.n=ce(t,16),this.e=parseInt(e,16),this.d=ce(i,16)}function pe(t,e,i,n,o,s,a,r){this.n=ce(t,16),this.e=parseInt(e,16),this.d=ce(i,16),this.p=ce(n,16),this.q=ce(o,16),this.dmp1=ce(s,16),this.dmq1=ce(a,16),this.coeff=ce(r,16)}function ye(t){if(null==this.p||null==this.q)return t.modPow(this.d,this.n);for(var e=t.mod(this.p).modPow(this.dmp1,this.p),i=t.mod(this.q).modPow(this.dmq1,this.q);e.compareTo(i)<0;)e=e.add(this.p);return e.subtract(i).multiply(this.coeff).mod(this.p).multiply(this.q).add(i)}function we(t){var e=ce(t,16),i=this.doPublic(e);return null==i?null:ve(i,this.n.bitLength()+7>>3)}function Ae(t,e,i){var n=0,o=0,s=e.split("\n"),a=2*t.measureText("e").width;return s.forEach(function(e){if(i){var s,r,h,l,c,d=e.split(" "),u=d.length,_="";for(h=0;u>h;h++)if(s=d[h]+(h===u-1?"":" "),r=_+s,l=t.measureText(r).width,i>l)_=r;else if(l==i)_="",o+=a;else{for(c=0;c<s.length;c++)if(r=_+s.substr(0,c+1),t.measureText(r).width>i){_=s.substring(c,s.length),o+=a;break}for(;_.length>0&&t.measureText(_).width>i;)for(c=0;c<_.length;c++)if(r=_.substr(0,c+1),t.measureText(r).width>i){_=_.substring(c,_.length),o+=a;break}}}else l=t.measureText(e).width,n=l>n?l:n;o+=a}),n=i?i:n,{w:n,h:o}}function xe(t,e,i,n){var o,s=t.animate,a=n._now,r=n._shapeDataIndex,h=i._animates;if(h||(h=i._animates={}),r.length)for(var l=0;l<r.length;l++){o=r[l];var c=h[o];c||(c=h[o]={}),h=c}else o=r;var d=h[o];d||(d=h[o]={},s.forEach(function(o){var s,r=o.attr,h=d[r];o={attr:r,to:o.to,type:o.type||"number",delay:o.delay||0,dur:o.dur||1e3,interval:o.interval||0,finish:o.finish,repeat:o.repeat||1,reverse:null==o.reverse?!0:o.reverse,onDone:o.onDone,easing:o.easing,trigger:null==o.to,start:a,time:0,total:0,count:0,started:!1,stopped:!1,current:null},Array.isArray(o.dur)&&(o.groupDur=o.dur.slice(0,o.dur.length-1),o.dur=o.dur[o.dur.length-1],o.groupDurTotal=o.groupDur.reduce(function(t,e,i){return o.groupDur[i]=t+e},0),o.groupIndex=0,o.groupTime=0,o.groupStart=a),null==o.finish&&(o.finish=o.delay+o.dur+o.interval),h?Array.isArray(h)?(h.push(o),h=h[h.length-2]):d[r]=[h,o]:(s=qi(i,e,t,r,n),d[r]=o),h&&(s=h.to,"group_set"===h.type&&(s=s[s.length-1])),o.from=s,o.trigger||(o.started=!0,Pe(o),Re(o))})),s=d,Object.keys(s).forEach(function(o){var r=s[o];if(Array.isArray(r)){var h=r[r.length-1];h.count+1===h.repeat?r.forEach(function(o){Ee(o,t,e,i,n,!0)}):h.count+1<h.repeat&&(h.total>=h.finish&&r.forEach(function(t){t.trigger||(t.started=!0),t.stopped=!1,t.time=0,t.start=a,t.total=0,"group_set"===t.type&&(t.groupIndex=0,t.groupTime=0,t.groupStart=a)}),r.forEach(function(o){Ee(o,t,e,i,n,!1)}))}else Ee(r,t,e,i,n,!0)})}function Ee(t,e,i,n,o,s){if(t.trigger){var a=qi(n,i,e,t.attr,o,null,!1);if(!t.started){if(a===t.from)return;t.started=!0,t.start=o._now,t.to=a,Pe(t),Re(t)}t.started&&a!==t.to&&(t.start=o._now,t.from=t.current,t.to=a,t.time=0,t.total=0,t.count=0,Pe(t),Re(t))}if(t.started&&!t.stopped){var r=o._now,h=r-t.start;if(h>=t.delay&&(t.total=h,h-=t.delay,t.time=h>t.dur?t.dur:h,"group_set"===t.type&&(t.groupTime=r-t.groupStart,t.groupStart===t.start&&(t.groupTime-=t.delay),t.groupTime>=t.groupDur[t.groupIndex]&&t.groupIndex++,t.groupTime>=t.groupDurTotal&&(t.groupIndex=0,t.groupTime=t.groupTime-t.groupDurTotal,t.groupStart=r)),t.total>=t.finish))if(t.count++,"group_set"===t.type,t.count>=t.repeat)t.time=t.dur,t.stopped=!0,t.trigger&&(t.from=t.to,t.to=null,t.start=null,t.time=0,t.total=0,t.count=0,t.started=!1,t.stopped=!1),t.onDone&&t.onDone.call(i,n,o);else if(s&&(t.time=0,t.start=r,t.total=0,t.reverse)){var l=t.from;t.from=t.to,t.to=l,Re(t)}o&&!o._invalidate&&(o._invalidate=!0)}}function Te(t){if(!ln[t.id]){if(dn=!0,ln[t.id]=t,null==t.from&&t.attr&&t.source){var e;t.from=(e=t.attr.match(/^S[:@](.*)/i))?t.source.getStyle(e[1]):(e=t.attr.match(/^C[:@](.*)/i))?t.source.getClient(e[1]):Me.Util.getValue(t.source,t.attr)}Pe(t),Re(t)}return t.resume(),t}function Ce(t,e){return ln[t.id]&&(null==e&&(e=!0),e&&Le(t,t.to),t.onStop&&t.onStop(),t.time=0,t.total=0,t.start=null,t.count=0,t.started=!1,t.stopped=!1,t.paused=!1,t.pausedTime=null,t.pausedTotal=0,t._oldSpeed=null,t._speedTotal=0,t._speedTime=null,t._percent=0,t._percentSet=null,t._percentDiff=0,delete ln[t.id]),t}function be(t){null==t&&(t=!0),Object.keys(ln).forEach(function(e){var i=ln[e];i&&(t&&Le(i,i.to),i.onStop&&i.onStop())}),ln={}}function ke(){Object.keys(ln).forEach(function(t){var e=ln[t];e&&e.pause()})}function Se(){Object.keys(ln).forEach(function(t){var e=ln[t];e&&e.resume()})}function Ie(t){Object.keys(ln).forEach(function(e){var i=ln[e];if(i&&(null==i.start&&(i._speedTime=i.start=t),null!=i._percentSet&&(i._percentDiff+=(i._percentSet-i._percent)*i.finish),!i.paused||(i.pausedTime||(i.pausedTime=t),null!=i._percentSet))){if(null==i._percentSet&&i.pausedTime&&(i.pausedTotal+=(t-i.pausedTime)*(i._oldSpeed||i._speed),i.pausedTime=null),i._oldSpeed&&!i.pausedTime&&(i._speedTotal=(t-i._speedTime)*i._oldSpeed-i.pausedTotal+i._percentDiff+i._speedTotal,i._percentDiff=0,i.pausedTotal=0,i._speedTime=t,i._oldSpeed=null),i.total=(t-i._speedTime)*i._speed-i.pausedTotal+i._percentDiff+i._speedTotal,null!=i._percentSet&&i.pausedTime&&(i.total-=(t-i.pausedTime)*(i._oldSpeed||i._speed)),i._percent=i.total>=i.finish?1:i.total/i.finish,i.total>i.delay){i.time=i.total-i.delay;var n=!1;if(i.time>=i.dur&&(i.time=i.dur,i.total>=i.finish&&(n=!0)),!i.stopped&&Le(i,De(i)),i.stopped=n,i.total>=i.finish)if(i.count++,i.count>=i.repeat)Ce(i,!1),i.onDone&&i.onDone();else if(i.time=0,i.total=0,i.start=null,i.stopped=!1,i.reverse){var o=i.from;i.from=i.to,i.to=o,Re(i)}}i.paused||!dn&&(dn=!0),null!=i._percentSet&&(i._percentSet=null)}})}function Le(t,e){if(t.started||(t.started=!0,t.onPlay&&t.onPlay()),t.filter&&(e=t.filter(e)),t.attr&&t.source){var i;(i=t.attr.match(/^S[:@](.*)/i))?t.source.setStyle(i[1],e):(i=t.attr.match(/^C[:@](.*)/i))?t.source.setClient(i[1],e):Me.Util.setValue(t.source,t.attr,e)}t.onUpdate&&t.onUpdate(e)}function Pe(t){var e=t.type,i=t.from,n=t.to;"number"===e?(t.from=i||0,t.to=n||0):"point"===e?(i?i.length&&(t.from={x:i[0],y:i[1]}):t.from="scale"===t.attr?{x:1,y:1}:{x:0,y:0},n?n.length&&(t.to={x:n[0],y:n[1]}):t.to="scale"===t.attr?{x:1,y:1}:{x:0,y:0}):"rect"===e?(i?i.length&&(t.from={x:i[0],y:i[1],w:i[2],h:i[3]}):t.from={x:0,y:0,w:0,h:0},n?n.length&&(t.to={x:n[0],y:n[1],w:n[2],h:n[3]}):t.to={x:0,y:0,w:0,h:0}):"color"===e&&(t.from=wn(i),t.to=wn(n)),t.current=t.from}function Re(t){var e=t.type,i=t.from,n=t.to;"number"===e?t.delta=n-i:"point"===e?t.delta={x:n.x-i.x,y:n.y-i.y}:"rect"===e?t.delta={x:n.x-i.x,y:n.y-i.y,w:n.w-i.w,h:n.h-i.h}:"color"===e&&(t.delta={r:n.r-i.r,g:n.g-i.g,b:n.b-i.b,a:n.a-i.a})}function De(t,e){var i=t.type,n=t.delta,o=t.from,s=t.time,a=t.dur,r=un[t.easing||"easeNone"];return r||(r=un.easeNone),"number"===i?e=r(s,o,n,a):"point"===i?e={x:r(s,o.x,n.x,a),y:r(s,o.y,n.y,a)}:"rect"===i?e={x:r(s,o.x,n.x,a),y:r(s,o.y,n.y,a),w:r(s,o.w,n.w,a),h:r(s,o.h,n.h,a)}:"color"===i?e="rgba("+Math.floor(r(s,o.r,n.r,a))+","+Math.floor(r(s,o.g,n.g,a))+","+Math.floor(r(s,o.b,n.b,a))+","+Math.floor(r(s,o.a,n.a,a))+")":"set"===i?t.time&&(e=t.to):"group_set"===i&&(e=t.to[t.groupIndex]),t.current=e,e}t.twaver&&(t.twaver.animateLoopId&&cancelAnimationFrame(t.twaver.animateLoopId),t.twaver.animateLoopId=null),String.prototype.startsWithTT||(String.prototype.startsWithTT=function(t,e){return e=e||0,this.indexOf(t,e)===e}),Object.prototype.__defineGetter__=Object.prototype.__defineGetter__||function(t,e){var i=Object.getOwnPropertyDescriptor(this,t),n={get:e,configurable:!0};i&&(console.assert(i.configurable,"Cannot set getter"),i.set&&(n.set=i.set)),Object.defineProperty(this,t,n)},Object.prototype.__defineSetter__=Object.prototype.__defineSetter__||function(t,e){var i=Object.getOwnPropertyDescriptor(this,t),n={set:e,configurable:!0};i&&(console.assert(i.configurable,"Cannot set setter"),i.get&&(n.get=i.get)),Object.defineProperty(this,t,n)};var Me={};Me._isInitializing=!1;var Oe={isDeserializing:!1,isCalculatingBus:!1,images:{},registerImage:function(t,e,i,n,o){Oe.images[t]=new Me.ImageAsset(t,e,i,n,o),bn(t)},getRegisteredImageNames:function(){return Object.keys(Oe.images)},unregisterImage:function(t){delete Oe.images[t]},getImageAsset:function(t){if("string"==typeof t){var e=Oe.images[t];return e}},showVersion:function(t){Oe.isCtrlDown(t)&&t.shiftKey&&76==t.keyCode&&alert("TWaver HTML5 "+Me.Util.getVersion()+"\n"+Be)},callLater:function(t,e,i,n){return setTimeout(function(){t.apply(e,i)},n||Rn.CALL_LATER_DELAY)},isEmptyObject:function(t){for(var e in t)return!1;return!0},xml:function(e){if(t.DOMParser)return(new DOMParser).parseFromString(e,"text/xml");var i=new ActiveXObject("Microsoft.XmlDOM");return i.async=!1,i.loadXml(e),i},num:function(t){return"number"==typeof t&&!isNaN(t)&&isFinite(t)},getter:function(t){var e=t.charAt(0).toUpperCase()+t.slice(1),i=/ble$/.test(t)||/ed$/.test(t)?"is":"get";return i+e},setter:function(t){var e=t.charAt(0).toUpperCase()+t.slice(1);return"set"+e},_id:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],id:function(){for(var t=[],e=0;32>e;e++)t[e]=this._id[Math.floor(16*Me.Util.random())];return t[12]="4",t[16]=this._id[3&t[16]|8],t.join("")},keys:function(t){var e=new fn;for(var i in t)e.add(i);return e},es:["toString","toLocaleString","valueOf"],ip:function(t,e){var i="_"+e;t[Oe.getter(e)]=function(){return this[i]},t[Oe.setter(e)]=function(t){var n=this[i];this[i]=t,this.firePropertyChange(e,n,t)}},validateLicense:function(t){Be=t,_i()},ibool:function(t,e){var i="_"+e,n=e.charAt(0).toUpperCase()+e.slice(1);t["is"+n]=function(){return this[i]},t[Oe.setter(e)]=function(t){var n=this[i];this[i]=t,this.firePropertyChange(e,n,t)}},getValue:function(t,e,i){var n=e.charAt(0).toUpperCase()+e.slice(1),o="get"+n,s="is"+n;return i?"boolean"===i?t[s]():t[o]():t[o]?t[o]():t[s]?t[s]():t[e]},setValue:function(t,e,i){t["set"+e.charAt(0).toUpperCase()+e.slice(1)](i)},clone:function(t){if(!t)return null;var e={};for(var i in t)e[i]=t[i];return e},cloneRect:function(t){return t?{x:t.x,y:t.y,width:t.width,height:t.height}:null},classCache:{},getClass:function(e){var i=Oe.classCache[e];if(!i){var n=e.split("."),o=n.length;i=t;for(var s=0;o>s;s++)i=i[n[s]],i||"twaver"===n[s]&&(i=Me);Oe.classCache[e]=i}return i},newInstance:function(e){var i=Oe.getClass(e)||t[e];if(!i)return null;var n=arguments.length,o=arguments;if(1===n)return new i;if(2===n)return new i(o[1]);if(3===n)return new i(o[1],o[2]);if(4===n)return new i(o[1],o[2],o[3]);if(5===n)return new i(o[1],o[2],o[3],o[4]);if(6===n)return new i(o[1],o[2],o[3],o[4],o[5]);if(7===n)return new i(o[1],o[2],o[3],o[4],o[5],o[6]);if(8===n)return new i(o[1],o[2],o[3],o[4],o[5],o[6],o[7]);throw"don't support args more than 7"},addMethod:function(t,e){var i=t.prototype;for(var n in e)i[n]=e[n]},ext:function(t,e,i){var n;if("string"==typeof t&&(n=t,t=Oe.getClass(t)),e){var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t,t.superClass=e.prototype,e.prototype.constructor==Object.prototype.constructor&&(e.prototype.constructor=e)}if(n&&(t.prototype.getClassName=function(){return n}),i){var s=t.prototype;for(var a in i)We.ext(a,s,i);for(var r=Oe.es.length,h=0;r>h;h++)a=Oe.es[h],i.hasOwnProperty(a)&&!i.propertyIsEnumerable(a)&&(s[a]=i[a])}},setViewBounds:function(t,e){if(t)if(t.adjustBounds)t.adjustBounds(e);else{var i=t.style;!i&&t.getView()&&(i=t.getView().style),i&&(i.position="absolute",i.left=e.x+"px",i.top=e.y+"px",i.width=e.width+"px",i.height=e.height+"px")}},getImageSrc:function(t){var e=Oe.getImageAsset(t);return e?e.getSrc()?e.getSrc():e.getImage().getAttribute("src"):t},nextColorCount:0,nextColor:function(){return Oe.nextColorCount>=Rn.COLORS.length&&(Oe.nextColorCount=0),Rn.COLORS[Oe.nextColorCount++]},isCtrlDown:function(t){return t.ctrlKey||t.metaKey},isShiftDown:function(t){return t.shiftKey},isAltDown:function(t){return t.altKey},setText:function(t,e,i){i?He.isFirefox?t.textContent=e:t.innerText=e:t.innerHTML=e},fillDescendant:function(t,e){e.add(t),t.hasChildren()&&t.getChildren().forEach(function(t){Oe.fillDescendant(t,e)})}},Be=(Date,"l=1.0\ntype=1\ngis=1\n3d=0\nstart=2016-12-26\nend=2017-04-01\nnote=This license applies to the evaluation version of TWaver. The License is limited to noncommercial use. Noncommercial use relates only to educational, research, personal or evaluation purposes. Any other use is commercial use. You may not use the Software in connection with any business activities.And You are not permitted to modify the software or attempt to decipher, decompile, disassemble or reverse engineer this Software.\nsignature=4c415ed4212f9e2c00778837150b7229b92f9aa372c6024655359ee3e0cdc9481dbc762abb79935c735295fd9cd03e60eff6430c390860424b940c47a3e8f85760deddffbd36050015c8107f6de52063b778f85adb48b04c5cb4e5f8cccfb73d41db8e9d2dde00ae2995af49d25d0b8b0e50a6803f79a125cdf70f500865a1a7510afad5a1983f735b02b7d0652b63ccca0a19318f162c57fcd849e7f662f46ce5579632a4321ba5502cb5c7832174daedd962f3cff2449ad5617944d6f01e6c6ba136991c745539a446eeb491a9730c7da44059a40423d9f3b1eaf2c669978a0ba61bb6868948ea7905ea3b39be45100bab50fcb13ba7a93d2736242d3c195508b9f9a7e922efd669722903bc578b54b650a9fa47969a81b531b502dbf069183681fdc8b2012884fba2dc1f3f6718ab644f972b11f6a18e55dc33d88d3c0e4d214524a3ce692558ce1ebb6c4d4ab329922caed6bb74a9fb443965e3300510f33bc06a82808a2cb9814b4c544e814ed7924afded6ccea6aa2f6ce515cc424aa40fb654e366795e486efc5977634433600083a54a8019788399b324d87e0d219dc5e8588af05aae26687711193c156445f5689901a55bd4549e7b7645788305937912ec0217bc68a560e92d6d2c4727fef811b7ae571175a11ba0769d1892ab982b60ce0e21bcbe9cd874034952da481e01aa0f13e25578c735081297f1be3b9568cb1e0036c968ba1b4525a598d77bdd7f28460379819b70ffab83a302975c2de089d64f1d635ab4d5dc593ca1eacfe5c7389cdbe9435f401c049dbde431227e2f0a6e34c642a2172c93bb3f20f511b3309ac17aafee50219a4707d9907b8f22d3d1bb03a6a3104448d6b4b6c9ed88d70f5c47a6c18d80c86677f769037f7d7d");t.twaver=Me,t._twaver=Oe,Me.animate={},Me.network={},Me.network.interaction={},Me.controls={},Me.charts={},Me.layout={};var Ne,ze,Fe=t.navigator,Ve=t.document,Ue=t.Image;t.document||(ze=!0,Ne=require("canvas"),Ue=Ne.Image,Fe={userAgent:""},Ve={});var He=function(){var t={},e=Fe.userAgent.toLowerCase();return t.isOpera=/opera/.test(e),t.isIE=/msie/.test(e)||/trident/.test(e)||/edge/.test(e),t.isFirefox=/firefox/i.test(e),t.isChrome=/chrome/i.test(e),t.isSafari=!t.isChrome&&/safari/i.test(e),t.isIPhone=/iphone/.test(e),t.isIPod=/ipod/.test(e),t.isIPad=/ipad/.test(e),t.isAndroid=/android/i.test(e),t.isWebOS=/webos/i.test(e),t.isMSTouchable=t.isIE&&(Fe.msMaxTouchPoints&&Fe.msMaxTouchPoints>1||Fe.maxTouchPoints&&Fe.maxTouchPoints>1),t.isTouchable="ontouchend"in Ve||t.isMSTouchable,t}();Oe.ua=He;var We={__accessor:function(t,e){for(var i=e.__accessor,n=i.length,o=0;n>o;o++)Oe.ip(t,i[o])},__bool:function(t,e){for(var i=e.__bool,n=i.length,o=0;n>o;o++)Oe.ibool(t,i[o])},__client:function(t,e){t.getClient=function(t){return this._clientMap[t]},t.setClient=function(t,e){var i=this._clientMap[t];return null==e?delete this._clientMap[t]:this._clientMap[t]=e,this.firePropertyChange("C:"+t,i,e)&&this.onClientChanged(t,i,e),this},t.getClientProperties=function(){return Oe.keys(this._clientMap)},t.getClientMap=function(){return this._clientMap},t.onClientChanged=function(t,e,i){}},__style:function(t,i){t.getStyle=function(t,i){var n=this._styleMap[t];return i===e&&(i=!0),null==n&&i?Me.Styles.getStyle(t):n},t.setStyle=function(t,e){var i=this._styleMap[t];return null==e?delete this._styleMap[t]:this._styleMap[t]=e,this.firePropertyChange("S:"+t,i,e)&&this.onStyleChanged(t,i,e),this},t.getStyleProperties=function(){return Oe.keys(this._styleMap)},t.onStyleChanged=function(t,e,i){}},__new:function(t,e){t.newInstance=function(){var t=Oe.getClass(this.getClassName());if(!t)return null;var e=arguments.length,i=arguments;if(0===e)return new t;if(1===e)return new t(i[0]);if(2===e)return new t(i[0],i[1]);if(3===e)return new t(i[0],i[1],i[2]);if(4===e)return new t(i[0],i[1],i[2],i[3]);if(5===e)return new t(i[0],i[1],i[2],i[3],i[4]);if(6===e)return new t(i[0],i[1],i[2],i[3],i[4],i[5]);if(7===e)return new t(i[0],i[1],i[2],i[3],i[4],i[5],i[6]);throw"don't support args more than 7"}},__property:function(t,e){t.getValue=function(t,e){return"accessor"===this._propertyType?Oe.getValue(t,this._propertyName):"style"===this._propertyType&&t.getStyle?t.getStyle(this._propertyName):"client"===this._propertyType&&t.getClient?t.getClient(this._propertyName):"field"===this._propertyType?t[this._propertyName]:null},t.setValue=function(t,e,i){if("accessor"===this._propertyType)t[Oe.setter(this._propertyName)](e);else{if("style"===this._propertyType&&t.setStyle)return t.setStyle(this._propertyName,e);if("client"===this._propertyType&&t.setClient)return t.setClient(this._propertyName,e);"field"===this._propertyType&&(t[this._propertyName]=e)}}},map:{__accessor:1,__bool:1,__client:1,__style:1,__new:1,__tree:1,__property:1},ext:function(t,e,i){1===We.map[t]?We[t](e,i):e[t]=i[t]}};Oe.extend=We;var Ye=Oe.Matrix=function(t,e,i,n,o,s){this.setMatrix(t,e,i,n,o,s)};Ye.identity=function(){return new Ye(1,0,0,1,0,0)},Ye.prototype.setMatrix=function(t,e,i,n,o,s){this._m11=t,this._m12=e,this._m21=i,this._m22=n,this._offsetX=o,this._offsetY=s,this._type=0,0!=this._m21||0!=this._m12?this._type=4:((1!=this._m11||1!=this._m22)&&(this._type=2),(0!=this._offsetX||0!=this._offsetY)&&(this._type|=1),0==(3&this._type)&&(this._type=0))},Ye.prototype.transform=function(){var t;if(t=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],!t||!Oe.num(t.x)||!Oe.num(t.y))throw"arguments should contain x, y";switch(this._type){case 0:return{x:t.x,y:t.y};case 1:return{x:this._offsetX+t.x,y:this._offsetY+t.y};case 2:return{x:t.x*this._m11,y:t.y*this._m22};case 3:return{x:t.x*this._m11+this._offsetX,y:t.y*this._m22+this._offsetY}}return{x:this._m11*t.x+t.y*this._m21+this._offsetX,y:this._m22*t.y+t.x*this._m12+this._offsetY}},Ye.prototype.translate=function(t,e){this.multiply(new Ye(1,0,0,1,t,e))},Ye.prototype.scale=function(t,e){this.multiply(new Ye(t,0,0,e,0,0))},Ye.prototype.rotate=function(t,e,i){t=t*Math.PI/180;var n=Math.sin(t),o=Math.cos(t),s=e*(1-o)+i*n,a=i*(1-o)-e*n;this.multiply(new Ye(o,n,-n,o,s,a))},Ye.prototype.skew=function(t,e){this.multiply(new Ye(1,Math.tan(e*Math.PI/180),Math.tan(t*Math.PI/180),1,0,0))},Ye.prototype.multiply=function(t){var e=this,i=t,n=e._type,o=i._type;if(0!=o)if(0==n)e.setMatrix(i._m11,i._m12,i._m21,i._m22,i._offsetX,i._offsetY);else if(1==o)e._offsetX+=i._offsetX,e._offsetY+=i._offsetY,4!=n&&(e._type|=1);else if(1==n){var s=e._offsetX,a=e._offsetY;e.setMatrix(i._m11,i._m12,i._m21,i._m22,i._offsetX,i._offsetY),e._offsetX=s*i._m11+a*i._m21+i._offsetX,e._offsetY=s*i._m12+a*i._m22+i._offsetY,e._type=4==o?4:3}else switch(n<<4|o){case 34:return e._m11*=i._m11,void(e._m22*=i._m22);case 35:return e._m11*=i._m11,e._m22*=i._m22,e._offsetX=i._offsetX,e._offsetY=i._offsetY,void(e._type=3);case 36:case 52:case 66:case 67:case 68:return void e.setMatrix(e._m11*i._m11+e._m12*i._m21,e._m11*i._m12+e._m12*i._m22,e._m21*i._m11+e._m22*i._m21,e._m21*i._m12+e._m22*i._m22,e._offsetX*i._m11+e._offsetY*i._m21+i._offsetX,e._offsetX*i._m12+e._offsetY*i._m22+i._offsetY);case 50:return e._m11*=i._m11,e._m22*=i._m22,e._offsetX*=i._m11,void(e._offsetY*=i._m22);case 51:return e._m11*=i._m11,e._m22*=i._m22,e._offsetX=i._m11*e._offsetX+i._offsetX,void(e._offsetY=i._m22*e._offsetY+i._offsetY);default:console.log("Matrix multiply hit an invalid case: "+combinedType)}};var Ze={getDistance:function(t,e){var i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)},getCenterPoint:function(t,e){return t&&e?{x:(t.x+e.x)/2,y:(t.y+e.y)/2}:null==e&&t.width?{x:t.x+t.width/2,y:t.y+t.height/2}:void 0},isPointInPolygon:function(t,e){t=t._as?t._as:t;var i=0,n=0,o=!1,s=t.length;for(i=0,n=s-1;s>i;n=i++){var a=t[i],r=t[n];a.y>e.y!=r.y>e.y&&e.x<(r.x-a.x)*(e.y-a.y)/(r.y-a.y)+a.x&&(o=!o)}return o},unionRect:function(t,e){if(t&&!e)return Oe.cloneRect(t);if(!t&&e)return Oe.cloneRect(e);if(t&&e){var i={};return i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i.width=Math.max(t.x+t.width,e.x+e.width)-i.x,i.height=Math.max(t.y+t.height,e.y+e.height)-i.y,i}return null},intersects:function(t,e){if(!t||!e)return!1;var i=e.width,n=e.height,o=t.width,s=t.height;if(0>=o||0>=s||0>=i||0>=n)return!1;var a=e.x,r=e.y,h=t.x,l=t.y;return o+=h,s+=l,i+=a,n+=r,(h>o||o>a)&&(l>s||s>r)&&(a>i||i>h)&&(r>n||n>l)},intersection:function(t,e){if(!t||!e)return!1;var i=e.x,n=e.y,o=t.x,s=t.y,a=i;a+=e.width;var r=n;r+=e.height;var h=o;h+=t.width;var l=s;return l+=t.height,o>i&&(i=o),s>n&&(n=s),a>h&&(a=h),r>l&&(r=l),a-=i,r-=n,0===a||0===r?null:{x:i,y:n,width:a,height:r}},contains:function(t,e){var i=e.x,n=e.y,o=e.width,s=e.height,a=t.width,r=t.height;if(0>(a|r|o|s))return!1;var h=t.x,l=t.y;if(h>i||l>n)return!1;if(a+=h,o+=i,i>=o){if(a>=h||o>a)return!1}else if(a>=h&&o>a)return!1;if(r+=l,s+=n,n>=s){if(r>=l||s>r)return!1}else if(r>=l&&s>r)return!1;return!0},getLinePoints:function(t){if(!t)return null;var e=new fn;return t.forEach(function(t){e.addAll(t)}),e},getLineRect:function(t){var e=Ze.getLinePoints(t);return Ze.getRect(e)},getRect:function(t,e){if(!t)return null;t._as&&(t=t._as);var i=t.length;if(0>=i)return null;var n=t[0];e=e||{x:null,y:null,width:0,height:0};for(var o=0;i>o;o++)if(n=t[o],n instanceof fn)Ze.getRect(n,e);else{null==e.x&&(e.x=n.x,e.y=n.y);var s=Math.min(e.x,n.x),a=Math.min(e.y,n.y),r=Math.max(e.x+e.width,n.x),h=Math.max(e.y+e.height,n.y);e.x=s,e.y=a,e.width=r-s,e.height=h-a}return e},addPadding:function(t,e,i,n){n=n||-1;var o=e.getStyle(i)*n;0!=o&&Ze.grow(t,o,o),o=e.getStyle(i+".left")*n,0!=o&&(t.x-=o,t.width+=o),o=e.getStyle(i+".right")*n,0!=o&&(t.width+=o),o=e.getStyle(i+".top")*n,0!=o&&(t.y-=o,t.height+=o),o=e.getStyle(i+".bottom")*n,0!=o&&(t.height+=o),t.width<0&&(t.width=-t.width,t.x-=t.width),t.height<0&&(t.height=-t.height,t.y-=t.height)},grow:function(t,e,i){if(null==t)return null;null==i&&(i=e);var n=t.width+e+e;if(!(0>n)){var o=t.height+i+i;if(!(0>o))return t.x-=e,t.y-=i,t.width=n,t.height=o,t}},containsPoint:function(t,e,i){return arguments.length<3&&(i=e.y,e=e.x),!t||e<t.x||i<t.y||e>t.x+t.width||i>t.y+t.height?!1:!0},getHotSpot:function(t,e,i,n,o){if("oval"===o){var s=.35;return{x:t+.5*i+i*s,y:e+n/2-Math.sqrt(.25-s*s)*n}}if("circle"===o){var a=t+i/2,r=e+n/2,h=Math.min(i,n)/2;t=a-h,e=r-h,i=2*h,n=2*h;var l=i/2,c=n/2,d=l*c/Math.sqrt(l*l+c*c);return{x:t+i/2+d,y:e+n/2-d}}var u={x:t+i,y:e};return i>3&&(u.x-=3),n>3&&(u.y+=3),u},getCircleRect:function(t){var e=Math.min(t.width,t.height)/2;return{x:t.x+t.width/2-e,y:t.y+t.height/2-e,width:2*e,height:2*e}},getEllipsePoint:function(t,e){if(!t||!e)return null;var i=t.x+t.width/2,n=t.y+t.height/2,o=e.x-i,s=e.y-n,a=t.width/2,r=t.height/2,h=Math.sqrt(1/(1/a/a+s*s/o/o/r/r));0>o&&(h=-h);var l;return l=0==o?s>0?r:-r:h*s/o,{x:i+h,y:n+l}},createMatrix:function(t,e,i){var n=Math.sin(t),o=Math.cos(t),s=e*(1-o)+i*n,a=i*(1-o)-e*n;return new Ye(o,n,-n,o,s,a)},calculatePointInfoAlongLineBySegments:function(t,e,i,n,o){return Ze.calculatePointInfoAlongLine(Ze.getPointObject(t,e),i,n,o)},calculatePointInfoAlongLine:function(t,i,n,o){if(i=i===e?!0:i,n=n||0,o=o||0,!t||t.size()<2)throw"must more than two points";if(!i){var s=Ze.reversePath(t);return Ze.calculatePointInfoAlongLine(s,!0,n,o)}t._as&&(t=t._as);var a,r,h,l,c,d=0,u=0,_=t.length;for(l=0;_>l;l++)if(c=t[l],0!=l){if(0>=n){h=Ze.calculatePointInfoOnStraightLine(Ze._getPoint(r),Ze._getControlPoint(c),n,o),a=h;break}if(u=Ze._getLength(c,r),d+u>n){h=Ze.getPathInfo(c,r,n-d,o,u),a=h;break}d+=u,r=c}else r=c;if(null==a){var g,f;r=t[_-1],f=Ze._getPoint(r),r instanceof fn&&(r=r._as),g=r instanceof Array?Ze._getControlPoint(r):Ze._getPoint(t[_-2]);var v=Math.atan2(f.y-g.y,f.x-g.x);h=Ze.transformPoint(f,v,n-d,o),h.angle=v,a=h}return a},reversePath:function(t){var e,i=new fn,n=null;t._as&&(t=t._as);for(var o=t.length-1;o>=0;o--)e=t[o],i.add(Ze._getReversePath(e,n)),n=e;return i},_getPoint:function(t){return t._as&&(t=t._as),t instanceof Array?t[t.length-1]:t},_getControlPoint:function(t){return t._as&&(t=t._as),t instanceof Array?t[t.length-2]:t},_getReversePath:function(t,e){var i=Ze._getPoint(t);return e&&e._as&&(e=e._as),null!=e&&e instanceof Array?new fn(2==e.length?[e[0],i]:[e[1],e[0],i]):i},_getLength:function(t,e){var i=Ze._getPoint(e),n=Ze._getPoint(t);if(t instanceof fn&&(t=t._as),t instanceof Array)return Ze.calculateCurveLength(i,t,1);var o=n.y-i.y,s=n.x-i.x;return Math.sqrt(s*s+o*o)},getPathInfo:function(t,e,i,n,o){var s,a=Ze._getPoint(e),r=Ze._getPoint(t);if(t instanceof fn&&(t=t._as),t instanceof Array){0>o&&(o=Ze._getLength(t,e));var h=i/o,l=Ze.calculatePointInfoOnCurveLine(a,t,h);a=l.point,s=l.angle,i=0}else s=Math.atan2(r.y-a.y,r.x-a.x);return Ze.transformPoint(a,s,i,n)},transformPoint:function(t,e,i,n){var o={x:i,y:n},s=Ze.createMatrix(e,0,0);return o=s.transform(o),o.x+=t.x,o.y+=t.y,{point:o,angle:e}},calculatePointInfoOnStraightLine:function(t,e,i,n){var o=Math.atan2(e.y-t.y,e.x-t.x);return Ze.transformPoint(t,o,i,n)},calculatePointInfoOnCurveLine:function(t,e,i){if(0>i||i>1)throw"Illegal arguments";return e._as&&(e=e._as),2==e.length?Ze._calculatePointInfoOnCurveLine2(t,e[0],e[1],i):Ze._calculatePointInfoOnCurveLine3(t,e[0],e[1],e[2],i)},_calculatePointInfoOnCurveLine2:function(t,e,i,n){var o=2*(t.x+i.x-2*e.x)*n+2*e.x-2*t.x,s=2*(t.y+i.y-2*e.y)*n+2*e.y-2*t.y,a=Math.atan2(s,o),r=(t.x+i.x-2*e.x)*n*n+(2*e.x-2*t.x)*n+t.x,h=(t.y+i.y-2*e.y)*n*n+(2*e.y-2*t.y)*n+t.y;return{point:{x:r,y:h},angle:a}},_calculatePointInfoOnCurveLine3:function(t,e,i,n,o){var s,a,r;s=1-o,a=s*s*s,r=o*o*o;var h=a*t.x+3*o*s*s*e.x+3*o*o*s*i.x+r*n.x,l=a*t.y+3*o*s*s*e.y+3*o*o*s*i.y+r*n.y;return{point:{x:h,y:l},angle:Math.atan2(Ze._bezeSpeedY(t,e,i,n,o),Ze._bezeSpeedX(t,e,i,n,o))}},calculateCurveLength:function(t,e,i){return e._as&&(e=e._as),2==e.length?Ze._calculateCurveLength(t,e[0],e[1],i):Ze._calculateBezierCurveLength(t,e[0],e[1],e[2],i)},_calculateCurveLength:function(t,e,i,n){if(0>=n||n>1)return 0;var o=Math.floor(n*(Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))+Math.sqrt((i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y)))/2),s=0;0>=o&&(o=1);for(var a,r,h=n/o,l=0,c=0;o>c;c++)l=h*c,a=2*(t.x+i.x-2*e.x)*l+2*e.x-2*t.x,r=2*(t.y+i.y-2*e.y)*l+2*e.y-2*t.y,a*=h,r*=h,s+=Math.sqrt(a*a+r*r);return s},_calculateBezierCurveLength:function(t,e,i,n,o){if(0>=o||o>1)return 0;var s=1e4,a=Math.floor(s*o);if(1==(1&a)&&a++,0==a)return 0;var r,h=Math.floor(a/2),l=0,c=0,d=o/a;for(r=0;h>r;r++)l+=Ze._bezeSpeed(t,e,i,n,(2*r+1)*d);for(r=1;h>r;r++)c+=Ze._bezeSpeed(t,e,i,n,2*r*d);return(Ze._bezeSpeed(t,e,i,n,0)+Ze._bezeSpeed(t,e,i,n,1)+2*c+4*l)*d/3},_bezeSpeedX:function(t,e,i,n,o){var s=1-o;return-3*t.x*s*s+3*e.x*s*s-6*e.x*s*o+6*i.x*s*o-3*i.x*o*o+3*n.x*o*o},_bezeSpeedY:function(t,e,i,n,o){var s=1-o;return-3*t.y*s*s+3*e.y*s*s-6*e.y*s*o+6*i.y*s*o-3*i.y*o*o+3*n.y*o*o},_bezeSpeed:function(t,e,i,n,o){var s=Ze._bezeSpeedX(t,e,i,n,o),a=Ze._bezeSpeedY(t,e,i,n,o);return Math.sqrt(s*s+a*a)},getPointObject:function(t,e){if(e&&0!=e.size()){var i=new fn;e=e._as,t=t._as;var n,o,s=0,a=e.length,r=t.length;for(n=0;a>n&&(o=e[n],s!=r);n++)"cubicto"===o?r-2>s&&i.add([t[s++],t[s++],t[s++]]):"quadto"===o?r-1>s&&i.add([t[s++],t[s++]]):r>s&&i.add(t[s++]);for(;r>s;s++)i.add(t[s]);return i}return t},calculateLineLength:function(t,e){if(!t||t.size()<2)return 0;if(e)return Ze.calculateLineLength(Ze.getPointObject(t,e));t=t._as;var i,n,o,s,a,r,h,l=t.length,c=0;for(i=0;l>i;i++)s=t[i],0!=i?(o=s,o instanceof fn&&(o=o._as),o instanceof Array?(a=Ze.calculateCurveLength(n,o,1),n=o[o.length-1]):(h=s.y-n.y,r=s.x-n.x,a=Math.sqrt(r*r+h*h),n=o),c+=a):n=s;return c},toDegrees:function(t){return 180*t/Math.PI},toRadians:function(t){return t/180*Math.PI},getRadiansBetweenLines:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},getAngle:function(t,e){return t.x===e.x?e.y===t.y?0:e.y>t.y?Math.PI/2:-Math.PI/2:Math.atan((e.y-t.y)/(e.x-t.x))}};Oe.math=Ze;var Ge={getPoints:function(t){var e=new fn;return t.forEach(function(t){e.add({x:t.x,y:t.y}),e.add({x:t.x+t.width,y:t.y+t.height}),e.add({x:t.x+t.width,y:t.y}),e.add({x:t.x,y:t.y+t.height})}),e},rectangle:function(t){var e;return t.forEach(function(t){e=Ze.unionRect(e,t)}),e},oval:function(t){var e=Ge.rectangle(t),i=0,n=e.height/e.width,o=n*n,s=e.x+e.width/2,a=e.y+e.height/2,r=Ge.getPoints(t);r.forEach(function(t){var e=t.x-s,n=t.y-a,r=e*e+n*n/o;r>i&&(i=r)}),i=Math.sqrt(i);var h=n*i;return{x:s-i,y:a-h,width:2*i,height:2*h}},circle:function(t){var e=Ge.rectangle(t),i=0,n=e.x+e.width/2,o=e.y+e.height/2,s=Ge.getPoints(t);return s.forEach(function(t){var e=t.x-n,s=t.y-o,a=e*e+s*s;a>i&&(i=a)}),i=Math.sqrt(i),{x:n-i,y:o-i,width:2*i,height:2*i}},roundrect:function(t){var e=Ge.rectangle(t),i=Math.min(e.width,e.height)/16;return Ze.grow(e,i,i),e},star:function(t){var e=Ge.rectangle(t);return Ze.grow(e,e.width,e.height),e},triangle:function(t){var e=Ge.rectangle(t);return e.x-=e.width/2,e.width*=2,e.y-=e.height,e.height*=2,e},hexagon:function(t){var e=Ge.rectangle(t);return e.x-=e.width/2,e.width*=2,e},pentagon:function(t){var e=Ge.rectangle(t);return e.x-=e.width/6,e.width+=e.width/3,e.y-=e.height/4,e.height+=e.height/4,e},diamond:function(t){var e=Ge.rectangle(t);return e.x-=e.width/2,e.width+=e.width,e.y-=e.height/2,e.height+=e.height,e},trapezoidal:function(t){var e=Ge.rectangle(t);return e.x-=e.width/2,e.width+=e.width,e.y-=e.height/2,e.height+=e.height,e}};Oe.group=Ge;var Xe={"topleft.topleft":function(t,e){return{x:t.x-e.width,y:t.y-e.height}},"topleft.topright":function(t,e){return{x:t.x,y:t.y-e.height}},"top.top":function(t,e){return{x:t.x+t.width/2-e.width/2,y:t.y-e.height}},"topright.topleft":function(t,e){return{x:t.x+t.width-e.width,y:t.y-e.height}},"topright.topright":function(t,e){return{x:t.x+t.width,y:t.y-e.height}},topleft:function(t,e){return{x:t.x-e.width/2,y:t.y-e.height/2}},top:function(t,e){return{x:t.x-e.width/2+t.width/2,y:t.y-e.height/2}},topright:function(t,e){return{x:t.x-e.width/2+t.width,y:t.y-e.height/2}},"topleft.bottomleft":function(t,e){return{x:t.x-e.width,y:t.y}},"topleft.bottomright":function(t,e){return{x:t.x,y:t.y}},"top.bottom":function(t,e){return{x:t.x+t.width/2-e.width/2,y:t.y}},"topright.bottomleft":function(t,e){return{x:t.x-e.width+t.width,y:t.y}},"topright.bottomright":function(t,e){return{x:t.x+t.width,y:t.y}},"left.left":function(t,e){return{x:t.x-e.width,y:t.y+t.height/2-e.height/2}},left:function(t,e){return{x:t.x-e.width/2,y:t.y+t.height/2-e.height/2}},"left.right":function(t,e){return{x:t.x,y:t.y+t.height/2-e.height/2}},center:function(t,e){return{x:t.x+t.width/2-e.width/2,y:t.y+t.height/2-e.height/2}},"right.left":function(t,e){return{x:t.x+t.width-e.width,y:t.y+t.height/2-e.height/2}},right:function(t,e){return{x:t.x+t.width-e.width/2,y:t.y+t.height/2-e.height/2}},"right.right":function(t,e){return{x:t.x+t.width,y:t.y+t.height/2-e.height/2}},"bottomleft.topleft":function(t,e){return{x:t.x-e.width,y:t.y+t.height-e.height}},"bottomleft.topright":function(t,e){return{x:t.x,y:t.y+t.height-e.height}},"bottom.top":function(t,e){return{x:t.x+t.width/2-e.width/2,y:t.y+t.height-e.height}},"bottomright.topleft":function(t,e){return{x:t.x+t.width-e.width,y:t.y+t.height-e.height}},"bottomright.topright":function(t,e){return{x:t.x+t.width,y:t.y+t.height-e.height}},bottomleft:function(t,e){return{x:t.x-e.width/2,y:t.y+t.height-e.height/2}},bottom:function(t,e){return{x:t.x+t.width/2-e.width/2,y:t.y+t.height-e.height/2}},bottomright:function(t,e){return{x:t.x+t.width-e.width/2,y:t.y+t.height-e.height/2}},"bottomleft.bottomleft":function(t,e){return{x:t.x-e.width,y:t.y+t.height}},"bottomleft.bottomright":function(t,e){return{x:t.x,y:t.y+t.height}},"bottom.bottom":function(t,e){return{x:t.x+t.width/2-e.width/2,y:t.y+t.height}},"bottomright.bottomleft":function(t,e){return{x:t.x+t.width-e.width,y:t.y+t.height}},"bottomright.bottomright":function(t,e){return{x:t.x+t.width,y:t.y+t.height}},get:function(t,e,i){if(!e)throw"refRect can not be null";i||(i={width:0,height:0});var n=Xe[t];if(n)return n(e,i);throw"Can not resolve '"+t+"' position"}};Oe.position=Xe;var je={preventDefault:function(t){Rn.KEEP_DEFAULT_FUNCTION(t)||(t.preventDefault?t.preventDefault():t.preventManipulation?t.preventManipulation():t.returnValue=!1)},insertAfter:function(t,e){return e?e.parentNode.insertBefore(t,e.nextSibling):t.parentNode.insertBefore(t,t.parentNode.firstChild),t},forEach:function(t,e,i){if(je.isVisible(t)){for(var n=t.childNodes.length,o=0;n>o;o++)je.forEach(t.childNodes[o],e,i);i?e.call(i,t):e(t)}},setVisible:function(t,e){t.style.display=e?"block":"none"},isVisible:function(t){return"style"in t&&"none"!==t.style.display},release:function(t){for(var e=t.childNodes.length,i=0;e>i;i++)je.release(t.childNodes[i]);e>0&&je.clear(t),t._pool&&t._pool.release(t)},clear:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},setZoom:function(t,e){var i=t.style;if(i.setProperty)if(He.isFirefox)i.setProperty("-moz-transform","scale("+e+")",null),i.setProperty("-moz-transform-origin","0 0",null);else if(He.isOpera)i.setProperty("-o-transform","scale("+e+")",null),i.setProperty("-o-transform-origin","0 0",null);else if(He.isChrome||He.isSafari){i.setProperty("-webkit-transform","scale("+e+")",null),i.setProperty("-webkit-transform-origin","0 0",null);var n=null;t._webkitInvaildateDiv?n=t._webkitInvaildateDiv:(n=Ve.createElement("div"),t._webkitInvaildateDiv=n),n.parentNode&&n.parentNode==t?t.removeChild(n):t.appendChild(n)}else He.isIE?(i.setProperty("-ms-transform","scale("+e+")",null),i.setProperty("-ms-transform-origin","0 0",null)):(i.setProperty("transform","scale("+e+")",null),i.setProperty("transform-origin","0 0",null))},setRotate:function(t,e){var i=t.style;if(i.setProperty)if(He.isFirefox)i.setProperty("-moz-transform","scale("+e+")",null),i.setProperty("-moz-transform-origin","0 0",null);else if(He.isOpera)i.setProperty("-o-transform","scale("+e+")",null),i.setProperty("-o-transform-origin","0 0",null);else if(He.isChrome||He.isSafari){i.setProperty("-webkit-transform","scale("+e+")",null),i.setProperty("-webkit-transform-origin","0 0",null);var n=null;t._webkitInvaildateDiv?n=t._webkitInvaildateDiv:(n=Ve.createElement("div"),t._webkitInvaildateDiv=n),n.parentNode&&n.parentNode==t?t.removeChild(n):t.appendChild(n)}else He.isIE?(i.setProperty("-ms-transform","scale("+e+")",null),i.setProperty("-ms-transform-origin","0 0",null)):(i.setProperty("transform","scale("+e+")",null),i.setProperty("transform-origin","0 0",null))},setCSSStyle:function(t,e,i){t.style.setProperty(e,i,null)},removeCSSStyle:function(t,e){t.style.removeProperty(e)},getCSSStyle:function(t,e){return t.style.getPropertyValue(e)},setBorderRaidus:function(t,e){He.isFirefox?t.style.MozBorderRadius=e:t.style.borderRadius=e},createSelect:function(t,e){var i,n,o,s=Ve.createElement("select");if(Array.isArray(t))for(i=0;i<t.length;i++)n=t[i],o=Ve.createElement("option"),o.innerHTML=n,o.setAttribute("value",n),n===e&&o.setAttribute("selected","true"),s.appendChild(o);else for(i=0;i<t.values.length;i++)n=t.values[i],o=Ve.createElement("option"),o.innerHTML=t.map[n],o.setAttribute("value",n),n===e&&o.setAttribute("selected","true"),s.appendChild(o);return s},createImg:function(t){var e=Ve.createElement("img");return e.style.position="absolute","string"==typeof t&&e.setAttribute("src",t),e},createView:function(t,e){var i=Ve.createElement("div");return i.style.position=Rn.VIEW_POSITION,i.style.fontSize=Rn.VIEW_FONT_SIZE,i.style.fontFamily=Rn.VIEW_FONT_FAMILY,i.style.cursor="default",i.style.outline="none",i.style.textAlign="left",i.style.msTouchAction="none",i.style.touchAction="none",i.tabIndex=0,e||(i.onmousedown=je.preventDefault),i.style.setProperty&&(i.style.setProperty("-khtml-user-select","none",null),i.style.setProperty("-webkit-user-select","none",null),i.style.setProperty("-moz-user-select","none",null),i.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null)),t&&(i.style.overflow=t),i},createDiv:function(){var t=Ve.createElement("div");return t.style.position="absolute",t.style.msTouchAction="none",t.style.touchAction="none",t},createCanvas:function(t,e){if(t=t||0,e=e||0,ze){var i=require("canvas");return new i(t,e)}var n=Ve.createElement("canvas");return n.style.position="absolute",n.style.msTouchAction="none",n.style.touchAction="none",n.width=t,n.height=e,n},setCanvas:function(t,e,i,n,o){2===arguments.length&&(i=e.y,n=e.width,o=e.height,e=e.x),t.style.left=e+"px",t.style.top=i+"px",t.setAttribute("width",n),t.setAttribute("height",o),t._viewRect={x:e,y:i,width:n,height:o};var s=t.getContext("2d");return 0!==s.shadowBlur&&(s.shadowOffsetX=0,s.shadowOffsetY=0,s.shadowBlur=0,s.shadowColor="rgba(0,0,0,0.0)"),s.clearRect(0,0,n,o),s.translate(-e,-i),s},setImg:function(t,e,i){t.setAttribute("src",e),t.style.left=i.x+"px",t.style.top=i.y+"px",t.style.width=i.width+"px",t.style.height=i.height+"px",t._viewRect=Oe.clone(i)},setDiv:function(t,e,i,n,o){n=Oe.num(n)?n:0,t.style.left=e.x-n+"px",t.style.top=e.y-n+"px",t.style.width=e.width+"px",t.style.height=e.height+"px",t._viewRect=Oe.clone(e),t.style.backgroundColor=i?i:"",t.style.border=n>0?n+"px "+o+" solid":""},changeTypeForMS:function(e){var i=e;if(0===e.indexOf("MSPointer")||0===e.indexOf("pointer")){var n;0===e.indexOf("MSPointer")?(n=e.substring(9,10).toLowerCase(),n+=e.substring(10)):n=e.substring(7,8),t.MSPointerEvent?i="MSPointer"+n.substring(0,1).toUpperCase()+n.substring(1):t.PointerEvent&&(i="pointer"+n)}return i},addEventListener:function(t,e,i,n){t=this.changeTypeForMS(t);var o="_"+t+"_";if(!n[o]){var s=function(t){s.instance[s.method](t)};s.method=e,s.instance=n,n[o]=s,i.addEventListener(t,s,!1)}},removeEventListener:function(t,e,i){t=this.changeTypeForMS(t);var n="_"+t+"_",o=i[n];o&&(e.removeEventListener(t,o,!1),delete i[n])},isValidEvent:function(t,e){if(!e)return!1;if(e.target===t)if(He.isFirefox){if(t.clientHeight<t.scrollHeight&&e.layerX<25)return!1;if(t.clientWidth<t.scrollWidth&&e.layerY<25)return!1}else if(e.offsetX>t.clientWidth||e.offsetY>t.clientHeight)return!1;return!0},getLogicalPoint:function(t,e,i,n){i=i?i:1;var o,s=t.getBoundingClientRect();if(He.isTouchable&&e.changedTouches&&e.changedTouches.length>0){var a=e.changedTouches[0],r=He.isAndroid?0:bi.scrollLeft(),h=He.isAndroid?0:bi.scrollTop();o={x:(a.clientX+t.scrollLeft-s.left-r)/i,y:(a.clientY+t.scrollTop-s.top-h)/i}}else{if(!je.isValidEvent(t,e))return null;o={x:(e.clientX-s.left+t.scrollLeft)/i,y:(e.clientY-s.top+t.scrollTop)/i}}return o},handle_mousedown:function(e,i){je.target&&je.handle_mouseup(i),t.addEventListener("mousemove",je.handle_mousemove,!1),t.addEventListener("mouseup",je.handle_mouseup,!1),je.target=e},handle_mousemove:function(t){je.target.handle_mousemove&&je.target.handle_mousemove(t),je.target.handleMouseMove&&je.target.handleMouseMove(t)},handle_mouseup:function(e){je.target.handle_mouseup&&je.target.handle_mouseup(e),je.target.handleMouseUp&&je.target.handleMouseUp(e),t.removeEventListener("mousemove",je.handle_mousemove,!1),t.removeEventListener("mouseup",je.handle_mouseup,!1),delete je.target},getClientPoint:function(t){return{x:t.clientX,y:t.clientY}},windowWidth:function(){return"number"==typeof t.innerWidth?t.innerWidth:Ve.documentElement&&Ve.documentElement.clientWidth?Ve.documentElement.clientWidth:Ve.body&&Ve.body.clientWidth?Ve.body.clientWidth:0},windowHeight:function(){return"number"==typeof t.innerHeight?t.innerHeight:Ve.documentElement&&Ve.documentElement.clientHeight?Ve.documentElement.clientHeight:Ve.body&&Ve.body.clientHeight?Ve.body.clientHeight:0}};Oe.html=je;var Ke={cache:{},g:je.createCanvas().getContext("2d"),getTextSize:function(t,e){Ke.g.font=t?t:Rn.FONT;var i=Ke.cache[Ke.g.font];i||(i=2*Ke.g.measureText("e").width+4,Ke.cache[Ke.g.font]=i),e=e||"",e=String(e);for(var n,o=e.split("\n"),s=o.length,a=0,r=s-1;r>=0;r--)n=Ke.g.measureText(o[r]).width,n>a&&(a=n);return{width:a+4,height:i*s}},getSubStringInLength:function(t,e,i){var n=this,o=function(t,e,i,s,a){if(t>=e)return s.substring(0,t+1);var r=Math.floor((t+e)/2),h=s.substring(0,r+1),l=n.getTextSize(i,h).width;if(l>a)return o(t,r-1,i,s,a);var c=r+1,d=s.substring(0,c+1),u=n.getTextSize(i,d).width;return u>a?h:o(c,e,i,s,a)},s=this.getTextSize(t,e).width;return s>i?o(0,e.length-1,t,e,i):e},getCollapseTextInLength:function(t,e,i){var n=this.getTextSize(t,e).width;if(n>i){for(var o=0,s="",a=e,r=n;r>i;){var h=this.getSubStringInLength(t,a,i);s=s+h+"\n",o+=h.length,a=e.substring(o),r=this.getTextSize(t,a).width}return s+a}return e},drawText:function(t,i,n,o,s,a){i=i||"",i=String(i),o||(o=Rn.FONT);var r="center";a&&(r=a),t.font=o,t.fillStyle=s,t.textAlign=r,t.textBaseline="middle";var h,l,c=i.split("\n"),d=c.length,u=0;n?n.width===e?(h=n.x,l=n.y):(u=n.height/d,"left"==r?h=n.x:"center"==r&&(h=n.x+n.width/2),l=n.y+u/2):(h=0,l=0),He.isOpera&&(l-=2);for(var _=0;d>_;_++)"right"==r&&(t.textAlign="left",h=n.x+n.width-Ke.getTextSize(o,c[_]).width),t.fillText(c[_],h,l),l+=u},drawArc:function(t,e,i,n,o,s,a,r){var h,l,c,d,u,_,g,f,v,m,p;if(Math.abs(o)>2*Math.PI&&(o=2*Math.PI),u=Math.ceil(Math.abs(o)/(Math.PI/4)),h=o/u,l=-h,c=-n,u>0){_=e+Math.cos(n)*s,g=i+Math.sin(-n)*a,r?t.lineTo(_,g):t.moveTo(_,g);for(var y=0;u>y;y++)c+=l,d=c-l/2,f=e+Math.cos(c)*s,v=i+Math.sin(c)*a,m=e+Math.cos(d)*(s/Math.cos(l/2)),p=i+Math.sin(d)*(a/Math.cos(l/2)),t.quadraticCurveTo(m,p,f,v)}},dashedLine:function(t,e,i,n,o,s,a){var r=s-n,h=a-o,l=Math.sqrt(r*r+h*h);if(0!=l){r/=l,h/=l;for(var c=l,d=-i.offset,u=i.drawing,_=i.patternIndex;c>d;)d+=e[_],d>=c&&(i.offset=e[_]-(d-c),i.patternIndex=_,i.drawing=u,d=c),u?t.lineTo(n+d*r,o+d*h):t.moveTo(n+d*r,o+d*h),u=!u,_=(_+1)%e.length}},drawLinePoints:function(t,e,i,n,o){var s,a,r,h,l,c,d=0,u=0,_=e.size();if(c=i&&i.length>0?new Ai(t,i[0],i.length>1?i[1]:i[0]):t,n)for(u=0,l=n.size();l>u;u++)if(s=n.get(u),"moveto"===s&&_>d)a=e.get(d++),c.moveTo(a.x,a.y);else if("lineto"===s&&_>d)a=e.get(d++),c.lineTo(a.x,a.y);else if("cubicto"===s&&_-2>d)a=e.get(d++),r=e.get(d++),h=e.get(d++),c.bezierCurveTo(a.x,a.y,r.x,r.y,h.x,h.y);else{if(!("quadto"===s&&_-1>d))throw"Can not resolve segment '"+s+"'";a=e.get(d++),r=e.get(d++),c.quadraticCurveTo(a.x,a.y,r.x,r.y)}else this._drawLine(e,c);o&&c.closePath()},_drawLine:function(t,e){var i,n,o,s,a,r=0,h=t.size();for(i=t.get(0),e.moveTo(i.x,i.y),r=1;h>r;r++)a=t.get(r),a.size?(s=a.size(),2===s?(i=a.get(0),n=a.get(1),e.quadraticCurveTo(i.x,i.y,n.x,n.y)):3===s&&(i=a.get(0),n=a.get(1),o=a.get(2),e.bezierCurveTo(i.x,i.y,n.x,n.y,o.x,o.y))):e.lineTo(a.x,a.y)},drawRoundRect:function(t,e,i,n,o,s,a,r,h){6===arguments.length&&(a=s,r=s,h=s);var l=e+n,c=i+o,d=o>n?2*n:2*o;s=d>s?s:d,a=d>a?a:d,r=d>r?r:d,h=d>h?h:d;var u=.292893218813453*h,_=.585786437626905*h;t.moveTo(l,c-h),t.quadraticCurveTo(l,c-_,l-u,c-u),t.quadraticCurveTo(l-_,c,l-h,c),u=.292893218813453*r,_=.585786437626905*r,t.lineTo(e+r,c),t.quadraticCurveTo(e+_,c,e+u,c-u),t.quadraticCurveTo(e,c-_,e,c-r),u=.292893218813453*s,_=.585786437626905*s,t.lineTo(e,i+s),t.quadraticCurveTo(e,i+_,e+u,i+u),t.quadraticCurveTo(e+_,i,e+s,i),u=.292893218813453*a,_=.585786437626905*a,t.lineTo(l-a,i),t.quadraticCurveTo(l-_,i,l-u,i+u),t.quadraticCurveTo(l,i+_,l,i+a),t.lineTo(l,c-h)},drawVector:function(t,e,i,n,o,s,a){var r;4===arguments.length?(o=n.y,s=n.width,a=n.height,n=n.x):5===arguments.length&&"roundrect"===e&&(r={},r.topLeft=o,r.topRight=o,r.bottomLeft=o,r.bottomRight=o,o=n.y,s=n.width,a=n.height,n=n.x);var h=Ke["_"+e];h&&(t.beginPath(),i&&i.length>0&&(t=new Ai(t,i[0],i.length>1?i[1]:i[0])),5===arguments.length&&"roundrect"===e?h(t,{x:n,y:o,width:s,height:a},r):h(t,n,o,s,a))},_rectangle:function(t,e,i,n,o){t.rect(e,i,n,o)},_circle:function(t,e,i,n,o){var s=e+n/2,a=i+o/2,r=Math.min(n,o)/2;t instanceof Ai?Ke.drawArc(t,s,a,0,2*Math.PI,r,r,!1):t.arc(s,a,r,0,2*Math.PI,!0)},_oval:function(t,e,i,n,o){if(t instanceof Ai)Ke.drawArc(t,e+n/2,i+o/2,0,2*Math.PI,n/2,o/2,!1);else{var s=.5522848,a=n/2*s,r=o/2*s,h=e+n,l=i+o,c=e+n/2,d=i+o/2;t.moveTo(e,d),t.bezierCurveTo(e,d-r,c-a,i,c,i),t.bezierCurveTo(c+a,i,h,d-r,h,d),t.bezierCurveTo(h,d+r,c+a,l,c,l),t.bezierCurveTo(c-a,l,e,d+r,e,d)}},_roundrect:function(t,e,i,n,o){if(3===arguments.length){var s=i;i=e.y,n=e.width,o=e.height,e=e.x,s.topLeft?Ke.drawRoundRect(t,e,i,n,o,s.topLeft):Ke.drawRoundRect(t,e,i,n,o,Math.min(Math.min(n,o)/4,10))}else Ke.drawRoundRect(t,e,i,n,o,Math.min(Math.min(n,o)/4,10))},_star:function(t,e,i,n,o){var s=2*n,a=2*o,r=e+n/2,h=i+o/2;t.moveTo(r-s/4,h-a/12),t.lineTo(e+.306*n,i+.579*o),t.lineTo(r-s/6,h+a/4),t.lineTo(e+n/2,i+.733*o),t.lineTo(r+s/6,h+a/4),t.lineTo(e+.693*n,i+.579*o),t.lineTo(r+s/4,h-a/12),t.lineTo(e+.611*n,i+.332*o),t.lineTo(r+0,h-a/4),t.lineTo(e+.388*n,i+.332*o),t.closePath()},_triangle:function(t,e,i,n,o){t.moveTo(e+n/2,i),t.lineTo(e+n,i+o),t.lineTo(e,i+o),t.closePath()},_hexagon:function(t,e,i,n,o){t.moveTo(e,i+o/2),t.lineTo(e+n/4,i+o),t.lineTo(e+3*n/4,+i+o),t.lineTo(e+n,i+o/2),t.lineTo(e+3*n/4,i),t.lineTo(e+n/4,i),t.closePath()},_pentagon:function(t,e,i,n,o){var s=2*n,a=2*o,r=e+n/2,h=i+o/2;t.moveTo(r-s/4,h-a/12),t.lineTo(r-s/6,h+a/4),t.lineTo(r+s/6,h+a/4),t.lineTo(r+s/4,h-a/12),t.lineTo(r+0,h-a/4),t.closePath()},_trapezoidal:function(t,e,i,n,o){t.moveTo(e+n/4,i),t.lineTo(e,i+o),t.lineTo(e+n,i+o),t.lineTo(e+3*n/4,i),t.closePath()},_diamond:function(t,e,i,n,o){t.moveTo(e+n/2,i),t.lineTo(e,i+o/2),t.lineTo(e+n/2,i+o),t.lineTo(e+n,i+o/2),t.closePath()},fill:function(t,e,i,n,o,s,a,r){var h=Je[i];t.fillStyle=h?5===arguments.length?h(t,e,n,o.x,o.y,o.width,o.height):h(t,e,n,o,s,a,r):e},createRadialGradient:function(t,e,i,n,o,s,a,r,h){var l=t.createRadialGradient(n+s*r,o+a*h,Math.min(s,a)/24,n+s/2,o+a/2,Math.max(s,a)/2);return l.addColorStop(0,i),l.addColorStop(1,e),l},drawPath:function(t,e,i,n,o,s,a,r){var h=t._element,l=t.getBodyRect();n&&Ze.addPadding(l,h,i+".padding",1);var c=Oe.clone(l),d=h.getStyle(i+".outline.width");d>0&&Ze.grow(c,d/2,d/2);var u=t.setShadow(t,e,c);0!=h.getAngle()&&(h instanceof Un||(l=h.getOriginalRect()),Me.Util.rotateCanvas(u,l,h.getAngle()));var _,g=h.getStyle(i+".fill");if(g){_=t._innerColor&&!xi.hasDefault(t._element)?t._innerColor:h.getStyle(i+".fill.color");var f=h.getStyle(i+".gradient");f?Ke.fill(u,_,f,h.getStyle(i+".gradient.color"),l):u.fillStyle=_}var v=h.getStyle(i+".shape"),m=h.getStyle("group.shape.roundrect.radius");return g&&(u.beginPath(),s?Ke.drawLinePoints(u,s,null,a,r):"roundrect"===v&&"group"===i?Ke.drawVector(u,v,null,l,m):Ke.drawVector(u,v,null,l),u.fill()),d>0&&(u.lineWidth=d,u.lineCap=h.getStyle(i+".cap"),u.lineJoin=h.getStyle(i+".join"),u.strokeStyle=h.getStyle(i+".outline.color"),u.beginPath(),s?Ke.drawLinePoints(u,s,o,a,r):"roundrect"===v&&"group"===i?Ke.drawVector(u,v,o,l,m):Ke.drawVector(u,v,o,l),u.stroke()),c},draw3DRect:function(t,e,i,n,o,s,a){if(0!==i){arguments.length<=4&&(a=n.height,s=n.width,o=n.y,n=n.x);var r=i>0;i=Math.abs(i);var h,l;if(t.lineWidth=1,t.lineCap="square",1===i)h=Ke.brighter(e),l=Ke.darker(e),t.strokeStyle=r?h:l,t.beginPath(),t.moveTo(n,o),t.lineTo(n,o+a),t.moveTo(n,o),t.lineTo(n+s,o),t.closePath(),t.stroke(),t.strokeStyle=r?l:h,t.beginPath(),t.moveTo(n,o+a),t.lineTo(n+s,o+a),t.moveTo(n+s,o),t.lineTo(n+s,o+a),t.closePath(),t.stroke();else for(var c=2*i,d=50/c,u=0;c>u;u++)h=Ke.brighter(e,50-u*d),l=Ke.darker(e,50-u*d),n+=.5,o+=.5,s-=1,a-=1,t.strokeStyle=r?h:l,t.beginPath(),t.moveTo(n,o),t.lineTo(n,o+a),t.moveTo(n,o),t.lineTo(n+s,o),t.closePath(),t.stroke(),t.strokeStyle=r?l:h,t.beginPath(),t.moveTo(n,o+a),t.lineTo(n+s,o+a),t.moveTo(n+s,o),t.lineTo(n+s,o+a),t.closePath(),t.stroke()}},brighter:function(t,e){return e||(e=50),Ke.adjustBrightness2(t,e)},darker:function(t,e){return e||(e=50),Ke.adjustBrightness2(t,-e)},adjustBrightness2:function(t,e){var i,n,o;if(0===e)return t;var s=wn(t);return 0>e?(e=(100+e)/100,i=Math.ceil(s.r*e),n=Math.ceil(s.g*e),o=Math.ceil(s.b*e)):(e/=100,i=s.r,n=s.g,o=s.b,i+=(255-i)*e,n+=(255-n)*e,o+=(255-o)*e,i=Math.min(Math.ceil(i),255),n=Math.min(Math.ceil(n),255),o=Math.min(Math.ceil(o),255)),"rgba("+i+","+n+","+o+",1)"},getColorArray:function(t){return yn.clearRect(0,0,1,1),yn.fillStyle=t,yn.fillRect(0,0,1,1),yn.getImageData(0,0,1,1).data},hit:function(t,e,i,n){if(!t)return!1;var o=t._viewRect;if(!o)return!1;if(e-=o.x,i-=o.y,0>e||0>i||e>=o.width||i>=o.height)return!1;try{for(var s=t.getContext("2d").getImageData(e,i,1,1),a=s.data,r=0,h=a.length;h>r;r+=4)if(0!==a[r+3])return!0}catch(t){return!0}return!1},intersects:function(t,e){if(!t)return!1;if(e=Ze.intersection(e,t._viewRect),!e)return!1;e.x-=t._viewRect.x,e.y-=t._viewRect.y;try{for(var i=t.getContext("2d").getImageData(e.x,e.y,e.width,e.height),n=i.data,o=0,s=n.length;s>o;o+=4)if(0!==n[o+3])return!0}catch(t){}return!1},strokeRect:function(t,e,i,n){e&&(t.beginPath(),t.strokeStyle=i?i:Me.Util.randomColor(),t.lineWidth=n?n:2,t.strokeRect(e.x,e.y,e.width,e.height),t.stroke())}};Oe.g=Ke;var Je={"linear.southwest":function(t,e,i,n,o,s,a){var r=t.createLinearGradient(n,o+a,n+s,o);return r.addColorStop(0,i),r.addColorStop(1,e),r},"linear.southeast":function(t,e,i,n,o,s,a){var r=t.createLinearGradient(n+s,o+a,n,o);return r.addColorStop(0,i),r.addColorStop(1,e),r},"linear.northwest":function(t,e,i,n,o,s,a){var r=t.createLinearGradient(n+s,o+a,n,o);return r.addColorStop(0,e),r.addColorStop(1,i),r},"linear.northeast":function(t,e,i,n,o,s,a){var r=t.createLinearGradient(n+s,o,n,o+a);return r.addColorStop(0,i),r.addColorStop(1,e),r},"linear.north":function(t,e,i,n,o,s,a){var r=t.createLinearGradient(n,o,n,o+a);return r.addColorStop(0,i),r.addColorStop(1,e),r},"linear.south":function(t,e,i,n,o,s,a){var r=t.createLinearGradient(n,o,n,o+a);return r.addColorStop(0,e),r.addColorStop(1,i),r},"linear.west":function(t,e,i,n,o,s,a){var r=t.createLinearGradient(n,o,n+s,o);return r.addColorStop(0,i),r.addColorStop(1,e),r},"linear.east":function(t,e,i,n,o,s,a){var r=t.createLinearGradient(n,o,n+s,o);return r.addColorStop(0,e),r.addColorStop(1,i),r},"radial.center":function(t,e,i,n,o,s,a){return Ke.createRadialGradient(t,e,i,n,o,s,a,.5,.5)},"radial.southwest":function(t,e,i,n,o,s,a){return Ke.createRadialGradient(t,e,i,n,o,s,a,.25,.75)},"radial.southeast":function(t,e,i,n,o,s,a){return Ke.createRadialGradient(t,e,i,n,o,s,a,.75,.75)},"radial.northwest":function(t,e,i,n,o,s,a){return Ke.createRadialGradient(t,e,i,n,o,s,a,.25,.25)},"radial.northeast":function(t,e,i,n,o,s,a){return Ke.createRadialGradient(t,e,i,n,o,s,a,.75,.25)},"radial.north":function(t,e,i,n,o,s,a){return Ke.createRadialGradient(t,e,i,n,o,s,a,.5,.25)},"radial.south":function(t,e,i,n,o,s,a){return Ke.createRadialGradient(t,e,i,n,o,s,a,.5,.75)},"radial.west":function(t,e,i,n,o,s,a){return Ke.createRadialGradient(t,e,i,n,o,s,a,.25,.5)},"radial.east":function(t,e,i,n,o,s,a){return Ke.createRadialGradient(t,e,i,n,o,s,a,.75,.5)},"spread.horizontal":function(t,e,i,n,o,s,a){var r=t.createLinearGradient(n,o,n+s,o);return r.addColorStop(0,e),r.addColorStop(.5,i),r.addColorStop(1,e),r},"spread.vertical":function(t,e,i,n,o,s,a){var r=t.createLinearGradient(n,o,n,o+a);return r.addColorStop(0,e),r.addColorStop(.5,i),r.addColorStop(1,e),r},"spread.diagonal":function(t,e,i,n,o,s,a){var r=t.createLinearGradient(n+s,o,n,o+a);return r.addColorStop(0,e),r.addColorStop(.5,i),r.addColorStop(1,e),r},"spread.antidiagonal":function(t,e,i,n,o,s,a){var r=t.createLinearGradient(n,o,n+s,o+a);return r.addColorStop(0,e),r.addColorStop(.5,i),r.addColorStop(1,e),r},"spread.north":function(t,e,i,n,o,s,a){var r=t.createLinearGradient(n,o-a/4,n,o+a+a/4);return r.addColorStop(0,e),r.addColorStop(1/3,i),r.addColorStop(2/3,e),r.addColorStop(1,i),r},"spread.south":function(t,e,i,n,o,s,a){var r=t.createLinearGradient(n,o-a/4,n,o+a+a/4);return r.addColorStop(0,i),r.addColorStop(1/3,e),r.addColorStop(2/3,i),r.addColorStop(1,e),r},"spread.west":function(t,e,i,n,o,s,a){var r=t.createLinearGradient(n-s/4,o,n+s+s/4,o);return r.addColorStop(0,e),r.addColorStop(1/3,i),r.addColorStop(2/3,e),r.addColorStop(1,i),r},"spread.east":function(t,e,i,n,o,s,a){var r=t.createLinearGradient(n-s/4,o,n+s+s/4,o);return r.addColorStop(0,i),r.addColorStop(1/3,e),r.addColorStop(2/3,i),r.addColorStop(1,e),r}};Me.Util={getVersion:function(){var t=["\n %c %c %c twaver.js 5.5.9 - ✰ HTML5 ✰  %c  %c  http://servasoft.com/ %c %c ♥%c♥%c♥ \n\n","background: rgb(190,96,42); padding:5px 0;","background: rgb(190,96,42); padding:5px 0;","color: rgb(190,96,42); background: #030307; padding:5px 0;","background: rgb(190,96,42); padding:5px 0;","background: rgb(160,200,225); color: rgb(190,96,42);padding:5px 0;","background: rgb(190,96,42); padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];return console.log.apply(console,t),"5.6.3"},registerImage:function(t,e,i,n,o){Oe.registerImage(t,e,i,n,o)},registerImageByUrl:function(t,e,i,n){if(e&&t&&t.indexOf(".json")>0){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){var t=JSON.parse(o.responseText);Me.Util.registerImage(e,t),i&&i.invalidateElementUIs(),n&&n()}},o.open("GET",t,!0),o.send()}else{var s=new Ue;s.src=t,s.onload=function(){Me.Util.registerImage(e,s,s.width,s.height),s.onload=null,i&&i.invalidateElementUIs(),n&&n()}}},getRegisteredImageNames:function(){return Oe.getRegisteredImageNames()},unregisterImage:function(t){Oe.unregisterImage(t)},getImageAsset:function(t){return Oe.getImageAsset(t)},validateLicense:function(t){Oe.validateLicense(t)},getLicense:function(){return Be},isPermissionGIS:function(){return wi()},moveElements:function(t,e,i,n,o,s){if((0!==e||0!==i)&&t&&!t.isEmpty()){var a,r,h=Me.animate.AnimateManager;h.endAnimate(),t=xi.filterMovingElements(t),n&&(a=new fn,r=new fn),t.forEach(function(t){t instanceof Fn&&(n?(a.add(t),r.add({x:t.getX()+e,y:t.getY()+i})):t.translate(e,i))}),n?h.start(new Me.animate.AnimateLocation(a,r,o)):o&&o()}},isTypeOf:function(t,e){if(t===e)return!0;for(var i=t.superClass;i;){if(i===e.prototype)return!0;i=i.constructor.superClass}return!1},setFocus:function(t){if(Ve.activeElement!==t){var e,i,n,o=Ve.documentElement,s=Ve.body;o&&(He.isIE||He.isOpera||o.scrollLeft||o.scrollTop)?(e=o.scrollLeft,i=o.scrollTop,n=o):s&&(e=s.scrollLeft,i=s.scrollTop,n=s),t.focus(),n&&(n.scrollLeft=e,n.scrollTop=i)}},isOpera:He.isOpera,isIE:He.isIE,isFirefox:He.isFirefox,isChrome:He.isChrome,isSafari:He.isSafari,isIPhone:He.isIPhone,isIPod:He.isIPod,isIPad:He.isIPad,isAndroid:He.isAndroid,isWebOS:He.isWebOS,isTouchable:He.isTouchable,ext:function(t,e,i){Oe.ext(t,e,i)},getValue:function(t,e,i){return Oe.getValue(t,e,i)},setValue:function(t,e,i){Oe.setValue(t,e,i)},grow:function(t,e,i){Ze.grow(t,e,i)},containsPoint:function(t,e,i){return Ze.containsPoint.apply(null,arguments)},intersects:function(t,e){return Ze.intersects(t,e)},getRect:function(t){return Ze.getRect(t)},unionRect:function(t,e){return Ze.unionRect(t,e)},createDiv:function(){return je.createDiv()},createCanvas:function(){return je.createCanvas()},setCanvas:function(t,e,i,n,o){return je.setCanvas.apply(null,arguments)},drawVector:function(t,e,i,n,o,s,a){Ke.drawVector.apply(null,arguments)},fill:function(t,e,i,n,o,s,a,r){Ke.fill.apply(null,arguments)},getClass:function(t){return Oe.getClass(t)},getAllClassNames:function(){var t,e=[];for(t in Oe.classCache)e.push(t);return e},newInstance:function(t){return Oe.newInstance.apply(null,arguments)},isDeserializing:function(){return Oe.isDeserializing},addEventListener:function(t,e,i,n){je.addEventListener(t,e,i,n)},removeEventListener:function(t,e,i){je.removeEventListener(t,e,i)},drawArrow:function(t,e,i,n,o,s,a,r,h,l,c,d,u){vn.drawArrow.apply(null,arguments)},calculatePointAngleAlongLine:function(t,e,i,n,o){return Ze.calculatePointInfoAlongLineBySegments(t,e,i,n,o)},getSubNetwork:function(t){return xi.getSubNetwork(t)},transformPoint:function(t,e,i,n){return Ze.transformPoint(t,e,i,n)},getToolTipDiv:function(){return Si.getToolTipDiv()},showToolTip:function(t,e){Si.showToolTip(t,e)},hideToolTip:function(){Si.hideToolTip()},resetToolTip:function(){Si.resetToolTip()},setCSSStyle:function(t,e,i){je.setCSSStyle(t,e,i)},removeCSSStyle:function(t,e){je.removeCSSStyle(t,e)},getCSSStyle:function(t,e){return je.getCSSStyle(t,e)},toDegrees:function(t){return Ze.toDegrees(t)},toRadians:function(t){return Ze.toDegrees(t)},getRadiansBetweenLines:function(t,e){return Ze.getRadiansBetweenLines(t,e)},getElementsBounds:function(t,e){var i=null;return t.forEach(function(t){if(t.getRect){var n,o;e&&(o=e.getElementUI(t),o&&(n=o.getViewRect())),n||(n=t.getRect()),i=i?Me.Util.unionRect(i,n):n}}),i},getPointIndex:function(t,e,i){if(i||(i=10),t)for(var n=t.size();n--;n>=0)if(Ze.getDistance(t.get(n),e)<=i)return n;return-1},registerVectorShape:function(t,e){Oe.g["_"+t]=e},rotateCanvas:function(t,e,i){t.translate(e.x+e.width/2,e.y+e.height/2),t.rotate(i*Math.PI/180),t.translate(-(e.x+e.width/2),-(e.y+e.height/2))},registerShape:function(t,e){rn(t,e)},registerDraw:function(t,e){an(t,e)},getFilterColor:function(t,e){return An(t,e)},registerGifImage:function(t,e){},parseVectorData:function(t){return Pi(t)},getSharedLinks:function(t,e){var i=t.getLinks(),n=e.getLinks();if(i&&0!=i.size()&&n&&0!=n.size()){var o=i.size()>n.size()?i:n;return o.toList(function(i){return i.getFromNode()==t&&i.getToNode()==e||i.getFromNode()==e&&i.getToNode()==t})}return null},isSharedLinks:function(t,e){var i=!1,n=t.getLinks(),o=e.getLinks();if(n&&0!=n.size()&&o&&0!=o.size()){var s=n.size()>o.size()?n:o;s.forEach(function(n){return n.getFromNode()==t&&n.getToNode()==e||n.getFromNode()==e&&n.getToNode()==t?(i=!0,!1):!0})}return i},playAnimate:function(t){return Te(t)},pauseAnimate:function(t){t.pause()},resumeAnimate:function(t){t.resume()},stopAnimate:function(t,e){Ce(t,e)},pauseAllAnimates:function(){ke()},resumeAllAnimates:function(){Se()},stopAllAnimates:function(t){be(t)},randomColor:function(){return"#"+("00000"+(16777216*this.random()<<0).toString(16)).substr(-6)},random:function(){return Math.random()},getHSVColor:function(t,i,n){var o,s,a,r,h,l,c,d;switch(t&&i===e&&n===e&&(i=t.s,n=t.v,t=t.h),r=Math.floor(6*t),h=6*t-r,l=n*(1-i),c=n*(1-h*i),d=n*(1-(1-h)*i),r%6){case 0:o=n,s=d,a=l;break;case 1:o=c,s=n,a=l;break;case 2:o=l,s=n,a=d;break;case 3:o=l,s=c,a=n;break;case 4:o=d,s=l,a=n;break;case 5:o=n,s=l,a=c}var u="#"+toHex(255*o)+toHex(255*s)+toHex(255*a);return u},toHex:function(t){var e=parseInt(t).toString(16);return 1==e.length&&(e="0"+e),e},makeHighRes:function(e){var i=e.getContext("2d"),n=t.devicePixelRatio||1,o=i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1,s=n/o;if(n!==o){var a=e.width,r=e.height;e.width=Math.round(a*s),e.height=Math.round(r*s),e.style.width=a+"px",e.style.height=r+"px",i.scale(s,s)}},newFunction:function(){var t=arguments,e=t.length;return 1===e?Oe.newInstance("Function",t[0]):2===e?Oe.newInstance("Function",t[0],t[1]):3===e?Oe.newInstance("Function",t[0],t[1],t[2]):4===e?Oe.newInstance("Function",t[0],t[1],t[2],t[3]):5===e?Oe.newInstance("Function",t[0],t[1],t[2],t[3],t[4]):6===e?Oe.newInstance("Function",t[0],t[1],t[2],t[3],t[4],t[5]):7===e?Oe.newInstance("Function",t[0],t[1],t[2],t[3],t[4],t[5],t[6]):8===e?Oe.newInstance("Function",t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):null}},Oe.ext("twaver.Util",Object,{});var qe,Qe=0xdeadbeefcafe,$e=15715070==(16777215&Qe);$e&&"Microsoft Internet Explorer"==Fe.appName?(n.prototype.am=a,qe=30):$e&&"Netscape"!=Fe.appName?(n.prototype.am=s,qe=26):(n.prototype.am=r,qe=28),n.prototype.DB=qe,n.prototype.DM=(1<<qe)-1,n.prototype.DV=1<<qe;var ti=52;n.prototype.FV=Math.pow(2,ti),n.prototype.F1=ti-qe,n.prototype.F2=2*qe-ti;var ei,ii,ni="0123456789abcdefghijklmnopqrstuvwxyz",oi=new Array;for(ei="0".charCodeAt(0),ii=0;9>=ii;++ii)oi[ei++]=ii;for(ei="a".charCodeAt(0),ii=10;36>ii;++ii)oi[ei++]=ii;for(ei="A".charCodeAt(0),ii=10;36>ii;++ii)oi[ei++]=ii;L.prototype.convert=P,L.prototype.revert=R,L.prototype.reduce=D,L.prototype.mulTo=M,L.prototype.sqrTo=O,N.prototype.convert=z,N.prototype.revert=F,N.prototype.reduce=V,N.prototype.mulTo=H,N.prototype.sqrTo=U,n.prototype.copyTo=c,n.prototype.fromInt=d,n.prototype.fromString=_,n.prototype.clamp=g,n.prototype.dlShiftTo=A,n.prototype.drShiftTo=x,n.prototype.lShiftTo=E,n.prototype.rShiftTo=T,n.prototype.subTo=C,n.prototype.multiplyTo=b,n.prototype.squareTo=k,n.prototype.divRemTo=S,n.prototype.invDigit=B,n.prototype.isEven=W,n.prototype.exp=Y,n.prototype.toString=f,n.prototype.negate=v,n.prototype.abs=m,n.prototype.compareTo=p,n.prototype.bitLength=w,n.prototype.mod=I,n.prototype.modPowInt=Z,n.ZERO=u(0),n.ONE=u(1),Bt.prototype.convert=Nt,Bt.prototype.revert=Nt,Bt.prototype.mulTo=zt,Bt.prototype.sqrTo=Ft,Wt.prototype.convert=Yt,Wt.prototype.revert=Zt,Wt.prototype.reduce=Gt,Wt.prototype.mulTo=jt,Wt.prototype.sqrTo=Xt;var si=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],ai=(1<<26)/si[si.length-1];n.prototype.chunkSize=J,n.prototype.toRadix=Q,n.prototype.fromRadix=$,n.prototype.fromNumber=tt,n.prototype.bitwiseTo=st,n.prototype.changeBit=xt,n.prototype.addTo=bt,n.prototype.dMultiply=Mt,n.prototype.dAddOffset=Ot,n.prototype.multiplyLowerTo=Ut,n.prototype.multiplyUpperTo=Ht,n.prototype.modInt=qt,n.prototype.millerRabin=te,n.prototype.clone=G,n.prototype.intValue=X,n.prototype.byteValue=j,n.prototype.shortValue=K,n.prototype.signum=q,n.prototype.toByteArray=et,n.prototype.equals=it,n.prototype.min=nt,n.prototype.max=ot,n.prototype.and=rt,n.prototype.or=lt,n.prototype.xor=dt,n.prototype.andNot=_t,n.prototype.not=gt,n.prototype.shiftLeft=ft,n.prototype.shiftRight=vt,n.prototype.getLowestSetBit=pt,n.prototype.bitCount=wt,n.prototype.testBit=At,n.prototype.setBit=Et,n.prototype.clearBit=Tt,n.prototype.flipBit=Ct,n.prototype.add=kt,n.prototype.subtract=St,n.prototype.multiply=It,n.prototype.divide=Pt,n.prototype.remainder=Rt,n.prototype.divideAndRemainder=Dt,n.prototype.modPow=Kt,n.prototype.modInverse=Qt,n.prototype.pow=Vt,n.prototype.gcd=Jt,n.prototype.isProbablePrime=$t,n.prototype.square=Lt,ee.prototype.init=ie,ee.prototype.next=ne;var ri,hi,li,ci=256;if(null==hi){hi=new Array,li=0;var di;if("Netscape"==Fe.appName&&Fe.appVersion<"5"&&t.crypto){var ui=t.crypto.random(32);for(di=0;di<ui.length;++di)hi[li++]=255&ui.charCodeAt(di)}for(;ci>li;)di=Math.floor(65536*Me.Util.random()),hi[li++]=di>>>8,hi[li++]=255&di;li=0,ae()}le.prototype.nextBytes=he;ue.prototype.doPublic=ge,ue.prototype.setPublic=_e,ue.prototype.encrypt=fe,ue.prototype.doPrivate=ye,ue.prototype.setPrivate=me,ue.prototype.setPrivateEx=pe,ue.prototype.decrypt=we;var _i=function(){gi.v(Be)},gi={},fi="6a384c1259bdb5e731ec96b3174683f48a2c56a85e52e7a5bb20b58711ce50c1a294bd5e1d1752e766085e9ae94bae6d217c25dbb5fcdb86a8a9a7e180fa066723d00fcb85fcf7c9d29f8cc8859f53244a49c0bc30dcc45156daf8843ce1d24fe8ebc9a3c186bb26e9d0714041aef160304c1db8cc5728cf4acb39d29755f319",vi="10001",mi="b881f568eb43e7a60c256a8a90e08b7c7638fd66ce3cded9005c72e283ca4f2b8601e2edc687d7f898348a05723b515d9edeb626af7b499a56ddaea93b0c2047";gi.cross=function(t){if(t){for(var e="",i=0;i<t.length;)i+1<t.length?(e+=t[i+1],e+=t[i]):e+=t[i],i+=2;return e}return null},gi.reverse=function(t){if(t){for(var e="",i=t.length;i>0;i--)e+=t[i-1];return e}return null},gi.v=function(t){if(t){var e=gi;if(e.start=null,e.beginDate=null,e.end=null,e.endDate=null,e.gis=null,e["3D"]=null,e["3d"]=null,e.l=null,e.__li__=null,t.indexOf("signature=")>0){var i=t.split("signature="),n=i[0],o=i[1],s=new ue;s.setPublic(fi,vi);for(var a=o,r=a.length,h=256,l=0,c="",d="";r>l;)c=a.substr(l,h),d+=s.decrypt(c),l+=h;if(d===n)return e.i(t),!0}}return!1},gi.i=function(t){var i=gi;i.__li__=t;var n,o,s,a,r,h=t.split("\n");for(n=h.length-1;n>=0;n--)o=h[n],r=o.split("="),s=r[0],a=r[1],i[s]=a;i.start!=e&&(i.beginDate=new Date(Date.parse(i.start.replace(/-/g,"/")))),i.end!=e&&(i.endDate=new Date(Date.parse(i.end.replace(/-/g,"/"))));var l=i.gis;l!=e&&(l=parseInt(l)),l&&(i._isPermissionGIS=!0);var c=i["3D"]||i["3d"];c!=e&&(c=parseInt(c)),c&&(i._isPermission3D=!0),i["3D"]&&(i._isPermission3D=!0),i.l!=e&&(i.version=i.l)};var pi=function(t){return t.__li__!==e&&!t._isPermission3D},yi=function(t){if(!pi(t))return!0;var e=new Date;return null!=t.beginDate&&t.beginDate.getTime()-e.getTime()>=0||null!=t.endDate&&t.endDate.getTime()-e.getTime()<=0},wi=function(){return yi(gi)?!1:gi._isPermissionGIS};gi.$z=function(t){var e=new ue;e.setPublic(fi,vi);for(var i=t,n=i.length,o=256,s=0,a="",r="";n>s;)a=i.substr(s,o),r+=e.decrypt(a),s+=o;return r},gi.twm=function(t){var i=gi,n=i.$z("4cd18113d0c7046bfe51f7a3fbd41c2b7cf14dd785d6ea7cec9da17710d3acfb8ce0cb9cf10839f4bd51e88819de19cdc0db09278584396156fcb65abe0353ac49d01326b30efa0ea98a07da9f8ceeb7572fc1b37b5965ba6103ccba4913b62e36e49425c6ff21a2f008830c59cff8f29058769f858c8a9f0bab3eaea7fb8a9e"),o=this.type,s=this.markText,a=i.$z("648be38cd61c870e95ffc1ea0676af40736c1365015abc326e891a4de67b4de3d4b05da70b9aebedc83ec26ecf71eb74c72f42f6d9a4be2d507d2f67d2860b7b66e3ba1d565e15923f2db335ff922eef17c01b59818b583d5656412d6cc9d9ba70001c2c88e3efd492c6b13a07fda5f325b333138a2036f4696542ec137cc341");if(t[a]=i.__li__,"3"!==o||yi(gi)||s!==e){t.__liLabel==e&&(t.__liLabel=Ve.createElement("div")),i.startDate===e&&(i.startDate=new Date);var r=(new Date).getTime()-i.startDate.getTime();if(!(3e5>r)){var h=yi(i)&&r>3e5,l=s;if(h?l=i.$z("0dd629dbd0ce341ecdd447e35ddc3135a0b46916f7571a687f38ae665cf0ae095fee885e14329caa75112d8787508da17285b0897845d8ccae73e6a2727dd19f1ca335fe139d0e60d240f9ececc78f81c2c5667f51aeed4135b9c4bb436b8acb7cd418eeeb404bc4f3bcdedb481ac0edff7644435ce2b9f2bda78c892bd56d73"):"2"!=o||l!==e&&""!=l?"1"!=o||s||(l=n):l=i.$z("644d54bf9c59afbd8a742a9e7e2731f23f149ccb7f04c3547548c50ac2d77faea108b55f1f6261e99869f1c06b84e8abdefdf45b5170048531421f3d528123972ba2f03d70f37c33f1341dc12f986e0089e42bab517e2a05b455d12d90991bbba9bc45c715a81943062ea5fa5408c8b1b9270d260cc5a67b38ecc4178ce512fc"),l!==e){var c=t,d=c.__liLabel;if(d.innerHTML=l,c._rootCanvas)d.type=o,d.mark=s,d.expired=h,c._xyz=d;else{var u=0,_=0;d.style.position="absolute";var g=c.getView().style;s!=e&&null!=s&&""!=s||"2"==o?(u=10-c.getView().scrollLeft,_=10-c.getView().scrollTop):(u=g.width.replace("px","")/2-50-c.getView().scrollLeft,_=g.height.replace("px","")/2-c.getView().scrollTop),d.style.right=u+"px",d.style.bottom=_+"px",d.style.fontSize="120%",h&&(c.getView().style.opacity=.1,d.style.color="red",d.style.fontSize="150%"),c.getView().appendChild(d)}}}}},Oe.validateLicense(Be);var Ai=function(t,e,i){this.g=t,this.onLength=e,this.offLength=i,this.isLine=!0,this.overflow=0,this.dashLength=e+i,this.pen={x:0,y:0}};Oe.ext(Ai,Object,{_curveaccuracy:6,moveTo:function(t,e){this.pen={x:t,y:e},this.g.moveTo(t,e),this.start||(this.start={x:t,y:e})},lineTo:function(t,e){var i=t-this.pen.x,n=e-this.pen.y,o=Math.atan2(n,i),s=Math.cos(o),a=Math.sin(o),r=this.lineLength(this.pen.x,this.pen.y,t,e);if(this.overflow){if(this.overflow>r)return this.isLine?this._lineTo(t,e):this.moveTo(t,e),void(this.overflow-=r);if(this.isLine?this._lineTo(this.pen.x+s*this.overflow,this.pen.y+a*this.overflow):this.moveTo(this.pen.x+s*this.overflow,this.pen.y+a*this.overflow),r-=this.overflow,this.overflow=0,this.isLine=!this.isLine,!r)return}var h=Math.floor(r/this.dashLength);if(h){for(var l=s*this.onLength,c=a*this.onLength,d=s*this.offLength,u=a*this.offLength,_=0;h>_;_++)this.isLine?(this._lineTo(this.pen.x+l,this.pen.y+c),this.moveTo(this.pen.x+d,this.pen.y+u)):(this.moveTo(this.pen.x+d,this.pen.y+u),this._lineTo(this.pen.x+l,this.pen.y+c));r-=this.dashLength*h}this.isLine?r>this.onLength?(this._lineTo(this.pen.x+s*this.onLength,this.pen.y+a*this.onLength),this.moveTo(t,e),this.overflow=this.offLength-(r-this.onLength),this.isLine=!1):(this._lineTo(t,e),r==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-r,this.moveTo(t,e))):r>this.offLength?(this.moveTo(this.pen.x+s*this.offLength,this.pen.y+a*this.offLength),this._lineTo(t,e),this.overflow=this.onLength-(r-this.offLength),this.isLine=!0):(this.moveTo(t,e),r==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-r)},quadraticCurveTo:function(t,e,i,n){var o,s=this.pen.x,a=this.pen.y,r=this.curveLength(s,a,t,e,i,n),h=0,l=0;if(this.overflow){if(this.overflow>r)return this.isLine?this._curveTo(t,e,i,n):this.moveTo(i,n),void(this.overflow-=r);if(h=this.overflow/r,o=this.curveSliceUpTo(s,a,t,e,i,n,h),this.isLine?this._curveTo(o[2],o[3],o[4],o[5]):this.moveTo(o[4],o[5]),this.overflow=0,this.isLine=!this.isLine,!r)return}var c=r-r*h,d=Math.floor(c/this.dashLength),u=this.onLength/r,_=this.offLength/r;if(d)for(var g=0;d>g;g++)this.isLine?(l=h+u,o=this.curveSlice(s,a,t,e,i,n,h,l),this._curveTo(o[2],o[3],o[4],o[5]),h=l,l=h+_,o=this.curveSlice(s,a,t,e,i,n,h,l),this.moveTo(o[4],o[5])):(l=h+_,o=this.curveSlice(s,a,t,e,i,n,h,l),this.moveTo(o[4],o[5]),h=l,l=h+u,o=this.curveSlice(s,a,t,e,i,n,h,l),this._curveTo(o[2],o[3],o[4],o[5])),h=l;c=r-r*h,this.isLine?c>this.onLength?(l=h+u,o=this.curveSlice(s,a,t,e,i,n,h,l),this._curveTo(o[2],o[3],o[4],o[5]),this.moveTo(i,n),this.overflow=this.offLength-(c-this.onLength),this.isLine=!1):(o=this.curveSliceFrom(s,a,t,e,i,n,h),this._curveTo(o[2],o[3],o[4],o[5]),r==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-c,this.moveTo(i,n))):c>this.offLength?(l=h+_,o=this.curveSlice(s,a,t,e,i,n,h,l),this.moveTo(o[4],o[5]),o=this.curveSliceFrom(s,a,t,e,i,n,l),this._curveTo(o[2],o[3],o[4],o[5]),this.overflow=this.onLength-(c-this.offLength),this.isLine=!0):(this.moveTo(i,n),c==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-c)},bezierCurveTo:function(t,e,i,n,o,s){this.pen={x:o,y:s};var a=[this.onLength,this.offLength];this.g.setLineDash&&this.g.setLineDash(a),this.g.lineDash=a,this.g.bezierCurveTo(t,e,i,n,o,s)},rect:function(t,e,i,n){this.pen={x:t,y:e},this.moveTo(t,e),this.lineTo(t,e+n),this.lineTo(t+i,e+n),this.lineTo(t+i,e),this.lineTo(t,e)},closePath:function(){this.lineTo(this.start.x,this.start.y)},lineLength:function(t,e,i,n){var o=i-t,s=n-e;return Math.sqrt(o*o+s*s)},curveLength:function(t,e,i,n,o,s,a){for(var r,h,l,c,d,u,_,g=0,f=t,v=e,m=a>0?a:this._curveaccuracy,p=1;m>=p;p++)l=p/m,c=1-l,d=c*c,u=2*l*c,_=l*l,r=d*t+u*i+_*o,h=d*e+u*n+_*s,g+=this.lineLength(f,v,r,h),f=r,v=h;return g},curveSlice:function(t,e,i,n,o,s,a,r){if(0==a)return this.curveSliceUpTo(t,e,i,n,o,s,r);if(1==r)return this.curveSliceFrom(t,e,i,n,o,s,a);var h=this.curveSliceUpTo(t,e,i,n,o,s,r);return h.push(a/r),this.curveSliceFrom.apply(this,h)},curveSliceUpTo:function(t,e,i,n,o,s,a){if(1!=a){var r=i+(o-i)*a,h=n+(s-n)*a;i=t+(i-t)*a,n=e+(n-e)*a,o=i+(r-i)*a,s=n+(h-n)*a}return[t,e,i,n,o,s]},curveSliceFrom:function(t,e,i,n,o,s,a){if(1!=a){var r=t+(i-t)*a,h=e+(n-e)*a;i+=(o-i)*a,n+=(s-n)*a,t=r+(i-r)*a,e=h+(n-h)*a}return[t,e,i,n,o,s]},_lineTo:function(t,e){(t!=this.pen.x||e!=this.pen.y)&&(this.pen={x:t,y:e},this.g.lineTo(t,e))},_curveTo:function(t,e,i,n){(t!=i||e!=n||i!=this.pen.x||n!=this.pen.y)&&(this.pen={x:i,y:n},this.g.quadraticCurveTo(t,e,i,n))}}),Oe.DashedLine=Ai;var xi={DEFAULTS:{default:1,"default.vector":1,"vector.default":1},VECTORS:{vector:1,"default.vector":1,"vector.default":1},hasDefault:function(t){if(t instanceof Fn){var e=t.getStyle("body.type");return 1===xi.DEFAULTS[e]}return!0},hasVector:function(t){if(t instanceof Fn){var e=t.getStyle("body.type");return 1===xi.VECTORS[e]}return!1},hasAgentLinks:function(t){for(var e=t.getChildrenSize(),i=0;e>i;i++){var n=t.getChildAt(i);if(n instanceof Fn&&xi.hasAgentLinks(n))return!0}return t.hasAgentLinks()},getParents:function(t,e,i){i||(i=!0);for(var n=new fn,o=t._parent;null!=o&&o!==e;)n.add(o,0),o=o._parent;return i&&null!=o&&o===e&&n.add(o,0),n},getSubNetwork:function(t){if(!t)return null;if(t instanceof Me.Link){var e=t._fromAgent,i=t._toAgent;if(!e||!i)return null;var n=xi.getSubNetwork(e),o=xi.getSubNetwork(i);return n===o?n:null}var s=t._parent;if(!s)return null;for(;s instanceof Me.Link&&!s.ISubNetwork;)s=s._parent;return s.ISubNetwork?s:xi.getSubNetwork(s)},figureSameSubNetworkAgent:function(t){if(!t)return null;for(var e=t._parent;e instanceof Un;){if(!(e._parent instanceof Un))return e.isExpanded()?t:e;e.isExpanded()||(t=e),e=e._parent}return t},figureSpanSubNetworkAgent:function(t,e){if(!t||!e)return null;var i=xi.getSubNetwork(t),n=xi.getSubNetwork(e);if(i!=n){for(;null!=n&&i!=n;)n=xi.getSubNetwork(n);if(i===n)return t;var o=new fn;o.add(t,0);for(var s=t._parent;s instanceof Fn&&!e.isDescendantOf(s);)o.add(s,0),s=s._parent;for(var a=o.size(),r=0;a>r;r++){var h=o.get(r);if(h instanceof Un&&!h.isExpanded())return h;if(h.ISubNetwork)return h}return t}return t},figureFromAgent:function(t){if(t.isLooped())return t.getFromNode();var e=xi.figureSameSubNetworkAgent(t.getFromNode()),i=xi.figureSameSubNetworkAgent(t.getToNode());return e===i?t.getFromNode():xi.figureSpanSubNetworkAgent(e,i)},figureToAgent:function(t){if(t.isLooped())return t.getToNode();var e=xi.figureSameSubNetworkAgent(t.getFromNode()),i=xi.figureSameSubNetworkAgent(t.getToNode());return e===i?t.getToNode():xi.figureSpanSubNetworkAgent(i,e)},getBundleLinks:function(t,e){if(!t||!e)return null;var i,n,o,s;if(t===e){if(s=t.getLoopedLinks(),!s)return null;s=new fn(s)}else{var a=t.getAgentLinks(),r=e.getAgentLinks();if(!a||!r)return null;for(n=a.size(),i=0;n>i;i++)o=a.get(i),r.contains(o)&&(s||(s=new fn),s.add(o))}if(null!=s)for(i=0;i<s.size();i++)o=s.get(i),o.getStyle("link.bundle.enable")||(o._setBundleLinks(null),s.removeAt(i),i--);return s},resetBundleLinks:function(t,e){var i=xi.getBundleLinks(t,e);if(i&&0!==i.size()){var n=null;if(1===i.size())return n=i.get(0),void n._setBundleLinks(null);var o,s,a=new fn;for(o=0;o<i.size();o++)n=i.get(o),s=n.getStyle("link.bundle.id"),a.indexOf(s)<0&&a.add(s);a.sort();var r,h,l=new fn;for(h=0;h<a.size();h++){s=a.get(h);var c=new fn;for(o=0;o<i.size();o++)n=i.get(o),s===n.getStyle("link.bundle.id")&&c.add(n);r=new Me.BundleLinks(c,l),l.add(r)}for(h=0;h<l.size();h++)for(r=l.get(h),o=0;o<r.getLinks().size();o++)n=r.getLinks().get(o),n._setBundleLinks(r)}},moveElements:function(t,e,i,n){for(var o=xi.filterMovingElements(t,n),s=o.size(),a=0;s>a;a++)o.get(a).translate(e,i)},filterMovingElements:function(t,e){for(var i=new fn,n=t.size(),o=0;n>o;o++){var s=t.get(o);if(s instanceof Fn&&(!e||e(s))){for(var a=!0,r=i.toArray(),h=0;h<r.length;h++){var l=r[h];a&&l instanceof Me.Follower&&s instanceof Me.Follower&&s.isLoopedHostOn(l)?a=!1:l instanceof Me.Follower&&l.isHostOn(s)?i.remove(l):a&&s instanceof Me.Follower&&l instanceof Fn&&s.isHostOn(l)?a=!1:xi.isDescendantOfGroup(l,s)?i.remove(l):a&&xi.isDescendantOfGroup(s,l)&&(a=!1)}a&&i.add(s)}}return i},isDescendantOfGroup:function(t,e){if(!(t&&e instanceof Un))return!1;if(!e.hasChildren())return!1;for(t=t._parent;t instanceof Un;){if(t===e)return!0;t=t._parent}return!1}};Oe.element=xi;var Ei={between:function(t,e,i){return i>=t&&e>=i?!0:i>=e&&t>=i?!0:!1},considerEast:function(t,e,i){return e?Ei.between(e.x,i.x,t.x)?i.x>e.x:Math.abs(e.x-t.x)>Math.abs(i.x-t.x):!0},considerWest:function(t,e,i){return e?Ei.between(e.x,i.x,t.x)?i.x<e.x:Math.abs(e.x-t.x)>Math.abs(i.x-t.x):!0},considerNorth:function(t,e,i){return e?Ei.between(e.y,i.y,t.y)?i.y<e.y:Math.abs(e.y-t.y)>Math.abs(i.y-t.y):!0},considerSouth:function(t,e,i){return e?Ei.between(e.y,i.y,t.y)?i.y>e.y:Math.abs(e.y-t.y)>Math.abs(i.y-t.y):!0},getHorizontalPoint:function(t,e,i){return Ei.between(e.x,i.x,t.x)?{x:t.x,y:e.y}:Math.abs(t.x-e.x)<Math.abs(t.x-i.x)?{x:e.x,y:e.y}:{x:i.x,y:i.y}},getVerticalPoint:function(t,e,i){return Ei.between(e.y,i.y,t.y)?{x:e.x,y:t.y}:Math.abs(t.y-e.y)<Math.abs(t.y-i.y)?{x:e.x,y:e.y}:{x:i.x,y:i.y}},getPoint:function(t,e,i,n,o){var s=Math.abs(n.x-i.x)>Math.abs(n.y-i.y);if("south"===o)return s&&Ei.considerSouth(e,t,i)?Ei.getHorizontalPoint(e,i,n):null;if("north"===o)return s&&Ei.considerNorth(e,t,i)?Ei.getHorizontalPoint(e,i,n):null;if("west"===o)return!s&&Ei.considerWest(e,t,i)?Ei.getVerticalPoint(e,i,n):null;if("east"===o)return!s&&Ei.considerEast(e,t,i)?Ei.getVerticalPoint(e,i,n):null;if("nearby"===o){var a;return a=s?Ei.getHorizontalPoint(e,i,n):Ei.getVerticalPoint(e,i,n),!t||Ze.getDistance(t,e)>Ze.getDistance(a,e)?a:null}return null},getBusPoint:function(t,e,i){var n,o=t.size();if(o>0){for(var s=t.get(0),a=1;o>a;a++){var r=t.get(a),h=Ei.getPoint(n,e,s,r,i);h&&(n=h),s=r}n||(n={x:s.x,y:s.y})}return n}};Oe.bus=Ei;var Ti={createFromPoint:function(t,e){var i=t._element;if(!i.getFromAgent())return{x:0,y:0};var n,o=i.getStyle("link.from.position"),s=i.getStyle("link.from.xoffset"),a=i.getStyle("link.from.yoffset"),r=i.getStyle("link.from.percent");if(r&&r instanceof Array&&2===r.length&&r[0]<=1&&r[0]>=0&&r[1]<=1&&r[1]>=0){var h=i.getFromAgent(),l=h.getSize(),c=h.getRect().x+l.width*r[0],d=h.getRect().y+l.height*r[1];return{x:c,y:d}}if(t._network._edgeDetect){var h=i.getFromAgent(),u=i.getToAgent(),_=h.getImage(),g=Oe.images[_],f=h.getCenterLocation(),v=u.getCenterLocation(),m=this._getPointAngleDegree(v.x,v.y,f.x,f.y),p={x:0,y:0};if(g){var y=g._image;if(y&&on(y)||y&&Me.Util.getImageAsset(_)._cache)return on(y)?g._edgeData||(g._edgeData=g._createEdgeData(y,h._width,h._height)):"object"==typeof y&&(g._edgeData||(g._edgeData=g._createEdgeData(Me.Util.getImageAsset(_)._cache,h.getWidth(),h.getHeight()))),p.x=g._edgeData[m].x+h.getRect().x,p.y=g._edgeData[m].y+h.getRect().y,p}}if(!Oe.isCalculatingBus){if(Oe.isCalculatingBus=!0,i.getFromAgent()instanceof Me.Bus){var w=i.getFromAgent();if(xi.hasVector(w)){var A=e?e._getElementZoomRect(t,w.getRect()):w.getRect(),x=w.getStyle("vector.shape");if("oval"===x)n=Ze.getEllipsePoint(A,Ti.createToPoint(t));else if("circle"===x)n=Ze.getEllipsePoint(Ze.getCircleRect(A),Ti.createToPoint(t));else if("rectangle"===x||"roundrect"===x){var E=new fn;E.add({x:w.x,y:w.y}),E.add({x:w.x+w.width,y:w.y}),E.add({x:w.x+w.width,y:w.y+w.height}),E.add({x:w.x,y:w.y+w.height}),E.add({x:w.x,y:w.y}),E=e?e._getShapeNodeZoomPoints(t,E):E,n=Ei.getBusPoint(E,Ti.createToPoint(t),w.getStyle("bus.style"))}}else{var E=e?e._getShapeNodeZoomPoints(t,w.getPoints()):w.getPoints();n=Ei.getBusPoint(E,Ti.createToPoint(t),w.getStyle("bus.style"))}}Oe.isCalculatingBus=!1}return n?(n.x+=s,n.y+=a):n=t._network.getPosition(o,i.getFromAgent(),null,s,a,!0),n},createToPoint:function(t,e){var i=t._element;if(!i.getToAgent())return{x:0,y:0};var n,o=i.getStyle("link.to.position"),s=i.getStyle("link.to.xoffset"),a=i.getStyle("link.to.yoffset"),r=i.getStyle("link.to.percent");if(r&&r instanceof Array&&2===r.length&&r[0]<=1&&r[0]>=0&&r[1]<=1&&r[1]>=0){var h=i.getToAgent(),l=h.getSize(),c=h.getRect().x+l.width*r[0],d=h.getRect().y+l.height*r[1];return{x:c,y:d}}if(t._network._edgeDetect){var u=i.getFromAgent(),h=i.getToAgent(),_=h.getImage(),g=Oe.images[_],f=u.getLocation(),v=h.getCenterLocation(),m=this._getPointAngleDegree(f.x,f.y,v.x,v.y),p={x:0,y:0};if(g){var y=g._image;if(y&&on(y)||y&&Me.Util.getImageAsset(_)._cache)return on(y)?g._edgeData||(g._edgeData=g._createEdgeData(y,h.getWidth(),h.getHeight())):"object"==typeof y&&(g._edgeData||(g._edgeData=g._createEdgeData(Me.Util.getImageAsset(_)._cache,h.getWidth(),h.getHeight()))),p.x=g._edgeData[m].x+h.getRect().x,p.y=g._edgeData[m].y+h.getRect().y,p}}if(!Oe.isCalculatingBus){if(Oe.isCalculatingBus=!0,i.getToAgent()instanceof Me.Bus){var w=i.getToAgent();if(xi.hasVector(w)){var A=e?e._getElementZoomRect(t,w.getRect()):w.getRect(),x=w.getStyle("vector.shape");if("oval"===x)n=Ze.getEllipsePoint(A,Ti.createFromPoint(t));else if("circle"===x)n=Ze.getEllipsePoint(Ze.getCircleRect(A),Ti.createFromPoint(t));else if("rectangle"===x||"roundrect"===x){var E=new fn;E.add({x:w.x,y:w.y}),E.add({x:w.x+w.width,y:w.y}),E.add({x:w.x+w.width,y:w.y+w.height}),E.add({x:w.x,y:w.y+w.height}),E.add({x:w.x,y:w.y}),E=e?e._getShapeNodeZoomPoints(t,E):E,n=Ei.getBusPoint(E,Ti.createFromPoint(t),w.getStyle("bus.style"))}}else{var E=e?e._getShapeNodeZoomPoints(t,w.getPoints()):w.getPoints();n=Ei.getBusPoint(E,Ti.createFromPoint(t),w.getStyle("bus.style"))}}Oe.isCalculatingBus=!1}return n?(n.x+=s,n.y+=a):n=t._network.getPosition(o,i.getToAgent(),null,s,a,!0),n},fillLoopedPoints:function(t,e,i){var n,o=Ti.getBundleGap(t,!0),s=o,a=t.getStyle("link.looped.type"),r=t.getStyle("link.looped.direction");if("north"===r)return"arc"===a?Ti.drawArc(e.x+e.width/2,e.y,0,Math.PI,o,o,!1,i):(n={x:e.x+e.width/2,y:e.y},i.add({x:n.x+s,y:n.y}),i.add({x:n.x+s,y:n.y-o}),i.add({x:n.x-s,y:n.y-o}),i.add({x:n.x-s,y:n.y})),{x:e.x+e.width/2,y:e.y-o};if("northeast"===r)return"arc"===a?Ti.drawArc(e.x+e.width,e.y,1.5*Math.PI,1.5*Math.PI,o,o,!1,i):(n={x:e.x+e.width,y:e.y},i.add({x:n.x,y:n.y+s}),i.add({x:n.x+s,y:n.y+s}),i.add({x:n.x+s,y:n.y-o}),i.add({x:n.x-s,y:n.y-o}),i.add({x:n.x-s,y:n.y})),{x:e.x+e.width+.707*o,y:e.y-.707*o};if("east"===r)return"arc"===a?Ti.drawArc(e.x+e.width,e.y+e.height/2,1.5*Math.PI,Math.PI,o,o,!1,i):(n={x:e.x+e.width,y:e.y+e.height/2},i.add({x:n.x,y:n.y-s}),i.add({x:n.x+o,y:n.y-s}),i.add({x:n.x+o,y:n.y+s}),i.add({x:n.x,y:n.y+s})),{x:e.x+e.width+o,y:e.y+e.height/2};if("southeast"===r)return"arc"===a?Ti.drawArc(e.x+e.width,e.y+e.height,Math.PI,1.5*Math.PI,o,o,!1,i):(n={x:e.x+e.width,y:e.y+e.height},i.add({x:n.x,y:n.y-s}),i.add({x:n.x+s,y:n.y-s}),i.add({x:n.x+s,y:n.y+o}),i.add({x:n.x-s,y:n.y+o}),i.add({x:n.x-s,y:n.y})),{x:e.x+e.width+.707*o,y:e.y+e.height+.707*o};if("south"===r)return"arc"===a?Ti.drawArc(e.x+e.width/2,e.y+e.height,Math.PI,Math.PI,o,o,!1,i):(n={x:e.x+e.width/2,y:e.y+e.height},i.add({x:n.x-s,y:n.y}),i.add({x:n.x-s,y:n.y+o}),i.add({x:n.x+s,y:n.y+o}),i.add({x:n.x+s,y:n.y})),{x:e.x+e.width/2,y:e.y+e.height+o};if("southwest"===r)return"arc"===a?Ti.drawArc(e.x,e.y+e.height,.5*Math.PI,1.5*Math.PI,o,o,!1,i):(n={x:e.x,y:e.y+e.height},i.add({x:n.x,y:n.y-s}),i.add({x:n.x-s,y:n.y-s}),i.add({x:n.x-s,y:n.y+o}),i.add({x:n.x+s,y:n.y+o}),i.add({x:n.x+s,y:n.y})),{x:e.x-.707*o,y:e.y+e.height+.707*o};if("west"===r)return"arc"===a?Ti.drawArc(e.x,e.y+e.height/2,.5*Math.PI,Math.PI,o,o,!1,i):(n={x:e.x,y:e.y+e.height/2},i.add({x:n.x,y:n.y-s}),i.add({x:n.x-o,y:n.y-s}),i.add({x:n.x-o,y:n.y+s}),i.add({x:n.x,y:n.y+s})),{x:e.x-o,y:e.y+e.height/2};if("northwest"===r)return"arc"===a?Ti.drawArc(e.x,e.y,0,1.5*Math.PI,o,o,!1,i):(n={x:e.x,y:e.y},i.add({x:n.x,y:n.y+s}),i.add({x:n.x-s,y:n.y+s}),i.add({x:n.x-s,y:n.y-o}),i.add({x:n.x+s,y:n.y-o}),i.add({x:n.x+s,y:n.y})),{x:e.x-.707*o,y:e.y-.707*o};throw"Can not resolve link looped direction '"+r+"'"},drawArc:function(t,e,i,n,o,s,a,r){var h,l,c,d,u,_,g,f,v,m,p;if(Math.abs(n)>2*Math.PI&&(n=2*Math.PI),u=Math.ceil(Math.abs(n)/(Math.PI/4)),h=n/u,l=-h,c=-i,u>0){_=t+Math.cos(i)*o,g=e+Math.sin(-i)*s,r.add({x:_,y:g});for(var y=0;u>y;y++){c+=l,d=c-l/2,f=t+Math.cos(c)*o,v=e+Math.sin(c)*s,m=t+Math.cos(d)*(o/Math.cos(l/2)),p=e+Math.sin(d)*(s/Math.cos(l/2));var w=new fn;w.add({x:m,y:p}),w.add({x:f,y:v}),r.add(w)}}},fillBundlePoints:function(t,i,n,o,s,a){{var r;t._element.getBundleCount(),t._element.getBundleIndex(),t.getStyle("link.bundle.expanded")}if("parallel"!==i&&0===(r=Ti.getBundleGap(t,!1)))return s.add(n),s.add(o),Ze.getCenterPoint(n,o);r===e&&(r=Ti.getBundleGap(t,!1));var h=Ti.getBundleOffset(t),l=Ze.getDistance(n,o);if(a){var c=a.getSizeZoom();h*=c,r*=c}("arc"===i||"triangle"===i)&&s.add({x:0,y:0}),"arc"===i&&s.add({x:0,y:r}),s.add({x:h,y:r}),s.add({x:l-h,y:r}),"arc"===i&&s.add({x:l,y:r}),("arc"===i||"triangle"===i)&&s.add({x:l,y:0});for(var d=Math.atan2(o.y-n.y,o.x-n.x),u=Ze.createMatrix(d,0,0),_=0,g=s.size();g>_;_++){var f=s.get(_);f=u.transform(f),f.x+=n.x,f.y+=n.y,s.set(_,f)}if("arc"===i){var v=Ze.getCenterPoint(s.get(2),s.get(3)),m=new fn;return m.add(s.get(1)),m.add(s.get(2)),s.set(1,m),m=new fn,m.add(s.get(4)),m.add(s.get(5)),s.set(4,m),s.removeAt(5),s.removeAt(2),v}return Ti.calculateCenterPoint(s)},calculateCenterPoint:function(t){var e=t.size();if(null==t||1>e)return{x:0,y:0};if(e%2===0){var i=e/2,n=t.get(i-1),o=t.get(i);return{x:(n.x+o.x)/2,y:(n.y+o.y)/2}}return t.get((e-1)/2)},getBundleOffset:function(t){var e=Ze.getDistance(t.getFromPoint(),t.getToPoint()),i=t.getStyle("link.bundle.offset");return e>2*i?i:e/2},getBundleGap:function(t,e){var i=t._element;if(!i.getBundleLinks())return e?i.getStyle("link.looped.gap"):0;for(var n=e?"link.looped.gap":"link.bundle.gap",o=null,s=0,a=0,r=i.getBundleLinks().getSiblings(),h=0,l=i.getStyle("link.bundle.independent"),c=i.getStyle("link.bundle.group.gap"),d=0,u=r.size();u>d;d++){var _=r.get(d);if(!l||_===i.getBundleLinks()){for(var g=0,f=_.getLinks().size();f>g;g++){var v=_.getLinks().get(g);if(l===v.getStyle("link.bundle.independent")&&t._network.isVisible(v)){if(null==o)o=v,h=v.getStyle(n);else{var m=v.getStyle(n);a+=h/2+m/2,h=m}v===i&&(s=a+c/2)}}a+=c}}if(e)return a-s+h;var p=s-a/2;return null!=o&&i.getFromAgent()!==o.getFromAgent()&&(p=-p),p},isTargetPriority:function(t,e,i){if(t){if(e.height<i.height)return e.height+i.height<Math.max(e.y+e.height,i.y+i.height)-Math.min(e.y,i.y)+e.height/2}else if(e.width<i.width)return e.width+i.width<Math.max(e.x+e.width,i.x+i.width)-Math.min(e.x,i.x)+e.width/2;return!0},calculateOrthogonalAndFlexionalLinkPoints:function(t,e,i,n){var o=Ti.isHorizontal(t,e,i,n),s=new fn;if(Ti.isFlexionalTypeLink(t))Ti.flexional(o,e,i,s,n.getStyle("link.extend"));else{Ti.orthogonal(t,e,i,s,o,n);var a=Ti.isSplitByPercent(t,n),r=a?Ti.calculateSplitValueByPercent(t,o,e,i,n.getStyle("link.split.percent")):n.getStyle("link.split.value");0===r&&(o=!o)}var h;0===s.size()?Ti.isTargetPriority(o,e,i)?(h={x:i.x+i.width/2,y:i.y+i.height/2},s.add(Ti.rectanglePerimeter(e,!0,h)),s.add(Ti.rectanglePerimeter(i,!1,s.get(s.size()-1)))):(h={x:e.x+e.width/2,y:e.y+e.height/2},h=Ti.rectanglePerimeter(i,!1,h),s.add(Ti.rectanglePerimeter(e,!0,h)),s.add(h)):(h=s.get(0),s.add(Ti.rectanglePerimeter(e,!0,h),0),s.add(Ti.rectanglePerimeter(i,!1,s.get(s.size()-1))));var l=s.size();if(2>l)return s;for(var c=s.get(0),d=1;l-1>d;d++){var u=s.get(d);u.x===c.x&&u.y===c.y&&(s.remove(u),l--,d--),c=u}return s},isHorizontal:function(t,e,i,n){if(t){if("flexional.horizontal"===t||"orthogonal.horizontal"===t||"orthogonal.H.V"===t||"extend.left"===t||"extend.right"===t)return!0;if("flexional.vertical"===t||"orthogonal.vertical"===t||"orthogonal.V.H"===t||"extend.top"===t||"extend.bottom"===t)return!1}var o=Ti.calculateXGap(e,i),s=Ti.calculateYGap(e,i);return o>=s},flexional:function(t,e,i,n,o){t?Ti.flexionalHorizontal(e,i,n,o):Ti.flexionalVertical(e,i,n,o)},isSplitByPercent:function(t,e){return e.getStyle("link.split.by.percent")},isExtendTypeLink:function(t){return t&&("extend.top"===t||"extend.left"===t||"extend.bottom"===t||"extend.right"===t)},isFlexionalTypeLink:function(t){return t&&("flexional"===t||"flexional.horizontal"===t||"flexional.vertical"===t)},calculateControlPoint:function(t,e,i,n,o){if("orthogonal.H.V"===t||"orthogonal.V.H"===t)return{x:n.x+n.width/2,y:n.y+n.height/2};var s;if(Ti.isExtendTypeLink(t)){var a=Math.min(i.y,n.y),r=Math.min(i.x,n.x),h=Math.max(i.y+i.height,n.y+n.height),l=Math.max(i.x+i.width,n.x+n.width);if(s=o.getStyle("link.extend"),"extend.top"===t)return{x:(r+l)/2,y:a-s};if("extend.left"===t)return{x:r-s,y:(a+h)/2};if("extend.bottom"===t)return{x:(r+l)/2,y:h+s};if("extend.right"===t)return{x:l+s,y:(a+h)/2}}var c=Ti.isSplitByPercent(t,o);if(s=c?Ti.calculateSplitValueByPercent(t,e,i,n,o.getStyle("link.split.percent")):o.getStyle("link.split.value"),s===Number.NEGATIVE_INFINITY||s===Number.POSITIVE_INFINITY)return{x:n.x+n.width/2,y:n.y+n.height/2};if(0===s)return{x:i.x+i.width/2,y:i.y+i.height/2};if(e){var d=i.x+i.x+i.width<n.x+n.x+n.width;return{x:Ti.calculateSplitLocation(d,s,i.x,i.width),y:i.y+i.height/2}}var u=i.y+i.y+i.height<n.y+n.y+n.height;return{x:i.x+i.width/2,y:Ti.calculateSplitLocation(u,s,i.y,i.height)}},calculateGap:function(t,e,i,n){var o=Math.max(e,n)-Math.min(t,i);return o-(e-t+n-i)},calculateXGap:function(t,e){var i=Math.max(t.x+t.width,e.x+e.width)-Math.min(t.x,e.x);return i-t.width-e.width},calculateYGap:function(t,e){var i=Math.max(t.y+t.height,e.y+e.height)-Math.min(t.y,e.y);return i-t.height-e.height},calculateSplitValueByPercent:function(t,e,i,n,o){var s=Ti.calculateSplitGapByPercent(o,e,i,n);return s*o},calculateSplitGapByPercent:function(t,e,i,n,o){return e?Ti._calculateSplitGapByPercent(t,i.x,i.x+i.width,n.x,n.x+n.width):Ti._calculateSplitGapByPercent(t,i.y,i.y+i.height,n.y,n.y+n.height)},_calculateSplitGapByPercent:function(t,e,i,n,o){var s=Ti.calculateGap(e,i,n,o),a=n+o>e+i;if(s>0){if(1===t)return s+(o-n)/2;if(t>=0&&1>t)return s;if(0>t)return a?n-e:i-o}return Math.abs(a&&t>0||!a&&0>t?i-o:e-n)},calculateSplitPercentByControlPoint:function(t,e,i,n){return e?Ti.calculateSplitPercent(t.x,i.x,i.x+i.width,n.x,n.x+n.width):Ti.calculateSplitPercent(t.y,i.y,i.y+i.height,n.y,n.y+n.height)},calculateSplitPercent:function(t,e,i,n,o){if(t>=e&&i>=t)return 0;var s=Ti.calculateGap(e,i,n,o);if(s>0&&t>=n&&o>=t)return 1;var a=n+o>e+i;if(s>0){if(t>Math.min(i,o)&&t<Math.max(e,n))return Math.abs(t-(a?i:e))/s;if(a){if(e>t)return(t-e)/(n-e)}else if(t>i)return(i-t)/(i-o)}return t>i?(a?t-i:i-t)/Math.abs(i-o):(a?t-e:e-t)/Math.abs(e-n)},calculateSplitLocation:function(t,e,i,n){return t===e>0?i+n+Math.abs(e):i-Math.abs(e)},calculateAngle:function(t,e){if(0!==t&&0!==e)return Math.atan2(t,e);if(0===t){if(e>0)return 0;if(0>e)return Math.PI}return t>0?Math.PI/2:-Math.PI/2},drawCorner:function(t,e){var i=t.size();if(!(3>i)){var n=e.getStyle("link.corner");if("none"!==n){for(var o,s,a,r,h=e.getStyle("link.xradius"),l=e.getStyle("link.yradius"),c=t.get(0),d=t.get(1),u=2;i>u;u++){var _=t.get(u),g=d.x-c.x,f=d.y-c.y,v=_.x-d.x,m=_.y-d.y,p=0===f;if(0===g&&0===m||0===f&&0===v)if(p?(o=Math.min(2===u?Math.abs(g):Math.abs(g)/2,h),s=Math.min(u===i-1?Math.abs(m):Math.abs(m)/2,l),a={x:d.x-(g>0?o:-o),y:d.y},r={x:d.x,y:d.y+(m>0?s:-s)}):(o=Math.min(u===i-1?Math.abs(v):Math.abs(v)/2,h),s=Math.min(2===u?Math.abs(f):Math.abs(f)/2,l),a={x:d.x,y:d.y-(f>0?s:-s)},r={x:d.x+(v>0?o:-o),y:d.y}),t.remove(d),u--,i--,(a.x!==c.x||a.y!==c.y)&&(t.add(a,u),u++,i++),"bevel"===n)t.add(r,u),u++,i++;else if("round"===n){var y=new fn;y.add(d),y.add(r),t.add(y,u),u++,i++}c=d,d=_}r&&r.x===d.x&&r.y===d.y&&t.remove(d)}}},orthogonal:function(t,e,i,n,o,s){var a=s.getStyle("link.control.point"),r=null==a;if(a){var h=Ze.unionRect(e,i);Ze.containsPoint(h,a)||(o=Ti.calculateIsHorizontalByControlPoint(a.x,a.y,h.y,h.x,h.y+h.height,h.x+h.width))}else a=Ti.calculateControlPoint(t,o,e,i,s);o?Ti.sideToSide(e,i,a,n,r):Ti.topToBottom(e,i,a,n,r)},calculateIsHorizontalByControlPoint:function(t,e,i,n,o,s){return i>e&&i-e>n-t&&i-e>t-s||e>o&&e-o>n-t&&e-o>t-s?!1:!0},contains:function(t,e,i){return e>=t.x&&e<=t.x+t.width&&i>=t.y&&i<=t.y+t.height},topToBottom:function(t,e,i,n,o){var s=Math.max(t.y,e.y),a=Math.min(t.y+t.height,e.y+e.height),r=i?i.y:a+(s-a)/2,h=t.x+t.width/2,l=e.x+e.width/2;if(!o&&i&&(i.x>=t.x&&i.x<=t.x+t.width&&(h=i.x),i.x>=e.x&&i.x<=e.x+e.width&&(l=i.x)),Ti.contains(e,h,r)||Ti.contains(t,h,r)||n.add({x:h,y:r}),Ti.contains(e,l,r)||Ti.contains(t,l,r)||n.add({x:l,y:r}),0===n.size())if(i)Ti.contains(e,i.x,r)||Ti.contains(t,i.x,r)||n.add({x:i.x,y:r});else{var c=Math.max(t.x,e.x),d=Math.min(t.x+t.width,e.x+e.width);n.add({x:c+(d-c)/2,y:r})}},sideToSide:function(t,e,i,n,o){var s=Math.max(t.x,e.x),a=Math.min(t.x+t.width,e.x+e.width),r=i?i.x:a+(s-a)/2,h=t.y+t.height/2,l=e.y+e.height/2;if(!o&&i&&(i.y>=t.y&&i.y<=t.y+t.height&&(h=i.y),i.y>=e.y&&i.y<=e.y+e.height&&(l=i.y)),Ti.contains(e,r,h)||Ti.contains(t,r,h)||n.add({x:r,y:h}),Ti.contains(e,r,l)||Ti.contains(t,r,l)||n.add({x:r,y:l}),0===n.size())if(i)Ti.contains(e,r,i.y)||Ti.contains(t,r,i.y)||n.add({x:r,y:i.y});else{var c=Math.max(t.y,e.y),d=Math.min(t.y+t.height,e.y+e.height);n.add({x:r,y:c+(d-c)/2})}},flexionalHorizontal:function(t,e,i,n){var o=e.x+e.width<t.x,s=t.x+t.width<e.x,a=o?t.x:t.x+t.width,r=t.y+t.height/2,h=s?e.x:e.x+e.width,l=e.y+e.height/2,c=n,d=o?-c:c,u={x:a+d,y:r};d=s?-c:c;var _={x:h+d,y:l};if(o===s){var g=o?Math.min(a,h)-n:Math.max(a,h)+n;i.add({x:g,y:r}),i.add({x:g,y:l})}else if(u.x<_.x===o){var f=r+(l-r)/2;i.add(u),i.add({x:u.x,y:f}),i.add({x:_.x,y:f}),i.add(_)}else i.add(u),i.add(_)},flexionalVertical:function(t,e,i,n){var o=e.y+e.height<t.y,s=t.y+t.height<e.y,a=t.x+t.width/2,r=o?t.y:t.y+t.height,h=e.x+e.width/2,l=s?e.y:e.y+e.height,c=n,d=o?-c:c,u={x:a,y:r+d};d=s?-c:c;var _={x:h,y:l+d};if(o===s){var g=o?Math.min(r,l)-n:Math.max(r,l)+n;i.add({x:a,y:g}),i.add({x:h,y:g})}else if(u.y<_.y===o){var f=a+(h-a)/2;i.add(u),i.add({x:f,y:u.y}),i.add({x:f,y:_.y}),i.add(_)}else i.add(u),i.add(_)},rectanglePerimeter:function(t,e,i){var n=t.x+t.width/2,o=t.y+t.height/2,s=i.x-n,a=i.y-o,r=Math.atan2(a,s),h={x:0,y:0},l=Math.PI,c=Math.PI/2,d=c-r,u=Math.atan2(t.height,t.width);return-l+u>r||r>l-u?(h.x=t.x,h.y=o-t.width*Math.tan(r)/2):-u>r?(h.y=t.y,h.x=n-t.height*Math.tan(d)/2):u>r?(h.x=t.x+t.width,h.y=o+t.width*Math.tan(r)/2):(h.y=t.y+t.height,h.x=n+t.height*Math.tan(d)/2),i.x>=t.x&&i.x<=t.x+t.width?h.x=i.x:i.y>=t.y&&i.y<=t.y+t.height&&(h.y=i.y),i.x<t.x?h.x=t.x:i.x>t.x+t.width&&(h.x=t.x+t.width),i.y<t.y?h.y=t.y:i.y>t.y+t.height&&(h.y=t.y+t.height),h},isSplitTypeLink:function(t){return t&&("orthogonal"===t||"orthogonal.horizontal"===t||"orthogonal.vertical"===t)},isOrthogonalOrFlexionalLink:function(t){if(t instanceof Me.ShapeLink)return!1;if(t.isLooped())return!1;var e=t.getStyle("link.type");return Ti.isOrthogonalOrFlexionalType(e)},isOrthogonalLink:function(t){if(t instanceof Me.ShapeLink)return!1;if(t.isLooped())return!1;var e=t.getStyle("link.type");return Ti.isOrthogonalType(e)},isOrthogonalOrFlexionalType:function(t){return"orthogonal"===t||"orthogonal.horizontal"===t||"orthogonal.H.V"===t||"orthogonal.vertical"===t||"orthogonal.V.H"===t||"extend.top"===t||"extend.left"===t||"extend.bottom"===t||"extend.right"===t||"flexional"===t||"flexional.horizontal"===t||"flexional.vertical"===t},isOrthogonalType:function(t){return"orthogonal"===t||"orthogonal.horizontal"===t||"orthogonal.H.V"===t||"orthogonal.vertical"===t||"orthogonal.V.H"===t||"extend.top"===t||"extend.left"===t||"extend.bottom"===t||"extend.right"===t},hasControlPoint:function(t){return"orthogonal"===t||"orthogonal.horizontal"===t||"orthogonal.vertical"===t||"extend.bottom"===t||"extend.left"===t||"extend.right"===t||"extend.top"===t},getControlPoint:function(t,e,i){if(!t)throw"link can't be null";var n=t.getStyle("link.type");if(!Ti.hasControlPoint(n))return null;var o=t.getStyle("link.control.point");if(o)return o;var s,a;if(null==e?(s=t.getFromAgent().getRect(),a=t.getToAgent().getRect()):(s=Ti.getLinkSourceBounds(e,i),a=Ti.getLinkTargetBounds(e,i)),null==s||null==a)return null;var r=Ti.isHorizontal(n,s,a,t);return Ti.calculateControlPoint(t.getStyle("link.type"),r,s,a,t)},getSplitValueByControlPoint:function(t,e,i,n,o){if("extend.top"===e)return Math.min(i.y,n.y)-t.y;if("extend.left"===e)return Math.min(i.x,n.x)-t.x;if("extend.bottom"===e)return t.y-Math.max(i.y+i.height,n.y+n.height);if("extend.right"===e)return t.x-Math.max(i.x+i.width,n.x+n.width);var s;if(o){var a=i.x+i.x+i.width<n.x+n.x+n.width;return s=a?t.x-i.x+i.width:i.x-t.x,s>0?s:s>-i.width?0:s+i.width}var r=i.y+i.y+i.height<n.y+n.y+n.height;return s=r?t.y-i.y-i.height:i.y-t.y,s>0?s:s>-i.height?0:s+i.height},isHorizontalByControlPoint:function(t,e,i,n,o){var s=Ze.unionRect(i,n);return Ze.containsPoint(s,t)?Ti.isHorizontal(e,i,n,o):Ti.calculateIsHorizontalByControlPoint(t.x,t.y,s.y,s.x,s.y+s.height,s.x+s.width)},setParamsByControlPoint:function(t,e,i,n,o){var s=Ti.isHorizontalByControlPoint(t,n,e,i,o),a=o.getStyle("link.control.point");if((a||"orthogonal"===n||"orthogonal.horizontal"===n||"orthogonal.vertical"===n)&&o.setStyle("link.type",s?"orthogonal.horizontal":"orthogonal.vertical"),a)return void o.setStyle("link.control.point",t);var r=Ti.getSplitValueByControlPoint(t,n,e,i,s);if(Ti.isExtendTypeLink(n))return void o.setStyle("link.extend",r);var h=Ti.isSplitByPercent(n,o);return h?0===r?void o.setStyle("link.split.percent",0):void o.setStyle("link.split.percent",Ti.calculateSplitPercentByControlPoint(t,s,e,i)):void o.setStyle("link.split.value",r)},getLinkNodeBounds:function(t,e,i,n,o,s){if(s){var a=s.getLocationZoom();s.getSizeZoom(t)}if(null==t)return null;var r;if(n)s?(r=t.getZoomBodyRect(),r.x+=e,r.y+=i):(r=t.getBodyRect(),r.x+=e,r.y+=i);else{var h=t.getNetwork().getPosition(o,t,null,e,i);r=s?{x:h.x*a,y:h.y*a,width:1,height:1}:{x:h.x,y:h.y,width:1,height:1}}return r},getLinkSourceBounds:function(t,e){var i=t._element,n=t.getNetwork().getElementUI(i.getFromAgent());if(null==n)return null;var o=i.getStyle("link.from.position"),s=i.getStyle("link.from.xoffset"),a=i.getStyle("link.from.yoffset"),r=i.getStyle("link.from.at.edge");return Ti.getLinkNodeBounds(n,s,a,r,o,e)},getLinkTargetBounds:function(t,e){var i=t._element,n=t.getNetwork().getElementUI(i.getToAgent());if(null==n)return null;var o=i.getStyle("link.to.position"),s=i.getStyle("link.to.xoffset"),a=i.getStyle("link.to.yoffset"),r=i.getStyle("link.to.at.edge");return Ti.getLinkNodeBounds(n,s,a,r,o,e)},orthogonalAndFlexional:function(t,e,i){var n=Ti.getLinkSourceBounds(t,i);if(null==n)return null;var o=Ti.getLinkTargetBounds(t,i);if(null==o)return null;var s=Ti.calculateOrthogonalAndFlexionalLinkPoints(e,n,o,t._element);return Ti.offsetLink(t,s),t.setHotSpot(Ti.calculateCenterPoint(s)),"flexional"!==e&&Ti.drawCorner(s,t._element),s},offsetLink:function(t,e){var i=t._element,n=i.isBundleAgent();if(!n){var o=Ti.getBundleGap(t,!1);if(0!==o)for(var s,a,r=!1,h=!1,l=e.get(0),c=Oe.clone(l),d=1,u=e.size();u>d;d++){var _=e.get(d),g=_.x-c.x,f=_.y-c.y;c=Oe.clone(_),a=Ti.calculateAngle(g,f),0===g?((a-s)%Math.PI===0&&(a-s)%(2*Math.PI)!==0&&(r=!r,r&&(f=-f)),(a-s)%Math.PI!==0&&(l.x+=0>f?o:-o),_.x+=0>f?o:-o):0===f&&((a-s)%Math.PI===0&&(a-s)%(2*Math.PI)!==0&&(h=!h,h&&(g=-g)),s&&(a-s)%Math.PI===0||(l.y-=0>g?o:-o),_.y-=0>g?o:-o),s=a,l=_}}},_getPointAngleDegree:function(t,e,i,n){var o=i-t,s=n-e,a=Math.atan2(s,o);return a=a/Math.PI*180,a=parseInt(a)+180,a%=360}};Oe.link=Ti;var Ci={findMoveToBottomDatas:function(t,e,i){for(var n=0;n<i.size();n++){var o=i.get(n);t.contains(o)&&e.add(o)}for(n=0;n<i.size();n++)o=i.get(n),Ci.findMoveToBottomDatas(t,e,o.getChildren())},findMoveToTopDatas:function(t,e,i){for(var n=0;n<i.size();n++){var o=i.get(i.size()-1-n);t.contains(o)&&e.add(o)}for(n=0;n<i.size();n++)o=i.get(n),Ci.findMoveToTopDatas(t,e,o.getChildren())},findMoveUpDatas:function(t,e,i){for(var n=!1,o=0;o<i.size();o++){var s=i.get(o);t.contains(s)?n&&e.add(s):n=!0}for(o=0;o<i.size();o++)s=i.get(o),Ci.findMoveUpDatas(t,e,s.getChildren())},findMoveDownDatas:function(t,e,i){for(var n=!1,o=0;o<i.size();o++){var s=i.get(i.size()-1-o);t.contains(s)?n&&e.add(s):n=!0}for(o=0;o<i.size();o++)s=i.get(o),Ci.findMoveDownDatas(t,e,s.getChildren())},doLayout:function(t,e){e=e||{},e.type=e.type||"round",e.animate=e.animate||!0,e.elements=e.elements||new Me.List,e.repulsion=e.repulsion||1,e.expandGroup=e.expandGroup||!1;var i=new Me.layout.AutoLayouter(t.getElementBox());i.getElements=function(){}}};Oe.box=Ci;var bi={scrollLeft:function(){return bi._filterResults(t.pageXOffset?t.pageXOffset:0,Ve.documentElement?Ve.documentElement.scrollLeft:0,Ve.body?Ve.body.scrollLeft:0)},scrollTop:function(){return bi._filterResults(t.pageYOffset?t.pageYOffset:0,Ve.documentElement?Ve.documentElement.scrollTop:0,Ve.body?Ve.body.scrollTop:0)},_filterResults:function(t,e,i){var n=t?t:0;return e&&(!n||n>e)&&(n=e),i&&(!n||n>i)?i:n},isSingleTouch:function(t){return t.touches&&1==t.touches.length},isMultiTouch:function(t){return t.touches&&t.touches.length>1},getDistance:function(t){if(!bi.isMultiTouch(t))return 0;var e=t.touches[0],i=t.touches[1];return Math.sqrt(Math.pow(e.clientX-i.clientX,2)+Math.pow(e.clientY-i.clientY,2))},getCenterLocation:function(t){if(!bi.isMultiTouch(t))return 0;var e=t.touches[0],i=t.touches[1];return{x:(e.clientX+i.clientX)/2,y:(e.clientY+i.clientY)/2}}};Oe.touch=bi;var ki={_string:function(t,e,i,n){var o=i._stringPool.get();o.style.whiteSpace="nowrap",o.style.verticalAlign="middle",o.style.padding="0px 2px",Oe.setText(o,t,n),o.setAttribute("title",t),e.appendChild(o)},_boolean:function(t,e,i){var n=i._booleanPool.get();e._editInfo?(n._editInfo=e._editInfo,delete e._editInfo,n.disabled=!1):n.disabled=!0,n.keepDefault=!0,n.type="checkbox",n.style.margin="0px 2px",n.style.verticalAlign="middle",n.checked=t,e.appendChild(n),""===e.style.textAlign&&(e.style.textAlign="center")},_color:function(t,e,i){var n=i._colorPool.get();n.style.width="100%",n.style.height="100%",n.style.backgroundColor=t,n.setAttribute("title",t),e.appendChild(n)},_listPoints:function(t,e,i,n){var o=i._stringPool.get();o.style.whiteSpace="nowrap",o.style.verticalAlign="middle",o.style.padding="0px 2px";var s=t._as||t,a="";s.forEach(function(t,e){a+=e==s.length-1?"["+t.x+","+t.y+"]":"["+t.x+","+t.y+"],"}),t=a,Oe.setText(o,t,n),o.setAttribute("title",t),e.appendChild(o)},render:function(t,e,i,n,o){if(null!=e){var s=ki["_"+t];s?s(e,i,n,o):"boolean"==typeof e?ki._boolean(e,i,n,o):e instanceof Me.List?ki._listPoints(e,i,n,o):ki._string(e,i,n,o)}}};Oe.render=ki;var Si={toolTipDiv:null,getToolTipDiv:function(){if(!Si.toolTipDiv){Si.toolTipDiv=Ve.createElement("div");var t=Rn,e=Si.toolTipDiv.style;e.position="absolute",e.color=t.TOOLTIP_COLOR,e.background=t.TOOLTIP_BACKGROUND,e.fontSize=t.TOOLTIP_FONT_SIZE,e.padding=t.TOOLTIP_PADDING,e.border=t.TOOLTIP_BORDER,e.borderRadius=t.TOOLTIP_BORDER_RADIUS,e.boxShadow=t.TOOLTIP_BOX_SHADOW,e.zIndex=t.TOOLTIP_ZINDEX,e.setProperty&&e.setProperty("-webkit-box-shadow",t.TOOLTIP_BOX_SHADOW,null)}return Si.toolTipDiv},isToolTipVisible:function(){return Si.getToolTipDiv().parentNode?!0:!1},hideToolTip:function(){if(Si._clearTimeout(),Si._clearDismiss(),Si.isToolTipVisible()){var t=Si.getToolTipDiv();t.parentNode&&t.parentNode.removeChild(t)}},showToolTip:function(t,e,i){return t&&e?void(Si.isToolTipVisible()||Si._reshow_timeout?Si._showToolTip(t,e,i):(Si._clearTimeout(),Si._show_timeout=setTimeout(function(){Si._showToolTip(t,e,i)},Rn.TOOLTIP_INITIAL_DELAY))):void Si.hideToolTip()},_showToolTip:function(t,e,i){var n,o,s;if(t.target?(n=t.clientX,o=t.clientY):(n=t.x,o=t.y),s=Si.getToolTipDiv(),je.clear(s),e instanceof Element){var a=e.cloneNode(!0);s.appendChild(a)}else s.innerHTML=e;s.style.left=n+Rn.TOOLTIP_XOFFSET+"px",s.style.top=o+Rn.TOOLTIP_YOFFSET+"px",s.parentNode||Ve.body.appendChild(s),i&&i(s),Si._clearDismiss(),Si._dismiss_timeout=setTimeout(Si.hideToolTip,Rn.TOOLTIP_DISMISS_DELAY),Si._clearReshow(),Si._reshow_timeout=setTimeout(Si._clearReshow,Rn.TOOLTIP_RESHOW_DELAY)},_clearDismiss:function(){Si._dismiss_timeout&&(clearTimeout(Si._dismiss_timeout),Si._dismiss_timeout=null)},_clearReshow:function(){Si._reshow_timeout&&(clearTimeout(Si._reshow_timeout),Si._reshow_timeout=null)},_clearTimeout:function(){Si._show_timeout&&(clearTimeout(Si._show_timeout),Si._show_timeout=null)},resetToolTip:function(){Si.hideToolTip(),Si.toolTipDiv=null}};Oe.popup=Si;var Ii={handleClicked:function(t,e,i){if(He.isTouchable||0===e.button)if(i){var n=Li(i);n&&n.onClick&&n.onClick(i,t),t.onClickElement(i,e),t.fireInteractionEvent({kind:"clickElement",event:e,element:i})}else t.onClickBackground(e),t.fireInteractionEvent({kind:"clickBackground",event:e})},handleDoubleClicked:function(t,e,i){if((He.isTouchable||0===e.button)&&!t.isEditingElement()){if(i){var n=Li(i);n&&n.onDoubleClick&&n.onDoubleClick(i,t),t.onDoubleClickElement(i,e),t.fireInteractionEvent({kind:"doubleClickElement",event:e,element:i})}else t.onDoubleClickBackground(e),t.fireInteractionEvent({kind:"doubleClickBackground",event:e});i?i instanceof Me.Link&&t.isDoubleClickToLinkBundle()?i.ISubNetwork&&t.isDoubleClickToSubNetwork()&&!Oe.isCtrlDown(e)?(t.isDoubleClickToEmptySubNetwork()||i.getChildrenSize()>0)&&t.setCurrentSubNetwork(i,t.isSubNetworkAnimate(),function(){t.fireInteractionEvent({kind:"enterSubNetwork",event:e,element:i})}):i.reverseBundleExpanded()&&t.fireInteractionEvent({kind:"bundleLink",event:e,element:i}):i.ISubNetwork&&t.isDoubleClickToSubNetwork()?(t.isDoubleClickToEmptySubNetwork()||i.getChildrenSize()>0)&&t.setCurrentSubNetwork(i,t.isSubNetworkAnimate(),function(){t.fireInteractionEvent({kind:"enterSubNetwork",event:e,element:i})}):i instanceof Un&&t.isDoubleClickToGroupExpand()&&(i.reverseExpanded(),t.fireInteractionEvent({kind:"expandGroup",event:e,element:i})):t.isDoubleClickToUpSubNetwork()&&t.upSubNetwork(t.isSubNetworkAnimate(),function(){t.fireInteractionEvent({kind:"upSubNetwork",event:e})})}},handleKeyDown:function(t,e){Oe.isCtrlDown(e)&&65==e.keyCode?(t.isKeyboardSelectEnabled()&&t.selectAll().size()>0&&t.fireInteractionEvent({kind:"selectAll"}),je.preventDefault(e)):46==e.keyCode?(t.isKeyboardRemoveEnabled()&&t.removeSelection()&&t.fireInteractionEvent({kind:"removeElement"}),je.preventDefault(e)):Oe.showVersion(e)},handleLongClicked:function(t,e,i){if(He.isTouchable||0===e.button)if(i){var n=Li(i);n&&n.onLongClick&&n.onLongClick(i,t),t.onLongClickElement(i,e),t.fireInteractionEvent({kind:"longClickElement",event:e,element:i})}else t.onLongClickBackground(e),t.fireInteractionEvent({kind:"longClickBackground",event:e})}},Li=function(t){if(t&&t._image){if("object"==typeof t._image)return t._image;var e=Oe.getImageAsset(t._image);if(e)return e._image}return null};Oe.interaction=Ii;var Pi=function(t){return t.trim()[0].match(/[mlhvcsqta]/i)?Ni(t):Di(t)},Ri={},Di=function(t){var e=Ri[t];return e?e:(Ri[t]=e=[],t.trim().split(" ").forEach(function(t){t=t.split(","),e.push(2===t.length?{x:parseFloat(t[0]),y:parseFloat(t[1])}:t[0])}),e)},Mi={},Oi=/[mlhvcsqtaz][\d.,\-\s]*/gi,Bi=/-?(\d)+(\.(\d)+)?/g,Ni=function(t){var e,i=Mi[t];return i?i:(e=t.trim().match(Oi),Mi[t]=i=[],e&&e.forEach(function(t){var e,n=t[0],o=t.match(Bi),s=o&&o.length;if(i.push(t={c:n}),s)switch(o.forEach(function(t,e){o[e]=parseFloat(t)}),n){case"M":case"m":case"L":case"l":for(e=0;s>e;e+=2)0!==e&&i.push(t={c:"M"===n||"L"===n?"L":"l"}),t.x=o[e],t.y=o[e+1];break;case"H":case"h":for(e=0;s>e;e++)0!==e&&i.push(t={c:n}),t.x=o[e];break;case"V":case"v":for(e=0;s>e;e++)0!==e&&i.push(t={c:n}),t.y=o[e];break;case"C":case"c":for(e=0;s>e;e+=6)0!==e&&i.push(t={c:n}),t.x1=o[e],t.y1=o[e+1],t.x2=o[e+2],t.y2=o[e+3],t.x=o[e+4],t.y=o[e+5];break;case"S":case"s":for(e=0;s>e;e+=4)0!==e&&i.push(t={c:n}),t.x2=o[e],t.y2=o[e+1],t.x=o[e+2],t.y=o[e+3];break;case"Q":case"q":for(e=0;s>e;e+=4)0!==e&&i.push(t={c:n}),t.x1=o[e],t.y1=o[e+1],t.x=o[e+2],t.y=o[e+3];break;case"T":case"t":for(e=0;s>e;e+=2)0!==e&&i.push(t={c:n}),t.x=o[e],t.y=o[e+1]}}),i)},zi=function(t,e){var i,n,o,s,a,r,h,l,c,d,u,_,g=t.transform&&Fi(t.transform);return g&&g.length&&(i=Ye.identity(),g.forEach(function(t){var e=t[0];"matrix"===e?i.multiply(new Ye(t[1],t[2],t[3],t[4],t[5],t[6])):"translate"===e?i.translate(t[1]||0,t[2]||0):"scale"===e?i.scale(t[1]||1,t[2]||t[1]||1):"rotate"===e?i.rotate(t[1]||0,t[2]||0,t[3]||0):"skewX"===e?i.skew(t[1]||0,0):"skewY"===e&&i.skew(0,t[1]||0)})),"linear"===t.type?(s=t.x1||0,a=t.y1||0,r=t.x2||0,h=t.y2||0,i&&(n=i.transform(s,a),s=n.x,a=n.y,n=i.transform(r,h),r=n.x,h=n.y),o=e.createLinearGradient(s,a,r,h)):"radial"===t.type&&(l=t.fx||0,c=t.fy||0,d=t.cx||0,u=t.cy||0,_=t.r||0,null==t.fx&&(l=d),null==t.fy&&(c=u),i&&(n=i.transform(l,c),l=n.x,c=n.y,n=i.transform(d,u),d=n.x,u=n.y,_=Math.max(i._m11,i._m22)*_),o=e.createRadialGradient(l,c,0,d,u,_)),o&&t.stop&&t.stop.length&&t.stop.forEach(function(t){o.addColorStop(parseFloat(t.offset),An(t.color,e._color))}),o},Fi=function(t){return t.replace(/[\s\r\t\n]+/gm," ").trim().replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/).map(function(t){return t.replace(")","").trim().split(/\s*\(\s*|\s+,?\s*|,\s*/).map(function(t,e){return 0===e?t:parseFloat(t)})})},Vi=function(t,e,i,n,o,s,a){var r,h,l,c,d=1;"object"!=typeof e&&(h=e,r=Oe.images[e],e=r&&r.getImage()),on(e)?t.drawImage(r?r.getImage(i,n.width,n.height):e,n.x,n.y,n.width,n.height):e&&"object"==typeof e&&(t._data=o,t._view=s,h?(l=n.width/(e.w&&qi(o,e,e,"w")||o.getWidth()),c=n.height/(e.h&&qi(o,e,e,"h")||o.getHeight()),s&&(d=s.getSizeZoom?s.getSizeZoom()*s.getGraphicsZoom():s.getZoom()),!r._cache||Math.max(l*d,c*d)>1?Ui(t,e,i,n,o,s,a):t.drawImage(i?r.getImage(i,n.width,n.height):r._cache,n.x,n.y,n.width,n.height)):Ui(t,e,i,n,o,s,a),t._data=null,t._view=null)},Ui=function(t,e,i,n,o,s,a){var r,h,l,c,d,u,_,g,f,v,m,p,y,w,A,x,E,T,C,b=o&&o.getStyle("image.state");if(f=t._vector,x=t._color,v=t._fill,m=t._pattern,p=t._lineWidth,y=t._alpha,w=t._sx,A=t._sy,u=e,qi(o,u,u,"visible",s)!==!1){for(t._color=i,r=qi(o,u,u,"v",s),h=r&&r.length,T=u.w&&qi(o,u,u,"w")||o.getWidth(),C=u.h&&qi(o,u,u,"h")||o.getHeight(),_=n.width/T,g=n.height/C,a===!0?(t._fill=null,t._pattern=null,t._lineWidth=null,t._alpha=null):(t._sx=_,t._sy=g),t.save(),t.translate(n.x+n.width/2,n.y+n.height/2),(1!==_||1!==g)&&t.scale(_,g),u.origin&&t.translate((u.origin.x-.5)*T,(u.origin.y-.5)*C),t._vector=u,u.clip&&(t.beginPath(),u.clip===!0?t.rect(-(u.origin?u.origin.x:.5)*T,-(u.origin?u.origin.y:.5)*C,T,C):u.clip.length?u.clip.forEach(function(e){t.drawShape(e)}):t.drawShape(u.clip),t.clip()),Gi(o,u,u,t,s),l=0,h=r.length;h>l;l++)d=r[l],t._shapeData=d,s&&(s._shapeDataIndex=l,d.animate&&xe(d,u,o,s)),E=qi(o,u,d,"state",s),qi(o,u,d,"visible",s)===!1||E&&!(Array.isArray(E)?E.indexOf(b)>=0:E===b)||(c=Wi[d.shape],c&&(t.save(),"vector"===d.shape||"g"===d.shape?c(t,d,o,s):Gi(o,u,d,t,s,function(){c(t,d,o,s)}),t.restore())),s&&(s._shapeDataIndex=null),t._shapeData=null;t.restore(),t._vector=f,t._shapeData=null,t._color=x,t._fill=v,t._pattern=m,t._lineWidth=p,t._alpha=y,t._sx=w,t._sy=A}},Hi=function(t,e,i,n,o){var s,a,r,h,l,c,d,u,_,g=t._vector,f=g.origin,v=g.w&&qi(n,g,g,"w")||n.getWidth(),m=g.h&&qi(n,g,g,"h")||n.getHeight();if("string"==typeof e?(_=Oe.images[e],_&&(r=_.getWidth(),h=_.getHeight())):(r=e.w&&qi(n,e,e,"w"),h=e.h&&qi(n,e,e,"h")),r&&h&&i)for(l=i.w/r*t._sx,c=i.h/h*t._sy,s=i.x-v/2*(t._sx-1),a=i.y-m/2*(t._sy-1),f&&(s-=(f.x-.5)*v*(t._sx-1),a-=(f.y-.5)*m*(t._sy-1)),(1!==t._sx||1!==t._sy)&&(t.scale(1/t._sx,1/t._sy),s+=((f?f.x:.5)*v+i.x)*(t._sx-1),a+=((f?f.x:.5)*m+i.y)*(t._sy-1)),i={x:0,y:0,width:r,height:h},d=0;l>d;d++)for(u=0;c>u;u++)i.x=d*r+s,i.y=u*h+a,Vi(t,e,null,i,n,o,!0)},Wi={line:function(t,e,i,n){var o,s,a,r,h=qi(i,t._vector,e,"p1",n),l=qi(i,t._vector,e,"p2",n);h?(o=Qi(h.length?h[0]:h.x,t),s=$i(h.length?h[1]:h.y,t)):(o=qi(i,t._vector,e,"x1",n,!0),s=qi(i,t._vector,e,"y1",n,!1)),l?(a=Qi(l.length?l[0]:l.x,t),r=$i(l.length?l[1]:l.y,t)):(a=qi(i,t._vector,e,"x2",n,!0),r=qi(i,t._vector,e,"y2",n,!1)),t.moveTo(o,s),t.lineTo(a,r)},rect:function(t,e,i,n){var o,s,a,r,h=qi(i,t._vector,e,"rect",n),l=qi(i,t._vector,e,"r",n);h?(Array.isArray(h)?(o=h[0],s=h[1],a=h[2],r=h[3]):(o=h.x,s=h.y,a=h.w,r=h.h),o=Qi(o,t),s=$i(s,t),a=Qi(a,t),r=$i(r,t)):(o=qi(i,t._vector,e,"x",n,!0),s=qi(i,t._vector,e,"y",n,!1),a=qi(i,t._vector,e,"w",n,!0),r=qi(i,t._vector,e,"h",n,!1)),t.drawRoundRect(o,s,a,r,l),(t._gradientFunc||t._pattern)&&(t._rect={x:o,y:s,w:a,h:r})},circle:function(t,e,i,n){var o=qi(i,t._vector,e,"cx",n,!0),s=qi(i,t._vector,e,"cy",n,!1),a=t._vector.w&&qi(i,t._vector,t._vector,"w")||i.getWidth(),r=t._vector.h&&qi(i,t._vector,t._vector,"h")||i.getHeight(),h=tn(qi(i,t._vector,e,"r",n),Math.min(a,r),e,t._vector),l=qi(i,t._vector,e,"startAngle",n),c=qi(i,t._vector,e,"endAngle",n),d=qi(i,t._vector,e,"anticlockwise",n),u=qi(i,t._vector,e,"close",n);null==l&&(l=0),null==c&&(c=360),null==d&&(d=!1),u&&t.moveTo(o,s),t.arc(o,s,h,l/180*Math.PI,c/180*Math.PI,d),u&&t.closePath(),(t._gradientFunc||t._pattern)&&(t._rect={x:o-h,y:s-h,w:2*h,h:2*h})},ellipse:function(t,e,i,n){var o=qi(i,t._vector,e,"cx",n,!0),s=qi(i,t._vector,e,"cy",n,!1),a=qi(i,t._vector,e,"rx",n,!0),r=qi(i,t._vector,e,"ry",n,!1),h=qi(i,t._vector,e,"startAngle",n),l=qi(i,t._vector,e,"endAngle",n),c=qi(i,t._vector,e,"anticlockwise",n),d=qi(i,t._vector,e,"close",n);null==h&&(h=0),null==l&&(l=360),null==c&&(c=!1),d&&t.moveTo(o,s),t.ellipse(o,s,a,r,0,h/180*Math.PI,l/180*Math.PI,c),d&&t.closePath(),(t._gradientFunc||t._pattern)&&(t._rect={x:o-a,y:s-r,w:2*a,h:2*r})},path:function(t,e,i,n){var o=qi(i,t._vector,e,"data",n);t.drawPath(o)},text:function(t,e,i,n){var o=qi(i,t._vector,e,"text",n),s=qi(i,t._vector,e,"x",n,!0),a=qi(i,t._vector,e,"y",n,!1),r=qi(i,t._vector,e,"w",n,!0);if(null!=o){o=String(o);var h=o.split("\n"),l=2*t.measureText("e").width,c=Ae(t,o,r);a-=(c.h/l-1)/2*l,h.forEach(function(e){if(r){var i,n,o,h,c,d=e.split(" "),u=d.length,_="";for(o=0;u>o;o++)if(i=d[o]+(o===u-1?"":" "),n=_+i,h=t.measureText(n).width,r>h)_=n;else if(h==r)t.fillText(_,s,a),_="",a+=l;else{for(c=0;c<i.length;c++)if(n=_+i.substr(0,c+1),t.measureText(n).width>r){t.fillText(n.substring(0,n.length-1),s,a),_=i.substring(c,i.length),a+=l;break}for(;_.length>0&&t.measureText(_).width>r;)for(c=0;c<_.length;c++)if(n=_.substr(0,c+1),t.measureText(n).width>r){t.fillText(_.substr(0,c),s,a),_=_.substring(c,_.length),a+=l;break}}t.fillText(_,s,a)}else t.fillText(e,s,a);a+=l})}},draw:function(t,e,i,n){var o,s,a=e.draw;"string"==typeof a&&((o=a.match(Ki))?(s="with(data) { "+o[1]+" }",a=Me.Util.newFunction("g","data","view",s)):a=sn[a]),"function"==typeof a&&a.call(t._vector,t,i,n)},vector:function(t,e,i,n){var o,s,a,r,h,l,c,d,u,_,g,f,v,m=t._vector,p=qi(i,m,e,"name",n),y=qi(i,m,e,"x",n,!0),w=qi(i,m,e,"y",n,!1),A=qi(i,m,e,"w",n),x=qi(i,m,e,"h",n);if("string"==typeof p?(d=Oe.images[p],c=d&&d._image):c=p,c)if(on(c))null!=A&&null!=x?t.drawImage(c,y,w,Qi(A,t),$i(x,t)):t.drawImage(c,y,w);else{for(u=qi(i,c,c,"v",n),_=u&&u.length,g=c.w&&qi(i,c,c,"w"),f=c.h&&qi(i,c,c,"h"),null!=A&&null!=x?(A=Qi(A,t),x=$i(x,t)):(A=g,x=f),t.save(),r=t._lineWidth,h=t._fill,l=t._alpha,Gi(i,c,c,t,n),Gi(i,m,e,t,n),t.translate(y,w),t.scale(A/g,x/f),c.origin&&t.translate((c.origin.x-.5)*g,(c.origin.y-.5)*f),c.clip&&(t.beginPath(),c.clip===!0?t.rect(-(c.origin?c.origin.x:.5)*g,-(c.origin?c.origin.y:.5)*f,g,f):c.clip.length?c.clip.forEach(function(e){t.drawShape(e)}):t.drawShape(c.clip),t.clip()),v=t._shapeData,t._vector=c,o=0;_>o;o++)s=u[o],t._shapeData=s,n&&(n._shapeDataIndex.length?n._shapeDataIndex.push(o):n._shapeDataIndex=[n._shapeDataIndex,o],s.animate&&xe(s,m,i,n)),qi(i,c,s,"visible",n)!==!1&&(a=Wi[s.shape],a&&(t.save(),"vector"===s.shape||"g"===s.shape?a(t,s,i,n):Gi(i,c,s,t,n,function(){a(t,s,i,n)}),t.restore())),n&&n._shapeDataIndex.pop();t._vector=m,t._shapeData=v,t._lineWidth=r,t._fill=h,t._alpha=l,t.restore()}},g:function(t,e,i,n){var o,s,a,r,h,l=qi(i,t._vector,e,"v",n);l&&l.length&&(t.save(),s=t._lineWidth,a=t._fill,r=t._alpha,h=t._shapeData,Gi(i,t._vector,e,t,n),l.forEach(function(e){qi(i,t._vector,e,"visible",n)!==!1&&(o=Wi[e.shape],o&&(t.save(),t._shapeData=e,"vector"===e.shape||"g"===e.shape?o(t,e,i,n):Gi(i,t._vector,e,t,n,function(){o(t,e,i,n)}),t.restore()))}),t._lineWidth=s,t._fill=a,t._alpha=r,t._shapeData=h,t.restore())}};Wi.image=Wi.vector;var Yi=Object.keys(Wi),Zi={M:function(t,e){return t.moveTo(e.x,e.y),t._path_start=e,t._rect&&nn(t._rect,e.x,e.y),e},m:function(t,e,i){return i&&(e={x:i.x+e.x,y:i.y+e.y}),t.moveTo(e.x,e.y),t._path_start=e,t._rect&&nn(t._rect,e.x,e.y),e},Z:function(t){return t.closePath(),t._path_start},z:function(t){return t.closePath(),t._path_start},L:function(t,e){return t.lineTo(e.x,e.y),t._rect&&nn(t._rect,e.x,e.y),e},l:function(t,e,i){var n={x:i.x+e.x,y:i.y+e.y};return t.lineTo(n.x,n.y),t._rect&&nn(t._rect,n.x,n.y),n},H:function(t,e,i){var n={x:e.x,y:i.y};return t.lineTo(n.x,n.y),t._rect&&nn(t._rect,n.x,n.y),n},h:function(t,e,i){var n={x:i.x+e.x,y:i.y};return t.lineTo(n.x,n.y),t._rect&&nn(t._rect,n.x,n.y),n},V:function(t,e,i){var n={x:i.x,y:e.y};return t.lineTo(n.x,n.y),t._rect&&nn(t._rect,n.x,n.y),n},v:function(t,e,i){var n={x:i.x,y:i.y+e.y};return t.lineTo(n.x,n.y),t._rect&&nn(t._rect,n.x,n.y),n},Q:function(t,e){return t._preQ_x=e.x1,t._preQ_y=e.y1,t.quadraticCurveTo(e.x1,e.y1,e.x,e.y),t._rect&&(nn(t._rect,e.x1,e.y1),nn(t._rect,e.x,e.y)),e},q:function(t,e,i){var n={x:i.x+e.x,y:i.y+e.y},o=t._preQ_x=i.x+e.x1,s=t._preQ_y=i.y+e.y1;return t.quadraticCurveTo(o,s,n.x,n.y),t._rect&&(nn(t._rect,o,s),nn(t._rect,n.x,n.y)),n},T:function(t,e,i){var n=t._preQ_x=2*i.x-t._preQ_x,o=t._preQ_y=2*i.y-t._preQ_y;return t.quadraticCurveTo(n,o,e.x,e.y),t._rect&&(nn(t._rect,n,o),nn(t._rect,e.x,e.y)),e},t:function(t,e,i){var n={x:i.x+e.x,y:i.y+e.y},o=t._preQ_x=2*i.x-t._preQ_x,s=t._preQ_y=2*i.y-t._preQ_y;return t.quadraticCurveTo(o,s,n.x,n.y),t._rect&&(nn(t._rect,o,s),nn(t._rect,n.x,n.y)),n},C:function(t,e){return t._preC_x=e.x2,t._preC_y=e.y2,t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y),t._rect&&(nn(t._rect,e.x1,e.y1),nn(t._rect,e.x2,e.y2),nn(t._rect,e.x,e.y)),e},c:function(t,e,i){var n={x:i.x+e.x,y:i.y+e.y},o=i.x+e.x1,s=i.y+e.y1,a=t._preC_x=i.x+e.x2,r=t._preC_y=i.y+e.y2;return t.bezierCurveTo(o,s,a,r,n.x,n.y),t._rect&&(nn(t._rect,o,s),nn(t._rect,a,r),nn(t._rect,n.x,n.y)),n},S:function(t,e,i){var n=2*i.x-t._preC_x,o=2*i.y-t._preC_y;return t._preC_x=e.x2,t._preC_y=e.y2,t.bezierCurveTo(n,o,e.x2,e.y2,e.x,e.y),t._rect&&(nn(t._rect,n,o),nn(t._rect,e.x2,e.y2),nn(t._rect,e.x,e.y)),e},s:function(t,e,i){var n={x:i.x+e.x,y:i.y+e.y},o=2*i.x-t._preC_x,s=2*i.y-t._preC_y,a=t._preC_x=i.x+e.x2,r=t._preC_y=i.y+e.y2;return t.bezierCurveTo(o,s,a,r,n.x,n.y),t._rect&&(nn(t._rect,o,s),nn(t._rect,a,r),nn(t._rect,n.x,n.y)),n}},Gi=function(t,e,i,n,o,s){var a,r,h,l,c,d,u,_,g,f,v,m,p,y=qi(t,e,i,"line",o),w=qi(t,e,i,"fill",o),A=qi(t,e,i,"fillRule",o)||"nonzero",x=qi(t,e,i,"gradient",o),E=qi(t,e,i,"gradientColor",o),T=qi(t,e,i,"pattern",o),C=qi(t,e,i,"font",o),b=qi(t,e,i,"textAlign",o)||"center",k=qi(t,e,i,"textBaseline",o)||"middle",S=qi(t,e,i,"translate",o),I=qi(t,e,i,"rotate",o),L=qi(t,e,i,"rotateOrigin",o),P=qi(t,e,i,"scale",o),R=qi(t,e,i,"transform",o),D=qi(t,e,i,"alpha",o),M=n._lineWidth,O=n._fill,B=n._pattern,N=n._alpha,z=n._gradientFunc;if(y?(a=y.color,r=y.width,h=y.cap,l=y.join,c=y.miterLimit,d=y.dash,u=y.dashOffset):(a=qi(t,e,i,"lineColor",o),r=qi(t,e,i,"lineWidth",o),h=qi(t,e,i,"lineCap",o),l=qi(t,e,i,"lineJoin",o),c=qi(t,e,i,"miterLimit",o),d=qi(t,e,i,"lineDash",o),u=qi(t,e,i,"lineDashOffset",o)),null!=a&&(n.strokeStyle=An(a,n._color)),null!=r&&(n.lineWidth=n._lineWidth=o&&o.getSizeZoom&&!o.zoomManager.sizeChange?r/o.getSizeZoom():r),null!=h&&(n.lineCap=h),null!=l&&(n.lineJoin=l),null!=c&&(n.miterLimit=c),null!=d&&(n.lineDash=d,n.setLineDash(d)),null!=u&&(n.lineDashOffset=u),T?n._pattern=T:(w&&(n.fillStyle=n._fill=An(w,n._color)),x&&("string"==typeof x?g=Je[x]:(g=Je[x.type],x.color&&(E=x.color),g||(x=zi(x,n))),n._gradientFunc=g)),null!=C&&(n.font=C),null!=b&&(n.textAlign=b),null!=k&&(n.textBaseline=k),Xi(t,e,i,n,o),null!=R)"string"==typeof R&&(R=Fi(R)),R.length&&R.forEach(function(t){var e=t[0];"matrix"===e?n.transform(t[1],t[2],t[3],t[4],t[5],t[6]):"translate"===e?n.translate(t[1]||0,t[2]||0):"scale"===e?n.scale(t[1]||1,t[2]||t[1]||1):"rotate"===e?t.length>2?(n.translate(t[2],t[3]),n.rotate(t[1]),n.translate(-t[2],-t[3])):n.rotate(t[1]):"skewX"===e?n.transform(1,0,Math.tan(t[1]*Math.PI/180),1,0,0):"skewY"===e&&n.transform(1,Math.tan(t[1]*Math.PI/180),0,1,0,0)});else{if(null!=S&&(Array.isArray(S)?(m=S[0],p=S[1]):"object"==typeof S?(m=S.x,p=S.y):(m=S,p=0),m=Qi(m,n),p=$i(p,n),(0!==m||0!==p)&&n.translate(m,p)),null!=I&&I%360!==0){var F,V;L&&(Array.isArray(L)?(F=L[0],V=L[1]):"object"==typeof L?(F=L.x,V=L.y):F=V=L,F=Qi(F,n),V=$i(V,n),(0!==F||0!==V)&&n.translate(F,V)),n.rotate(I*Math.PI/180),L&&(0!==F||0!==V)&&n.translate(-F,-V)}null!=P&&(Array.isArray(P)?(f=P[0],v=P[1]):"object"==typeof P?(f=P.x,v=P.y):f=v=P,(1!==f||1!==v)&&n.scale(f,v))}null!=D&&(n.globalAlpha=n._alpha=null!=N?N*D:D),s&&(n.beginPath(),s(),_=n._rect||i.rect,n._pattern?(n._lineWidth>0&&n.stroke(),n.clip(),Hi(n,n._pattern,_,t,o)):(g&&_&&(x=g(n,An(w||"#000000",n._color),An(E||"#FFFFFF",n._color),_.x,_.y,_.w,_.h)),x&&(n.fillStyle=n._fill=x),n._fill&&n.fill(A),n._lineWidth>0&&n.stroke()),n._lineWidth=M,n._fill=O,n._pattern=B,n._alpha=N,n._gradientFunc=z,n._rect=null)},Xi=function(t,e,i,n,o){var s,a,r,h,l=qi(t,e,i,"shadow",o);l?(s=l.offsetX,a=l.offsetY,r=l.blur,h=l.color):(s=qi(t,e,i,"shadowOffsetX",o),a=qi(t,e,i,"shadowOffsetY",o),r=qi(t,e,i,"shadowBlur",o),h=qi(t,e,i,"shadowColor",o)),null!=s&&(n.shadowOffsetX=s),null!=a&&(n.shadowOffsetY=a),null!=r&&(n.shadowBlur=r),null!=h&&(n.shadowColor=h)},ji=/<%=([\s\S]+?)%>/,Ki=/<%([\s\S]+?)%>/,Ji=new RegExp([ji.source,Ki.source].join("|")),qi=function(t,i,n,o,s,a,r){var h,l,c,d,u,_=n[o],g=typeof _;if("string"===g&&(h=_.match(Ji))?(l="with(data) { "+(h[1]?"return "+h[1]:h[2])+" }",c=Me.Util.newFunction("data","view",l),_=c.call(i,t,s)):"function"===g&&(_=_.call(i,t,s)),a===!0?(d=i.w&&qi(t,i,i,"w")||t.getWidth(),(n.rel===!0||n.rel===e&&i.rel)&&1>=_&&_>=-1?_*=d:"string"==typeof _&&(_=parseInt(_)/100*d),_=_||0):a===!1&&(u=i.h&&qi(t,i,i,"h")||t.getHeight(),(n.rel===!0||n.rel===e&&i.rel)&&1>=_&&_>=-1?_*=u:"string"==typeof _&&(_=parseInt(_)/100*u),_=_||0),r!==!1&&s&&t&&n.animate&&t._animates){var f,v=t._animates,m=s._shapeDataIndex;if(m.length)for(var p=0;p<m.length;p++)f=m[p],v=v[f];else f=m;var y=v[f],w=y[o];if(w)if(Array.isArray(w))for(var p=w.length-1;p>=0;p--){var A=w[p];if((A.stopped||A.time>0)&&A.started)return De(A,_)}else if(w.started)return De(w,_)}return _},Qi=function(t,i){if(!t)return 0;var n=i._vector.w&&qi(i._data,i._vector,i._vector,"w")||i._data.getWidth();return(i._shapeData&&i._shapeData.rel===!0||(!i._shapeData||i._shapeData.rel===e)&&i._vector.rel)&&1>=t&&t>=-1?t*n:"string"==typeof t?parseInt(t)/100*n:t},$i=function(t,i){if(!t)return 0;var n=i._vector.h&&qi(i._data,i._vector,i._vector,"h")||i._data.getHeight();return(i._shapeData&&i._shapeData.rel===!0||(!i._shapeData||i._shapeData.rel===e)&&i._vector.rel)&&1>=t&&t>=-1?t*n:"string"==typeof t?parseInt(t)/100*n:t},tn=function(t,i,n,o){return t?(n.rel===!0||n.rel===e&&o.rel)&&1>=t&&t>=-1?t*i:"string"==typeof t?parseInt(t)/100*i:t:0},en=(t.CanvasRenderingContext2D||Ne.Context2d).prototype;en.drawShape=function(t){var e=this,i=e._vector,n=e._shapeData,o=e._data,s=e._view,a=Wi[t.shape];a&&(e.save(),e._shapeData=t,"vector"===t.shape||"g"===t.shape?a(e,t,o,s):Gi(o,i,t,e,s,function(){a(e,t,o,s)}),e._shapeData=n,e.restore())},en.drawPath=function(t){var e,i,n,o,s,a,r,h,l,c,d,u,_=this;if("string"==typeof t&&(t=Pi(t)),l=t?t.length:0,!(1>=l)){if((_._gradientFunc||_._pattern)&&(_._rect=c={x:0,y:0,w:0,h:0}),e=t&&t[0]&&t[0].c,e||(i=t&&t[0]&&null!=t[0].x,n="z"===t[l-1]||"Z"===t[l-1],n&&l--),e){for(o=0;l>o;o++)a=t[o],r=Zi[a.c],r&&(s=r(_,a,s));_._path_start=null,_._preC_x=null,_._preC_y=null,_._preQ_x=null,_._preQ_y=null}else if(i){for(h=t[0],d=Qi(h.x,_),u=$i(h.y,_),_.moveTo(d,u),c&&nn(c,d,u),o=1;l>o;o++)h=t[o],d=Qi(h.x,_),u=$i(h.y,_),_.lineTo(d,u),c&&nn(c,d,u);n&&_.closePath()}else{for(d=Qi(t[0],_),u=$i(t[1],_),_.moveTo(d,u),c&&nn(c,d,u),o=2;l>o;o+=2)d=Qi(t[o],_),u=$i(t[o+1],_),_.lineTo(d,u),c&&nn(c,d,u);n&&_.closePath()}return t}};var nn=function(t,e,i){var n=Math.min(t.x,e),o=Math.max(t.x+t.w,e),s=Math.min(t.y,i),a=Math.max(t.y+t.h,i);t.x=n,t.y=s,t.w=o-n,t.h=a-s};en._fillPath=function(t,e){var i=this;i.beginPath(),i.fillStyle=t,i.drawPath(e),i.fill()},en._fillRect=function(t,e,i,n,o){var s=this;s.beginPath(),s.fillStyle=t,s.rect(e,i,n,o),s.fill()},en.ellipse||(en.ellipse=function(t,e,i,n){var o=this,s=.5522848,a=i*s,r=n*s,h=t+i,l=e+n,c=t-i,d=e-n;o.moveTo(c,e),o.bezierCurveTo(c,e-r,t-a,d,t,d),o.bezierCurveTo(t+a,d,h,e-r,h,e),o.bezierCurveTo(h,e+r,t+a,l,t,l),o.bezierCurveTo(t-a,l,c,e+r,c,e)}),en.drawRoundRect=function(t,e,i,n,o){var s=this;if(!o)return void s.rect(t,e,i,n);var a,r,h,l;if(Array.isArray(o))if(1===o.length)a=r=h=l=o[0];else if(2===o.length)a=r=o[0],h=l=o[1];else{if(4!==o.length)return void s.rect(t,e,i,n);a=o[0],r=o[1],h=o[2],l=o[3]}else a=r=h=l=o;var c=t+i,d=e+n,u=n>i?2*i:2*n;a=u>a?a:u,r=u>r?r:u,h=u>h?h:u,l=u>l?l:u;var _=.292893218813453*l,g=.585786437626905*l;s.moveTo(c,d-l),s.quadraticCurveTo(c,d-g,c-_,d-_),s.quadraticCurveTo(c-g,d,c-l,d),_=.292893218813453*h,g=.585786437626905*h,s.lineTo(t+h,d),s.quadraticCurveTo(t+g,d,t+_,d-_),s.quadraticCurveTo(t,d-g,t,d-h),_=.292893218813453*a,g=.585786437626905*a,s.lineTo(t,e+a),s.quadraticCurveTo(t,e+g,t+_,e+_),s.quadraticCurveTo(t+g,e,t+a,e),_=.292893218813453*r,g=.585786437626905*r,s.lineTo(c-r,e),s.quadraticCurveTo(c-g,e,c-_,e+_),s.quadraticCurveTo(c,e+g,c,e+r),s.lineTo(c,d-l)};var on=function(t){return Ne?t instanceof Ne||t instanceof Ue:t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement},sn={},an=function(t,e){"function"==typeof e&&(sn[t]=e)},rn=function(t,e){"function"==typeof e&&Yi.indexOf(t)<0&&(Wi[t]=e)};!function(){for(var e=["webkit","moz"],i=0;i<e.length&&!t.requestAnimationFrame;++i){var n=e[i];t.requestAnimationFrame=t[n+"RequestAnimationFrame"],t.cancelAnimationFrame=t[n+"CancelAnimationFrame"]||t[n+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(t.navigator.userAgent)||!t.requestAnimationFrame||!t.cancelAnimationFrame){var o=0;t.requestAnimationFrame=function(t){var e=Date.now(),i=Math.max(o+16,e);return setTimeout(function(){t(o=i)},i-e)},t.cancelAnimationFrame=clearTimeout}}();var hn=Me.Animate=function(t){var e=this;e.type=null==t.type?"number":t.type,e.delay=null==t.delay?0:t.delay,e.dur=null==t.dur?1e3:t.dur,e.interval=null==t.interval?0:t.interval,e.finish=null==t.finish?e.delay+e.dur+e.interval:t.finish,null==t.finish?e.finish=e.delay+e.dur+e.interval:(e.finish=t.finish,e.interval=e.finish-e.delay-e.dur),e.repeat=null==t.repeat?1:t.repeat,e.reverse=null==t.reverse?!0:t.reverse,e.easing=null==t.easing?"easeNone":t.easing,e.onUpdate=t.onUpdate,e.onDone=t.onDone,e.onStop=t.onStop,e.onPlay=t.onPlay,e.attr=t.attr,e.source=t.source,e.filter=t.filter,e.from=t.from,e.to=t.to,e.start=null,e.time=0,e.total=0,e.count=0,e.started=!1,e.stopped=!1,e.paused=!1,e.pausedTime=null,e.pausedTotal=0,e._speed=1,e._oldSpeed=null,e._speedTotal=0,e._speedTime=null,e._percent=0,e._percentSet=null,e._percentDiff=0,e.id=cn++};Oe.ext("twaver.Animate",Object,{play:function(){return Te(this)},stop:function(t){return Ce(this,t)},pause:function(){this.stopped||(this.paused=!0)},resume:function(){this.paused&&(this.paused=!1,dn=!0)},isPaused:function(){return this.paused},percent:function(t){return null==t?this._percentSet||this._percent:(this._percentSet=0>t?0:t>100?100:t,this.paused&&(dn=!0),this.started||(this.play(),this.pause()),this)},speed:function(t){return null==t?this._speed:(t=0>t?1:t,t!==this.speed&&(this.stopped||(this._oldSpeed=this._speed),this._speed=t),this)},clone:function(){return new hn(this)},chain:function(t){var e,i=this;return i.next=t,t.pre=i,i.onDone?(e=i.onDone,i.onDone=function(){e.call(i),t.play()}):i.onDone=function(){t.play()},i}});var ln={},cn=1,dn=!1;!function t(e){Me.animateLoopId=requestAnimationFrame(t),dn&&(dn=!1,Ie(e))}(0);var un={easeNone:function(t,e,i,n){return i*t/n+e},easeIn:function(t,e,i,n){return i*(t/=n)*t+e},easeOut:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeBoth:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInStrong:function(t,e,i,n){return i*(t/=n)*t*t*t+e},easeOutStrong:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},easeBothStrong:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},elasticIn:function(t,e,i,n,o,s){var a;return 0===t?e:1===(t/=n)?e+i:(s||(s=.3*n),!o||o<Math.abs(i)?(o=i,a=s/4):a=s/(2*Math.PI)*Math.asin(i/o),-(o*Math.pow(2,10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/s))+e)},elasticOut:function(t,e,i,n,o,s){var a;return 0===t?e:1===(t/=n)?e+i:(s||(s=.3*n),!o||o<Math.abs(i)?(o=i,a=s/4):a=s/(2*Math.PI)*Math.asin(i/o),o*Math.pow(2,-10*t)*Math.sin(2*(t*n-a)*Math.PI/s)+i+e)},elasticBoth:function(t,e,i,n,o,s){var a;return 0===t?e:2===(t/=n/2)?e+i:(s||(s=.3*n*1.5),!o||o<Math.abs(i)?(o=i,a=s/4):a=s/(2*Math.PI)*Math.asin(i/o),1>t?-.5*o*Math.pow(2,10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/s)+e:o*Math.pow(2,-10*(t-=1))*Math.sin(2*(t*n-a)*Math.PI/s)*.5+i+e)},backIn:function(t,i,n,o,s){return s===e&&(s=1.70158),t===o&&(t-=.001),n*(t/=o)*t*((s+1)*t-s)+i},backOut:function(t,e,i,n,o){return"undefined"==typeof o&&(o=1.70158),i*((t=t/n-1)*t*((o+1)*t+o)+1)+e},backBoth:function(t,e,i,n,o){return"undefined"==typeof o&&(o=5.70158),(t/=n/2)<1?i/2*t*t*(((o*=1.525)+1)*t-o)+e:i/2*((t-=2)*t*(((o*=1.525)+1)*t+o)+2)+e},bounceIn:function(t,e,i,n){return i-un.bounceOut(n-t,0,i,n)+e},bounceOut:function(t,e,i,n){return(t/=n)<1/2.75?7.5625*i*t*t+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},bounceBoth:function(t,e,i,n){return n/2>t?.5*un.bounceIn(2*t,0,i,n)+e:.5*un.bounceOut(2*t-n,0,i,n)+.5*i+e}},_n={draw:function(t,e){var i=null==e.getCurrentSubNetwork()?e.getElementBox():e.getCurrentSubNetwork(),n=i.getStyle("background.type");"image"==n?this.drawImage(t,i,e):"vector"==n?this.drawVector(t,i,e):"image.vector"==n?(this.drawImage(t,i,e),this.drawVector(t,i,e)):"vector.image"==n&&(this.drawVector(t,i,e),this.drawImage(t,i,e))},drawImage:function(t,e,i){var n=e.getStyle("background.image"),o=Oe.getImageAsset(n),s=i.getGraphicsZoom?i.getGraphicsZoom():i.getZoom();if(null!=o){var a=e.getStyle("background.image.scope"),r=i.getScopeRect(a),h=i._dragToPan?0:-r.x/s,l=i._dragToPan?0:-r.y/s;("rootcanvas"==a||"viewport"==a)&&(r.x=h,r.y=l),"rootcanvas"==a&&(r.width=Math.max(o.getWidth(),r.width/s),r.height=Math.max(o.getHeight(),r.height/s)),"none"==e.getStyle("background.image.stretch")&&(r.width=o.getWidth(),r.height=o.getHeight());var c=e.getStyle("background.image.padding");if(c&&Ze.grow(r,c,c),"tile"==e.getStyle("background.image.stretch")){if(on(o.getImage()))for(var d=0;d<r.width;d+=o.getWidth())for(var u=0;u<r.height;u+=o.getHeight())t.drawImage(o.getImage(),d,u)}else("fill"==e.getStyle("background.image.stretch")||"none"==e.getStyle("background.image.stretch"))&&Vi(t,o.getImage(),null,r,e,i)}},drawVector:function(t,e,i){var n=e.getStyle("background.vector.scope"),o=i.getScopeRect(n),s=i.getGraphicsZoom?i.getGraphicsZoom():i.getZoom(),a=i._dragToPan?0:-o.x/s,r=i._dragToPan?0:-o.y/s;("rootcanvas"==n||"viewport"==n)&&(o.x=a,o.y=r),"rootcanvas"==n&&(o.width=o.width/s,o.height=o.height/s);var h=e.getStyle("background.outline.width"),l=(e.getStyle("background.outline.color"),e.getStyle("background.vector.fill")),c=e.getStyle("background.vector.fill.color"),d=e.getStyle("background.vector.padding"),u=e.getStyle("background.vector.shape"),_=e.getStyle("background.vector.pattern");d&&Ze.grow(o,d,d);var g=e.getStyle("background.vector.gradient");l&&(g?Ke.fill(t,c,g,e.getStyle("background.vector.gradient.color"),o):t.fillStyle=c,Ke.drawVector(t,u,_,o),t.fill()),h>0&&(t.lineWidth=h,t.strokeStyle=e.getStyle("background.outline.color"),Ke.drawVector(t,u,_,o),t.stroke())}},gn=Me.UndoManager=function(t){var e=this;e._list=[],e._cursor=-1,e._suspended=!1,e._dispatcher=new Me.EventDispatcher,e._box=t,e._enabled=!1,e._limit=100};gn._IGNORE_PROPERTIES={alarmState:1,propagateSeverity:1,enablePropagation:1,children:1,fromAgent:1,toAgent:1,bundleLinks:1},Oe.ext("twaver.UndoManager",Object,{setEnabled:function(t){var e=this,i=e._box;e._enabled!=t&&(t?(i.addDataBoxChangeListener(e._handleDataBoxChange,e,!0),i.addDataPropertyChangeListener(e._handleDataPropertyChange,e,!0)):(i.removeDataBoxChangeListener(e._handleDataBoxChange,e),i.removeDataPropertyChangeListener(e._handleDataPropertyChange,e))),e._enabled=t},isEnabled:function(){return this._enabled},undo:function(){var t,e,i,n=this,o=n._list;if(n.canUndo()){if(t=o[n._cursor--],n._suspended=!0,t.length)for(i=t.length,e=i-1;e>=0;e--)t[e].undo();else t.undo();n._suspended=!1,n._fire({kind:"undo",action:t})}},redo:function(){var t,e=this,i=e._list;e.canRedo()&&(t=i[++e._cursor],e._suspended=!0,t.length?t.forEach(function(t){t.redo()}):t.redo(),e._suspended=!1,e._fire({kind:"redo",action:t}))},canUndo:function(){return this._cursor>=0},canRedo:function(){return this._cursor<this._list.length-1},_add:function(t){var e=this,i=e._batch,n=e._list;i?i.push(t):(e._cursor!==n.length-1&&n.splice(e._cursor+1,n.length),0!==e._limit&&n.length===e._limit&&n.splice(0,1),n.push(t),e._cursor=n.length-1,e._fire({kind:"add",action:t}))},_handleDataBoxChange:function(t){if(!this._suspended){var e=this,i=e._box,n=t.kind,o=t.data;"add"===n?e._add({undo:function(){var t=this;t.parent=o.getParent(),t.host=o.getHost&&o.getHost(),o.getFromNode&&(t.fromNode=o.getFromNode(),t.toNode=o.getToNode()),i.remove(o)},redo:function(){var t=this;t.parent&&o.setParent(t.parent),o.getHost&&t.host&&o.setHost(t.host),o.getFromNode&&(t.fromNode&&o.setFromNode(t.fromNode),t.toNode&&o.setToNode(t.toNode)),i.add(o)}}):"remove"===n&&e._add({undo:function(){i.add(o)},redo:function(){i.remove(o)}})}},_handleDataPropertyChange:function(t){if(!this._suspended){var e=this,i=t.property,n=i.substr(0,2),o=t.source,s=t.oldValue,a=t.newValue;"C:"===n?(i=i.substr(2),e._add({undo:function(){o.setClient(i,s)},redo:function(){o.setClient(i,a)}})):"S:"===n?(i=i.substr(2),e._add({undo:function(){o.setStyle(i,s)},redo:function(){o.setStyle(i,a)}})):gn._IGNORE_PROPERTIES[i]||e._add({undo:function(){o[Oe.setter(i)](s)},redo:function(){o[Oe.setter(i)](a)}})}},size:function(){return this._list.length},getCursor:function(){return this._cursor},_fire:function(t){this._dispatcher.fire(t)},on:function(t,e,i){this._dispatcher.add(t,e,i)},off:function(t,e){this._dispatcher.remove(t,e)},isSuspended:function(){return this._suspended},setSuspended:function(t){this._suspended=t},getLimit:function(){return this._limit},setLimit:function(t){var e,i,n=this,o=n._list;return 0>t&&(t=0),t!==n._limit&&(e=o.length-t,t>0&&e>0&&(i=n._cursor+1,n._cursor-=e,n._cursor<-1&&(n._cursor=-1),i>0&&o.splice(0,i),e-=i,e>0&&o.splice(o.length-e,e)),n._limit=t,n._fire({kind:"change"})),n},clear:function(){var t=this;return t._list=[],t._cursor=-1,t._fire({kind:"clear"}),t},batch:function(t,e){var i=this;return i.startBatch(),t.call(e),i.endBatch(),i},startBatch:function(){var t=this;return t._batch||(t._batch=[]),t},endBatch:function(){var t,e=this;return e._batch&&(t=e._batch,e._batch=null,t.length&&e._add(t)),e}}),Me.Pool=function(t,e){this.func="string"==typeof t?function(){return Ve.createElement(t)}:t,this.tagName=t,null!=e&&(this.redundancy=e)},Oe.ext("twaver.Pool",Object,{redundancy:2,currentIndex:-1,get:function(){if(this.currentIndex++,this.currentIndex===this.size()){var t=this.func();return t._pool=this,t.style.margin="0px",t.style.padding="0px",this.list||(this.list=new fn),this.list.add(t),t}return this.list.get(this.currentIndex)},release:function(t){this.list&&this.list.remove(t)>=0&&(delete t._selectData,delete t._expandData,delete t._checkData,delete t._editInfo,delete t.keepDefault,t.style.margin="0px",t.style.padding="0px",t.style.backgroundColor="",t.removeAttribute("title"),"img"===this.tagName&&t.removeAttribute&&(t.removeAttribute("width"),t.removeAttribute("height"),t.removeAttribute("src")),this.list.add(t),this.currentIndex--)},reset:function(){this.currentIndex=-1},clear:function(){if(this.list)for(;this.redundancy+this.currentIndex<this.list.size()-1;)delete this.list.removeAt(this.list.size()-1)._pool},size:function(){return this.list?this.list.size():0}});var fn=function(){if(this._as=[],1===arguments.length){var t=arguments[0];if(t instanceof fn&&(t=t._as),t instanceof Array)for(var e=t.length,i=0;e>i;i++)this._as.push(t[i]);else t===!1?(this._duplicatable=!1,this._map={}):null!=t&&this._as.push(t)}else if(arguments.length>1)for(e=arguments.length,i=0;e>i;i++)this._as.push(arguments[i])};Me.List=fn,Oe.ext("twaver.List",Object,{_duplicatable:!0,size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(t,i){if(!this._duplicatable){if(this._map[t._id])return;this._map[t._id]=!0}return i===e?this._as.push(t):this._as.splice(i,0,t)},addAll:function(t){if(t instanceof fn&&(t=t._as),t instanceof Array)for(var e=t.length,i=0;e>i;i++)this.add(t[i]);else this.add(t)},get:function(t){return this._as[t]},remove:function(t){if(!this._duplicatable&&!this._map[t&&t._id])return-1;var e=this._as.indexOf(t);return e>=0&&e<this._as.length&&this.removeAt(e),e},removeAt:function(t){var e=this._as.splice(t,1)[0];return!this._duplicatable&&e&&delete this._map[e._id],e},set:function(t,e){var i=this._as[t];if(i===e)return e;if(!this._duplicatable){if(this._map[e._id])throw"duplicate item:"+e;delete this._map[i._id],this._map[e._id]=!0}return this._as[t]=e,i},clear:function(){return this._duplicatable||(this._map={}),this._as.splice(0,this._as.length)},contains:function(t){return this._duplicatable?this.indexOf(t)>=0:!!this._map[t&&t._id]},indexOf:function(t){return this._as.indexOf(t)},forEach:function(t,e){for(var i=this._as.length,n=0;i>n;n++){var o=this._as[n];e?t.call(e,o):t(o)}},forEachReverse:function(t,e){for(var i=this._as.length,n=i-1;n>=0;n--){var o=this._as[n];e?t.call(e,o):t(o)}},toArray:function(t,e){if(t){for(var i=[],n=this._as.length,o=0;n>o;o++){var s=this._as[o];e?t.call(e,s)&&i.push(s):t(s)&&i.push(s)}return i}return this._as.concat()},toList:function(t,e){if(t){for(var i=new fn,n=this._as.length,o=0;n>o;o++){var s=this._as[o];e?t.call(e,s)&&i.add(s):t(s)&&i.add(s)}return i}return new fn(this)},sort:function(t){return t?this._as.sort(t):this._as.sort(),this},toString:function(){return this._as.toString()}});var vn={shapeMap:{},init:function(){vn.register("arrow.standard",vn.createStandardArrow()),vn.register("arrow.delta",vn.createDeltaArrow()),vn.register("arrow.diamond",vn.createDiamondArrow()),vn.register("arrow.short",vn.createShortArrow()),vn.register("arrow.slant",vn.createSlantArrow()),vn.register("arrow.doubledelta",vn.createDoubleDeltaArrow()),vn.register("arrow.tee",vn.createTeeArrow()),vn.register("arrow.box",vn.createBoxArrow()),vn.register("arrow.dot",vn.createDotArrow()),vn.register("arrow.tail",vn.createTailArrow())},createStandardArrow:function(){var t=new fn;return t.add({x:-1,y:-5/9}),t.add({x:-.75,y:0}),t.add({x:-1,y:5/9}),t.add({x:0,y:0}),t.add({x:-1,y:-5/9}),{points:t}},createDeltaArrow:function(){var t=new fn;return t.add({x:-1,y:-5/9}),t.add({x:-1,y:5/9}),t.add({x:0,y:0}),t.add({x:-1,y:-5/9}),{points:t}},createDoubleDeltaArrow:function(){var t=new fn;return t.add({x:-1,y:-5/9}),t.add({x:-1,y:5/9}),t.add({x:-.5,y:0}),t.add({x:-.5,y:-5/9}),t.add({x:0,y:0}),t.add({x:-.5,y:5/9}),t.add({x:-.5,y:0}),t.add({x:-1,y:-5/9}),{points:t}},createTeeArrow:function(){var t=new fn;return t.add({x:-1/9,y:-5/9}),t.add({x:-1/9,y:5/9}),t.add({x:0,y:5/9}),t.add({x:0,y:-5/9}),t.add({x:-1/9,y:-5/9}),{points:t}},createBoxArrow:function(){var t=new fn;return t.add({x:-10/9,y:-5/9}),t.add({x:-10/9,y:5/9}),t.add({x:0,y:5/9}),t.add({x:0,y:-5/9}),t.add({x:-10/9,y:-5/9}),{points:t}},createDotArrow:function(){var t={},e=new Me.List;return e.add({x:-.5,y:0}),t.points=e,t.draw=function(t,e){if(t&&e&&e.points&&!(e.points.size()<=0)){var i=e.points._as,n=i[0],o=Math.min(e.width,e.height)/2;t.save(),t.beginPath(),t.arc(n.x,n.y,o,0,2*Math.PI,!1),t.closePath(),t.restore()}},t},createTailArrow:function(){for(var t={},e=new Me.List,i=30,n=-i/2;i/2>n;n++)e.add({x:-n/9,y:0});return t.points=e,t.draw=function(t,e){if(t&&e&&e.points&&!(e.points.size()<=0))for(var i=e.points._as,n=e.shadow,o=e.shadowColor,s=e.shadowXOffset,a=e.shadowYOffset,r=e.shadowBlur,o=e.shadowColor,h=i.length-4,l=Math.min(e.width,e.height)/2,c=0;h>c;c++){var d=c/h,u=i[c],_=.4*l;t.save(),t.restore(),t.beginPath(),t.globalAlpha=d*d,n&&(t.shadowOffsetX=s,t.shadowOffsetY=a,t.shadowBlur=r,t.shadowColor=o),t.arc(u.x,u.y,_,0,2*Math.PI,!1),t.closePath(),t.fill()}},t},createDiamondArrow:function(){var t=new fn;return t.add({x:-7/12,y:5/9}),t.add({x:-14/12,y:0}),t.add({x:-7/12,y:-5/9}),t.add({x:0,y:0}),t.add({x:-7/12,y:5/9}),{points:t}},createShortArrow:function(){var t=new fn;return t.add({x:-8/12,y:6/9}),t.add({x:-5/12,y:0}),t.add({x:-8/12,y:-6/9}),t.add({x:0,y:0}),t.add({x:-8/12,y:6/9}),{points:t}},createSlantArrow:function(){var t=new fn;return t.add({x:-1,y:-5/9}),t.add({x:-6.5/12,y:0}),t.add({x:-.75,y:4/9}),t.add({x:0,y:0}),t.add({x:-1,y:-5/9}),{points:t}},register:function(t,e){vn.shapeMap[t]=e},getShape:function(t){if(t)return vn.shapeMap[t];throw"shape type can't be null"},getArrowRect:function(t,e,i,n,o,s,a,r,h){var l=vn.getShape(n);if(l&&l.points&&!(l.points&&l.points.size()<=0)){if(a>0&&1>a){var c;c=t.getLineLength?t.getLineLength():t._element.getLineLength(),a*=c}else t.getLineLength&&(a+=vn.calculateArrowXOffsetAtEdge(e,t,i,h));var d,u,_,g=Ze.calculatePointInfoAlongLine(e,i,a,r),f=g.point,v=g.angle,m=l.points._as,p=m.length,y=new fn;for(_=new Ye(o,0,0,s,f.x,f.y),d=0;p>d;d++)y.add(_.transform(m[d]));for(_=Ze.createMatrix(v+Math.PI,f.x,f.y),d=0;p>d;d++)u=y.get(d),u instanceof fn&&(u=u._as),u instanceof Array?(u[0]=_.transform(u[0]),u[1]=_.transform(u[1])):y.set(d,_.transform(u));return Ze.getLineRect(y)}},drawArrow:function(t,e,i,n,o,s,a,r,h,l,c,d,u){h=h||0,l=l||0,c=c||0;var _=u._element.getStyle("arrow.from.shadow"),g=u._element.getStyle("arrow.from.shadow.color"),f=u._element.getStyle("arrow.from.shadow.xoffset"),v=u._element.getStyle("arrow.from.shadow.yoffset"),m=u._element.getStyle("arrow.from.shadow.blur"),p=c>=0&&d;if(a||p){var y=vn.getShape(s);if(y&&y.points&&!(y.points&&y.points.size()<=0)){var w=Ze.calculatePointInfoAlongLine(n,o,h,l),A=w.point,x=w.angle;a&&(t.fillStyle=r),t.beginPath(),p&&(t.lineWidth=c,t.strokeStyle=d),vn._drawArrow(t,y,x,A,e,i,d,g,_,f,v,m),_&&(t.shadowOffsetX=f,t.shadowOffsetY=v,t.shadowBlur=m,t.shadowColor=g),a&&t.fill(),p&&t.stroke()}}},_drawArrow:function(t,e,i,n,o,s,a,r,h,l,c,d){if(e.draw){for(var u=new Me.List,_=0;_<e.points._as.length;_++)u.add(e.points.get(_));u.add({x:-1,y:-.5}),u.add({x:-1,y:.5}),u.add({x:0,y:.5}),u.add({x:0,y:-.5}),u=u._as;var _,g,f,v=u.length,m=new fn;f=new Ye(o,0,0,s,n.x,n.y);for(var _=0;v>_;_++)m.add(f.transform(u[_]));m=m._as,f=Ze.createMatrix(i+Math.PI,n.x,n.y);for(var p=new fn,_=0;v>_;_++)p.add(f.transform(m[_]));e.draw&&e.draw(t,{points:p,width:o,height:s,shadowColor:r,shadow:h,shadowXOffset:l,shadowYOffset:c,shadowBlur:d})}else{var _,g,f,u=e.points._as,v=u.length,m=new fn;for(f=new Ye(o,0,0,s,n.x,n.y),_=0;v>_;_++)m.add(f.transform(u[_]));m=m._as,f=Ze.createMatrix(i+Math.PI,n.x,n.y);var y=m[0];for(y=f.transform(y),t.moveTo(y.x,y.y),_=1;v>_;_++)g=m[_],g instanceof fn&&(g=g._as),g instanceof Array?(g[0]=f.transform(g[0]),g[1]=f.transform(g[1]),t.quadraticCurveTo(g[0].x,g[0].y,g[1].x,g[1].y)):(g=f.transform(g),t.lineTo(g.x,g.y))}},drawLinkArrow:function(t,e,i,n){if(!(i.size()<2)){var o=t._element.isBundleAgent?t._element.isBundleAgent():!1;t._element.getStyle(o?"arrow.agent.from":"arrow.from")&&vn._drawFromArrow(t,e,i,n),t._element.getStyle(o?"arrow.agent.to":"arrow.to")&&vn._drawToArrow(t,e,i,n)}},_drawFromArrow:function(t,e,i,n){{var o=t._element,s=o.isBundleAgent?o.isBundleAgent():!1,a=o.getStyle(s?"arrow.agent.from.fill":"arrow.from.fill"),r=o.getStyle(s?"arrow.agent.from.outline.width":"arrow.from.outline.width");o.getStyle(s?"arrow.agent.from.shadow.color":"arrow.from.shadow.color")}if(a||r>=0){var h=o.getStyle(s?"arrow.agent.from.width":"arrow.from.width"),l=o.getStyle(s?"arrow.agent.from.height":"arrow.from.height"),c=o.getStyle(s?"arrow.agent.from.xoffset":"arrow.from.xoffset");if(c>0&&1>c){var d;d=t.getLineLength?t.getLineLength():t._element.getLineLength(),c*=d}else t.getLineLength&&(c+=vn.calculateArrowXOffsetAtEdge(i,t,!0,n));var u=o.getStyle(s?"arrow.agent.from.yoffset":"arrow.from.yoffset"),_=o.getStyle(s?"arrow.agent.from.shape":"arrow.from.shape");vn.drawArrow(e,h,l,i,!0,_,a,o.getStyle(s?"arrow.agent.from.color":"arrow.from.color"),c,u,r,o.getStyle(s?"arrow.agent.from.outline.color":"arrow.from.outline.color"),t)}},_drawToArrow:function(t,e,i,n){var o=t._element,s=o.isBundleAgent?o.isBundleAgent():!1,a=o.getStyle(s?"arrow.agent.to.fill":"arrow.to.fill"),r=o.getStyle(s?"arrow.agent.to.outline.width":"arrow.to.outline.width");if(a||r>=0){var h=o.getStyle(s?"arrow.agent.to.width":"arrow.to.width"),l=o.getStyle(s?"arrow.agent.to.height":"arrow.to.height"),c=o.getStyle(s?"arrow.agent.to.xoffset":"arrow.to.xoffset");if(c>0&&1>c){var d;d=t.getLineLength?t.getLineLength():t._element.getLineLength(),c*=d}else t.getLineLength&&(c+=vn.calculateArrowXOffsetAtEdge(i,t,!1,n));var u=o.getStyle(s?"arrow.agent.to.yoffset":"arrow.to.yoffset"),_=o.getStyle(s?"arrow.agent.to.shape":"arrow.to.shape");vn.drawArrow(e,h,l,i,!1,_,a,o.getStyle(s?"arrow.agent.to.color":"arrow.to.color"),c,u,r,o.getStyle(s?"arrow.agent.to.outline.color":"arrow.to.outline.color"),t)}},calculateArrowXOffsetAtEdge:function(t,e,i,n){if(null==t||t.size()<2)return 0;var o=e._element,s=o.getStyle(i?"arrow.from.at.edge":"arrow.to.at.edge");if(!s)return 0;var a=e._network.getElementUI(i?o.getFromAgent():o.getToAgent());if(!a)return 0;if(n)var r=a.getZoomBodyRect();else var r=a._bodyRect;if(null==r)return 0;for(var h=Ze._getPoint(t.get(i?0:t.size()-1)),l=0,c=e.getLineLength();vn._containsByInt(r,Math.floor(h.x),Math.floor(h.y),!1)&&c>l;)h=Ze.calculatePointInfoAlongLine(t,i,l++).point;return l},_containsByInt:function(t,i,n,o){return o=o===e?!0:o,o?i>=Math.floor(t.x)&&i<=Math.floor(t.x+t.width)&&n>=Math.floor(t.y)&&n<=Math.floor(t.y+t.height):i>Math.floor(t.x)&&i<Math.floor(t.x+t.width)&&n>Math.floor(t.y)&&n<Math.floor(t.y+t.height)}};vn.init(),Oe.arrow=vn,Me.EventDispatcher=function(){this._f=0},Oe.ext("twaver.EventDispatcher",null,{contains:function(t,e){if(this._ls)for(var i,n=0,o=this._ls.size();o>n;n++)if(i=this._ls.get(n),t===i.l&&e===i.s)return!0;return!1},add:function(t,e,i){var n={l:t,s:e,a:i};this._ls||(this._ls=new fn),this._f?(this._addPendings||(this._addPendings=new fn),this._addPendings.add(n)):n.a?this._ls.add(n,0):this._ls.add(n)},remove:function(t,e){this._ls&&(this._f?(this._removePendings||(this._removePendings=new fn),this._removePendings.add({l:t,s:e})):this._remove(t,e))},_remove:function(t,e){for(var i,n=0,o=this._ls.size();o>n;n++)if(i=this._ls.get(n),i.l===t&&i.s===e)return void this._ls.removeAt(n)},fire:function(t){if(this._ls){var e,i,n=this._ls.size();for(this._f++,e=0;n>e;e++)i=this._ls.get(e),i.s?i.l.call(i.s,t):i.l(t);if(this._f--,!this._f){if(this._removePendings){for(n=this._removePendings.size(),e=0;n>e;e++)i=this._removePendings.get(e),this._remove(i.l,i.s);delete this._removePendings}if(this._addPendings){for(n=this._addPendings.size(),e=0;n>e;e++)i=this._addPendings.get(e),i.a?this._ls.add(i,0):this._ls.add(i);delete this._addPendings}}}}}),Me.ImageAsset=function(t,e,i,n,o){this._name=t,this._width=i,this._height=n,this._svg=o,this._edgeData,"string"==typeof e?this._src=e:"function"==typeof e?this._func=e:on(e)?this._image=e:"object"==typeof e&&(this._image=e,this._width=e.w||e.width,this._height=e.h||e.height,e.cache!==!1&&kn(e)&&(Cn(t,e),this._cache=Ln(e)))},Oe.ext("twaver.ImageAsset",Object,{getName:function(){return this._name},getSrc:function(){return this._src},isSvg:function(){return this._svg},getImage:function(t,e,i){if(!t||!this._image)return this._image;this._map||(this._map={});var n;n=this._svg&&3===arguments.length?t+","+e+","+i:t;var o=this._map[n];return o?o:(o=xn(this._cache||this._image,wn(t),this._svg?e||this.getWidth():this.getWidth(),this._svg?i||this.getHeight():this.getHeight()),this._map[n]=o,o)},getWidth:function(){return this._width},getHeight:function(){return this._height},getFunction:function(){return this._func},_createEdgeData:function(t,e,i){var n=300,o=n/e;e>i&&(o=n/i);var s=Math.floor(e*o),a=Math.floor(i*o);this.tempCanvas||(this.tempCanvas=Ve.createElement("canvas"),this.ctx=this.tempCanvas.getContext("2d")),this.tempCanvas.width=s,this.tempCanvas.height=a,this.ctx.clearRect(0,0,s,a),this.ctx.drawImage(t,0,0,s,a);for(var r=this.ctx.getImageData(0,0,s,a),h=!0,l=[],c=0,e=s,i=a;i>c;c++)for(var d=0;e>d;d++){var u=4*(c*e+d),_=this._isTransparentPoint(r.data,u),g=h!=_||!_&&(0==d||d==e-1);if(g){var f=_?1:0;l.push({x:d-f,y:c})}h=_}h=!0;for(var d=0,e=s,i=a;e>d;d++)for(var c=0;i>c;c++){var u=4*(c*e+d),_=this._isTransparentPoint(r.data,u),g=h!=_||!_&&(0==c||c==i-1);if(g){var f=_?1:0;l.push({x:d,y:c-f})}h=_}for(var v=e/2,m=i/2,p=[],y=0;360>y;y++)p.push({x:v,y:m,dist:0});for(var y=0,w=l.length;w>y;y++){var A=l[y],x=this._getPointAngleDegree(A.x,A.y,v,m),E=this._getPointDist(A.x,A.y,v,m);p[x].dist<E&&(p[x]={x:A.x,y:A.y,dist:E})}for(var y=0,w=p.length;w>y;y++){var g=p[y];g.x=g.x/o,g.y=g.y/o,delete g.dist}return p},_isTransparentPoint:function(t,e){return t[e]+t[e+1]+t[e+2]+t[e+3]==0},_getPointAngleDegree:function(t,e,i,n){var o=i-t,s=n-e,a=Math.atan2(s,o);return a=a/Math.PI*180,a=parseInt(a)+180,a%=360},_getPointDist:function(t,e,i,n){var o=i-t,s=n-e;return Math.sqrt(o*o+s*s)}});var mn={},pn=je.createCanvas();pn.width=1,pn.height=1;var yn=pn.getContext("2d"),wn=function(t){t=t||"black";var e,i=mn[t];return i||(yn.clearRect(0,0,1,1),yn.fillStyle=t,yn.fillRect(0,0,1,1),e=yn.getImageData(0,0,1,1).data,i=mn[t]={r:e[0],g:e[1],b:e[2],a:e[3]}),i},An=function(t,e){if(!e)return t;if(e=wn(e),t=wn(t),Rn.PIXEL_FILTER_FUNCTION){var i=Rn.PIXEL_FILTER_FUNCTION(t,e);return"rgba("+i.r+","+i.g+","+i.b+","+t.a+")"}return null},xn=function(t,e,i,n){var o=je.createCanvas(i,n),s=o.getContext("2d");s.drawImage(t,0,0,i,n);try{for(var a=s.getImageData(0,0,i,n),r=a.data,h=0,l=r.length;l>h;h+=4){var c={r:r[h+0],g:r[h+1],b:r[h+2]},d=Rn.PIXEL_FILTER_FUNCTION(c,e);r[h+0]=d.r,r[h+1]=d.g,r[h+2]=d.b}s.putImageData(a,0,0)}catch(e){return t}return o},En={},Tn=function(t,e){if(t){var i=typeof t;"string"===i&&(t.match(Ji)||Oe.images[t]||(En[t]||(En[t]=[])).push(e))}},Cn=function(t,e){e.pattern&&Tn(e.pattern,t),e.v&&e.v.forEach(function(e){e.pattern&&Tn(e.pattern,t)})},bn=function(t){var e=En[t];e&&(e.forEach(function(t){var e=Oe.images[t];e._cache=Ln(e._image)}),delete En[t])},kn=function(t){return t.w&&t.h?Sn(t):!1},Sn=function(t){return!Object.keys(t).some(function(e){if(/^on/.test(e))return!1;var i=t[e],n=In(i);return n||"v"!==e||(n=i.some(function(t){if("draw"===t.shape)return!0;if("vector"===t.shape){var e=Oe.images[t.name];if(e&&!e._cache)return!0}var i=Object.keys(t).some(function(e){return"state"===e||"animate"===e?!0:In(t[e])});return i?!0:"g"===t.shape&&t.v&&t.v.length?!Sn(t):!1})),n})},In=function(t){var e=typeof t;return"string"===e&&t.match(Ji)||"function"===e},Ln=function(t){var e=je.createCanvas(t.w,t.h),i=e.getContext("2d");return Ui(i,t,null,{x:0,y:0,width:t.w,height:t.h}),e},Pn=Me.imageUtil={IMAGE_LOAD_COMPLETED:"IMAGE_LOAD_COMPLETED",_dispatcher:new Me.EventDispatcher,addEventListener:function(t,e,i){Pn._dispatcher.add(t,e,i)},removeEventListener:function(t,e){Pn._dispatcher.remove(t,e)},images:{},registerImageByUrl:function(t,e,i){if(e=e||Pn.getImageType(t),i=i||Pn.getImageName(t),!Pn.images[i]){Pn.images[i]=t;var n=new Ue;n.src=t,n.onload=function(){Oe.registerImage(i,n,n.width,n.height,e===!0),n.onload=null,delete Pn.images[i];var o={type:Pn.IMAGE_LOAD_COMPLETED,url:t,svg:e,name:i};Pn._dispatcher.fire(o)}}},getImageName:function(t){if("string"!=typeof t)return null;var e=t.lastIndexOf("/"),i=t;return e>=0&&(i=t.substring(e+1)),e=i.lastIndexOf("."),e>=0&&(i=i.substring(0,e)),i},getImageType:function(t){if("string"!=typeof t)return null;var e=t.lastIndexOf("/"),i=t;return e>=0&&(i=t.substring(e+1)),e=i.lastIndexOf("."),e>=0&&(i=i.substring(e+1)),i}},Rn={COLORS:["#6495ED","#FFFF00","#00FFFF","#FF0000","#7FFF00","#E0A580","#5FC0CB","#FA00F0","#A1BC50","#FFD700","#4169E1","#E5A5F5","#1E90FF","#696969","#FF6347","#00BFEF","#FFD700","#80E090","#5F9EA0","#A000FF","#7FAF00","#228BA2","#FF00FF","#7FFFD4","#800000","#0000CD","#20B2AA","#D2691E","#6495BD","#DC143C","#F0A8AF","#008B8B","#800080","#B8860B","#4B0082","#00FF00","#FFA500","#FF4500","#FFFF00","#9ACD32","#00008B","#FF1493","#ADFF2F","#4682B4","#00C0B1"],CALL_LATER_DELAY:17,SCROLL_BAR_WIDTH:17,SELECT_COLOR:"#C2CFF1",FOCUS_ON_CLICK:!0,VIEW_POSITION:"absolute",VIEW_FONT_SIZE:"12px",VIEW_FONT_FAMILY:"arial, tahoma, helvetica, sans-serif",TOOLTIP_BACKGROUND:"lightyellow",TOOLTIP_FONT_SIZE:"12px",TOOLTIP_COLOR:"black",TOOLTIP_PADDING:"4px 8px",TOOLTIP_BORDER:"1px solid gray",TOOLTIP_BORDER_RADIUS:"6px",TOOLTIP_XOFFSET:12,TOOLTIP_YOFFSET:12,TOOLTIP_BOX_SHADOW:"0px 0px 3px #AAA",TOOLTIP_ZINDEX:1e5,TOOLTIP_INITIAL_DELAY:750,TOOLTIP_RESHOW_DELAY:500,TOOLTIP_DISMISS_DELAY:4e3,ZOOM_MAX:5,ZOOM_MIN:.1,ZOOM_INCREMENT:1.3,ZOOM_ANIMATE:!0,COLUMN_INNER_TEXT:!0,COLUMN_WIDTH:80,COLUMN_HORIZONTAL_ALIGN:"",COLUMN_PROPERTY_TYPE:"accessor",COLUMN_VALUE_TYPE:"string",COLUMN_EDITABLE:!1,COLUMN_SORTABLE:!0,COLUMN_VISIBLE:!0,COLUMN_RESIZABLE:!0,COLUMN_MOVABLE:!0,COLUMN_RENDER_CELL:null,COLUMN_RENDER_HEADER:null,COLUMN_RENDER_EDITOR:null,PROPERTY_INNER_TEXT:!0,PROPERTY_HORIZONTAL_ALIGN:"",PROPERTY_PROPERTY_TYPE:"accessor",PROPERTY_VALUE_TYPE:"string",PROPERTY_EDITABLE:!1,PROPERTY_CATEGORY_NAME:null,PROPERTY_RENDER_NAME:null,PROPERTY_RENDER_VALUE:null,PROPERTY_RENDER_EDITOR:null,TAB_WIDTH:100,TAB_CLOSABLE:!1,TAB_RESIZABLE:!0,TAB_MOVABLE:!0,TAB_DISABLED:!1,TAB_VISIBLE:!0,ACCORDION_EXPAND_ICON:"expand_icon",ACCORDION_COLLAPSE_ICON:"collapse_icon",ACCORDION_TITLE_HEIGHT:20,ACCORDION_TITLE_BACKGROUND:"#EBEBEB",ACCORDION_BORDER_BOTTOM_COLOR:"lightgray",ACCORDION_ICON_POSITION:"left",TITLEPANE_TITLE_HEIGHT:20,TITLEPANE_TITLE_BACKGROUND:"#DDD",TITLEPANE_TITLE_HORIZONTAL_ALIGN:"left",BORDERPANE_HGAP:0,BORDERPANE_VGAP:0,CHARTPANE_TITLE_HEIGHT:20,CHARTPANE_TITLE_HORIZONTAL_ALIGN:"center",CHARTPANE_LEGEND_ORIENTATION:"bottom",CHARTPANE_LEGEND_WIDTH:80,LEGENDPANE_ICON_WIDTH:10,LEGENDPANE_ICON_HEIGHT:10,LEGENDPANE_ICON_RADIUS:0,LEGENDPANE_ROW_HEIGHT:20,LEGENDPANE_ORIENTATION:"horizontal",LEGENDPANE_HIDDEN_COLOR:"#BABBBC",LEGENDPANE_SELECT_BACKGROUND_COLOR:"#00007D",LEGENDPANE_SELECT_FOREGROUND_COLOR:"#FFFFFF",CHART_TOOLTIP_ENABLED:!0,CHART_SELECT_TOLERANCE:0,CHART_XGAP:6,CHART_YGAP:6,CHART_XZOOM_ENABLED:!0,CHART_YZOOM_ENABLED:!0,CHART_XTRANSLATE_ENABLED:!0,CHART_YTRANSLATE_ENABLED:!0,CHART_DOUBLE_CLICK_TO_RESET:!0,CHART_VALUE_VISIBLE:!0,CHART_VALUE_FONT:null,CHART_BACKGROUND_VISIBLE:!1,CHART_BACKGROUND_FILL:!0,CHART_BACKGROUND_FILL_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_OUTLINE_WIDTH:1,CHART_BACKGROUND_OUTLINE_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_GRADIENT:"linear.north",CHART_BACKGROUND_GRADIENT_COLOR:"#FFFFFF",PIECHART_TYPE:"oval",PIECHART_START_ANGLE:0,PIECHART_SELECT_OFFSET:5,PIECHART_SHADOW_OFFSET:1,PIECHART_SHADOW_COLOR:"#C2CFF1",PIECHART_LINE_RATE:.5,PIECHART_DONUT_RATE:.5,PIECHART_VALUE_POSITION:.5,BARCHART_TYPE:"default",BARCHART_UPPER_LIMIT:null,BARCHART_LOWER_LIMIT:0,BARCHART_XAXIS_LINE_COLOR:"#808080",BARCHART_XAXIS_LINE_WIDTH:1,BARCHART_XAXIS_TEXT_COLOR:"#000000",BARCHART_XAXIS_TEXT_FONT:null,BARCHART_YAXIS_LINE_COLOR:"#808080",BARCHART_YAXIS_LINE_WIDTH:1,BARCHART_YAXIS_TEXT_COLOR:"#000000",BARCHART_YAXIS_TEXT_FONT:null,BARCHART_XSCALE_TEXT_FONT:null,BARCHART_XSCALE_TEXT_COLOR:"#000000",BARCHART_XSCALE_TEXT_ORIENTATION:"horizontal",BARCHART_YSCALE_TEXT_VISIBLE:!0,BARCHART_YSCALE_TEXT_COLOR:"#000000",BARCHART_YSCALE_TEXT_FONT:null,BARCHART_YSCALE_LINE_COLOR:"#808080",BARCHART_YSCALE_LINE_WIDTH:.3,BARCHART_YSCALE_VALUE_GAP:0,BARCHART_YSCALE_PIXEL_GAP:20,BARCHART_YSCALE_MIN_TEXT_VISIBLE:!1,LINECHART_INTERRUPTABLE:!0,LINECHART_UPPER_LIMIT:null,LINECHART_LOWER_LIMIT:null,LINECHART_XAXIS_LINE_COLOR:"#808080",LINECHART_XAXIS_LINE_WIDTH:1,LINECHART_XAXIS_TEXT_COLOR:"#000000",LINECHART_XAXIS_TEXT_FONT:null,LINECHART_YAXIS_LINE_COLOR:"#808080",LINECHART_YAXIS_LINE_WIDTH:1,LINECHART_YAXIS_TEXT_COLOR:"#000000",LINECHART_YAXIS_TEXT_FONT:null,LINECHART_XSCALE_TEXT_FONT:null,LINECHART_XSCALE_TEXT_COLOR:"#000000",LINECHART_XSCALE_TEXT_ORIENTATION:"horizontal",LINECHART_XSCALE_LINE_COLOR:"#808080",LINECHART_XSCALE_LINE_WIDTH:.3,LINECHART_YSCALE_TEXT_VISIBLE:!0,LINECHART_YSCALE_TEXT_COLOR:"#000000",LINECHART_YSCALE_TEXT_FONT:null,LINECHART_YSCALE_LINE_COLOR:"#808080",LINECHART_YSCALE_LINE_WIDTH:.3,LINECHART_YSCALE_VALUE_GAP:0,LINECHART_YSCALE_PIXEL_GAP:20,LINECHART_YSCALE_MIN_TEXT_VISIBLE:!1,LINECHART_VALUESPANCOUNT:1,BUBBLECHART_UPPER_LIMIT:null,BUBBLECHART_LOWER_LIMIT:null,BUBBLECHART_XAXIS_UPPER_LIMIT:null,BUBBLECHART_XAXIS_LOWER_LIMIT:null,BUBBLECHART_XAXIS_LINE_COLOR:"#808080",BUBBLECHART_XAXIS_LINE_WIDTH:1,BUBBLECHART_XAXIS_TEXT_COLOR:"#000000",BUBBLECHART_XAXIS_TEXT_FONT:null,BUBBLECHART_YAXIS_LINE_COLOR:"#808080",BUBBLECHART_YAXIS_LINE_WIDTH:1,BUBBLECHART_YAXIS_TEXT_COLOR:"#000000",BUBBLECHART_YAXIS_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_COLOR:"#000000",BUBBLECHART_XSCALE_TEXT_ORIENTATION:"horizontal",BUBBLECHART_XSCALE_LINE_COLOR:"#808080",BUBBLECHART_XSCALE_LINE_WIDTH:.3,BUBBLECHART_YSCALE_TEXT_VISIBLE:!0,BUBBLECHART_YSCALE_TEXT_COLOR:"#000000",BUBBLECHART_YSCALE_TEXT_FONT:null,BUBBLECHART_YSCALE_LINE_COLOR:"#808080",BUBBLECHART_YSCALE_LINE_WIDTH:.3,BUBBLECHART_YSCALE_VALUE_GAP:0,BUBBLECHART_YSCALE_PIXEL_GAP:20,BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE:!1,BUBBLECHART_SELECT_SHADOW_COLOR:"#000000",BUBBLECHART_SELECT_SHADOW_OFFSET:3,RADARCHART_AXIS_TEXT_FONT:null,RADARCHART_AXIS_TEXT_COLOR:"#000000",RADARCHART_AXIS_TEXT_VISIBLE:!0,RADARCHART_SCALE_TEXT_FONT:null,RADARCHART_SCALE_TEXT_COLOR:"#000000",RADARCHART_SCALE_TEXT_VISIBLE:!0,RADARCHART_AXIS_VISIBLE:!0,RADARCHART_AXIS_LINE_COLOR:"#808080",RADARCHART_AXIS_LINE_WIDTH:3,RADARCHART_AXIS_START_ANGLE:0,RADARCHART_RING_VISIBLE:!0,RADARCHART_RING_TYPE:"line",RADARCHART_RING_LINE_COLOR:"#808080",RADARCHART_RING_LINE_WIDTH:1,RADARCHART_SCALE_COUNT:5,RADARCHART_SCALE_MAXVALUE:1,RADARCHART_SCALE_MINVALUE:0,RADARCHART_ANCHOR_VISIBLE:!0,RADARCHART_AREA_FILL:!0,RADARCHART_AREA_FILL_ALPHA:.2,RADARCHART_AREA_SELECT_FILL_ALPHA:.5,DIALCHART_UPPER_LIMIT:100,DIALCHART_LOWER_LIMIT:0,DIALCHART_START_ANGLE:0,DIALCHART_END_ANGLE:360,DIALCHART_INNER_RADIUS:.8,DIALCHART_COLOR_RANGE_FILL_COLOR:"#808080",DIALCHART_OUTLINE_WIDTH:0,DIALCHART_OUTLINE_COLOR:"#808080",DIALCHART_SCALE_INSIDE:!0,DIALCHART_MAJOR_SCALE_COUNT:11,DIALCHART_MAJOR_SCALE_LINE_WIDTH:2,DIALCHART_MAJOR_SCALE_LINE_LENGTH:8,DIALCHART_MAJOR_SCALE_LINE_COLOR:"#000000",DIALCHART_MINOR_SCALE_COUNT:4,DIALCHART_MINOR_SCALE_LINE_WIDTH:1,DIALCHART_MINOR_SCALE_LINE_LENGTH:4,DIALCHART_MINOR_SCALE_LINE_COLOR:"#000000",DIALCHART_SCALE_TEXT_VISIBLE:!0,DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_TEXT_FONT:null,DIALCHART_SCALE_TEXT_COLOR:"#000000",DIALCHART_PIVOT_RADIUS:10,DIALCHART_PIVOT_FILL:!0,DIALCHART_PIVOT_FILL_COLOR:"#808080",DIALCHART_PIVOT_OUTLINE_WIDTH:0,DIALCHART_PIVOT_OUTLINE_COLOR:"#808080",DIALCHART_VALUE_POSITION:.5,DIALCHART_INNER_DARKER_RADIUS:10,DIALCHART_OUTER_BRIGHTER_RADIUS:10,DIALCHART_SELECT_SHADOW_COLOR:"#000000",DIALCHART_SELECT_SHADOW_OFFSET:3,TABPANE_TAB_GAP:1,TABPANE_TAB_RADIUS:0,TABPANE_TAB_HEIGHT:24,TABPANE_TAB_ORIENTATION:"top",TABPANE_RESIZE_TOLERANCE:3,TABPANE_TAB_BACKGROUND:"#EBEBEB",TABPANE_DISABLED_COLOR:"#BABBBC",TABPANE_SELECT_BACKGROUND:"white",TABPANE_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABPANE_INSERT_BACKGROUND:"orange",TABPANE_HORIZONTAL_ALIGN:"center",TABPANE_CLOSE_ICON:"close_icon",TABPANE_SELECT_NEXT_ON_CLOSE:!0,TABPANE_SELECT_NEXT_ON_INVISIBLE:!0,LISTBASE_INNER_TEXT:!0,LIST_ROW_HEIGHT:19,LIST_INDENT:2,LIST_ROW_LINE_WIDTH:0,LIST_ROW_LINE_COLOR:"#DDD",LIST_MAKE_VISIBLE_ON_SELECTED:!0,LIST_KEYBOARD_REMOVE_ENABLED:!0,LIST_KEYBOARD_SELECT_ENABLED:!0,TREE_ROW_HEIGHT:19,TREE_INDENT:16,TREE_ROW_LINE_WIDTH:0,TREE_ROW_LINE_COLOR:"#DDD",TREE_MAKE_VISIBLE_ON_SELECTED:!0,TREE_KEYBOARD_REMOVE_ENABLED:!0,TREE_KEYBOARD_SELECT_ENABLED:!0,TREE_EXPAND_ICON:"expand_icon",TREE_COLLAPSE_ICON:"collapse_icon",TREE_LINE_TYPE:"none",TREE_LINE_THICKNESS:2,TREE_LINE_COLOR:"#000000",TREE_LINE_ALPHA:1,TREE_LINE_DASH:[4,2],TABLE_ROW_HEIGHT:19,TABLE_ROW_LINE_WIDTH:1,TABLE_ROW_LINE_COLOR:"#DDD",TABLE_COLUMN_LINE_WIDTH:1,TABLE_COLUMN_LINE_COLOR:"#DDD",TABLE_MAKE_VISIBLE_ON_SELECTED:!0,TABLE_KEYBOARD_REMOVE_ENABLED:!0,TABLE_KEYBOARD_SELECT_ENABLED:!0,TABLE_EDITABLE:!1,TABLEHEADER_HEIGHT:24,TABLEHEADER_RESIZE_TOLERANCE:3,TABLEHEADER_BACKGROUND:"#EBEBEB",TABLEHEADER_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABLEHEADER_INSERT_BACKGROUND:"orange",TABLEHEADER_COLUMN_LINE_COLOR:"#DDD",TABLEHEADER_SORT_DESC_ICON:"sort_desc",TABLEHEADER_SORT_ASC_ICON:"sort_asc",TABLEHEADER_SORT_ICON_POSITION:"98% 50%",TREETABLE_ROW_HEIGHT:19,TREETABLE_INDENT:16,TREETABLE_ROW_LINE_WIDTH:1,TREETABLE_ROW_LINE_COLOR:"#DDD",TREETABLE_COLUMN_LINE_WIDTH:1,TREETABLE_COLUMN_LINE_COLOR:"#DDD",TREETABLE_MAKE_VISIBLE_ON_SELECTED:!0,TREETABLE_KEYBOARD_REMOVE_ENABLED:!0,TREETABLE_KEYBOARD_SELECT_ENABLED:!0,TREETABLE_EXPAND_ICON:"expand_icon",TREETABLE_COLLAPSE_ICON:"collapse_icon",TREETABLE_EDITABLE:!1,PROPERTYSHEET_AUTO_ADJUSTABLE:!0,PROPERTYSHEET_INDENT:16,PROPERTYSHEET_ROW_HEIGHT:19,PROPERTYSHEET_ROW_LINE_WIDTH:1,PROPERTYSHEET_COLUMN_LINE_WIDTH:1,PROPERTYSHEET_BORDER_COLOR:"#EBEBEB",PROPERTYSHEET_EXPAND_ICON:"expand_icon",PROPERTYSHEET_COLLAPSE_ICON:"collapse_icon",PROPERTYSHEET_PROPERTY_NAME_WIDTH:100,PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN:"",PROPERTYSHEET_SUM_WIDTH:200,PROPERTYSHEET_RESIZE_TOLERANCE:3,PROPERTYSHEET_EDITABLE:!1,PROPERTYSHEET_CATEGORIZABLE:!0,PROPERTYSHEET_EXPAND_CATEGORY:!0,POPUPMENU_SUBNENU_ENABLE_ICON:"submenu_enable_icon",POPUPMENU_SUBNENU_DISABLE_ICON:"submenu_disable_icon",POPUPMENU_CHECKBOX_SELECTED_ICON:"checkbox_selected_icon",POPUPMENU_CHECKBOX_UNSELECTED_ICON:"checkbox_unselected_icon",POPUPMENU_RADIOBUTTON_SELECTED_ICON:"radiobutton_selected_icon",POPUPMENU_RADIOBUTTON_UNSELECTED_ICON:"radiobutton_unselected_icon",SPLITPANE_ORIENTATION:"horizontal",SPLITPANE_POSITION:.5,SPLITPANE_DIVIDER_WIDTH:6,SPLITPANE_DIVIDER_BACKGROUND:"#CCCCFF",SPLITPANE_DIVIDER_OPACITY:.5,SPLITPANE_MASK_BACKGROUND:"",SPLITPANE_UP_EXPAND_ICON:"up_expand_icon",SPLITPANE_DOWN_EXPAND_ICON:"down_expand_icon",SPLITPANE_LEFT_EXPAND_ICON:"left_expand_icon",SPLITPANE_RIGHT_EXPAND_ICON:"right_expand_icon",NODE_WIDTH:50,NODE_HEIGHT:50,IMAGE_NODE:"node_image",IMAGE_GROUP:"group_image",IMAGE_SUBNETWORK:"subnetwork_image",ICON_DATABOX:"databox_icon",ICON_DATA:"data_icon",ICON_NODE:"node_icon",ICON_LINK:"link_icon",ICON_GROUP:"group_icon",ICON_SUBNETWORK:"subnetwork_icon",ICON_GRID:"grid_icon",ICON_BUS:"bus_icon",ICON_SHAPENODE:"shapenode_icon",ICON_SHAPELINK:"shapelink_icon",ICON_LINKSUBNETWORK:"linksubnetwork_icon",ICON_SHAPESUBNETWORK:"shapesubnetwork_icon",LAYER_DEFAULT_ID:"default",LAYER_DEFAULT_NAME:"default",ATTACHMENT_POINTER_LENGTH:10,ATTACHMENT_POINTER_WIDTH:8,ATTACHMENT_CORNER_RADIUS:5,ATTACHMENT_CONTENT_WIDTH:30,ATTACHMENT_CONTENT_HEIGHT:20,ATTACHMENT_POSITION:"topright.topright",ATTACHMENT_XOFFSET:0,ATTACHMENT_YOFFSET:0,ATTACHMENT_PADDING:0,ATTACHMENT_PADDING_LEFT:0,ATTACHMENT_PADDING_RIGHT:0,ATTACHMENT_PADDING_TOP:0,ATTACHMENT_PADDING_BOTTOM:0,ATTACHMENT_DIRECTION:"right",ATTACHMENT_FILL:!1,ATTACHMENT_FILL_COLOR:"#000000",ATTACHMENT_GRADIENT:null,ATTACHMENT_GRADIENT_COLOR:"#FFFFFF",ATTACHMENT_OUTLINE_WIDTH:-1,ATTACHMENT_OUTLINE_COLOR:"#000000",ATTACHMENT_CAP:"butt",ATTACHMENT_JOIN:"miter",ATTACHMENT_SHADOWABLE:!0,NETWORK_TOOLTIP_ENABLED:!0,NETWORK_SELECT_MODE:"mix",NETWORK_MAKE_VISIBLE_ON_SELECTED:!0,NETWORK_NO_AGENT_LINK_VISIBLE:!1,NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE:!1,NETWORK_SUBNETWORK_ANIMATE:!0,NETWORK_SENDTOTOP_ON_SELECTED:!0,NETWORK_KEYBOARD_REMOVE_ENABLED:!0,NETWORK_KEYBOARD_SELECT_ENABLED:!0,NETWORK_RECT_SELECT_ENABLED:!0,NETWORK_DOUBLECLICK_TO_SUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_UPSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_LINKBUNDLE:!0,NETWORK_DOUBLECLICK_TO_GROUPEXPAND:!0,NETWORK_SELECT_OUTLINE_COLOR:"#2877A8",NETWORK_SELECT_OUTLINE_WIDTH:1,NETWORK_SELECT_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_OUTLINE_COLOR:"#2877A8",NETWORK_LAZYMOVE_OUTLINE_WIDTH:1,NETWORK_LAZYMOVE_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_FILL:!0,NETWORK_LAZYMOVE_ANIMATE:!0,NETWORK_RESIZE_POINT_SIZE:3,NETWORK_RESIZE_POINT_FILL_COLOR:"#FFFFFF",NETWORK_RESIZE_POINT_OUTLINE_COLOR:"#000000",NETWORK_RESIZE_POINT_OUTLINE_WIDTH:1,NETWORK_RESIZE_LINE_COLOR:"#000000",NETWORK_RESIZE_LINE_WIDTH:1,NETWORK_RESIZE_ANIMATE:!0,NETWORK_EDIT_POINT_SIZE:3,NETWORK_EDIT_POINT_FILL_COLOR:"#FFFF00",NETWORK_EDIT_POINT_OUTLINE_COLOR:"#000000",NETWORK_EDIT_POINT_OUTLINE_WIDTH:1,NETWORK_EDIT_LINE_COLOR:"rgba(184,211,240,0.7)",NETWORK_EDIT_LINE_WIDTH:2,NETWORK_ROTATE_POINT_SIZE:5,NETWORK_ROTATE_POINT_FILL_COLOR:"#FFFF00",NETWORK_ROTATE_POINT_OFFSET:15,NETWORK_ROTATE_POINT_OUTLINE_WIDTH:1,NETWORK_ROTATE_POINT_OUTLINE_COLOR:"rgba(0,0,0,1)",NETWORK_ROTATE_SCALE_FILL_COLOR:"rgb(227,166,103)",NETWORK_ROTATE_SCALE_FONT_COLOR:"#FFFFFF",NETWORK_ROTATE_SCALE_WIDTH:30,NETWORK_ROTATE_SCALE_HEIGHT:20,NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION:!0,NETWORK_LINK_FLOW_STEPPING:3,NETWORK_LINK_FLOW_COLOR:"#FF0000",NETWORK_LINK_FLOW_INTERVAL:600,NETWORK_SELECTION_TOLERANCE:2,NETWORK_TRANSPARENT_SELECTION_ENABLE:!1,SHOW_ALARM_IN_ATTACHMENT_DIV:!0,SHOW_LABEL_IN_ATTACHMENT_DIV:!1,SHOW_LABEL2_IN_ATTACHMENT_DIV:!1,SHOW_ICON_IN_ATTACHMENT_DIV:!1,SHOW_EDIT_IN_ATTACHMENT_DIV:!1,OVERVIEW_FILL_COLOR:"rgba(184,211,240,0.4)",OVERVIEW_OUTLINE_COLOR:"#B8D3F0",OVERVIEW_OUTLINE_WIDTH:1,OVERVIEW_SELECT_COLOR:"#0000FF",OVERVIEW_SELECT_WIDTH:1,OVERVIEW_PADDING:1,OVERVIEW_ANIMATE:!0,OVERVIEW_MAX_PACKING_WIDTH:-1,OVERVIEW_MAX_PACKING_HEIGHT:-1,TOUCH_MOVE_THRESHOLD:5,TOUCH_RECT_SELECT_THRESHOLD:20,TOUCH_ZOOM_THRESHOLD:30,LINK_BUNDLE_AGENT_FUNCTION:null,IS_LINK_ADJUSTED_TO_BOTTOM:!1,GROUP_EXPAND_ALIGN:"center",ELEMENTUI_FUNCTION:function(t,e){var i=e.getElementUIClass();return i?new i(t,e):null},CANVASUI_FUNCTION:function(t,e){var i=e.getCanvasUIClass();return i?new i(t,e):null},VECTORUI_FUNCTION:function(t,e){var i=e.getVectorUIClass();return i?new i(t,e):null},KEEP_DEFAULT_FUNCTION:function(t){return t.target.keepDefault||t.target.getAttribute("keepDefault")?!0:t.target.parentNode&&(t.target.parentNode.keepDefault||t.target.parentNode.getAttribute("keepDefault"))?!0:t.shiftKey?!0:!1},SORT_FUNCTION:function(t,i){if(t===i)return 0;if(null==t&&null!=i)return 1;if(null!=t&&null==i)return-1;if(null==t&&null==i)return 0;var n,o=typeof t,s=typeof i;return"string"===o&&"string"===s&&(n=t.localeCompare(i)),"number"===o&&"number"===s&&(n=t-i),n===e&&(n=(""+t).localeCompare(""+i)),n>0?1:0>n?-1:0},CENTER_LOCATION:!1,PIXEL_FILTER_FUNCTION:function(t,e){if(!e)return t;var i=.3*t.r+.59*t.g+.11*t.b;return{r:Math.floor(e.r*i/255),g:Math.floor(e.g*i/255),b:Math.floor(e.b*i/255)}}};!function(){var e=Rn;if(t.OverrideTWaverDefaults)for(var i in OverrideTWaverDefaults)e[i]=OverrideTWaverDefaults[i];e.FONT=e.VIEW_FONT_SIZE&&e.VIEW_FONT_FAMILY?e.VIEW_FONT_SIZE+" "+e.VIEW_FONT_FAMILY:Ve.createElement("canvas").getContext("2d").font,e.CHART_VALUE_FONT||(e.CHART_VALUE_FONT="10px "+e.VIEW_FONT_FAMILY),e.BARCHART_XSCALE_TEXT_FONT||(e.BARCHART_XSCALE_TEXT_FONT="10px "+e.VIEW_FONT_FAMILY),e.BARCHART_YSCALE_TEXT_FONT||(e.BARCHART_YSCALE_TEXT_FONT="10px "+e.VIEW_FONT_FAMILY),e.BARCHART_XAXIS_TEXT_FONT||(e.BARCHART_XAXIS_TEXT_FONT="12px "+e.VIEW_FONT_FAMILY),e.BARCHART_YAXIS_TEXT_FONT||(e.BARCHART_YAXIS_TEXT_FONT="12px "+e.VIEW_FONT_FAMILY),e.LINECHART_XSCALE_TEXT_FONT||(e.LINECHART_XSCALE_TEXT_FONT="10px "+e.VIEW_FONT_FAMILY),e.LINECHART_YSCALE_TEXT_FONT||(e.LINECHART_YSCALE_TEXT_FONT="10px "+e.VIEW_FONT_FAMILY),e.LINECHART_XAXIS_TEXT_FONT||(e.LINECHART_XAXIS_TEXT_FONT="12px "+e.VIEW_FONT_FAMILY),e.LINECHART_YAXIS_TEXT_FONT||(e.LINECHART_YAXIS_TEXT_FONT="12px "+e.VIEW_FONT_FAMILY),e.BUBBLECHART_XAXIS_TEXT_FONT||(e.BUBBLECHART_XAXIS_TEXT_FONT="12px "+e.VIEW_FONT_FAMILY),e.BUBBLECHART_YAXIS_TEXT_FONT||(e.BUBBLECHART_YAXIS_TEXT_FONT="12px "+e.VIEW_FONT_FAMILY),e.BUBBLECHART_XSCALE_TEXT_FONT||(e.BUBBLECHART_XSCALE_TEXT_FONT="10px "+e.VIEW_FONT_FAMILY),e.BUBBLECHART_YSCALE_TEXT_FONT||(e.BUBBLECHART_YSCALE_TEXT_FONT="10px "+e.VIEW_FONT_FAMILY),e.RADARCHART_AXIS_TEXT_FONT||(e.RADARCHART_AXIS_TEXT_FONT="12px "+e.VIEW_FONT_FAMILY),e.RADARCHART_SCALE_TEXT_FONT||(e.RADARCHART_SCALE_TEXT_FONT="10px "+e.VIEW_FONT_FAMILY),e.DIALCHART_SCALE_TEXT_FONT||(e.DIALCHART_SCALE_TEXT_FONT="10px "+e.VIEW_FONT_FAMILY)}(),Me.Defaults=Rn,Oe.ext("twaver.Defaults",Object,{}),Me.Colors={orange:"#EC6C00",orange_light:"#EF8200",orange_dark:"#EA5404",gray_light:"#666666",gray_dark:"#242424",green_light:"#57AB9A",green_dark:"#238475",blue_light:"#61B6D8",blue_dark:"#0089C1"},Me.SerializationSettings=function(){var t=Me.SerializationSettings;this.isDataBoxSerializable=t.isDataBoxSerializable,this.isLayerBoxSerializable=t.isLayerBoxSerializable,this.isStyleSerializable=t.isStyleSerializable,this.isClientSerializable=t.isClientSerializable,this.isImageSerializable=t.isImageSerializable,this._pm=Oe.clone(t._pm),this._sm=Oe.clone(t._sm),this._cm=Oe.clone(t._cm)},function(){var t=Me.SerializationSettings;t.isDataBoxSerializable=!0,t.isLayerBoxSerializable=!0,t.isStyleSerializable=!0,t.isClientSerializable=!0,t.isImageSerializable=!0,t._pm={},t._sm={},t._cm={},t.setPropertyType=function(e,i){t._pm[e]=i},t.getPropertyType=function(e){return t._pm[e]},t.setStyleType=function(e,i){t._sm[e]=i},t.getStyleType=function(e){return t._sm[e]},t.setClientType=function(e,i){t._cm[e]=i},t.getClientType=function(e){return t._cm[e]}}(),Oe.ext("twaver.SerializationSettings",Object,{setPropertyType:function(t,e){this._pm[t]=e},getPropertyType:function(t){return this._pm[t]},setStyleType:function(t,e){this._sm[t]=e},getStyleType:function(t){return this._sm[t]},setClientType:function(t,e){this._cm[t]=e},getClientType:function(t){return this._cm[t]}}),Me.Styles={_m:{},setStyle:function(t,e){null==e?delete Me.Styles._m[t]:Me.Styles._m[t]=e},getStyle:function(t){return Me.Styles._m[t]},getStyleProperties:function(){return Oe.keys(Me.Styles._m)}},function(){var t=function(t,e){Me.SerializationSettings.setPropertyType(t,e)};t("name","cdata"),t("name2","cdata"),t("icon","string"),t("toolTip","cdata"),t("parent","data"),t("layerId","string"),t("alarmState","alarmstate"),t("image","string"),t("imageUrl","string"),t("location","point"),t("width","number"),t("height","number"),t("expanded","boolean"),t("host","data"),t("fromNode","data"),t("toNode","data"),t("points","list.point"),t("segments","list.string"),t("angle","number"),t("visible","boolean"),t=function(t,e,i){null==i&&(i=null!=e?typeof e:"string"),Me.Styles.setStyle(t,e),Me.SerializationSettings.setStyleType(t,i)},t("chart.color",null),t("chart.value",0),t("chart.values",null,"list.number"),t("chart.value.color","#000000"),t("chart.value.font",null),t("chart.line.width",2),t("chart.marker.size",6),t("chart.marker.shape","circle"),t("chart.bubble.shape","circle"),t("chart.names",null,"list.string"),t("chart.xaxis.values",null,"list.number"),t("chart.yaxis.values",null,"list.number"),t("dialchart.rear.extension",0),t("dialchart.base.width",5),t("dialchart.top.width",0),t("dialchart.radius",.8),t("inner.color",null),t("outer.shape","rectangle"),t("outer.color",null),t("outer.width",2),t("outer.padding",1),t("outer.padding.left",0),t("outer.padding.right",0),t("outer.padding.top",0),t("outer.padding.bottom",0),t("outer.cap","butt"),t("outer.join","miter"),t("outer.style","border"),t("shadow.color",null),t("shadow.xoffset",3),t("shadow.yoffset",3),t("shadow.blur",6),t("select.style","shadow"),t("select.color","rgba(0, 0, 0, 0.7)"),t("select.shape","rectangle"),t("select.width",2),t("select.padding",2),t("select.padding.left",0),t("select.padding.right",0),t("select.padding.top",0),t("select.padding.bottom",0),t("select.cap","butt"),t("select.join","miter"),t("whole.alpha",1),t("body.type","default"),t("network.label",null,"cdata"),t("image.padding",0),t("image.padding.left",0),t("image.padding.right",0),t("image.padding.top",0),t("image.padding.bottom",0),t("image.state",null),t("vector.shape","rectangle"),t("vector.fill",!0),t("vector.fill.color","#CCCCFF"),t("vector.outline.width",-1),t("vector.outline.pattern",null,"array.number"),t("vector.outline.color","#5B5B5B"),t("vector.gradient","none"),t("vector.gradient.color","#FFFFFF"),t("vector.padding",0),t("vector.padding.left",0),t("vector.padding.right",0),t("vector.padding.top",0),t("vector.padding.bottom",0),t("vector.cap","butt"),t("vector.join","miter"),t("vector.deep",0),t("group.shape","rectangle"),t("group.fill",!0),t("group.fill.color","#CCCCFF"),t("group.outline.width",-1),t("group.outline.color","#5B5B5B"),t("group.gradient","none"),t("group.gradient.color","#FFFFFF"),t("group.padding",5),t("group.padding.left",0),t("group.padding.right",0),t("group.padding.top",0),t("group.padding.bottom",0),t("group.cap","butt"),t("group.join","miter"),t("group.deep",1),t("group.shape.roundrect.radius",-1),t("group.expend.image",null),t("group.expend.image.vector",!1),t("label.alpha",1),t("label.color","#000000"),t("label.font",null),t("label.position","bottom.bottom"),t("label.direction","below"),t("label.corner.radius",0),t("label.pointer.length",0),t("label.pointer.width",8),t("label.xoffset",0),t("label.yoffset",2),t("label.padding",0),t("label.padding.left",0),t("label.padding.right",0),t("label.padding.top",0),t("label.padding.bottom",0),t("label.fill",!1),t("label.fill.color","#C0C0C0"),t("label.gradient","none"),t("label.gradient.color","#FFFFFF"),t("label.outline.width",-1),t("label.outline.color","#000000"),t("label.cap","butt"),t("label.join","miter"),t("label.shadowable",!0),t("label.align","center"),t("label.rotate.angle",0),t("label.maxlength",0),t("link.label.rotatable",!1),t("label2.alpha",1),t("label2.color","#000000"),t("label2.font",null),t("label2.position","top.top"),t("label2.direction","below"),t("label2.corner.radius",0),t("label2.pointer.length",0),t("label2.pointer.width",8),t("label2.xoffset",0),t("label2.yoffset",-2),t("label2.padding",0),t("label2.padding.left",0),t("label2.padding.right",0),t("label2.padding.top",0),t("label2.padding.bottom",0),t("label2.fill",!1),t("label2.fill.color","#C0C0C0"),t("label2.gradient","none"),t("label2.gradient.color","#FFFFFF"),t("label2.outline.width",-1),t("label2.outline.color","#000000"),t("label2.cap","butt"),t("label2.join","miter"),t("label2.shadowable",!0),t("label2.align","center"),t("label2.rotate.angle",0),t("label2.maxlength",0),t("link.label2.rotatable",!1),t("icons.names",null,"array.string"),t("icons.colors",null,"array.string"),t("icons.position",null,"array.string"),t("icons.orientation",null,"array.string"),t("icons.xoffset",[0],"array.number"),t("icons.yoffset",[0],"array.number"),t("icons.xgap",[1],"array.number"),t("icons.ygap",[1],"array.number"),t("alarm.alpha",1),t("alarm.color","#000000"),t("alarm.font",null),t("alarm.position","hotspot"),t("alarm.direction","aboveright"),t("alarm.corner.radius",5),t("alarm.pointer.length",10),t("alarm.pointer.width",8),t("alarm.xoffset",0),t("alarm.yoffset",0),t("alarm.padding",0),t("alarm.padding.left",0),t("alarm.padding.right",0),t("alarm.padding.top",0),t("alarm.padding.bottom",0),t("alarm.gradient","none"),t("alarm.gradient.color","#FFFFFF"),t("alarm.outline.width",-1),t("alarm.outline.color","#000000"),t("alarm.cap","butt"),t("alarm.join","miter"),t("alarm.shadowable",!0),t("link.color","#658DC1"),t("link.width",3),t("link.cap","butt"),t("link.join","miter"),t("link.type","arc"),t("link.pattern",null,"array.number"),t("link.extend",20),t("link.control.point",null,"point"),t("link.bundle.id",0),t("link.bundle.enable",!0),t("link.bundle.expanded",!0),t("link.bundle.independent",!1),t("link.bundle.offset",20),t("link.bundle.gap",12),t("link.bundle.group.gap",0),t("link.looped.gap",6),t("link.looped.direction","northwest"),t("link.looped.type","arc"),t("link.from.position","center"),t("link.from.xoffset",0),t("link.from.yoffset",0),t("link.from.percent",null),t("link.from.at.edge",!0),t("link.to.position","center"),t("link.to.xoffset",0),t("link.to.yoffset",0),t("link.to.percent",null),t("link.to.at.edge",!0),t("link.split.by.percent",!0),t("link.split.percent",.5),t("link.split.value",20),t("link.corner","round"),t("link.xradius",8),t("link.yradius",8),t("link.flow",!1),t("link.flow.converse",!1),t("link.flow.offset",0),t("link.handler.alpha",1),t("link.handler.color","#000000"),t("link.handler.font",null),t("link.handler.position","topleft.topleft"),t("link.handler.direction","below"),t("link.handler.corner.radius",0),t("link.handler.pointer.length",0),t("link.handler.pointer.width",8),t("link.handler.xoffset",0),t("link.handler.yoffset",0),t("link.handler.padding",0),t("link.handler.padding.left",0),t("link.handler.padding.right",0),t("link.handler.padding.top",0),t("link.handler.padding.bottom",0),t("link.handler.fill",!1),t("link.handler.fill.color","#C0C0C0"),t("link.handler.gradient","none"),t("link.handler.gradient.color","#FFFFFF"),t("link.handler.outline.width",-1),t("link.handler.outline.color","#000000"),t("link.handler.cap","butt"),t("link.handler.join","miter"),t("link.handler.shadowable",!0),t("link.agent",!1),t("link.agent.color","#658DC1"),t("link.agent.width",3),t("link.agent.cap","butt"),t("link.agent.join","miter"),t("link.agent.type","arc"),t("link.agent.pattern",null,"array.number"),t("link.agent.extend",20),t("link.agent.control.point",null,"point"),t("link.agent.from.position","center"),t("link.agent.from.xoffset",0),t("link.agent.from.yoffset",0),t("link.agent.from.percent",null),t("link.agent.from.at.edge",!0),t("link.agent.to.position","center"),t("link.agent.to.xoffset",0),t("link.agent.to.yoffset",0),t("link.agent.to.percent",null),t("link.agent.to.at.edge",!0),t("link.agent.split.by.percent",!0),t("link.agent.split.percent",.5),t("link.agent.split.value",20),t("link.agent.corner","round"),t("link.agent.xradius",8),t("link.agent.yradius",8),t("link.agent.flow",!1),t("link.agent.flow.converse",!1),t("link.agent.flow.offset",0),t("follower.row.index",0),t("follower.column.index",0),t("follower.row.span",1),t("follower.column.span",1),t("follower.padding",0),t("follower.padding.left",0),t("follower.padding.right",0),t("follower.padding.top",0),t("follower.padding.bottom",0),t("follower.fill.cell",!0),t("follower.cell.position","center"),t("glow.blur",20),t("grid.row.count",1),t("grid.column.count",1),t("grid.row.percents",null,"array.number"),t("grid.column.percents",null,"array.number"),t("grid.border",1),t("grid.border.left",0),t("grid.border.right",0),t("grid.border.top",0),t("grid.border.bottom",0),t("grid.padding",1),t("grid.padding.left",0),t("grid.padding.right",0),t("grid.padding.top",0),t("grid.padding.bottom",0),t("grid.fill",!0),t("grid.fill.color","#C0C0C0"),t("grid.deep",1),t("grid.cell.deep",-1),t("shapelink.type","lineto"),t("shapenode.closed",!1),t("shapenode.pattern",null,"array.number"),t("bus.style","nearby"),t("arrow.from",!1),t("arrow.from.fill",!0),t("arrow.from.shape","arrow.standard"),t("arrow.from.color","#000000"),t("arrow.from.xoffset",0),t("arrow.from.yoffset",0),t("arrow.from.width",12),t("arrow.from.height",9),t("arrow.from.outline.color","#000000"),t("arrow.from.outline.width",-1),t("arrow.from.at.edge",!0),t("arrow.from.shadow",!1),t("arrow.from.shadow.color","#000000"),t("arrow.from.shadow.xoffset",0),t("arrow.from.shadow.yoffset",0),t("arrow.from.shadow.blur",16),t("arrow.to",!1),t("arrow.to.fill",!0),t("arrow.to.shape","arrow.standard"),t("arrow.to.color","#000000"),t("arrow.to.xoffset",0),t("arrow.to.yoffset",0),t("arrow.to.width",12),t("arrow.to.height",9),t("arrow.to.outline.color","#000000"),t("arrow.to.outline.width",-1),t("arrow.to.at.edge",!0),t("arrow.agent.from",!1),t("arrow.agent.from.fill",!0),t("arrow.agent.from.shape","arrow.standard"),t("arrow.agent.from.color","#000000"),t("arrow.agent.from.xoffset",0),t("arrow.agent.from.yoffset",0),t("arrow.agent.from.width",12),t("arrow.agent.from.height",9),t("arrow.agent.from.outline.color","#000000"),t("arrow.agent.from.outline.width",-1),t("arrow.agent.from.at.edge",!0),t("arrow.agent.from.shadow",!1),t("arrow.agent.from.shadow.color","#000000"),t("arrow.agent.from.shadow.xoffset",0),t("arrow.agent.from.shadow.yoffset",0),t("arrow.agent.from.shadow.blur",16),t("arrow.agent.to",!1),t("arrow.agent.to.fill",!0),t("arrow.agent.to.shape","arrow.standard"),t("arrow.agent.to.color","#000000"),t("arrow.agent.to.xoffset",0),t("arrow.agent.to.yoffset",0),t("arrow.agent.to.width",12),t("arrow.agent.to.height",9),t("arrow.agent.to.outline.color","#000000"),t("arrow.agent.to.outline.width",-1),t("arrow.agent.to.at.edge",!0),t("background.image",null),t("background.image.scope","viewport"),t("background.type","none"),t("background.outline.width",-1),t("background.outline.color",null),t("background.vector.padding",0),t("background.image.padding",0),t("background.image.stretch","fill"),t("background.vector.scope","viewport"),t("background.vector.fill",null),t("background.vector.fill.color",null),t("background.vector.gradient",!1),t("background.vector.gradient.color",null),t("background.vector.shape","rectangle"),t("background.outline.pattern",null,"array.number"),t("attachment.label.style","html"),t("attachment.label2.style","html"),t("attachment.alarm.style","html"),t("attachment.htmllabel.hyperlink",!1),t("attachment.htmllabel2.hyperlink",!1)}(),Oe.ext("twaver.Styles",Object,{}),Me.PropertyChangeDispatcher=function(){this._dispatcher=new Me.EventDispatcher},Oe.ext("twaver.PropertyChangeDispatcher",Object,{addPropertyChangeListener:function(t,e,i){this._dispatcher.add(t,e,i)},removePropertyChangeListener:function(t,e){this._dispatcher.remove(t,e)},firePropertyChange:function(t,e,i){if(e==i)return!1;var n={property:t,oldValue:e,newValue:i,source:this};return this._dispatcher.fire(n),this.onPropertyChanged(n),!0},onPropertyChanged:function(t){}}),Me.animate.Animate=function(){},Oe.ext("twaver.animate.Animate",Object,{current:0,step:8,delay:4,finishFunction:null,shouldBeFinished:!1,getCurrentDelay:function(){return this.delay*this.current+1},action:function(t){}}),Me.animate.AnimateProperty=function(t,e,i){this.objects=t,this.newValues=e,this.finishFunction=i,this.oldValues=new fn;for(var n=this.objects.size(),o=0;n>o;o++){var s=this.objects.get(o);this.oldValues.add(this.getPropertyValue(s))}},Oe.ext("twaver.animate.AnimateProperty",Me.animate.Animate,{action:function(t){for(var e=this.objects.size(),i=0;e>i;i++){var n=this.objects.get(i),o=this.oldValues.get(i),s=this.newValues.get(i);this.currentAction(n,o,s,t)}},getPropertyValue:function(t){},currentAction:function(t,e,i,n){}}),Me.animate.AnimateBounds=function(t,e,i){this.node=t,this.newBounds=e,this.oldBounds=t.getRect(),this.finishFunction=i},Oe.ext("twaver.animate.AnimateBounds",Me.animate.Animate,{shouldBeFinished:!0,action:function(t){var e=this.oldBounds,i=this.newBounds;this.node.setLocation(e.x+(i.x-e.x)*t,e.y+(i.y-e.y)*t),this.node.setSize(e.width+(i.width-e.width)*t,e.height+(i.height-e.height)*t)}}),Me.animate.AnimateCenterLocation=function(t,e,i){Me.animate.AnimateCenterLocation.superClass.constructor.call(this,t,e,i)},Oe.ext("twaver.animate.AnimateCenterLocation",Me.animate.AnimateProperty,{getPropertyValue:function(t){return t.getCenterLocation()},currentAction:function(t,e,i,n){var o=e.x+(i.x-e.x)*n,s=e.y+(i.y-e.y)*n;t.setCenterLocation(o,s)}}),Me.animate.AnimateLocation=function(t,e,i){Me.animate.AnimateLocation.superClass.constructor.call(this,t,e,i)},Oe.ext("twaver.animate.AnimateLocation",Me.animate.AnimateProperty,{getPropertyValue:function(t){return t.getLocation()},currentAction:function(t,e,i,n){var o=e.x+(i.x-e.x)*n,s=e.y+(i.y-e.y)*n;t.setLocation(o,s)}}),Me.animate.AnimateScrollPosition=function(t,e,i){this.view=t,this.oldHorizontalOffset=t.scrollLeft,this.oldVerticalOffset=t.scrollTop,this.newHorizontalOffset=e,this.newVerticalOffset=i},Oe.ext("twaver.animate.AnimateScrollPosition",Me.animate.Animate,{action:function(t){this.view.scrollLeft=this.oldHorizontalOffset+(this.newHorizontalOffset-this.oldHorizontalOffset)*t,this.view.scrollTop=this.oldVerticalOffset+(this.newVerticalOffset-this.oldVerticalOffset)*t}}),Me.animate.AnimateZoom=function(t,e,i){this.view=t,this.oldZoom=t.getZoom(),this.newZoom=e,this.finishFunction=i},Oe.ext("twaver.animate.AnimateZoom",Me.animate.Animate,{shouldBeFinished:!0,action:function(t){this.view.setZoom(this.oldZoom+(this.newZoom-this.oldZoom)*t,!1)}}),Me.animate.AnimateXZoom=function(t,e,i){this.view=t,this.oldXZoom=t.getXZoom(),this.newXZoom=e,this.finishFunction=i},Oe.ext("twaver.animate.AnimateXZoom",Me.animate.Animate,{shouldBeFinished:!0,action:function(t){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*t,!1)}}),Me.animate.AnimateYZoom=function(t,e,i){this.view=t,this.oldYZoom=t.getYZoom(),this.newYZoom=e,this.finishFunction=i},Oe.ext("twaver.animate.AnimateYZoom",Me.animate.Animate,{shouldBeFinished:!0,action:function(t){this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*t,!1)}}),Me.animate.AnimateXYZoom=function(t,e,i,n){this.view=t,this.oldXZoom=t.getXZoom(),this.newXZoom=e,this.oldYZoom=t.getYZoom(),this.newYZoom=i,this.finishFunction=n},Oe.ext("twaver.animate.AnimateXYZoom",Me.animate.Animate,{shouldBeFinished:!0,action:function(t){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*t,!1),this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*t,!1)}}),Me.animate.AnimateSubNetwork=function(t,e,i){this.network=t,this.subNetwork=e,this.finishFunction=i},Oe.ext("twaver.animate.AnimateSubNetwork",Me.animate.Animate,{shouldBeFinished:!0,action:function(t){t>.5?(this.network.getView().style.opacity=2*t-1,this.network._setCurrentSubNetwork(this.subNetwork)):this.network.getView().style.opacity=1-2*t}}),Me.animate.AnimateManager={timer:null,animate:null,start:function(t,e){var i=Me.animate.AnimateManager;t.current<0&&(t.current=0),e?Oe.callLater(i.startImpl,null,[t],e):i.startImpl(t)},startImpl:function(t){var e=Me.animate.AnimateManager;e.animate&&e.endAnimate(),e.animate=t,e.timer=setTimeout(e.tick,t.getCurrentDelay())},tick:function(){var t=Me.animate.AnimateManager,e=t.animate;if(e){if(e.current<0)return void e.current++;e.current<e.step&&(e.current++,e.action(e.current/e.step),t.timer=setTimeout(t.tick,e.getCurrentDelay())),e.current>=e.step&&t.endAnimate()}},endAnimate:function(){var t=Me.animate.AnimateManager;if(t.animate){t.animate.shouldBeFinished&&t.animate.current<t.animate.step&&(t.animate.current=t.animate.step,t.animate.action(t.animate.current/t.animate.step));var e=t.animate.finishFunction;t.animate=null,t.timer&&(clearTimeout(t.timer),t.timer=null),e&&e()}else t.timer&&(clearTimeout(t.timer),t.timer=null)}},Me.DataBox=function(t){Me.DataBox.superClass.constructor.apply(this,arguments),1===arguments.length&&(this._name=t),this._dataList=new fn,this._dataMap={},this._rootList=new fn,this._rootMap={},this._clientMap={},this._dataBoxChangeDispatcher=new Me.EventDispatcher,this._dataPropertyChangeDispatcher=new Me.EventDispatcher,this._hierarchyChangeDispatcher=new Me.EventDispatcher,this._selectionModel=new Me.SelectionModel(this)},Oe.ext("twaver.DataBox",Me.PropertyChangeDispatcher,{IClient:!0,__client:1,__new:1,_limit:-1,_name:"DataBox",_icon:Rn.ICON_DATABOX,__accessor:["name","icon","toolTip"],getSelectionModel:function(){return this._selectionModel},size:function(){return this._dataList.size()},isEmpty:function(){return this._dataList.isEmpty()},getLimit:function(){return this._limit},setLimit:function(t){var e=this._limit;this._limit=t,this.firePropertyChange("limit",e,t),this._checkLimit()},_checkLimit:function(){this._limit>=0&&this.size()>this._limit&&this.removeFirst(this.size()-this._limit)},removeFirst:function(t){for(0===arguments.length&&(t=1);t>0&&this._dataList.size()>0;){var e=this._dataList.get(0);this.remove(e),t--}},getSiblings:function(t){if(!this.contains(t))throw t+" dosen't belong to this dataBox";var e=t.getParent();return e?e.getChildren():this._rootList},getRoots:function(){return this._rootList},getSiblingIndex:function(t){return t.getParent()?t.getParent().getChildren().indexOf(t):this._rootList.indexOf(t)},getDatas:function(){return this._dataList},getDataAt:function(t){return this._dataList.get(t)},toDatas:function(t,e){return this._dataList.toList(t,e)},forEach:function(t,e){this._dataList.forEach(t,e)},forEachReverse:function(t,e){this._dataList.forEachReverse(t,e)},forEachByDepthFirst:function(t,e,i){if(e)this._depthFirst(t,e,i);else for(var n=this._rootList.size(),o=0;n>o;o++){var s=this._rootList.get(o);if(this._depthFirst(t,s,i)===!1)return}},_depthFirst:function(t,e,i){for(var n=e.getChildrenSize(),o=0;n>o;o++){var s=e.getChildAt(o);if(this._depthFirst(t,s,i)===!1)return!1}if(i){if(t.call(i,e)===!1)return!1}else if(t(e)===!1)return!1},forEachByBreadthFirst:function(t,e,i){var n=new fn;for(e?n.add(e):this._rootList.forEach(n.add,n);n.size()>0;)if(e=n.removeAt(0),e.getChildren().forEach(n.add,n),i){if(t.call(i,e)===!1)return}else if(t(e)===!1)return},add:function(t,e){if(t){1===arguments.length&&(e=-1);var i=t.getId();if(this._dataMap.hasOwnProperty(i))throw"Data with ID '"+i+"' already exists";this._dataBoxChangeDispatcher.fire({kind:"preAdd",data:t}),this._dataMap[i]=t,this._dataList.add(t),t.getParent()||(this._rootMap[i]=t,e>=0?this._rootList.add(t,e):this._rootList.add(t)),t.addPropertyChangeListener(this.handleDataPropertyChange,this,!0),this._dataBoxChangeDispatcher.fire({kind:"add",data:t}),this._checkLimit()}},addByDescendant:function(t){this.add(t),t.getChildren().size()>0&&t.getChildren().forEach(function(t){this.addByDescendant(t)},this)},remove:function(t){this.removeById(t.getId())},removeSelection:function(){this._selectionModel.toSelection().forEach(function(t){this.remove(t)},this)},removeById:function(t){var e=this.getDataById(t);e&&(this._dataBoxChangeDispatcher.fire({kind:"preRemove",data:e}),e instanceof Me.Link&&(e.setFromNode(null),e.setToNode(null)),e instanceof Fn&&e.getLinks()&&e.getLinks().toList().forEach(function(t){this.remove(t)},this),e instanceof Fn&&e.getFollowers()&&e.getFollowers().toList().forEach(function(t){t.setHost(null)}),e instanceof Me.Follower&&e.getHost()&&e.setHost(null),e.toChildren().forEach(function(t){this.remove(t)},this),e.getParent()&&e.getParent().removeChild(e),this._dataList.remove(e),delete this._dataMap[t],this._rootMap[t]&&(delete this._rootMap[t],this._rootList.remove(e)),this._dataBoxChangeDispatcher.fire({kind:"remove",data:e}),e.removePropertyChangeListener(this.handleDataPropertyChange,this))},clear:function(){if(this._dataList.size()>0){this._dataList.forEach(function(t){t.removePropertyChangeListener(this.handleDataPropertyChange,this)},this);var t=this._dataList.toList();this._dataList.clear(),this._dataMap={},this._rootList.clear(),this._rootMap={},this._dataBoxChangeDispatcher.fire({kind:"clear",datas:t})}},getDataById:function(t){return this._dataMap[t]},containsById:function(t){return this._dataMap.hasOwnProperty(t)},contains:function(t){return t?this._dataMap[t._id]===t:!1},moveTo:function(t,e){if(!this.contains(t))throw t+" dosen't belong to this dataBox";var i=this.getSiblings(t),n=i.indexOf(t);n===e||0>n||e>=0&&e<=i.size()&&(i.remove(t),e>i.size()&&e--,i.add(t,e),this._hierarchyChangeDispatcher.fire({data:t,oldIndex:n,newIndex:e}))},moveUp:function(t){var e=this.getSiblings(t);this.moveTo(t,e.indexOf(t)-1)},moveDown:function(t){var e=this.getSiblings(t);this.moveTo(t,e.indexOf(t)+1)},moveToTop:function(t){this.moveTo(t,0)},moveToBottom:function(t){var e=this.getSiblings(t);this.moveTo(t,e.size())},moveSelectionUp:function(t){t||(t=this._selectionModel);var e=new fn;Ci.findMoveUpDatas(t,e,this._rootList),e.forEach(this.moveUp,this)},moveSelectionDown:function(t){t||(t=this._selectionModel);var e=new fn;Ci.findMoveDownDatas(t,e,this._rootList),e.forEach(this.moveDown,this)},moveSelectionToTop:function(t){t||(t=this._selectionModel);var e=new fn;Ci.findMoveToTopDatas(t,e,this._rootList),e.forEach(this.moveToTop,this)},moveSelectionToBottom:function(t){t||(t=this._selectionModel);var e=new fn;Ci.findMoveToBottomDatas(t,e,this._rootList),e.forEach(this.moveToBottom,this)},handleDataPropertyChange:function(t){var e=t.source;if("parent"===t.property){var i=e.getId();e.getParent()?this._rootMap[i]&&(delete this._rootMap[i],this._rootList.remove(e)):this._rootMap[i]||(this._rootMap[i]=e,this._rootList.add(e))}this.onDataPropertyChanged(e,t),this._dataPropertyChangeDispatcher.fire(t)},onDataPropertyChanged:function(t,e){},addDataBoxChangeListener:function(t,e,i){this._dataBoxChangeDispatcher.add(t,e,i)},removeDataBoxChangeListener:function(t,e){this._dataBoxChangeDispatcher.remove(t,e)},addDataPropertyChangeListener:function(t,e,i){this._dataPropertyChangeDispatcher.add(t,e,i)},removeDataPropertyChangeListener:function(t,e){this._dataPropertyChangeDispatcher.remove(t,e)},addHierarchyChangeListener:function(t,e,i){this._hierarchyChangeDispatcher.add(t,e,i)},removeHierarchyChangeListener:function(t,e){this._hierarchyChangeDispatcher.remove(t,e)},getRandomData:function(t){if(t){for(var e=new Me.List,i=0;i<this._dataList.size()-1;i++){var n=this._dataList.get(i);n instanceof t&&e.add(n)}if(0==e.size())return null}var o=t?e.get(parseInt(Me.Util.random()*e.size())):this._dataList.get(parseInt(Me.Util.random()*this._dataList.size()));return o}}),Me.ElementBox=function(t){Me.ElementBox.superClass.constructor.apply(this,arguments),this._styleMap={},this._alarmBox=new Me.AlarmBox(this),this._layerBox=new Me.LayerBox(this),this._alarmStatePropagator=new Me.AlarmStatePropagator(this),this._alarmStatePropagator.setEnable(!0),this._indexChangeDispatcher=new Me.EventDispatcher,this._undoManager=new Me.UndoManager(this)},Me.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY={fromAgent:1,toAgent:1,expanded:1,parent:1,host:1},Oe.ext("twaver.ElementBox",Me.DataBox,{IStyle:!0,__style:1,_name:"ElementBox",add:function(t,e){if(t){if(!t.IElement)throw"Only IElement can be added into ElementBox";Me.ElementBox.superClass.add.apply(this,arguments),this.adjustElementIndex(t)}},onDataPropertyChanged:function(t,e){Me.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY[e.property]&&this.adjustElementIndex(t),Me.ElementBox.superClass.onDataPropertyChanged.apply(this,arguments)},addIndexChangeListener:function(t,e,i){this._indexChangeDispatcher.add(t,e,i)},removeIndexChangeListener:function(t,e){this._indexChangeDispatcher.remove(t,e)},sendToTop:function(t){if(this.contains(t)){if(t!==this.getDatas().get(this.size()-1)){var e=this.getDatas().indexOf(t);this.getDatas().removeAt(e),this.getDatas().add(t),this._indexChangeDispatcher.fire({element:t,oldIndex:e,newIndex:this.size()-1})}t instanceof Me.Link&&(t.getFromAgent()&&!t.getFromAgent().isAdjustedToBottom()&&this.sendToTop(t.getFromAgent()),t.getToAgent()&&!t.getToAgent().isAdjustedToBottom()&&this.sendToTop(t.getToAgent())),t instanceof Fn&&t.getFollowers()&&t.getFollowers().forEach(function(e){e.isRelatedTo(t)||t instanceof Me.Follower&&e.isLoopedHostOn(t)||this.sendToTop(e)},this),t.ISubNetwork||t instanceof Un&&!t.isExpanded()||t.getChildren().forEach(function(t){t instanceof Me.Link||this.sendToTop(t)},this)}},sendToBottom:function(t,e){if(t!==e&&this.contains(t)&&(!e||this.contains(e))){var i=this.getDatas().remove(t),n=0;e&&(n=this.getDatas().indexOf(e)),this.getDatas().add(t,n),i!=n&&(this._indexChangeDispatcher.fire({element:t,oldIndex:i,newIndex:n}),!t.getParent()||t.getParent().ISubNetwork||t.getParent()instanceof Me.Link||this.sendToBottom(t.getParent(),t))}},fireIndexChange:function(t,e,i){this._indexChangeDispatcher.fire({element:t,oldIndex:e,newIndex:i})},adjustElementIndex:function(t){this.contains(t)&&(t.isAdjustedToBottom()?(this.sendToBottom(t),t.getChildren().forEach(this.adjustElementIndex,this)):this.sendToTop(t))},forEachByLayer:function(t,e,i){var n=this.size(),o=this.getDatas();if(e)for(var s=0;n>s;s++){var a=o.get(s);if(this._layerBox.getLayerByElement(a)===e)if(i){if(t.call(i,a)===!1)return}else if(t(a)===!1)return}else this._layerBox.forEachByDepthFirst(function(e){for(var s=0;n>s;s++){var a=o.get(s);if(this._layerBox.getLayerByElement(a)===e)if(i){if(t.call(i,a)===!1)return}else if(t(a)===!1)return}},null,this)},forEachByLayerReverse:function(t,e,i){var n=new fn;this.forEachByLayer(function(t){n.add(t,0)},e),n.forEach(t,i)},getLayerBox:function(){return this._layerBox},getAlarmBox:function(){return this._alarmBox},getAlarmStatePropagator:function(){return this._alarmStatePropagator},startBatch:function(t,e){Me._isInitializing=!0,Me._bundleLinks={},Me._links={},t.call(e);var i,n;for(var o in Me._links)i=Me._links[o],i._checkAgentNodeImpl();for(var o in Me._bundleLinks)n=Me._bundleLinks[o],xi.resetBundleLinks(n[0],n[1]);Me._bundleLinks=null,Me._links=null,Me._isInitializing=!1},getUndoManager:function(){return this._undoManager}}),Me.SelectionModel=function(t){Me.SelectionModel.superClass.constructor.apply(this,arguments),this._selectionMode="multipleSelection",this._selectionList=new fn,this._selectionChangeDispatcher=new Me.EventDispatcher,this._selectionMap={},this._setDataBox(t)},Oe.ext("twaver.SelectionModel",Me.PropertyChangeDispatcher,{getSelectionMode:function(){return this._selectionMode},setSelectionMode:function(t){if(this._selectionMode!==t&&("noneSelection"===t||"singleSelection"===t||"multipleSelection"===t)){this.clearSelection();var e=this._selectionMode;this._selectionMode=t,this.firePropertyChange("selectionMode",e,this._selectionMode)}},getDataBox:function(){return this._dataBox},_setDataBox:function(t){if(!t)throw"dataBox can not be null";if(this._dataBox!==t){this._dataBox&&(this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this));var e=this._dataBox;this._dataBox=t,this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this.firePropertyChange("dataBox",e,this._dataBox)}},dispose:function(){this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this)},handleDataBoxChange:function(t){if("remove"===t.kind){var e=t.data;this.contains(e)&&(this._selectionList.remove(e),delete this._selectionMap[e.getId()],this.fireSelectionChange("remove",new fn(e)))}else"clear"===t.kind&&this.clearSelection()},getFilterFunction:function(){return this._filterFunction},setFilterFunction:function(t){if(this._filterFunction!==t){this.clearSelection();var e=this._filterFunction;this._filterFunction=t,this.firePropertyChange("filterFunction",e,this._filterFunction)}},fireSelectionChange:function(t,e,i){i&&(this._selectionList.forEach(function(t){i.contains(t)?i.remove(t):i.add(t)}),e=i.toList()),this._selectionChangeDispatcher.fire({kind:t,datas:new fn(e)})},addSelectionChangeListener:function(t,e,i){this._selectionChangeDispatcher.add(t,e,i)},removeSelectionChangeListener:function(t,e){this._selectionChangeDispatcher.remove(t,e)},_filterList:function(t,e){for(var i=new fn(t),n=0;n<i.size();n++){var o=i.get(n);(this._filterFunction&&!this._filterFunction(o)||e&&this.contains(o)||!e&&!this.contains(o)||!this._dataBox.contains(o))&&(i.removeAt(n),n--)}return i},appendSelection:function(t){if("noneSelection"!==this._selectionMode){var e=this._filterList(t,!0);if(!e.isEmpty()){var i=null;"singleSelection"===this._selectionMode&&(i=new fn(this._selectionList),this._selectionList.clear(),this._selectionMap={},e=new fn(e.get(e.size()-1)));for(var n=0;n<e.size();n++){var o=e.get(n);this._selectionList.add(o),this._selectionMap[o.getId()]=o}this.fireSelectionChange("append",e,i)}}},removeSelection:function(t){var e=this._filterList(t);if(0!==e.size()){for(var i=0;i<e.size();i++){var n=e.get(i);this._selectionList.remove(n),delete this._selectionMap[n.getId()]}this.fireSelectionChange("remove",e)}},toSelection:function(t,e){return this._selectionList.toList(t,e)},getSelection:function(){return this._selectionList},setSelection:function(t){if("noneSelection"!==this._selectionMode&&(0!==this._selectionList.size()||null!=t)){var e=new fn(this._selectionList);this._selectionList.clear(),this._selectionMap={};var i=this._filterList(t,!0);"singleSelection"===this._selectionMode&&i.size()>1&&(i=new fn(i.get(i.size()-1)));for(var n=0;n<i.size();n++){var o=i.get(n);this._selectionList.add(o),this._selectionMap[o.getId()]=o}this.fireSelectionChange("set",null,e)}},clearSelection:function(){if(this._selectionList.size()>0){var t=this._selectionList.toList();this._selectionList.clear(),this._selectionMap={},this.fireSelectionChange("clear",t)}},selectAll:function(){if("noneSelection"!==this._selectionMode){var t=this._dataBox.toDatas(),e=0,i=null;if(this._filterFunction)for(e=0;e<t.size();e++)i=t.get(e),this._filterFunction(i)||(t.removeAt(e),e--);var n=new fn(this._selectionList);for(this._selectionList.clear(),this._selectionMap={},"singleSelection"===this._selectionMode&&t.size()>1&&(t=new fn(t.get(t.size()-1))),e=0;e<t.size();e++)i=t.get(e),this._selectionList.add(i),this._selectionMap[i.getId()]=i;this.fireSelectionChange("all",null,n)}},size:function(){return this._selectionList.size()},contains:function(t){return t?null!=this._selectionMap[t.getId()]:!1},getLastData:function(){return this._selectionList.size()>0?this._selectionList.get(this._selectionList.size()-1):null},getFirstData:function(){return this._selectionList.size()>0?this._selectionList.get(0):null},isSelectable:function(t){return t?"noneSelection"===this._selectionMode?!1:this._filterFunction&&!this._filterFunction(t)?!1:!0:!1}}),Me.QuickFinder=function(t,e,i,n,o){if(this._map={},!t)throw"dataBox can not be null";if(!e)throw"propertyName can not be null";this._dataBox=t,this._propertyName=e,this._propertyType=i||"accessor","accessor"===this._propertyType&&(this._getter=Oe.getter(e)),this._valueFunction=n||this.getValue,this._filterFunction=o||this.isInterested,this._dataBox.forEach(this._addData,this),this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this,!0)},Oe.ext("twaver.QuickFinder",Object,{_NULL_:"twaver-null-key",getValueFunction:function(){return this._valueFunction},getFilterFunction:function(){return this._filterFunction},handleDataBoxChange:function(t){"add"===t.kind?this._addData(t.data):"remove"===t.kind?this._removeData(t.data):"clear"===t.kind&&(this._map={})},handleDataPropertyChange:function(t){if(this._filterFunction.call(this,t.source)){if("accessor"===this._propertyType&&this._propertyName===t.property);else if("style"===this._propertyType&&t.source.IStyle&&"S:"+this._propertyName===t.property);else if("client"!==this._propertyType||"C:"+this._propertyName!==t.property)return;var e=this._getMap(t.oldValue);e&&e.remove(t.source),this._addData(t.source)}},_getMap:function(t){return t=null==t?this._NULL_:t,this._map[t]},find:function(t){var e=this._getMap(t);return e?e.toList():new fn},findFirst:function(t){var e=this._getMap(t);return!e||e.isEmpty()?null:e.get(0)},_addData:function(t){if(this._filterFunction.call(this,t)){var e=this._valueFunction.call(this,t),i=this._getMap(e);i||(i=new fn,e=null==e?this._NULL_:e,this._map[e]=i),i.add(t)}},_removeData:function(t){if(this._filterFunction.call(this,t)){var e=this._valueFunction.call(this,t),i=this._getMap(e);i&&(i.remove(t),i.isEmpty()&&(e=null==e?this._NULL_:e,delete this._map[e]))}},dispose:function(){this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),delete this._dataBox},getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isInterested:function(t){return("style"!==this._propertyType||t.IStyle)&&("accessor"!==this._propertyType||this._valueFunction!==this.getValue||t[this._getter])?!0:!1},getValue:function(t){return"accessor"===this._propertyType?t[this._getter]():"style"===this._propertyType&&t.getStyle?t.getStyle(this._propertyName):"client"===this._propertyType&&t.getClient?t.getClient(this._propertyName):null}}),Me.PropertyPropagator=function(t,e,i){if(!t)throw"dataBox can not be null";if(!e)throw"propertyName can not be null";this._dataBox=t,this._propertyName=e,this._propertyType=i||"accessor","accessor"===this._propertyType&&(this._getter=Oe.getter(e),this._setter=Oe.setter(e)),this._enable=!1,this._isPropagating=!1},Oe.ext("twaver.PropertyPropagator",Object,{getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isEnable:function(){return this._enable},setEnable:function(t){this._enable!==t&&(this._enable=t,this._enable?(this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this._dataBox.forEach(function(t){this.propagate(t)},this)):(this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this)))},handleDataBoxChange:function(t){t.data&&this.propagate(t.data)},handleDataPropertyChange:function(t){if(this.isInterestedProperty(t))this.propagate(t.source);else if("parent"===t.property){var e=t.oldValue;e&&this.propagate(e),this.propagate(t.source)}},isInterestedProperty:function(t){return"accessor"===this._propertyType&&this._propertyName===t.property?!0:"style"===this._propertyType&&t.IElement&&"S:"+this._propertyName===t.property?!0:"client"===this._propertyType&&"C:"+this._propertyName===t.property?!0:!1},propagate:function(t){t&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(t),this._isPropagating=!1)},propagateToTop:function(t){for(this.propagateToParent(null,t);t&&t.getParent();)this.propagateToParent(t,t.getParent()),t=t.getParent()},propagateToParent:function(t,e){}}),Me.AlarmStatePropagator=function(t){Me.AlarmStatePropagator.superClass.constructor.call(this,t,"alarmState")},Oe.ext("twaver.AlarmStatePropagator",Me.PropertyPropagator,{handleDataPropertyChange:function(t){"enablePropagation"===t.property?this.propagate(t.source):Me.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this,t)},propagateToParent:function(t,e){var i=null;e.getChildren().forEach(function(t){var e=t.getAlarmState().getHighestOverallAlarmSeverity();Me.AlarmSeverity.compare(e,i)>0&&(i=e)}),e.getAlarmState().setPropagateSeverity(i)}}),Me.AlarmSeverity=function(t,e,i,n,o){this.value=t,this.name=e,this.nickName=i,this.color=n,this.displayName=o},Oe.ext("twaver.AlarmSeverity",Object,{toString:function(){return this.displayName?this.displayName:this.name}}),function(){var t=Me.AlarmSeverity;t.severities=new fn,t._vm={},t._nm={},t._cp=function(t,e){if(t&&e){var i=t.value-e.value;return i>0?1:0>i?-1:0}return t&&!e?1:!t&&e?-1:0},t.forEach=function(e,i){t.severities.forEach(e,i)},t.getSortFunction=function(){return t._cp},t.setSortFunction=function(e){t._cp=e,t.severities.sort(e)},t.add=function(e,i,n,o,s){var a=new t(e,i,n,o,s);return t._vm[e]=a,t._nm[i]=a,t.severities.add(a),t.severities.sort(t._cp),a},t.remove=function(e){var i=t._nm[e];return i&&(delete t._nm[e],delete t._vm[i.value],t.severities.remove(i)),i},t.CRITICAL=t.add(500,"Critical","C","#FF0000"),t.MAJOR=t.add(400,"Major","M","#FFA000"),t.MINOR=t.add(300,"Minor","m","#FFFF00"),t.WARNING=t.add(200,"Warning","W","#00FFFF"),t.INDETERMINATE=t.add(100,"Indeterminate","N","#C800FF"),t.CLEARED=t.add(0,"Cleared","R","#00FF00"),t.isClearedAlarmSeverity=function(t){return t?0===t.value:!1},t.getByName=function(e){return t._nm[e]},t.getByValue=function(e){return t._vm[e]},t.clear=function(){t.severities.clear(),t._vm={},t._nm={}},t.compare=function(e,i){return t._cp(e,i)}}(),Me.AlarmState=function(t){this._e=t,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0},Oe.ext("twaver.AlarmState",Object,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._e.firePropertyChange("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var t=null;for(var e in this._am)e=Me.AlarmSeverity.getByName(e),Me.AlarmSeverity.isClearedAlarmSeverity(e)||0!==this.getAcknowledgedAlarmCount(e)&&(t=t&&Me.AlarmSeverity.compare(t,e)>0?t:e);this._haa=t},_c2:function(){var t=null;for(var e in this._nm)e=Me.AlarmSeverity.getByName(e),Me.AlarmSeverity.isClearedAlarmSeverity(e)||0!==this.getNewAlarmCount(e)&&(t=t&&Me.AlarmSeverity.compare(t,e)>0?t:e);this._hna=t},_c3:function(){if(!this._hna)return void(this._hls=!1);for(var t in this._nm)if(t=Me.AlarmSeverity.getByName(t),!Me.AlarmSeverity.isClearedAlarmSeverity(t)&&0!==this.getNewAlarmCount(t)&&Me.AlarmSeverity.compare(this._hna,t)>0)return void(this._hls=!0);this._hls=!1},_c4:function(){var t=this._haa,e=this._hna,i=this._ps;this._hoa=t,Me.AlarmSeverity.compare(e,this._hoa)>0&&(this._hoa=e),Me.AlarmSeverity.compare(i,this._hoa)>0&&(this._hoa=i)},_c5:function(){var t=this._haa,e=this._hna;this._hta=t,Me.AlarmSeverity.compare(e,this._hta)>0&&(this._hta=e)},increaseAcknowledgedAlarm:function(t,e){if(null==e&&(e=1),0!==e){var i=this._am[t.name];null==i&&(i=0),i+=e,this._am[t.name]=i,this._f()}},increaseNewAlarm:function(t,e){if(null==e&&(e=1),0!==e){var i=this._nm[t.name];null==i&&(i=0),i+=e,this._nm[t.name]=i,this._f()}},decreaseAcknowledgedAlarm:function(t,e){if(null==e&&(e=1),0!==e){var i=this._am[t.name];if(null==i&&(i=0),i-=e,0>i)throw"Alarm count can not be negative";this._am[t.name]=i,this._f()}},decreaseNewAlarm:function(t,e){if(null==e&&(e=1),0!==e){var i=this._nm[t.name];if(null==i&&(i=0),i-=e,0>i)throw"Alarm count can not be negative";this._nm[t.name]=i,this._f()}},acknowledgeAlarm:function(t){this.decreaseNewAlarm(t,1),this.increaseAcknowledgedAlarm(t,1)},acknowledgeAllAlarms:function(t){if(t){var e=this.getNewAlarmCount(t);this.decreaseNewAlarm(t,e),this.increaseAcknowledgedAlarm(t,e)}else for(var i in this._nm)this.acknowledgeAllAlarms(Me.AlarmSeverity.getByName(i))},_c6:function(){this._aac=0;for(var t in this._am)t=Me.AlarmSeverity.getByName(t),this._aac+=this.getAcknowledgedAlarmCount(t)},getAcknowledgedAlarmCount:function(t){if(t){var e=this._am[t.name];return null==e?0:e}return this._aac},getAlarmCount:function(t){return this.getAcknowledgedAlarmCount(t)+this.getNewAlarmCount(t)},_c7:function(){this._nac=0;for(var t in this._nm)t=Me.AlarmSeverity.getByName(t),this._nac+=this.getNewAlarmCount(t)},getNewAlarmCount:function(t){if(t){var e=this._nm[t.name];return null==e?0:e}return this._nac},setNewAlarmCount:function(t,e){this._nm[t.name]=e,this._f()},removeAllNewAlarms:function(t){t?delete this._nm[t]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(t,e){this._am[t.name]=e,this._f()},removeAllAcknowledgedAlarms:function(t){t?delete this._am[t.name]:this._am={},this._f()},isEmpty:function(){return null==this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(t){if(this._ep||(t=null),this._ps!==t){var e=this._ps;this._ps=t,this._f(),this._e.firePropertyChange("propagateSeverity",e,t)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(t){var e=this._ep;this._ep=t,this._e.firePropertyChange("enablePropagation",e,t)&&(t||this.setPropagateSeverity(null))}}),Me.AlarmBox=function(t){if(!t)throw"elementBox can not be null.";Me.AlarmBox.superClass.constructor.call(this),this._elementBox=t,this._alarmElementMapping=new Me.AlarmElementMapping(this,t),this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange,this,!0),this.addDataBoxChangeListener(this.handleAlarmBoxChange,this,!0),this.addDataPropertyChangeListener(this.handleAlarmPropertyChange,this,!0)},Oe.ext("twaver.AlarmBox",Me.DataBox,{__accessor:["removeAlarmWhenElementIsRemoved"],_name:"AlarmBox",_removeAlarmWhenAlarmIsCleared:!1,_removeAlarmWhenElementIsRemoved:!0,getElementBox:function(){return this._elementBox},isRemoveAlarmWhenAlarmIsCleared:function(){return this._removeAlarmWhenAlarmIsCleared},setRemoveAlarmWhenAlarmIsCleared:function(t){var e=this._removeAlarmWhenAlarmIsCleared;this._removeAlarmWhenAlarmIsCleared=t,this.firePropertyChange("removeAlarmWhenAlarmIsCleared",e,t),t&&this.toDatas(function(t){return t.isCleared()}).forEach(this.remove,this)},getAlarmElementMapping:function(){return this._alarmElementMapping},setAlarmElementMapping:function(t){if(!t)throw"alarmElementMapping can not be null";if(this._alarmElementMapping!==t){var e=this._alarmElementMapping;this.getDatas().forEach(this._decreaseAlarmState,this),this._alarmElementMapping=t,this.getDatas().forEach(this._increaseAlarmState,this),this.firePropertyChange("alarmElementMapping",e,t)}},handleElementBoxChange:function(t){"add"===t.kind?this.handleElementAdded(t.data):"remove"===t.kind?(this.handleElementRemoved(t.data),this._removeAlarmWhenElementIsRemoved&&this.removeAlarmsByElement(t.data)):"clear"===t.kind&&(t.datas.forEach(this.handleElementRemoved,this),this._removeAlarmWhenElementIsRemoved&&this.clear())},handleAlarmBoxChange:function(t){"add"===t.kind?this._increaseAlarmState(t.data):"remove"===t.kind?this._decreaseAlarmState(t.data):"clear"===t.kind&&t.datas.forEach(this._decreaseAlarmState,this)},handleAlarmPropertyChange:function(t){var e=t.source;e.isCleared()||("alarmSeverity"===t.property?this.handleAlarmSeverityChange(e,t):"acked"===t.property&&this.handleAckedChange(e,t)),"cleared"===t.property&&(e.isCleared()?(this._decreaseAlarmState(e,!0),this._removeAlarmWhenAlarmIsCleared&&this.remove(e)):this._increaseAlarmState(e,!0))},handleAckedChange:function(t,e){if(t.getAlarmSeverity()){var i=this.getCorrespondingElements(t);if(i)for(var n=0;n<i.size();n++){var o=i.get(n);e.oldValue?o.getAlarmState().decreaseAcknowledgedAlarm(t.getAlarmSeverity()):o.getAlarmState().decreaseNewAlarm(t.getAlarmSeverity()),e.newValue?o.getAlarmState().increaseAcknowledgedAlarm(t.getAlarmSeverity()):o.getAlarmState().increaseNewAlarm(t.getAlarmSeverity())}}},handleAlarmSeverityChange:function(t,e){var i=e.oldValue,n=e.newValue,o=this.getCorrespondingElements(t);if(o)for(var s=0;s<o.size();s++){var a=o.get(s);i&&(t.isAcked()?a.getAlarmState().decreaseAcknowledgedAlarm(i):a.getAlarmState().decreaseNewAlarm(i)),n&&(t.isAcked()?a.getAlarmState().increaseAcknowledgedAlarm(n):a.getAlarmState().increaseNewAlarm(n))}},getCorrespondingAlarms:function(t){return this._alarmElementMapping.getCorrespondingAlarms(t)},getCorrespondingElements:function(t){return this._alarmElementMapping.getCorrespondingElements(t)},handleElementAdded:function(t){var e=this.getCorrespondingAlarms(t);if(e)for(var i=0;i<e.size();i++){var n=e.get(i);if(!n.isCleared()){var o=n.getAlarmSeverity();o&&(n.isAcked()?t.getAlarmState().increaseAcknowledgedAlarm(o):t.getAlarmState().increaseNewAlarm(o))}}},_increaseAlarmState:function(t,e){if(!t.isCleared()||e){var i=t.getAlarmSeverity();if(i){var n=this.getCorrespondingElements(t);if(n)for(var o=0;o<n.size();o++){var s=n.get(o);t.isAcked()?s.getAlarmState().increaseAcknowledgedAlarm(i):s.getAlarmState().increaseNewAlarm(i)}}}},_decreaseAlarmState:function(t,e){if(!t.isCleared()||e){var i=t.getAlarmSeverity();if(i){var n=this.getCorrespondingElements(t);if(n)for(var o=0;o<n.size();o++){var s=n.get(o);t.isAcked()?s.getAlarmState().decreaseAcknowledgedAlarm(i):s.getAlarmState().decreaseNewAlarm(i)}}}},handleElementRemoved:function(t){var e=this.getCorrespondingAlarms(t);e&&e.forEach(function(e){!e.isCleared()&&e.getAlarmSeverity()&&(e.isAcked()?t.getAlarmState().decreaseAcknowledgedAlarm(e.getAlarmSeverity()):t.getAlarmState().decreaseNewAlarm(e.getAlarmSeverity()))})},removeAlarmsByElement:function(t){var e=this.getCorrespondingAlarms(t);e&&e.forEach(this.remove,this)},add:function(t,e){if(!t.IAlarm)throw"Only IAlarm can be added into AlarmBox";this._removeAlarmWhenAlarmIsCleared&&t.isCleared()||Me.AlarmBox.superClass.add.apply(this,arguments)}}),Me.AlarmElementMapping=function(t,e){if(!e)throw"ElementBox can not be null";if(!t)throw"AlarmBox can not be null";this._elementBox=e,this._alarmBox=t,this._alarmsFinder=new Me.QuickFinder(t,"elementId")},Oe.ext("twaver.AlarmElementMapping",Object,{getCorrespondingAlarms:function(t){return this._alarmsFinder.find(t.getId())},getCorrespondingElements:function(t){var e=this._elementBox.getDataById(t.getElementId());return new fn(e)},dispose:function(){this._alarmsFinder.dispose(),delete this._elementBox,delete this._alarmBox,delete this._alarmsFinder}}),Me.AlarmStateStatistics=function(t){Me.AlarmStateStatistics.superClass.constructor.apply(this,arguments),this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.elementMap={},this.setElementBox(t)},Oe.ext("twaver.AlarmStateStatistics",Me.PropertyChangeDispatcher,{getElementBox:function(){return this._elementBox},setElementBox:function(t){if(!t)throw"ElementBox can not be null";if(this._elementBox!==t){var e=this._elementBox;e&&(e.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),e.removeDataBoxChangeListener(this.handleElementBoxChange,this),this.severtiyMap={},this.elementMap={}),this._elementBox=t,this.reset(),t.addDataPropertyChangeListener(this.handleElementPropertyChange,this),t.addDataBoxChangeListener(this.handleElementBoxChange,this),this.firePropertyChange("elementBox",e,t)}},dispose:function(){this._elementBox.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),this._elementBox.removeDataBoxChangeListener(this.handleElementBoxChange,this),delete this._elementBox},handleElementPropertyChange:function(t){"alarmState"===t.property&&(this.increase(t.source),this.fireAlarmStateChange())},handleElementBoxChange:function(t){"add"===t.kind?(this.increase(t.data),this.fireAlarmStateChange()):"remove"===t.kind?(this.decrease(t.data),this.fireAlarmStateChange()):"clear"===t.kind&&(this.severtiyMap={},this.elementMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,Me.AlarmSeverity.forEach(function(t){var e=this.getSumInfo(t);this.sumAcked+=e.ackedCount,this.sumNew+=e.newCount,this.sumTotal+=e.totalCount},this),this.firePropertyChange("alarmState",!1,!0)},getNewAlarmCount:function(t){if(!t)return this.sumNew;var e=this.getSumInfo(t);return e.newCount},getAcknowledgedAlarmCount:function(t){if(!t)return this.sumAcked;var e=this.getSumInfo(t);return e.ackedCount},getTotalAlarmCount:function(t){if(!t)return this.sumTotal;var e=this.getSumInfo(t);return e.totalCount},getSumInfo:function(t){var e=this.severtiyMap[t.name];return e||(e={},e.newCount=0,e.ackedCount=0,e.totalCount=0,this.severtiyMap[t.name]=e),e},decrease:function(t){var e=this.elementMap[t.getId()];e&&(delete this.elementMap[t.getId()],Me.AlarmSeverity.forEach(function(t){var i=e[t.name],n=this.getSumInfo(t);n.newCount=n.newCount-i.newCount,n.ackedCount=n.ackedCount-i.ackedCount,n.totalCount=n.totalCount-i.totalCount},this))},increase:function(t){if(this.decrease(t),!this._filterFunction||this._filterFunction(t)){var e={};this.elementMap[t.getId()]=e,Me.AlarmSeverity.forEach(function(i){var n={};n.newCount=t.getAlarmState().getNewAlarmCount(i),n.ackedCount=t.getAlarmState().getAcknowledgedAlarmCount(i),n.totalCount=t.getAlarmState().getAlarmCount(i),e[i.name]=n;var o=this.getSumInfo(i);o.newCount=o.newCount+n.newCount,o.ackedCount=o.ackedCount+n.ackedCount,o.totalCount=o.totalCount+n.totalCount},this)}},reset:function(){this.severtiyMap={},this.elementMap={},this._elementBox.forEach(this.increase,this),this.fireAlarmStateChange()},setFilterFunction:function(t){var e=this._filterFunction;this._filterFunction=t,this.reset(),this.firePropertyChange("filterFunction",e,t)},getFilterFunction:function(){return _filterFunction}}),Me.LayerBox=function(t){Me.LayerBox.superClass.constructor.call(this),this._elementBox=t,this._defaultLayer=new Me.Layer(Rn.LAYER_DEFAULT_ID,Rn.LAYER_DEFAULT_NAME),this.add(this._defaultLayer)},Oe.ext("twaver.LayerBox",Me.DataBox,{_name:"LayerBox",getElementBox:function(){return this._elementBox},getDefaultLayer:function(){return this._defaultLayer},add:function(t,e){if(!t.ILayer)throw"Only ILayer can be added into LayerBox";Me.LayerBox.superClass.add.apply(this,arguments)},removeById:function(t){if(t===this._defaultLayer.getId())throw"Cannot remove default layer";Me.LayerBox.superClass.removeById.call(this,t)},getLayerByElement:function(t){if(!t)return null;if(t._layerId===Rn.LAYER_DEFAULT_ID)return this._defaultLayer;var e=this.getDataById(t.getLayerId());return e?e:this._defaultLayer},clear:function(){this.toDatas().forEach(function(t){t!=this._defaultLayer&&this.removeById(t.getId())},this)}}),Me.BundleLinks=function(t,e){this._links=t,this._siblings=e;var i,n,o=Me.Styles.getStyle("link.bundle.expanded");for(i=0;i<t.size();i++){n=t.get(i);var s=n.getStyle("link.bundle.expanded",!1);if(null!=s){o=s;break}}if(null==o&&(o=!0),Rn.LINK_BUNDLE_AGENT_FUNCTION){var a=Rn.LINK_BUNDLE_AGENT_FUNCTION(t);null==a?a=t.get(0):a!=t.get(0)&&(t.remove(a),t.add(a,0))}for(i=0;i<t.size();i++)t.get(i).setStyle("link.bundle.expanded",o)},Oe.ext("twaver.BundleLinks",Object,{getLinks:function(){return this._links},getSiblings:function(){return this._siblings},forEachSiblingLink:function(t,e){this._siblings.forEach(function(i){i.getLinks().forEach(t,e)})}});var Dn={bitsToNum:function(t){return t.reduce(function(t,e){return 2*t+e},0)},byteToBitArr:function(t){for(var e=[],i=7;i>=0;i--)e.push(!!(t&1<<i));return e},lzwDecode:function(t,e){for(var i,n,o=0,s=function(t){for(var i=0,n=0;t>n;n++)e.charCodeAt(o>>3)&1<<(7&o)&&(i|=1<<n),o++;return i},a=[],r=1<<t,h=r+1,l=t+1,c=[],d=function(){c=[],l=t+1;for(var e=0;r>e;e++)c[e]=[e];c[r]=[],c[h]=null};;)if(n=i,i=s(l),i!==r){if(i===h)break;if(i<c.length)n!==r&&c.push(c[n].concat(c[i][0]));else{if(i!==c.length)throw new Error("Invalid LZW code.");c.push(c[n].concat(c[n][0]))}a.push.apply(a,c[i]),c.length===1<<l&&12>l&&l++}else d();return a}},Mn=function(t){this.data=t,this.len=this.data.length,this.pos=0};Oe.ext(Mn,Object,{readByte:function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return 255&this.data.charCodeAt(this.pos++)},readBytes:function(t){for(var e=[],i=0;t>i;i++)e.push(this.readByte());return e},read:function(t){for(var e="",i=0;t>i;i++)e+=String.fromCharCode(this.readByte());return e},readUnsigned:function(){var t=this.readBytes(2);return(t[1]<<8)+t[0]}});var On=function(t){var e,i=t,n=null,o=null,s=null,a=0,r=null,h=null,l=null;this.frames=[],this.size={};var c=this,d=Ve.createElement("canvas");this.loaded=!1;var u=function(){n=null,o=null,r=s,s=null,h=null};this.doParse=function(){Bn(i,y)};var _=function(t){e=t,c.size.width=e.width,c.size.height=e.height},g=function(t){f(),u(),n=t.transparencyGiven?t.transparencyIndex:null,o=t.delayTime,s=t.disposalMethod},f=function(){h&&c.frames.push({data:h.getImageData(0,0,e.width,e.height),delay:o})},v=function(t){h||(h=d.getContext("2d"));var i=c.frames.length,o=t.lctFlag?t.lct:e.gct;i>0&&(3===r?h.putImageData(c.frames[a].data,0,0):a=i-1,2===r&&(l||h.clearRect(l.leftPos,l.topPos,l.width,l.height)));var s=h.getImageData(t.leftPos,t.topPos,t.width,t.height);t.pixels.forEach(function(t,e){t!==n&&(s.data[4*e+0]=o[t][0],s.data[4*e+1]=o[t][1],s.data[4*e+2]=o[t][2],s.data[4*e+3]=255)}),h.putImageData(s,t.leftPos,t.topPos),l=t},m=function(){},p=function(t){return function(e){t(e)}},y={hdr:p(_),gce:p(g),com:p(m),app:{NETSCAPE:p(m)},img:p(v),eof:function(t){f(),c.loaded=!0}}},Bn=function(t,e){e||(e={});var i=function(e){for(var i=[],n=0;e>n;n++)i.push(t.readBytes(3));return i},n=function(){var e,i;i="";do{e=t.readByte(),i+=t.read(e)}while(0!==e);return i},o=function(){var n={};if(n.sig=t.read(3),n.ver=t.read(3),"GIF"!==n.sig)throw new Error("Not a GIF file.");n.width=t.readUnsigned(),n.height=t.readUnsigned();var o=Dn.byteToBitArr(t.readByte());n.gctFlag=o.shift(),n.colorRes=Dn.bitsToNum(o.splice(0,3)),n.sorted=o.shift(),n.gctSize=Dn.bitsToNum(o.splice(0,3)),n.bgColor=t.readByte(),n.pixelAspectRatio=t.readByte(),n.gctFlag&&(n.gct=i(1<<n.gctSize+1)),e.hdr&&e.hdr(n)},s=function(i){var o=function(i){var n=(t.readByte(),Dn.byteToBitArr(t.readByte()));i.reserved=n.splice(0,3),i.disposalMethod=Dn.bitsToNum(n.splice(0,3)),i.userInput=n.shift(),i.transparencyGiven=n.shift(),i.delayTime=t.readUnsigned(),i.transparencyIndex=t.readByte(),i.terminator=t.readByte(),e.gce&&e.gce(i)},s=function(t){t.comment=n(),e.com&&e.com(t)},a=function(i){t.readByte();i.ptHeader=t.readBytes(12),i.ptData=n(),e.pte&&e.pte(i)},r=function(i){{var o=function(i){t.readByte();i.unknown=t.readByte(),i.iterations=t.readUnsigned(),i.terminator=t.readByte(),e.app&&e.app.NETSCAPE&&e.app.NETSCAPE(i)},s=function(t){t.appData=n(),e.app&&e.app[t.identifier]&&e.app[t.identifier](t)};t.readByte()}switch(i.identifier=t.read(8),i.authCode=t.read(3),i.identifier){case"NETSCAPE":o(i);break;default:s(i)}},h=function(t){t.data=n(),e.unknown&&e.unknown(t)};switch(i.label=t.readByte(),i.label){case 249:i.extType="gce",o(i);break;case 254:i.extType="com",s(i);break;case 1:i.extType="pte",a(i);break;case 255:i.extType="app",r(i);break;default:i.extType="unknown",h(i)}},a=function(o){var s=function(t,e){for(var i=new Array(t.length),n=t.length/e,o=function(n,o){var s=t.slice(o*e,(o+1)*e);i.splice.apply(i,[n*e,e].concat(s))},s=[0,4,2,1],a=[8,8,4,2],r=0,h=0;4>h;h++)for(var l=s[h];n>l;l+=a[h])o(l,r),r++;return i};o.leftPos=t.readUnsigned(),o.topPos=t.readUnsigned(),o.width=t.readUnsigned(),o.height=t.readUnsigned();var a=Dn.byteToBitArr(t.readByte());o.lctFlag=a.shift(),o.interlaced=a.shift(),o.sorted=a.shift(),o.reserved=a.splice(0,2),o.lctSize=Dn.bitsToNum(a.splice(0,3)),o.lctFlag&&(o.lct=i(1<<o.lctSize+1)),o.lzwMinCodeSize=t.readByte();var r=n();o.pixels=Dn.lzwDecode(o.lzwMinCodeSize,r),o.interlaced&&(o.pixels=s(o.pixels,o.width)),e.img&&e.img(o)},r=function(){var i={};switch(i.sentinel=t.readByte(),String.fromCharCode(i.sentinel)){case"!":i.type="ext",s(i);break;case",":i.type="img",a(i);break;case";":i.type="eof",e.eof&&e.eof(i);break;default:throw new Error("Unknown block: 0x"+i.sentinel.toString(16))}"eof"!==i.type&&setTimeout(r,0)},h=function(){o(),setTimeout(r,0)};h()},Nn=function(t,e,i){var n=Ve.createElement("canvas");return zn(n,e.width,e.height),n.getContext("2d").clearRect(0,0,e.width,e.height),n.getContext("2d").putImageData(t[i].data,0,0),n},zn=function(t,e,i){t.width=e,t.height=i,t.style.width=e+"px",t.style.height=i+"px"};Me.Data=function(t){if(Me.Data.superClass.constructor.apply(this,arguments),this._childList=new fn,this._childMap={},this._clientMap={},t===e||null===t)this._id=Oe.id();else if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)this._id=t;else{for(var i in t)if("clients"===i)for(var n in t.clients)this._clientMap[n]=t.clients[n];else if("styles"===i)for(var o in t.styles)this._styleMap[o]=t.styles[o];else null!=t[i]&&("id"===i?this._id=t[i]:this[Oe.setter(i)]&&this[Oe.setter(i)](t[i]));null==this._id&&(this._id=Oe.id())}},Oe.ext("twaver.Data",Me.PropertyChangeDispatcher,{IData:!0,IClient:!0,__client:1,__new:1,_parent:null,__accessor:["name","name2","icon","toolTip"],_icon:Rn.ICON_DATA,_dragBoundsFunc:null,getId:function(){return this._id},getChildren:function(){return this._childList},getChildrenSize:function(){return this._childList.size()},toChildren:function(t,e){return this._childList.toList(t,e)},addChild:function(t,i){return i===e&&(i=this._childList.size()),t&&t!==this?this._childMap[t.getId()]?!1:this.isDescendantOf(t)?!1:(t.getParent()&&t.getParent().removeChild(t),(0>i||i>this._childList.size())&&(i=this._childList.size()),this._childList.add(t,i),this._childMap[t._id]=t,t.setParent(this),this.firePropertyChange("children",null,t),this.onChildAdded(t,i),!0):!1},onChildAdded:function(t,e){},removeChild:function(t){if(!t)return!1;if(!this._childMap[t._id])return!1;var e=this._childList.remove(t);return delete this._childMap[t._id],this.firePropertyChange("children",t,null),t.setParent(null),this.onChildRemoved(t,e),!0},onChildRemoved:function(t,e){},getChildAt:function(t){return this._childList.get(t)},clearChildren:function(){if(0===this._childList.size())return!1;for(var t=this._childList.toArray(),e=t.length,i=0;e>i;i++)this.removeChild(t[i]);return this.onChildrenCleared(t),!0},onChildrenCleared:function(t){},getParent:function(){return this._parent},setParent:function(t){if(!(this._isUpdatingParent||this._parent===t||this===t||t&&t.isDescendantOf(this))){var e=this._parent;this._parent=t,this._isUpdatingParent=!0,e&&e.removeChild(this),t&&t.addChild(this),delete this._isUpdatingParent,this.firePropertyChange("parent",e,t),this.onParentChanged(e,t)}},onParentChanged:function(t,e){},hasChildren:function(){return this._childList.size()>0},isRelatedTo:function(t){return t?this.isDescendantOf(t)||t.isDescendantOf(this):!1},isParentOf:function(t){return t?null!=this._childMap[t._id]:!1},isDescendantOf:function(t){if(!t)return!1;if(!t.hasChildren())return!1;for(var e=this._parent;e;){if(t===e)return!0;e=e.getParent()}return!1},getDragBoundsFunc:function(){return this._dragBoundsFunc},setDragBoundsFunc:function(t){this._dragBoundsFunc=t},toString:function(){return this.getName()?this.getName():this._id}}),Me.Alarm=function(t,e,i,n,o){Me.Alarm.superClass.constructor.call(this,t),this._elementId=e,this._alarmSeverity=i,this._acked=n||!1,this._cleared=o||!1},Oe.ext("twaver.Alarm",Me.Data,{IAlarm:!0,getElementId:function(){return this._elementId},__accessor:["acked","cleared","alarmSeverity"]}),Me.Layer=function(t){Me.Layer.superClass.constructor.call(this,t)},Oe.ext("twaver.Layer",Me.Data,{ILayer:!0,__accessor:["visible","movable","editable","rotatable"],_visible:!0,_movable:!0,_editable:!0,_rotatable:!0,_name:"Default"}),Me.Element=function(t){this._styleMap=this._styleMap||{},this._alarmState=new Me.AlarmState(this),Me.Element.superClass.constructor.call(this,t)},Oe.ext("twaver.Element",Me.Data,{IElement:!0,IStyle:!0,__accessor:["layerId"],__bool:["visible","movable"],__style:1,_layerId:Rn.LAYER_DEFAULT_ID,_visible:!0,_movable:!0,getAlarmState:function(){return this._alarmState},isAdjustedToBottom:function(){return!1},getElementUIClass:function(){return null},getCanvasUIClass:function(){return null},getVectorUIClass:function(){return null},s:function(t,i){return i===e?this.getStyle(t):(this.setStyle(t,i),this)}}),Me.Dummy=function(t){Me.Dummy.superClass.constructor.call(this,t)},Oe.ext("twaver.Dummy",Me.Element,{IDummy:!0});var Fn=function(t){this._location={x:0,y:0},Fn.superClass.constructor.call(this,t)};Me.Node=Fn,Fn.IS_INTERESTED_NODE_PROPERTY={location:1,width:1,height:1,expanded:1},Oe.ext("twaver.Node",Me.Element,{_icon:Rn.ICON_NODE,_image:Rn.IMAGE_NODE,_imageUrl:null,_angle:0,getLoopedLinks:function(){return this._loopedLinks},getLinks:function(){return this._links},getAgentLinks:function(){return this._agentLinks},getFollowers:function(){return this._followers},_addFollower:function(t){this._followers||(this._followers=new fn),this._followers.add(t)},_removeFollower:function(t){this._followers.remove(t),this._followers.isEmpty()&&delete this._followers},getFromLinks:function(){return this._fromLinks},getToLinks:function(){return this._toLinks},_addFromLink:function(t){this._links||(this._links=new fn(!1)),this._fromLinks||(this._fromLinks=new fn(!1)),this._links.add(t),this._toLinks&&this._toLinks.contains(t)&&(this._loopedLinks||(this._loopedLinks=new fn(!1)),this._loopedLinks.add(t)),this._fromLinks.add(t)},_addToLink:function(t){this._links||(this._links=new fn(!1)),this._toLinks||(this._toLinks=new fn(!1)),this._links.add(t),this._fromLinks&&this._fromLinks.contains(t)&&(this._loopedLinks||(this._loopedLinks=new fn(!1)),this._loopedLinks.add(t)),this._toLinks.add(t)},_removeFromLink:function(t){this._links&&this._links.remove(t),this._fromLinks&&this._fromLinks.remove(t),this._loopedLinks&&this._loopedLinks.remove(t)},_removeToLink:function(t){this._links&&this._links.remove(t),this._toLinks&&this._toLinks.remove(t),this._loopedLinks&&this._loopedLinks.remove(t)},hasAgentLinks:function(){return null!=this._agentLinks&&!this._agentLinks.isEmpty()},getFromAgentLinks:function(){return this._fromAgentLinks},getToAgentLinks:function(){return this._toAgentLinks},_addFromAgentLink:function(t){this._fromAgentLinks||(this._fromAgentLinks=new fn(!1)),this._agentLinks||(this._agentLinks=new fn(!1)),this._fromAgentLinks.add(t),this._agentLinks.add(t)},_addToAgentLink:function(t){this._toAgentLinks||(this._toAgentLinks=new fn(!1)),this._agentLinks||(this._agentLinks=new fn(!1)),this._toAgentLinks.add(t),this._agentLinks.add(t)},_removeFromAgentLink:function(t){this._fromAgentLinks&&this._fromAgentLinks.remove(t),this._agentLinks&&this._agentLinks.remove(t)},_removeToAgentLink:function(t){this._toAgentLinks&&this._toAgentLinks.remove(t),this._agentLinks&&this._agentLinks.remove(t)},getImage:function(){return this._image},setImage:function(t){var e=this._image,i=this.getWidth(),n=this.getHeight();this._image=t,this.firePropertyChange("image",e,t),this.firePropertyChange("width",i,this.getWidth()),this.firePropertyChange("height",n,this.getHeight())},getImageUrl:function(){return this._imageUrl},setImageUrl:function(t){if(this._imageUrl!=t){var e=this._imageUrl;this._imageUrl=t,Pn.images[t]||Me.imageUtil.registerImageByUrl(t,"svg"===Me.imageUtil.getImageType(t),t),this.setImage(t),this.firePropertyChange("imageUrl",e,t)}},getX:function(){return this._location.x},getY:function(){return this._location.y},setX:function(t){this.setLocation(t,this._location.y)},setY:function(t){this.setLocation(this._location.x,t)},getLocation:function(){return this._location},setLocation:function(t,e){var i;if(i=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],Oe.num(i.x)&&Oe.num(i.y)&&(i.x!==this._location.x||i.y!==this._location.y)){this._dragBoundsFunc&&(i=this._dragBoundsFunc(i));var n=this._location;this._location=i,this.firePropertyChange("location",n,i)}},getCenterLocation:function(){return Rn.CENTER_LOCATION?this._location:{x:this.getX()+this.getWidth()/2,y:this.getY()+this.getHeight()/2}},setCenterLocation:function(t,e){var i;i=2===arguments.length?{x:arguments[0],y:arguments[1]}:Oe.clone(arguments[0]),Oe.num(i.x)&&Oe.num(i.y)&&(Rn.CENTER_LOCATION||(i.x-=this.getWidth()/2,i.y-=this.getHeight()/2),this.setLocation(i))},translate:function(t,e){this.setLocation(this.getX()+t,this.getY()+e)},getWidth:function(){if(Oe.num(this._width)&&this._width>=0)return this._width;if("object"!=typeof this._image){var t=Oe.getImageAsset(this._image);if(t){var e=t.getWidth();return Oe.num(e)&&e>=0?e:(t=t._image,qi(this,t,t,"w"))}}else if(this._image)return this._image.w;return Rn.NODE_WIDTH},setWidth:function(t){var e=this._width;this._width=t,this.firePropertyChange("width",e,t)},getHeight:function(){if(Oe.num(this._height)&&this._height>=0)return this._height;if("object"!=typeof this._image){var t=Oe.getImageAsset(this._image);if(t){var e=t.getHeight();return Oe.num(e)&&e>=0?e:(t=t._image,qi(this,t,t,"h"))}}else if(this._image)return this._image.h;return Rn.NODE_HEIGHT},setHeight:function(t){var e=this._height;this._height=t,this.firePropertyChange("height",e,t)},setSize:function(){2===arguments.length?(this.setWidth(arguments[0]),this.setHeight(arguments[1])):(this.setWidth(arguments[0].width),this.setHeight(arguments[0].height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getRect:function(){var t=this.getOriginalRect();if(0===this._angle)return t;for(var e=Ze.createMatrix(this._angle*Math.PI/180,t.x+t.width/2,t.y+t.height/2),i=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}],n=0,o=i.length;o>n;n++)i[n]=e.transform(i[n]);var s=Ze.getRect(i);return s},getOriginalRect:function(){var t=this,e=t.getWidth(),i=t.getHeight();return Rn.CENTER_LOCATION?{x:t._location.x-e/2,y:t._location.y-i/2,width:e,height:i}:{x:t.getX(),y:t.getY(),width:e,height:i}},getAngle:function(){return this._angle},setAngle:function(t){var e=this._angle;this._angle=t%360,this.firePropertyChange("angle",e,this._angle)},onParentChanged:function(t,e){Fn.superClass.onParentChanged.call(this,t,e),this._checkLinkAgent()},_checkLinkAgent:function(){if(Me._isInitializing){if(this._links)for(var t=this._links.size(),e=0;t>e;e++)this._links.get(e)._checkAgentNode()}else Me.ElementBox.prototype.startBatch(function(){if(this._links)for(var t=this._links.size(),e=0;t>e;e++)this._links.get(e)._checkAgentNode()},this)},onPropertyChanged:function(t){if(Fn.superClass.onPropertyChanged.call(this,t),this._followers)for(var e=this._followers.toList(),i=e.size(),n=0;i>n;n++)e.get(n).handleHostPropertyChange(t);this.getParent()instanceof Un&&Fn.IS_INTERESTED_NODE_PROPERTY[t.property]&&this.getParent().updateLocationFromChildren()},getElementUIClass:function(){return Me.network.NodeUI},getCanvasUIClass:function(){return Me.canvas.NodeUI},getVectorUIClass:function(){return Me.vector.NodeUI}});var Vn=function(t){Vn.superClass.constructor.call(this,t)};Me.HTMLNode=Vn,Oe.ext("twaver.HTMLNode",Me.Node,{getElementUIClass:function(){return Me.network.HTMLNodeUI},getCanvasUIClass:function(){return Me.canvas.HTMLNodeUI},getVectorUIClass:function(){return Me.vector.HTMLNodeUI}}),Me.Link=function(t,e,i){Me.Link.superClass.constructor.call(this,t instanceof Fn?null:t),t instanceof Fn&&(i=e,e=t),e&&this.setFromNode(e),i&&this.setToNode(i)},Me.Link.IS_INTERESTED_BUNDLE_STYLE={"link.bundle.enable":1,"link.bundle.id":1,"link.bundle.independent":1},Oe.ext("twaver.Link",Me.Element,{_fromNode:null,_toNode:null,_fromAgent:null,_toAgent:null,_icon:Rn.ICON_LINK,getFromNode:function(){return this._fromNode},getToNode:function(){return this._toNode},getFromAgent:function(){return this._fromAgent},getToAgent:function(){return this._toAgent},setFromNode:function(t){if(this._fromNode!==t){var e=this._fromNode;this._fromNode=t,e&&e._removeFromLink(this),this._fromNode&&this._fromNode._addFromLink(this),this._checkAgentNode(),this.firePropertyChange("fromNode",e,t)}},setToNode:function(t){if(this._toNode!==t){var e=this._toNode;this._toNode=t,e&&e._removeToLink(this),this._toNode&&this._toNode._addToLink(this),this._checkAgentNode(),this.firePropertyChange("toNode",e,t)}},isLooped:function(){return this._fromNode===this._toNode&&null!=this._fromNode&&null!=this._toNode},_checkAgentNode:function(){Me._isInitializing?Me._links[this._id]||(Me._links[this._id]=this):this._checkAgentNodeImpl()},_checkAgentNodeImpl:function(){var t,e,i=xi.figureFromAgent(this),n=this;this._fromAgent!=i&&(t=this._fromAgent,this._fromAgent&&this._fromAgent._removeFromAgentLink(this),this._fromAgent=i,this._fromAgent&&this._fromAgent._addFromAgentLink(this),this.firePropertyChange("fromAgent",t,this._fromAgent),Me._isInitializing?(t&&this._toAgent&&(e=t._id+":"+this._toAgent._id,Me._bundleLinks[e]||(Me._bundleLinks[e]=[t,this._toAgent])),this._fromAgent&&this._toAgent&&(e=this._fromAgent._id+":"+this._toAgent._id,Me._bundleLinks[e]||(Me._bundleLinks[e]=[this._fromAgent,this._toAgent]))):(xi.resetBundleLinks(t,n._toAgent),xi.resetBundleLinks(n._fromAgent,n._toAgent)));var o=xi.figureToAgent(this);this._toAgent!=o&&(t=this._toAgent,this._toAgent&&this._toAgent._removeToAgentLink(this),this._toAgent=o,this._toAgent&&this._toAgent._addToAgentLink(this),this.firePropertyChange("toAgent",t,this._toAgent),Me._isInitializing?(t&&this._fromAgent&&(e=t._id+":"+this._fromAgent._id,Me._bundleLinks[e]||(Me._bundleLinks[e]=[t,this._fromAgent])),this._toAgent&&this._fromAgent&&(e=this._toAgent._id+":"+this._fromAgent._id,Me._bundleLinks[e]||(Me._bundleLinks[e]=[this._toAgent,this._fromAgent]))):(xi.resetBundleLinks(t,n._fromAgent),xi.resetBundleLinks(n._toAgent,n._fromAgent)))},_setBundleLinks:function(t){this._bundleLinks=t,this.firePropertyChange("bundleLinks",!0,!1)},getBundleLinks:function(){return this._bundleLinks},getBundleCount:function(){return this._bundleLinks?this._bundleLinks.getLinks().size():1},getBundleIndex:function(){return this._bundleLinks?this._bundleLinks.getLinks().indexOf(this):0},reverseBundleExpanded:function(){if(this._bundleLinks&&this._bundleLinks.getLinks().size()>0){var t,e,i=this._bundleLinks.getLinks(),n=!this.getStyle("link.bundle.expanded");for(t=0;t<i.size();t++)e=i.get(t),e.setStyle("link.bundle.expanded",n);var o=this._bundleLinks.getSiblings();for(t=0;t<o.size();t++){var s=o.get(t);if(s!=this._bundleLinks){i=s.getLinks();for(var a=0;a<i.size();a++)e=i.get(a),e.firePropertyChange("bundleLinks",null,s)}}return!0}return!1},isBundleAgent:function(){return null!=this._bundleLinks&&this._bundleLinks.getLinks().size()>1&&this===this._bundleLinks.getLinks().get(0)&&!this.getStyle("link.bundle.expanded")},onStyleChanged:function(t,e,i){Me.Link.superClass.onStyleChanged.call(this,t,e,i),Me.Link.IS_INTERESTED_BUNDLE_STYLE[t]&&xi.resetBundleLinks(this._toAgent,this._fromAgent)},getElementUIClass:function(){return Me.network.LinkUI},getCanvasUIClass:function(){return Me.canvas.LinkUI},getVectorUIClass:function(){return Me.vector.LinkUI},isAdjustedToBottom:function(){return Rn.IS_LINK_ADJUSTED_TO_BOTTOM}}),Me.HTMLLink=function(t,e,i){Me.HTMLLink.superClass.constructor.call(this,t,e,i)},Me.Util.ext("twaver.HTMLLink",Me.Link,{getElementUIClass:function(){return Me.network.HTMLLinkUI},getCanvasUIClass:function(){return Me.canvas.HTMLLinkUI},getVectorUIClass:function(){return Me.vector.HTMLLinkUI}}),Me.Follower=function(t){this._isUpdatingFollower=!1,this._isUpdatingLocation=!1,Me.Follower.superClass.constructor.call(this,t)},Me.Follower.IS_INTERESTED_HOST_GRID_PROPERTY={location:1,width:1,height:1,"S:grid.row.count":1,"S:grid.column.count":1,"S:grid.row.percents":1,"S:grid.column.percents":1,"S:grid.border":1,"S:grid.border.left":1,"S:grid.border.right":1,"S:grid.border.top":1,"S:grid.border.bottom":1,"S:grid.padding":1,"S:grid.padding.left":1,"S:grid.padding.right":1,"S:grid.padding.top":1,"S:grid.padding.bottom":1},Me.Follower.IS_INTERESTED_FOLLOWER_STYLE={"follower.row.index":1,"follower.column.index":1,"follower.row.span":1,"follower.column.span":1,"follower.padding":1,"follower.padding.left":1,"follower.padding.right":1,"follower.padding.top":1,"follower.padding.bottom":1},Oe.ext("twaver.Follower",Fn,{_host:null,getHost:function(){return this._host},setHost:function(t){if(this!==t&&this._host!==t){var e=this._host;e&&e._removeFollower(this),this._host=t,this._host&&this._host._addFollower(this),this.firePropertyChange("host",e,t),this.onHostChanged(e,t)}},onStyleChanged:function(t,e,i){Me.Follower.superClass.onStyleChanged.call(this,t,e,i),Me.Follower.IS_INTERESTED_FOLLOWER_STYLE[t]&&this.updateFollower(null)},setLocation:function(){this._isUpdatingLocation||(this._isUpdatingLocation=!0,Me.Follower.superClass.setLocation.apply(this,arguments),this._isUpdatingLocation=!1)},onHostChanged:function(t,e){this.updateFollower(null)},handleHostPropertyChange:function(t){this.updateFollower(t)},updateFollower:function(t){this._isUpdatingFollower||Oe.isDeserializing||(this._isUpdatingFollower=!0,this.updateFollowerImpl(t),this._isUpdatingFollower=!1)},updateFollowerImpl:function(t){var e=this.getHost();if(e instanceof Me.Grid){if(!t||Me.Follower.IS_INTERESTED_HOST_GRID_PROPERTY[t.property]){var i=this.getStyle("follower.row.index"),n=this.getStyle("follower.column.index"),o=e.getCellRect(i,n);if(!o)return;var s=this.getStyle("follower.row.span"),a=this.getStyle("follower.column.span");if(1!=s||1!=a){var r=e.getCellRect(i+s-1,n+a-1);r&&(o=Ze.unionRect(o,r))}if(Ze.addPadding(o,this,"follower.padding"),this.getStyle("follower.fill.cell"))this.setLocation(o.x,o.y),this.setWidth(o.width),this.setHeight(o.height);else{var h=this.getStyle("follower.cell.position");o=Xe.get(h,o,this.getRect()),this.setLocation(o.x,o.y)}}}else if(null!=t&&"location"===t.property){var l=t.oldValue,c=t.newValue,d=this.getLocation();this.setLocation(d.x+(c.x-l.x),d.y+(c.y-l.y))}},isHostOn:function(t){if(!t)return!1;for(var e={},i=this._host;i&&i!=this&&!e[i.getId()];){if(i===t)return!0;e[i.getId()]=i,i=i instanceof Me.Follower?i.getHost():null}return!1},isLoopedHostOn:function(t){return this.isHostOn(t)&&t.isHostOn(this)}});var Un=function(t){this._isUpdatingLocationFromChildren=!1,this._isAdjusting=!1,this._expanded=!1,Un.superClass.constructor.call(this,t)};Me.Group=Un,Oe.ext("twaver.Group",Me.Follower,{_image:Rn.IMAGE_GROUP,_icon:Rn.ICON_GROUP,isAdjustedToBottom:function(){return this.isExpanded()&&xi.hasAgentLinks(this)},onChildAdded:function(t,e){Un.superClass.onChildAdded.apply(this,arguments),this.updateLocationFromChildren()},onChildRemoved:function(t,e){Un.superClass.onChildRemoved.apply(this,arguments),this.updateLocationFromChildren()},updateLocationFromChildren:function(){if(!this._isAdjusting&&!Oe.isDeserializing){for(var t,e,i=0,n=this.getChildrenSize();n>i;i++)e=this.getChildAt(i),e instanceof Fn&&(t=Ze.unionRect(t,this.getChildRect(e)));t&&(this._isUpdatingLocationFromChildren=!0,"lefttop"===Rn.GROUP_EXPAND_ALIGN?this.setLocation(t.x-this.getWidth()/2,t.y-this.getHeight()/2):this.setLocation(t.x+t.width/2-this.getWidth()/2,t.y+t.height/2-this.getHeight()/2),this._isUpdatingLocationFromChildren=!1)}},getChildRect:function(t){var e;return t instanceof Fn&&(t instanceof Un?(t.isExpanded()&&t.getChildren().forEach(function(i){e=Ze.unionRect(e,t.getChildRect(i))}),e||(e=t.getRect())):e=t.getRect()),e},setLocation:function(){if(!this._isAdjusting){var t;if(t=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],!Oe.isDeserializing&&!this._isUpdatingLocationFromChildren){this._isAdjusting=!0;var e=t.x-this.getX(),i=t.y-this.getY();xi.moveElements(this.getChildren(),e,i),this._isAdjusting=!1}Un.superClass.setLocation.call(this,t)}},reverseExpanded:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._expanded},setExpanded:function(t){if(this._expanded!==t){var e=this._expanded;this._expanded=t,this.firePropertyChange("expanded",e,this._expanded),this._checkLinkAgent()}},_checkLinkAgent:function(){Un.superClass._checkLinkAgent.call(this);for(var t=this.getChildrenSize(),e=0;t>e;e++){var i=this.getChildAt(e);i instanceof Fn&&i._checkLinkAgent()}},getElementUIClass:function(){return Me.network.GroupUI},getCanvasUIClass:function(){return Me.canvas.GroupUI},getVectorUIClass:function(){return Me.vector.GroupUI}}),Me.SubNetwork=function(t){Me.SubNetwork.superClass.constructor.call(this,t)},Oe.ext("twaver.SubNetwork",Me.Follower,{ISubNetwork:!0,_image:Rn.IMAGE_SUBNETWORK,_icon:Rn.ICON_SUBNETWORK,_checkLinkAgent:function(){Me.SubNetwork.superClass._checkLinkAgent.call(this);for(var t=this.getChildrenSize(),e=0;t>e;e++){var i=this.getChildAt(e);i instanceof Fn&&i._checkLinkAgent()}}}),Me.Grid=function(t){Me.Grid.superClass.constructor.call(this,t)},Oe.ext("twaver.Grid",Me.Follower,{_icon:Rn.ICON_GRID,_image:null,getCellObject:function(t,e){1===arguments.length&&(e=t.y,t=t.x);for(var i=this.getStyle("grid.row.count"),n=this.getStyle("grid.column.count"),o=0;i>o;o++)for(var s=0;n>s;s++){var a=this.getCellRect(o,s);if(Ze.containsPoint(a,t,e))return{rowIndex:o,columnIndex:s,rect:a}}return null},getCellRect:function(t,e){var i=this.getStyle("grid.row.count"),n=this.getStyle("grid.column.count");if(0>=i||0>=n)return null;if(0>t||t>=i)return null;if(0>e||e>=n)return null;var o=this.getRect();Ze.addPadding(o,this,"grid.border");var s=0,a=this.getStyle("grid.row.percents"),r=this.getStyle("grid.column.percents");if(a&&a.length===i){var h=0;for(s=0;t>s;s++)h+=o.height*a[s];o.y+=h,o.height=o.height*a[t]}else o.height=o.height/i,o.y+=o.height*t;if(r&&r.length===n){var l=0;for(s=0;e>s;s++)l+=o.width*r[s];o.x+=l,o.width=o.width*r[e]}else o.width=o.width/n,o.x+=o.width*e;return Ze.addPadding(o,this,"grid.padding"),o},getElementUIClass:function(){return Me.network.GridUI},getCanvasUIClass:function(){return Me.canvas.GridUI},getVectorUIClass:function(){return Me.vector.GridUI}}),Me.ShapeNode=function(t){this._isUpdatingShapeNode=!1,this._points=new fn,Me.ShapeNode.superClass.constructor.call(this,t)},Oe.ext("twaver.ShapeNode",Me.Follower,{_icon:Rn.ICON_SHAPENODE,__accessor:["segments"],getElementUIClass:function(){return Me.network.ShapeNodeUI},getCanvasUIClass:function(){return Me.canvas.ShapeNodeUI},getVectorUIClass:function(){return Me.vector.ShapeNodeUI},getPoints:function(){return this._points},setPoints:function(t){t||(t=new fn);var e=new fn(this._points);this._points=t,this.firePointsChange(e,this._points)},getSegments:function(){return this._segments},setSegments:function(t){t||(t=new fn);var e=new fn(this._segments);this._segments=t,this._reCalculateLineLength(),this.firePropertyChange("segments",e,this._segments)},addPoint:function(t,e){var i=new fn(this._points);this._points.add(t,e),this.firePointsChange(i,this._points)},setPoint:function(t,e){var i=new fn(this._points);this._points.set(t,e),this.firePointsChange(i,this._points)},removePoint:function(t){var e=new fn(this._points);this._points.remove(t),this.firePointsChange(e,this._points)},removeAt:function(t){var e=new fn(this._points);this._points.removeAt(t),this.firePointsChange(e,this._points)},setWidth:function(t){if(1>t&&(t=1),!this._isUpdatingShapeNode&&!Oe.isDeserializing){this._isUpdatingShapeNode=!0;for(var e=new fn(this._points),i=0;i<this._points.size();i++){var n=this._points.get(i);n.x=(n.x-this.getX())*t/this.getWidth()+this.getX()}this.firePointsChange(e,this._points),this._isUpdatingShapeNode=!1}Me.ShapeNode.superClass.setWidth.apply(this,arguments)},setHeight:function(t){if(1>t&&(t=1),!this._isUpdatingShapeNode&&!Oe.isDeserializing){this._isUpdatingShapeNode=!0;for(var e=new fn(this._points),i=0;i<this._points.size();i++){var n=this._points.get(i);n.y=(n.y-this.getY())*t/this.getHeight()+this.getY()}this.firePointsChange(e,this._points),this._isUpdatingShapeNode=!1}Me.ShapeNode.superClass.setHeight.apply(this,arguments)},setLocation:function(){if(!this._isUpdatingShapeNode&&!Oe.isDeserializing){var t;if(t=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],!Oe.num(t.x)||!Oe.num(t.y))return;var e=t.x-this.getX(),i=t.y-this.getY();if(0===e&&0===i)return;this._isUpdatingShapeNode=!0;for(var n=new fn(this._points),o=0;o<this._points.size();o++){var s=this._points.get(o);s.x+=e,s.y+=i}this.firePointsChange(n,this._points),this._isUpdatingShapeNode=!1}Me.ShapeNode.superClass.setLocation.apply(this,arguments)},firePointsChange:function(t,e){if(!this._isUpdatingShapeNode&&!Oe.isDeserializing){var i=Ze.getRect(e);i?(this._isUpdatingShapeNode=!0,Rn.CENTER_LOCATION?this.setLocation(i.x+i.width/2,i.y+i.height/2):this.setLocation(i.x,i.y),this.setWidth(i.width),this.setHeight(i.height),this._isUpdatingShapeNode=!1):(this._isUpdatingShapeNode=!0,this.setWidth(0),this.setHeight(0),this._isUpdatingShapeNode=!1)}this._reCalculateLineLength(),this.firePropertyChange("points",t,e)},_reCalculateLineLength:function(){this._lineLength=null!=this._points&&this._points.size()>0?Ze.calculateLineLength(this._points,this._segments):0},getLineLength:function(){return this._lineLength}}),Me.Bus=function(t){this._styleMap={},this._styleMap["vector.fill"]=!1,this._styleMap["shapenode.closed"]=!1,Me.Bus.superClass.constructor.call(this,t)},Oe.ext("twaver.Bus",Me.ShapeNode,{_icon:Rn.ICON_BUS,firePointsChange:function(t,e){var i=e.size();if(!Oe.isDeserializing&&i>=2)for(var n=e.get(0),o=1;i>o;o++){var s=e.get(o);Math.abs(s.x-n.x)>Math.abs(s.y-n.y)?s.y=n.y:s.x=n.x,n=s}Me.Bus.superClass.firePointsChange.apply(this,arguments)}}),Me.ShapeLink=function(t,e,i){this._points=new fn,this._styleMap={},this._styleMap["link.bundle.enable"]=!1,Me.ShapeLink.superClass.constructor.call(this,t,e,i)},Oe.ext("twaver.ShapeLink",Me.Link,{_icon:Rn.ICON_SHAPELINK,getElementUIClass:function(){return Me.network.ShapeLinkUI},getCanvasUIClass:function(){return Me.canvas.ShapeLinkUI},getVectorUIClass:function(){return Me.vector.ShapeLinkUI},getPoints:function(){return this._points},setPoints:function(t){t||(t=new fn);var e=new fn(this._points);this._points=t,this.firePointsChange(e,this._points)},addPoint:function(t,e){var i=new fn(this._points);this._points.add(t,e),this.firePointsChange(i,this._points)},setPoint:function(t,e){var i=new fn(this._points);this._points.set(t,e),this.firePointsChange(i,this._points)},removePoint:function(t){var e=new fn(this._points);this._points.remove(t),this.firePointsChange(e,this._points)},removeAt:function(t){var e=new fn(this._points);this._points.removeAt(t),this.firePointsChange(e,this._points)},firePointsChange:function(t,e){this.firePropertyChange("points",t,e)}}),Me.ShapeSubNetwork=function(t){Me.ShapeSubNetwork.superClass.constructor.call(this,t)},Oe.ext("twaver.ShapeSubNetwork",Me.ShapeNode,{ISubNetwork:!0,_icon:Rn.ICON_SHAPESUBNETWORK,_checkLinkAgent:function(){Me.ShapeSubNetwork.superClass._checkLinkAgent.call(this);for(var t=this.getChildrenSize(),e=0;t>e;e++){var i=this.getChildAt(e);i instanceof Fn&&i._checkLinkAgent()}}}),Me.LinkSubNetwork=function(){Me.LinkSubNetwork.superClass.constructor.apply(this,arguments)},Oe.ext("twaver.LinkSubNetwork",Me.Link,{ISubNetwork:!0,_icon:Rn.ICON_LINKSUBNETWORK}),Me.ShapeLinkSubNetwork=function(){Me.ShapeLinkSubNetwork.superClass.constructor.apply(this,arguments)},Oe.ext("twaver.ShapeLinkSubNetwork",Me.ShapeLink,{ISubNetwork:!0,_icon:Rn.ICON_LINKSUBNETWORK}),Me.RotatableNode=function(t){Me.RotatableNode.superClass.constructor.call(this,t)},Oe.ext("twaver.RotatableNode",Me.Follower,{getWidth:function(){return 0==this._angle?this._getOrignalWidth():this._getRotateRect().width},setWidth:function(t){},getHeight:function(){return 0==this._angle?this._getOrignalHeight():this._getRotateRect().height},setHeight:function(t){},getElementUIClass:function(){return Me.network.RotatableNodeUI},getCanvasUIClass:function(){return Me.canvas.RotatableNodeUI},getVectorUIClass:function(){return Me.vector.RotatableNodeUI},_getRotateRect:function(){for(var t=this._getOrignalWidth(),e=this._getOrignalHeight(),i=Ze.createMatrix(this._angle*Math.PI/180,t/2,e/2),n=[{x:0,y:0},{x:t,y:0},{x:t,y:e},{x:0,y:e}],o=0,s=n.length;s>o;o++)n[o]=i.transform(n[o]);return Ze.getRect(n)},_getOrignalWidth:function(){return Me.RotatableNode.superClass.getWidth.call(this)},_getOrignalHeight:function(){return Me.RotatableNode.superClass.getHeight.call(this)}}),Me.controls.ControlBase=function(){Me.controls.ControlBase.superClass.constructor.apply(this,arguments),this._pools=new fn},Oe.ext("twaver.controls.ControlBase",Me.PropertyChangeDispatcher,{_autoAdjustBounds:!1,addPool:function(t){this._pools.contains(t)||this._pools.add(t)},removePool:function(t){this._pools.remove(t)},adjustBounds:function(t){var e=this._view.style;e.position="absolute",e.left=t.x+"px",e.top=t.y+"px",e.width=t.width+"px",e.height=t.height+"px",this._autoAdjustBounds===!0&&(e.left="0px",e.top="0px",e.right="0px",e.bottom="0px"),this.invalidate&&this.invalidate()},setAutoAdjustBounds:function(e){e===!0?je.addEventListener("resize","_handleResize",t,this):je.removeEventListener("resize",t,this),this._autoAdjustBounds=e},isAutoAdjustBounds:function(){return this._autoAdjustBounds},_handleResize:function(t){this.adjustBounds({x:0,y:0,width:Ve.documentElement.clientWidth,height:Ve.documentElement.clientHeight})},getView:function(){return this._view},invalidate:function(t){this._invalidate||(this._invalidate=!0,Oe.callLater(this.validate,this,null,t))},validate:function(){this._invalidate&&(this._invalidate=!1,0===this._view.offsetWidth&&0===this._view.offsetHeight&&null!==this._reinvalidateCount?(this._reinvalidateCount===e&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()):this.validateImpl())},validateImpl:function(){}}),Me.controls.ViewBase=function(){Me.controls.ViewBase.superClass.constructor.apply(this,arguments),this._interactionDispatcher=new Me.EventDispatcher,this._viewDispatcher=new Me.EventDispatcher},Oe.ext("twaver.controls.ViewBase",Me.controls.ControlBase,{__bool:["focusOnClick"],_focusOnClick:Rn.FOCUS_ON_CLICK,getSelectionModel:function(){return this._selectionModel?this._selectionModel:this._box.getSelectionModel()},isShareSelectionModel:function(){return null==this._selectionModel},setShareSelectionModel:function(t){var e=null==this._selectionModel;e!==t&&(t?(this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.dispose(),this._selectionModel=null):(this._box.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel=new Me.SelectionModel(this._box),this._selectionModel.addSelectionChangeListener(this.handleSelectionChange,this)),this.onShareSelectionModelChanged(),this.firePropertyChange("shareSelectionModel",e,t))},removeSelection:function(){if(0===this.getSelectionModel().size())return null;var t=this.getSelectionModel().toSelection();return this._box._undoManager._enabled&&this._box._undoManager.startBatch(),t.forEach(function(t){this._box.remove(t)},this),this._box._undoManager._enabled&&this._box._undoManager.endBatch(),t},selectAll:function(){var t=new fn;return this._box.forEach(function(e){this.isVisible(e)&&t.add(e)},this),this.getSelectionModel().setSelection(t),t},isSelected:function(t){return this.getSelectionModel().contains(t)},isSelectable:function(t){return this.getSelectionModel().isSelectable(t)},getLabel:function(t){return t.getName()},getToolTip:function(t){return t.getToolTip()},getIcon:function(t){return t.getIcon()},getSelectColor:function(t){return Rn.SELECT_COLOR},addViewListener:function(t,e,i){this._viewDispatcher.add(t,e,i)},removeViewListener:function(t,e){this._viewDispatcher.remove(t,e)},fireViewEvent:function(t){this._viewDispatcher.fire(t)},addInteractionListener:function(t,e,i){this._interactionDispatcher.add(t,e,i)},removeInteractionListener:function(t,e){this._interactionDispatcher.remove(t,e)},fireInteractionEvent:function(t){this._interactionDispatcher.fire(t)},invalidate:function(t){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:"invalidate"}),Oe.callLater(this.validate,this,null,t))},validate:function(){this._invalidate&&(this._invalidate=!1,ze||0!==this._view.offsetWidth||0!==this._view.offsetHeight||null===this._reinvalidateCount?(this._isValidating=!0,this.fireViewEvent({kind:"validateStart"}),this.validateImpl(),this.fireViewEvent({kind:"validateEnd"}),delete this._isValidating):(this._reinvalidateCount===e&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()))}}),Me.controls.View=function(){Me.controls.View.superClass.constructor.apply(this,arguments)},Oe.ext("twaver.controls.View",Me.controls.ViewBase,{_zoom:1,_maxZoom:Rn.ZOOM_MAX,_minZoom:Rn.ZOOM_MIN,getRootDiv:function(){return this._rootDiv},isValidEvent:function(t){return je.isValidEvent(this._view,t)},getAlarmFillColor:function(t){if(t.IElement){var e=t.getAlarmState().getHighestNewAlarmSeverity();if(e)return e.color}return null},getInnerColor:function(t){if(t.IElement){var e=t.getAlarmState().getHighestNativeAlarmSeverity();return e?e.color:t.getStyle("inner.color")}return null},getOuterColor:function(t){if(t.IElement){var e=t.getAlarmState().getPropagateSeverity();return e?e.color:t.getStyle("outer.color")}return null},zoomOverview:function(t){var e=Math.min(this._view.clientWidth/this._viewRect.width,this._view.clientHeight/this._viewRect.height);this.setZoom(e,t)},getLogicalPoint:function(t){return je.getLogicalPoint(this._view,t,this.getZoom(),this._rootDiv)},centerByLogicalPoint:function(t,e,i){i&&Me.animate.AnimateManager.endAnimate();var n=this._view.scrollWidth-this._view.clientWidth,o=this._view.scrollHeight-this._view.clientHeight,s=(t-this._view.clientWidth/this._zoom/2)*this._zoom,a=(e-this._view.clientHeight/this._zoom/2)*this._zoom;0>s&&(s=0),0>a&&(a=0),s>n&&(s=n),a>o&&(a=o),i?Me.animate.AnimateManager.start(new Me.animate.AnimateScrollPosition(this._view,s,a)):(this._view.scrollLeft=s,this._view.scrollTop=a)},panByOffset:function(t,e){t*=this.getZoom(),e*=this.getZoom();var i=this._view.scrollLeft+t,n=this._view.scrollTop+e,o=this._view.scrollWidth-this._view.clientWidth,s=this._view.scrollHeight-this._view.clientHeight;0>i&&(i=0),i>o&&(i=o),0>n&&(n=0),n>s&&(n=s);var a={x:(i-this._view.scrollLeft)/this.getZoom(),y:(n-this._view.scrollTop)/this.getZoom()};return this._view.scrollLeft=i,this._view.scrollTop=n,a},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(t){if(!(0>t)){var e=this._maxZoom;this._maxZoom=t,this.firePropertyChange("maxZoom",e,t),this.getZoom()>t&&this.setZoom(t)}},getMinZoom:function(){return this._minZoom},setMinZoom:function(t){if(!(0>t)){var e=this._minZoom;this._minZoom=t,this.firePropertyChange("minZoom",e,t),this.getZoom()<t&&this.setZoom(t,!1)}},getZoom:function(){return this._zoom},onZoomChanged:function(t,e){},zoomIn:function(t){this.setZoom(this._zoom*Rn.ZOOM_INCREMENT,t)},zoomOut:function(t){this.setZoom(this._zoom/Rn.ZOOM_INCREMENT,t)},zoomReset:function(t){this.setZoom(1,t)},checkZoom:function(t){return t<this._minZoom&&(t=this._minZoom),t>this._maxZoom&&(t=this._maxZoom),t},setZoom:function(t,e){if(Oe.num(t)&&!(0>=t)&&(t=this.checkZoom(t),t!==this._zoom))if(null==e&&(e=Rn.ZOOM_ANIMATE),e)Me.animate.AnimateManager.start(new Me.animate.AnimateZoom(this,t));else{var i=(this._view.scrollLeft+this._view.clientWidth/2)/this._zoom,n=(this._view.scrollTop+this._view.clientHeight/2)/this._zoom,o=this._zoom;this._zoom=t,je.setZoom(this._rootDiv,t),this.firePropertyChange("zoom",o,t),this.onZoomChanged(o,t),this.centerByLogicalPoint(i,n,!1)}},setTouchZoom:function(t){this.setZoom(t,!1)}}),function(){var t=function(t,e,i,n){var o=new Ue;o.src=n,Me.Util.registerImage(t,o,e,i)};t("subnetwork_image",64,46,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAuCAYAAACYlx/0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB1JJREFUeNrkWmtQk1cafr4vUQhEiNeBpkWwXitCqK1WaiU4tCMjlmCnrU4rmE4v2v1Rmf7q7M6is/uj7e4OurMz7fSyiXXVddsasBa0xQawoqiFFPBWJATkVpQSLPdLTt/zkTCgSHVNuISXeZLvnC8JeZ7zvu8578kBRs/UhB0EE6GZwIaBmbCToIEXWSjBcAfCI4GLoZ3QzIX+0RwgpYnUsPT0dGY2m5nDwYagqKiYGQwGlpiYeKsQJvoc1UQjriKYCYwjJiaG5eScYN09fXeF8qsVLDk5hbneT2gWJkpYyARBJQpCMYFNV6nYRx9/wtq7uv8vnD57jkVGRjL+WYRmgsYDg+U+U0ydoiJvNpPjagICA2E6moVlERH39Zkt9hboEuJxobSUN+2iKMR2dPdYxkSAQD+FhoJSxxiLAY9LNsgtBeS6+qYFBuC/piNYGr7MLV/yZksLXkx6FpfKynjTRiJEtbR32EdFgNmB01REeAdjSHFm9N8146Ev8fgTq9zqqr/evImN8XGoq6nhzd1Nv7amelwA9awZOsrQBjizsHLaNCxf8YSEhUseue0L/nT5IgICArAp5RWP5Jeis2fwxpbN0jX3gtobv1g8IkCYOkjFiDiNvI63gx5QQ7/tD1i9Ng5KZcCYJtl3095BdqaJf3NjVX2j3u0CLA4LUTkcDjNzxvfLr24jbIdDmpLH3q7X1yMlKb5/xpGJSTwxOm9ZLldW2+9LgIhF8/vJ05zr76/EO399H0siHh1vawykvf0mSi1Fw9220/1cQRDyCBklV67a7kmA5eFLTNzt/ZVK/Ond3VCHPjwu1xqWwlM4lvnFQLvKehVtra23kyMRKFfsOVdyMfd3BYheHrmV3J4nPPz57/9CcEgoxqsRMdBADbRFQaQ+4HJZCWqrrDhtzkG1zTr49UZC6qnzxfZhBVj75EqVo89RybN9/MZNWLvhuYldg5AaDTVVOPnNURTmmwfCQxTF2O8KCi23CbBO+xQVLSxt+szZSP3LP9DrcHhFGSrQX431CrI/34+6a1VOcUR9tjnfOESAxHVxvD5XPbtZjwWRj8HbzNHTjexDeylELM41hBhlyvpGagibdBv40tYUOGMmknf8ET19ffBGk4si8r76H0rPF0rhIJPJww4czrDLfXx9+bqeprsodHR1w1utF31YGZeAlqYbaGyo4yvbdIJe2KZPLuZbUNoNz2O6ei683dqbfsbxz/e5QiFMrlD4SSs+1aw5cHhJ8hvJlLOCMG/hYtRfq+YZ8C25r59CujHVz9+rQ8Bl3TTIcxeHo7npOp8BtHI/Ig7XBhzDpDDV7GA4eWvkhn37pc650esmRQg4Yx8u3nJrZaV00dbZjclkLt5yV0e1tRwPjtPix6PrA14+0rO2zlaBkHkLJgXpcloROqtAO/eAPC5AydkCPBkXPykE4FydlivnNTOpkVZCNXZXZwf8/JXevRBqa8UZ83EqoQU+8+2V0UODzxS5TibKgnx8fLAoQiOVk96KzH2foOJCKWSiYOvpc2yXkuAUuXwP3TaczMrA07oXoPBSL+Be/n1WJqbK5TT6LLWzpxcyaXXU22tRKnx1zNEbdL2uBo89tVZyEW9CXVUFDO/vAnHkW+pGe1vHe0O2xIJUARpBFHlhhKSt27AmYaPXjHz+14dhMnzY32Ast765JdZ1T+a6aO3sapih9K+Sy2S68pIizJwTBHXo/Akd7/XVVhz453sozMmmmBe5Jxhrm5qTht0Uddl8dbCB3ruVX6+O1yFhy2sTbsQvnj+D77MzYb1UMtDHHCz1al3D7mE3RW+1R8JC0klBfpwFwSFhWP/yqwijCmpckCsqRENVJYLnhsGXCprO9jbUU7ujvRUN1ZVEumzI6xljRsKuS7ZrtuH3De9gkQvn6URBHPhdMJQEWPVMAhZHrRgz8vYbjfgg7W2J9EhGGd5GDxlEfM+P5VbbyBunI9jjSxepyBO4N2wd3B+6aCkio7USRss6O9rw2d92oqF/IG1E7lZiedTH9/1zz124ctc/mt7V+YBoTXgoifAWQUcIdfVvSNmOiFVrRkWAr/Z+iJLTeZIjUNkedaq41OaOz73nEyKxK5drnGJIXrF+y+tYtnK1B0e+HSe+3I/SMyelNidvLvxhbE6IDLb4mGiDS4SlK1YjVrcZvgo/t5JvrK3GsYOfSs/95Jn+WH6B0Z3/477OCCU+rd1JIqTx68AZs6DVbcKCcI0bRr0DRfnfouD4kYH8RyMfeyQnz+JuD7vvQ1LPr39GSyIYXLlhzgMP4dE1cZIQ9+oRLb/cQNm5Avxw8gS6yPWd01gukdd/kfWtzRMh5pZTYi/p1vPZYoczNwwcapxPIoQ8vFASZY76IRJEMeR9P9fWSESvVfyE8rJiNNbVDJ6/eabf9R/TUSM8aG49Jqd/IUkliiIXImXwbHEvRqQtNOJ7/n3osEeJe0SAwbY9ebOGxOBnjGKcYtxJEAsnTfiRkPHBZwdtGEX7TYABAPgBTYK366ChAAAAAElFTkSuQmCC"),t("bus_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAINJREFUeNqkU0EOgCAMo2Y/1P8Y/6NvnBADwTnGzHYiGetKW8DMKVJLChbVAwCNCrrzp5/Zg/4MaH0JMBOEh08o6OtxtgvXvkFuV/vFBeGEm0WZo8GgF+QlIkI2OrZq5WLAFjuy4DvVWXHl2VodyElMjkxAJNFm4EjmFGAqLKLf+RZgAKkFNRwzv7gHAAAAAElFTkSuQmCC"),t("data_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAMZJREFUeNqkU8ENwjAM9KEwWwaAKVA3iMQDtRtUTAEDdLZWMkkhIUljU4n7RInP9p3dgoiYBAzDgHAyfykA1rtzbr2bmpDDk5uBvu+ROO98pvs4FqRL10nCogokBS3UBaXCZg9JQ7JQY5qmZoK1trCQCuQJnoS9CsQZHKsNcOyWvS1ehdGqz8xyZ0BXEHG+PTdvj+uJkFsASsusdN5sQSKHGWgWfDxY1GcQfEIYIn4p+HuN+SqXRtL8+ZAOinwm5V+P8ZcAAwC0T1T5kpEqewAAAABJRU5ErkJggg=="),t("databox_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwMjI+N/BiIBUD0jMp8FpDm4cQ2DvYEiw8EL9/FqBqkBqUc3BGT7/0kbz/6HsXHhS/eewtWBXA7CYAMOX75PlCEgA9ANYYQaADbJVleRAShJ0Csw7+T5G2MaQCpgQReAuQAWqPhokAuYGCgEowZQwwBQuiYn/mGAEZaeYTkSlA6IBeCUCDMA2RBSsjZAgAEAOyp6/CYHWkwAAAAASUVORK5CYII="),t("grid_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFdJREFUeNpi/P//PwMlgImBQsACIhgZGUl2BtDljCguAHkFhIMb1xBkU9ULjCATQV4A2UAsWFsfAvcCzEn/YQBoEEE2VD1Y76gXhpcXyM0LjJRmZ4AAAwCoyOJjz29PsAAAAABJRU5ErkJggg=="),t("group_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOFJREFUeNqUUwsOwjAILa67i2fwEMbEnUej55mJO4Rn8DBtglAh6YfOSdJkBfregwEgottiHiAlQuZjh68TQRJzI5L07nSbC//zOrUAmkxAJXBP2VgxRjpDK818z06gZIwrfSACF0iVVZrLiab7ownOl7PTV0QESsRgWqoHt80oD0fpy/BVhuZfsOpkC8LYxAkBw4YedOdDhuRny1UyZEPE334NvbZ6kBYeJGFPKFgp4HsUAqtI9u1AYipJgfQ+GjtQlPvPMkGlBHrLdFjeBeHruE+hYAxSo6C3jb4zyh8BBgBVL19PZ27iaAAAAABJRU5ErkJggg=="),t("group_image",32,29,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAdCAYAAADLnm6HAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABHNJREFUeNqsV1ts21QY/uy4zc1ZnZY2bdbSLMlKxUWkaBJMgJY9gARIax/2NokVofLARWjiBYRY2QMdCGlI440H1ok3btsQ0wAxNdvKpnYdyyYK7UZHVK1L2rRZLo3j2InDOaZD60psp+WXrDjO93/nO7/PfwkDAwu0Nh8jH30wZwc6/f43X9jVJ5gBn/zueJozgaNkUXLtMwLyLt4XDG4Vtj+/B8lMQRf7QLsb079PCpzJnaVnEsmIEeiZgD/Mu5yYT4uYiWd1sW1NTlCsWQGmzC00gOd5lFQVkqLoYiuViobVBNzf3BRaCfUaUyuV2AomXI1sNrmkRUeUZBRlBXJJRVFRdQUoZVXDclvbvUeImn6j3VmAqpjg5ra0xcL2nDwdwW1JQeP2HJLLki7frVQOo+OXwNnttv5fp65vKPSvvLhHmBgf77fV10XqWBaLZPGEgYC0KIFiOYfdBoY8OH72D8QS6ZoX3x1+CFarFZSnxS1gk9OBeUJ+00BAimAolnM6nQDDEDVAHVOpWQBD/Ow2GyhPoyDHWKjYkr+GVrv+GWBmE6BYIsChRYCz0Kt2AWR92GxWUJ7TFy7GWltb9l368ZteM77lcukE53A4tC91VAC7jggwVIANd3h+OHM+Qlj2ktvQv9U0EIAkSZibm7vbNUpcIxxPQsfQV2BhwDHrE2C320F5qPnaPCMkdVel9EdDQ8iLeex/5+27H4dYljnGnRo5B1EUMT1fwI2lUs0CHs9JOD9xGeNjY9i7u9dXkKTovZgvv/j8H+y2njX+3FxiHmKhgHiGhCir1CwgKxawsLgEynP06xO0aO2sxV+rhAopm9migrRUuwCJVDMS8nXXEE2ALMtIF2UskVJaqxWIgIqqrl8ATUGFkNDaLKu174RGjzYWykO9A17P+6pa2WEqhVnmDOfmnUgmk+gN2vBsZ33NAng1DxspIpTH1+H1Pdrz2OCHn34GpaQfFYe1Dm+9+nKY62jzpIcG3xU20gukXAZtzU0Rkoo+mo6/TMZxI6E/Dzz9sFdLXc7jad6pSIW+jQho2OSKjl2djOyiAwmdB8jrLMj6Ka3emQd+Gh2jeUvTp7/aTGBgwyv+cJNm5HLx2plQSmX9AkYuiuXqOUuorKoj1RZ/7fU34PcHMLj/PSwv5/4LMsgy7EtKuTz887kLyMoq7CERi/miroD5TB4Xr/wGrsPT8omqqlV3PjAwgIYGAd9/+xVmrledG46QjhiZjs0iSYtSehk3M6KugAUigGK5rqA/rAc89MEBOJy81qq7u4LVJyYL27eYSkV50hkXxCLmDCKQIhiK5do3e3VL59TUNdrZ0N3dddTgLMQ89zX5XKQtP+m14kGB1QVv4VVMrIwCRn9M6PkAGctN1fjnwk9ddjc2hcxgb6eWov/rWE7tVGS0ZyWjfEYRoxlkVoBAIhE2gYst5vKDpVJ51QR96PBhxONxfHzw4Oo+wFl2mBFAJ1W6+IgR0OGwD2/zda4Z32/99ScpTiU80fPIvT/1/y3AAMOmtJl1Hv9IAAAAAElFTkSuQmCC"),t("link_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHVJREFUeNqkkwEOgCAIRaEr6nlqdR49I4XTzcqUn39jE5xP1C+LCPkjCl0Kq2NC5fYgRXlMSCw0K6Xozhqaol3ckj+QVwGFNIsI5HPCCunSLZDhGUcQ0033IOb3riE1CLJty/bTVubUBqDyc+Pm01oY8NQpwAAbUwhLBQIWcAAAAABJRU5ErkJggg=="),t("linksubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAU5JREFUeNqUUi1Tw0AQ3cukEY0AwdlDM8XRD41ARAAi/RHoCmQ7/QNofkTQFQh8W9kOOtgiQIBImTnuXbs3udAvduZms5t9b/fdrUiHGW2z0cOdLsdJ71GU46yfUrgL/PWx8HLxsUTOI3EE98mp9ZdXie0K8HgydYXtVtN6znHsTQAwdy2DOcY/TMFytkqogqskLIf6qQhYL7q/PI8cOIoiiuO69bvIRf3o5M/YANVqIZ03GjSbz2m5/KGiKDxgp90irbUINzEz2BSQEMKSwJiEwfgONmlFR4AAhg2yV0talWNfAbfJN4s7KHcCCcBPgy7WhobdM7q9uXbd3TPyhvEOwL4/30kpRVJKwrYySZ7nWABlzpsthM49R5lzYUhAruERr/P7CdZNPJJVakUiuOgAw9jSXOyUX8f4ZkCHGzQvAGIw4v9M4E0CMEh/BRgAwM37IYxGnbkAAAAASUVORK5CYII="),t("node_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGBJREFUeNpiZGBg+M9AJvj//z8jC5RBsmZGRkYwzQITCGlaS7TmNXXBcDYTA4Vg1IDBYAAjJB2Rl5DgKRGWqshyATm2o3uBgcwMBbacBZdmZJfh8CJIASMLodxGCAAEGACTAB0gDBYjygAAAABJRU5ErkJggg=="),t("node_image",30,32,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAgCAYAAAAFQMh/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAO0SURBVHjavJZJaF1lGIaffzzn3pvbxAyYJulgNKJIF7WkuhEHFCy40LpRBLdFcFi4ciOCC9dmU910WbduBEEoRhFEarJw2UaLJXFImya5ubln+AcX5+YG3ZjCaT44cDb/+5zv/Ybzi7npo7Mhhi+886c5hFBaLUshX9dKq8tW2bPjExOHweXW+vpZ7/1lrZWanz52jK+//f5QwC8+8xSrN2/Oa2OM10pJgKwoWd/cRQpRKyzEyMRIk9QatFIYY7xOEou1BoD1zS6ff/kTqbW1grtZyVsvz3N8cgRrDUli0dZabB+kpGSkYdHWUGfOSkT6prLH04m1GFOBBaAkKBkQsU5wACpBYyyJtfSt1hVYVGDZf68rpNjXs1b3rU72rZaAlhFJRMj6wJUm+1bv1diYqrmEFCgJQtaf8Z6gMaaqcbPRpJGmgxprCYhYK1iL/YwbaUqz0UTneUFeusG8uRARNYPLEAn95spLR54X6K+uLDI1NQ3A7e0ey3+UtBJDnfO004vc6WRMjg3zzeIPrK2toje3O6StLWII7GYFt7qOPNS7uTo9x25WEENgY2uLze0Oem9xhOBwwZM5j3WyVnDmPC54QnAoWWlrgBgj3nuc9+yWHq3rBe+Wlbb3nhjjPhiowM7TdQ7t6rW66xzOVeBBpw/AzlM4z3bpkTVnvF1W2t79B1xZXVI4x3bpUfcE7PC+/LfVUgic80giY6lhJDG1gmUESawY/QWhG0aLxBh2dnoMqcBrpyawNWdcuMCQCuzs9EiMoWG00GPDR2QrMVxdWqIsch5L1cCOukJowerKn/x9M6GVGMaGj0hx+uEHrypjzzwwN0cI4Z7et6SU/HbtGr4sftbNVvN9a5NP1m78elpK6a0x9wRalCUhBNUeai0Xhf5ASykXh4fbbxo9+nin2y2v3/i9B3jq29YRUA+dPN5ot1qmdOXS7dvldfHIiRky5wBJt9djfePONHA/4Or6KwJ/TYzet9pqNIBAqjVianSEtY1NgCeBd4FTQBuoq+AS6AC/AAvAj1OjIzAzPoqS8pyAFQHx/x4gzs7OxosXP4ufLizEkydORA5wrv+sKCnPzYyPooFHh5vppQiTB/n8PMt47523Of/qebIsY7fT4eOPPiRJkoMcnxVwCXhOH2kPXWi3WpMH7s48J5Ql1tpq3p3j6Pj44MJ4gJgUUlwQzz5xpgMMHbhFYyRNU55+/gWC93x35Qp5niHu7q60I9545aUeoO5qPkJAqupICOFuoQD+nwEAIKWd899qAZAAAAAASUVORK5CYII="),t("shapelink_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIJJREFUeNqkUwsOgCAIxeYN5Ty1Og+ekUarzRwQ5tsYDpTPExIzgwY86uWgtSTwIAF6KTvxg/sMliwwCy27mEVr2Xu7+TjaWm4JqxvKpW/iWowQprX2i8RXhS0xXv+WL0xiKIAVxKssa/0hEMuPiB4epNFxnh7lZG1jdCPdABGcAgwAc06H0rgwLSIAAAAASUVORK5CYII="),t("shapenode_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAI9JREFUeNq0UtsNgDAILI0jdZN2Ho3O027SnRA+MNb0QTWS8EPuLncAIKL5UvY5CEdC7h7pjrEtEABgqwucRCBFk7aAfo9uZJtwmXhQCLDyLJlrkSxaMuGgu8QZ8hVhYD8LVgZx9fMO1H9QKXbm+EJvBYwsuSYyFaEmUvyBUkQWCYUDfg5NV8/49xW6dQowAIJydCoPajIHAAAAAElFTkSuQmCC"),t("shapesubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATBJREFUeNpiDG5cw4ALbO/L+I/M9yyawYjMX1MXzMCCT/PXD69RxLgFREFiKIbADSjzlAfTjq6eYFtBmk+dPgNXaGZqAqZhYjA+igtAmmG2ImuG8UFyIFfAvIPTC+ia0Q2BeYehLpiRCeZfkO37d2/HqRmX4Yxc/CJwZ9+6fYeBEPjw4QOYNjczZfj//z8j3AuMjIjAvXnrNoomdTVVFDkonxEjEIEmgg1C1oAuhw5YQKEZGhHzH9kVbcuPoiiqirSGy5UUF8FtBwFwIK5esYQRaIMfyE/Y/A0yEGbopk2b/FACEeQ0mO1Ati+UvQndFciuAVkG5W5GMQDqV1+QAci2oxuAFC5+4MCBGQIzAEKBBbFimBxILc7MhOQiPzTxTcixwYhsOxLwRWJvxicHEGAAkPKxzyGuYWgAAAAASUVORK5CYII="),t("subnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOJJREFUeNqkUjsOwjAMzavSBQYY4FDM7SGYOUARHICZQ5SBiUPBAAMLIJk8aFASkoDgSVFlu/68Z6NatCqF3Woqrj2ZreHabVMpnUs+H/eerz8c0+cV0amuTK6XG69bDEWsa5hM0KafU/DZeJRCmBwWsXRUUwEU0Y5tRFLfgHRMARYDeoPRSyy383Zee0nsgO5rcROBzo19FUlOoYG0Bp/0IAW7y4LHQT5GB/UL4F6ie3mX0yFLoTQUTByQxE8lQ51wMRHx1Chd4FtkReQUj3VFktj97ZSDNYkK9h6L/03hLsAAjRx4oMVjqkMAAAAASUVORK5CYII="),t=function(t,e,i,n){Me.Util.registerImage(t,n,e,i)},t("expand_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrnK5MbGxsbW69jh8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhfAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNDjgi8GgQ40YGCwyQLDjAAYCXL1UeFBAS5QIFBVYSFMBxwU0EOWcyUIDAQIGjOgcegMnUYsOnUKMiDAgAOw=="),t("collapse_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrXI48bGxsbS59Te8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhhAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNADgq8GgQY0YADBYYIFlwgAMAMGGuPCjAAUcACxQUYElQAMcFABQg2EmTgVADBZLyHHggplOLDaNKnYowIAA7"),t("close_icon",11,11,"data:image/gif;base64,R0lGODlhCwALAIcAAHd3d319fUD/QIODg4iIiI6Ojq6urri4uNnZ2eHh4eTk5Ofn5/Dw8PT09Pj4+Pn5+fz8/P39/f///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAIALAAAAAALAAsAAAhdAAUIOECw4AGBAyUoXCjh4AEJDBA4mIiAQcMDERAUKOBgI4IIBCE0IECSZAMIBB8wYDCg5coHBBkkCECTZgIGMQ0AAKBgpwGcBxgsMLCgKFGcA1cqXXlQoMGCAgMCADs="),t("sort_desc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMDI4QYrnC0INxUnYLADs="),t("sort_asc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMlAWnwIrcDJwi2HsLADs="),t("submenu_enable_icon",8,8,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAA7SURBVHjafI9BDgAgDMKqH3c/ryd1iTqOpARARQUYJG0/AWboB2yoAgTG8jtvtXvMSUdVEdXIeN2cAwDPLmAjfDYS7AAAAABJRU5ErkJggg=="),t("submenu_disable_icon",8,8,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAABKSURBVHjafM9BDoAgDETRD1cTz0W9luDZxhUBCjpJkzZ9m0ESkrhLzW0fJ9JjpT4Zl+juBXmwoB0ACH/gOtNhX2B6AjDUtF3NdwAU6zx4LEQe5AAAAABJRU5ErkJggg=="),t("checkbox_selected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAflJREFUeNqkk09oE1EQxn+7btyIYBRCbayFtlhEtLeAin+KouDNo548eJHCQkFQC1K0Bw8VqT1EVIqo0IMUvejNg6AIIglSsdSCiA0WolaIOWi3+2fGw242CRFBHPjg8d7MfPO+mTEcxzkNDAF5/s1KwE0cxylWKhX1fV89r44gget6bVhd9bRcLqvjOEULyGezWTwvAMAwjIRCRAnD8I/0nZ05gLwZOTYeVBXQOIGgqgk+flrk3MUxVBWRyMeMw5oCG2eREFVBVZibf8+x4ydZLH9GVRISq5W5uXwhDKPSvnz9xolTZ/A29GNZFiJ1kjhBnVFVEw0a7MrQ8HlqbMZwXeYXlpL7ti/Usbz8Hd8PEBGmHzxk9kMVfI+BrWt4PHM/0abtC67r8vTZC4qlWY4c2s/Azh2MTxQwpIPduzZx99Z1bNtu1yBiFp6/fMXr4ht+/NzI+MQNBg/sxdccPbmAqcI1UqkUEresTQMR5ejhQbb19XJ25BJzC8Lbd3dIp22mCtPY9tokuDmB2VyBqtDb082VyxdYv26JXysrTF4dY0uuI3lvoKWCaOoMA1SF7q4u7t2eZObREw7u25MMTbPF8VGCqHNRB4IgQFXY3t/H6MhwLFirGYZBfeItoFSr1fKZTAbVaPbT6fRf19A0TarVKkDJ+N91/j0A8Y5o3Yt7KRAAAAAASUVORK5CYII="),t("checkbox_unselected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAiUlEQVR42qXM3QYFIRiF4d3dJpIhI5FKJCOSSHe7f9gn4ztZo3Wwzt6HvTbHfhdCeD8Nvw27Ad57OI4xUsA5BwMpJQpYa2Eg50wBYwwMlFIocJ4nDFzXRQGtNQzUWilwHAcMtNYooJSCgd47BaSUMDDGoIAQAgbmnBTgnMPAWosCcP3fDdjZNvABvRhVEQglsV8AAAAASUVORK5CYII="),t("radiobutton_selected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAXFJREFUeNrUUz9rwkAUv0syBVxMm01L2lIdilOg4BcQ7eKcIV/AqZAxo1/B2a/QoSSTH6AQCoFMJUSig5C0EiPEv8G+Z604eJNTHxz37vf73Y977+7obrcjlwRHLoyLDYTThWmav6AgKDA9wrg6UF8wvO12O8RFt9s9bwACwvP8U6lUajWbzbYsy/eIR1Hk27b9GgSBlef5O7OEzWZzC5ufNU17gc01gEQcmCOGHGqYJaxWq1qj0WhzHFfwfZ84jrPHVVUliqIUkPM87wOg4KzBcrm8liTpbr1ek8FgQNI03eOz2Yzouk6QQw3zBFmWUewDxnQ6JUmSHHsDRz9qmD0A8ns8HgcortfrRxxzxJBDDfMEi8XC7ff7b4Zh3FSr1UKlUtnjlFI0mCOHGqZBHMd+GIbWZDIROp1OCxqH74HA9Q17vZ7luq4liqJ/uoee/oVyufxX/wPctwqpfKAieB9OsVj8xMVoNDpv8D8/048AAwDskrF8QGeJUgAAAABJRU5ErkJggg=="),t("radiobutton_unselected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATVJREFUeNrUU71qhEAQ9q8S0mhip3C5kCpcFcgjiJfmal/BKr2lr2DtK1wR9BkCaYRUQTzUQtDE5sB/MTOJAQs3jVUGhp2Z75vPnV2XHseRWmMMtdJWC3DzxDTNnyLHbWC5A7+coA/wt77vT5hYlrUsAASKZdkHWZb3mqYdJEm6wXqWZYHneccwDN1hGF6II3Rddw3Nj7quP0HzDko8OsZYQww5RIGmaXaqqh4YhrnA3cwda4ghh3gGdV1fiaK4bdt28cAQQw5RoCxLGr/2lyGHOAKAn0mShDAnteSIIYcoUFWV7zjOM5DPuJPfxik+I4Yc4gh5ngdRFLlpmnKGYew3YFiH6zvZtu36vu/yPB/Me+j5W1AU5XstiuIW7vseQmmCMvg/XgVBeMckjuNlgf/5mL4EGAAhHbltcqEYDQAAAABJRU5ErkJggg=="),t("right_expand_icon",6,11,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAALCAYAAABcUvyWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N0ZBRTFFQjJGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N0ZBRTFFQjNGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCMzYzQTE5MUZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCMzYzQTE5MkZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqPQWR4AAABJSURBVHjaYvT08vrPwMAgCsQM27ZufcMABUxQ+jWI8PL2FkGXwJBElkCRRJeAS2KTAEvikhDFJiGKzSi4f5iwCSLrwPA5QIABAAmgFhOOHdKvAAAAAElFTkSuQmCC"),t("left_expand_icon",6,11,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAALCAYAAABcUvyWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N0ZBRTFFQjZGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N0ZBRTFFQjdGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo3RkFFMUVCNEZCMDUxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo3RkFFMUVCNUZCMDUxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PmpWGHAAAABISURBVHjaYvz//z8DDHh5e4tAma+ZsAmCCCZsgiDAfOr0aQxBuA50QZgEhiBMQhSXBAM2SaZtW7e+wSYJ1oFNEu5BdEmAAAMAvV8Xc/cw3YgAAAAASUVORK5CYII="),t("up_expand_icon",11,6,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QjM2M0ExOEZGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QjM2M0ExOTBGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCMzYzQTE4REZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCMzYzQTE4RUZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnCNygcAAABGSURBVHjaYvz//z8DDHh5e4tAma+BWBTE2LZ16xuYPBMOhXAaSRyiGItCBmwaGD29vHApRAaiyM7ApxAuz0SEQrgGgAADALOxFSETkKKwAAAAAElFTkSuQmCC"),t("down_expand_icon",11,6,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA0xpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QjM2M0ExOENGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QjM2M0ExOEJGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjQ5ZTRmZmE2LTQzNmYtMTE3OS04NThhLTk1ZGZjOWRiNmNiOCIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjQ5ZTRmZmE2LTQzNmYtMTE3OS04NThhLTk1ZGZjOWRiNmNiOCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PtPgXX8AAAA7SURBVHjaYvH08vrPQCRgAmJRItWKMsEYhBSCTd62desbAhrA4iB1TDAGDg2iyPIwZ2DTIIomzgAQYAAmahUFv1Iq6AAAAABJRU5ErkJggg==")}(),We.__tree=function(t,e){t._rootVisible=!0,t._initTree=function(t){this._rootData=null,this._expandMap={},this._levelMap={}},t.validateModel=function(){this._rowDatas.clear(),this._levelMap={},this._dataRowMap={},this._currentLevel=0,this._rootData?this._rootVisible?this.isVisible(this._rootData)&&this._buildData(this._rootData):this._buildChildren(this._rootData):this._buildChildren(),delete this._currentLevel},t._buildData=function(t){this._dataRowMap[t.getId()]=this._rowDatas.size(),this._rowDatas.add(t),this._levelMap[t.getId()]=this._currentLevel,this.isExpanded(t)&&(this._currentLevel++,this._buildChildren(t),this._currentLevel--)},t._buildChildren=function(t){var e=t?t.getChildren():this._box.getRoots(),i=this.getCurrentSortFunction();i&&this.isChildrenSortable(t)?e.toList(this.isVisible,this).sort(i).forEach(function(t){this._buildData(t)},this):e.forEach(function(t){this.isVisible(t)&&this._buildData(t)},this)},t.getLevel=function(t){return this._levelMap[t.getId()]},t.getToggleImage=function(t){return t.getChildrenSize()>0?this.isExpanded(t)?this._expandIcon:this._collapseIcon:null},t.isCheckable=function(t){return this.isCheckMode()},t.isCheckMode=function(){return 1===We.__tree._checkMap[this._checkMode]},t.isChildrenSortable=function(t){return!0},t.handleDataBoxChange=function(t){"remove"===t.kind?delete this._expandMap[t.data.getId()]:"clear"===t.kind&&(this._expandMap={}),this.invalidateModel()},t.isExpanded=function(t){return 1===this._expandMap[t.getId()]},t.expand=function(t){if(!this.isExpanded(t)){for(var e=t.getParent();null!=e&&e!==this._rootData;)this._expandMap[e.getId()]=1,e=e.getParent();this._expandMap[t.getId()]=1,this.invalidateModel()}},t.collapse=function(t){this.isExpanded(t)&&(delete this._expandMap[t.getId()],this.invalidateModel())},t.expandAll=function(){this._box.forEach(function(t){this._expandMap[t.getId()]=1},this),this.invalidateModel()},t.collapseAll=function(){this._expandMap={},this.invalidateModel()},t._handleClick=function(t){if(this.isFocusOnClick()&&Me.Util.setFocus(this._view),!this._isValidating){var e;if(t.target._expandData&&!t.target.ableExpand)e=t.target._expandData,this.isExpanded(e)?(this.collapse(e),this.fireInteractionEvent({kind:"collapse",data:e})):(this.expand(e),this.fireInteractionEvent({kind:"expand",data:e}));else if(t.target._selectData||t.target.parentNode._selectData){if(this._handlePressSelection(t.target._selectData||t.target.parentNode._selectData,t),this.isCheckMode()){var i=this.getRowIndexAt(t);i>=0&&this.__handleClick(t)}}else this._treeColumn?(e=this.getDataAt(t),e&&(this.isCheckMode()?t.target._checkData||this.__handleClick(t):this._handlePressSelection(e,t))):this.isCheckMode()&&!t.target._checkData&&this.__handleClick(t);if(this._currentEditor&&!this._isCommitting&&(this._isCommitting=!0,this.commitEditValue(this._currentEditor._editInfo,this._currentEditor)),this.updateCurrentEditor){var n=this;setTimeout(function(){n.updateCurrentEditor(t)},0)}}},t.__handleClick=function(t){var e=this.getDataAt(t);if(e){var i=this.getRowIndexByData(e);if(this._focusedRow!==i){var n=this._rowDatas.get(this._focusedRow);this._focusedRow=i,n&&this.invalidateData(n),this.invalidateData(e)}}},t._handleDoubleClick=function(t){if(this.isFocusOnClick()&&Me.Util.setFocus(this._view),!this._isValidating){var e;t.target.ableExpand&&t.target._expandData&&(e=t.target._expandData,this.isExpanded(e)?(this.collapse(e),this.fireInteractionEvent({kind:"collapse",data:e})):(this.expand(e),this.fireInteractionEvent({kind:"expand",data:e})))}},t.handleChange=function(t){if(!(this._isCommitting||this._isCanceling||this._isValidating)){var e=t.target._checkData;if(e){var i,n=this.isSelected(e),o=this.getSelectionModel();if("default"===this._checkMode)n?o.removeSelection(e):o.appendSelection(e);else if("children"===this._checkMode)i=new fn(e),i.addAll(e.getChildren());else if("descendant"===this._checkMode)i=new fn,Oe.fillDescendant(e,i);else if("descendantAncestor"===this._checkMode&&(i=new fn,Oe.fillDescendant(e,i),!n))for(var s=e.getParent();s;)i.add(s),s=s.getParent();n?o.removeSelection(i):o.appendSelection(i)}t.target._editInfo&&this.commitEditValue&&(this._isCommitting=!0,this.commitEditValue(t.target._editInfo,t.target))}},t.onLabelRendered=function(t,e,i,n,o,s){},t.onToggleImageRendered=function(t){},t._renderTree=function(t,e,i,n){var o=this._levelMap[e.getId()],s=this.getToggleImage(e),a=this.getLineType(),r=this._indent,h=this.__spanPool.get();h.style.display="inline-block",h.style.position="relative",h.style.verticalAlign="top",h.style.margin="0px 1px 0px 1px",h.style.width=(o+1)*r+"px",t.appendChild(h);var l=e,c=l.getParent(),d=0;if("dotted"===a||"solid"===a){if(null==c){var u=this.getIcon(e);this._addLine(h,e,u,!0)}for(;null!==c;){var _=c.getChildren(),g=l===_.get(_.size()-1),u=this.getIcon(l);l.setClient("isLast",g),0==d&&this._addLine(h,e,u,g),d++,l=c,c=c.getParent()}}if(s){var f=this.__imagePool.get();f.setAttribute("src",Oe.getImageSrc(s)),f.style.verticalAlign="middle",f._expandData=e,f.style.position="absolute",f.style.right="0px";var v=this;f.onload=function(){f.style.top=v.getRowHeight()/2-f.height/2+"px"},h.appendChild(f),this.onToggleImageRendered(f)}var m=this.isCheckable(e),p="disabled"===this.getUncheckableStyle();if(m||p){var y=this._addCheckBox(t,e,n);y.disabled=!m}var u=this.getIcon(e);if(u){var w=this.isCheckMode()||this._treeColumn?null:e;this._addIcon(t,e,u,w)}var A=this.getLabel(e);A&&(h=this.__textPool.get(),h.style.whiteSpace="nowrap",h.style.verticalAlign="middle",h.style.padding="1px 2px 1px 2px",Oe.setText(h,A,this._treeColumn?this._treeColumn.isInnerText():this._innerText),s&&(h._expandData=e,h.ableExpand=!0),this.isCheckMode()||this._treeColumn?this._focusedRow===i&&(h.style.backgroundColor=this.getSelectColor(e)):(h._selectData=e,h.style.backgroundColor=n?this.getSelectColor(e):""),this.onLabelRendered(h,e,A,i,o,n),t.appendChild(h),t.title=this.getToolTip(e))}},We.__tree._checkMap={default:1,children:1,descendant:1,descendantAncestor:1},Me.Column=function(t){Me.Column.superClass.constructor.call(this,t)},Oe.ext("twaver.Column",Me.Data,{IColumn:!0,__property:1,__accessor:["width","horizontalAlign","valueType","propertyType","propertyName","editable","visible","sortable","resizable","movable","sortDirection","sortFunction","enumInfo"],__bool:["innerText"],_innerText:Rn.COLUMN_INNER_TEXT,_width:Rn.COLUMN_WIDTH,_horizontalAlign:Rn.COLUMN_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:Rn.COLUMN_PROPERTY_TYPE,_valueType:Rn.COLUMN_VALUE_TYPE,_editable:Rn.COLUMN_EDITABLE,_sortable:Rn.COLUMN_SORTABLE,_visible:Rn.COLUMN_VISIBLE,_resizable:Rn.COLUMN_RESIZABLE,_movable:Rn.COLUMN_MOVABLE,_sortDirection:"asc",_sortFunction:Rn.SORT_FUNCTION,_enumInfo:null,renderCell:Rn.COLUMN_RENDER_CELL,renderHeader:Rn.COLUMN_RENDER_HEADER,renderEditor:Rn.COLUMN_RENDER_EDITOR,setParent:function(t){throw"parent not supported"},getEnumInfo:function(){return"object"==typeof this._enumInfo?this._enumInfo:"function"==typeof this._enumInfo?1===arguments.length?this._enumInfo(arguments[0]):this._enumInfo():void 0}}),Me.ColumnBox=function(t){Me.ColumnBox.superClass.constructor.apply(this,arguments)},Oe.ext("twaver.ColumnBox",Me.DataBox,{_name:"ColumnBox",add:function(t,e){if(!t.IColumn)throw"Only IColumn can be added into ColumnBox";Me.ColumnBox.superClass.add.apply(this,arguments)}}),Me.Property=function(t){Me.Property.superClass.constructor.call(this,t)},Oe.ext("twaver.Property",Me.Data,{IProperty:!0,__property:1,__accessor:["horizontalAlign","valueType","editable","propertyType","propertyName","categoryName","enumInfo"],__bool:["innerText"],_innerText:Rn.PROPERTY_INNER_TEXT,_horizontalAlign:Rn.PROPERTY_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:Rn.PROPERTY_PROPERTY_TYPE,_valueType:Rn.PROPERTY_VALUE_TYPE,_editable:Rn.PROPERTY_EDITABLE,_categoryName:Rn.PROPERTY_CATEGORY_NAME,_enumInfo:null,renderName:Rn.PROPERTY_RENDER_NAME,renderValue:Rn.PROPERTY_RENDER_VALUE,isVisible:null,renderEditor:Rn.PROPERTY_RENDER_EDITOR,setParent:function(t){throw"parent not supported"},setPropertyName:function(t){var e=this._propertyName;this._propertyName=t,this.firePropertyChange("propertyName",e,t)},setPropertyType:function(t){var e=this._propertyType;this._propertyType=t,this.firePropertyChange("propertyType",e,t)},getEnumInfo:function(){return"object"==typeof this._enumInfo?this._enumInfo:"function"==typeof this._enumInfo?1===arguments.length?this._enumInfo(arguments[0]):this._enumInfo():void 0}}),Me.PropertyBox=function(t){Me.PropertyBox.superClass.constructor.apply(this,arguments)},Oe.ext("twaver.PropertyBox",Me.DataBox,{_name:"PropertyBox",add:function(t,e){if(!t.IProperty)throw"Only IProperty can be added into PropertyBox";Me.PropertyBox.superClass.add.apply(this,arguments)}}),Me.Tab=function(t){Me.Tab.superClass.constructor.call(this,t)},Oe.ext("twaver.Tab",Me.Data,{ITab:!0,__accessor:["view","width","closable","resizable","movable","disabled","visible"],_icon:null,_width:Rn.TAB_WIDTH,_closable:Rn.TAB_CLOSABLE,_resizable:Rn.TAB_RESIZABLE,_movable:Rn.TAB_MOVABLE,_disabled:Rn.TAB_DISABLED,_visible:Rn.TAB_VISIBLE,setParent:function(t){throw"parent not supported"}}),Me.TabBox=function(t){Me.TabBox.superClass.constructor.apply(this,arguments),this.getSelectionModel().setSelectionMode("singleSelection")},Oe.ext("twaver.TabBox",Me.DataBox,{_name:"TabBox",add:function(t,e){if(!t.ITab)throw"Only ITab can be added into TabBox";Me.TabBox.superClass.add.apply(this,arguments)}}),Me.controls.ListBase=function(t){Me.controls.ListBase.superClass.constructor.apply(this,arguments),this._invalidate=!1,this._invalidateModel=!1,this._invalidateDisplay=!1,this._invalidateDatas=null,this._rowDatas=new fn,this._startRowIndex=0,this._endRowIndex=0,this._renderMap={},this._dataRowMap={},this.__divPool=new Me.Pool("div",20),this.__imagePool=new Me.Pool("img",20),this.__canvasPool=new Me.Pool("canvas",20),this.__spanPool=new Me.Pool("span",20),this.__textPool=new Me.Pool("span",20),this.__checkBoxPool=new Me.Pool("input",20),this.__linePool=new Me.Pool("canvas",20),this._pools.add(this.__divPool),this._pools.add(this.__linePool),this._pools.add(this.__imagePool),this._pools.add(this.__canvasPool),this._pools.add(this.__spanPool),this._pools.add(this.__textPool),this._pools.add(this.__checkBoxPool),this._view=je.createView("auto",!0),this._rootDiv=je.createDiv(),this._dataDiv=je.createDiv(),this._dataDiv.style.width="1px",this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(t?t:new Me.DataBox);var e=this;e.handleChange&&e._view.addEventListener("change",function(t){e.handleChange(t)},!1),He.isTouchable?He.isMSTouchable?new Me.controls.ListBaseMSTouchInteraction(this):(new Me.controls.ListBaseTouchInteraction(this),new Me.controls.ListBaseInteraction(this)):new Me.controls.ListBaseInteraction(this)},Oe.ext("twaver.controls.ListBase",Me.controls.View,{__bool:["innerText"],_innerText:Rn.LISTBASE_INNER_TEXT,getDataDiv:function(){return this._dataDiv},getStartRowIndex:function(){return this._startRowIndex},getEndRowIndex:function(){return this._endRowIndex},getRowDatas:function(){return this._rowDatas},getRowIndexByData:function(t){return this._dataRowMap[t.getId()]},getRowIndexById:function(t){return this._dataRowMap[t]},getRowSize:function(){return this._rowDatas.size()},getDataBox:function(){return this._box},setDataBox:function(t){if(!t)throw"DataBox can not be null";if(this._box!==t){var e=this._box;e&&(e.removeDataBoxChangeListener(this.handleDataBoxChange,this),e.removeDataPropertyChangeListener(this.handlePropertyChange,this),e.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=t,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(t):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",e,this._box)}},onPropertyChanged:function(t){"zoom"===t.property?this.invalidate():this.invalidateModel()},invalidateModel:function(){this._invalidateModel||(this._invalidateModel=!0,this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate())},invalidateDisplay:function(){this._invalidateDisplay||(this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate())},invalidateData:function(t){this._invalidateDisplay||(this._invalidateDatas||(this._invalidateDatas={}),this._invalidateDatas[t.getId()]=t,this.invalidate())},validateImpl:function(){var t=this._view.scrollLeft,e=this._view.scrollTop;this._invalidateModel&&(this._invalidateModel=!1,this.validateModel()),this._invalidateDisplay&&(this._invalidateDisplay=!1,this._renderMap={},je.release(this._dataDiv),this._dataDiv.style.height=this.getRowSize()*this._rowHeight+"px");var i;if(this._invalidateDatas){for(i in this._invalidateDatas){var n=this._renderMap[i];n&&(je.release(n),this._dataDiv.removeChild(n),delete this._renderMap[i])}this._invalidateDatas=null}var o=this._view.scrollTop/this._zoom,s=this._view.clientHeight/this._zoom;this._startRowIndex=Math.floor(o/this._rowHeight)-2,this._endRowIndex=Math.ceil((o+s)/this._rowHeight)+2,this._startRowIndex<0&&(this._startRowIndex=0),this._endRowIndex>this._rowDatas.size()&&(this._endRowIndex=this._rowDatas.size());for(var a=this._rowHeight-this._rowLineWidth-2+"px",r=this._rowLineWidth+"px",h=this._startRowIndex;h<this._endRowIndex;h++){var l=this._rowDatas.get(h);i=l.getId();var c=this._renderMap[i];if(!c){c=this.__divPool.get();var d=c.style;d.position="absolute",d.whiteSpace="nowrap",d.lineHeight=a,d.top=h*this._rowHeight+"px",d.borderStyle="solid",d.borderWidth="0px",d.borderBottomWidth=r,d.borderBottomColor=this._rowLineColor,d.opacity=l.getStyle?l.getStyle("whole.alpha"):1,this._dataDiv.appendChild(c),this._renderMap[i]=c;var u=this.isSelected(l);this.renderData(c,l,h,u),this.onDataRendered(c,l,h,u)}}this._dataDiv.style.width=this.calculateSumWidth()+"px","0px"===this._dataDiv.style.height&&(this._dataDiv.style.height="1px"),Oe.keys(this._renderMap).forEach(function(t){var e=this.getRowIndexById(t);if(e<this._startRowIndex||e>=this._endRowIndex){var i=this._renderMap[t];je.release(i),this._dataDiv.removeChild(i),delete this._renderMap[t]}},this),this._pools.forEach(function(t){t.clear()}),this._view.scrollLeft!==t&&(this._view.scrollLeft=t),this._view.scrollTop!==e&&(this._view.scrollTop=e),this.adjustRowSize(),this.onValidated()},adjustRowSize:function(){var t,e,i=this._rowHeight-this._rowLineWidth+"px",n=Math.floor((this._view.scrollLeft+this._view.clientWidth)/this._zoom)+"px";for(t in this._renderMap)e=this._renderMap[t],e.style.height=i,e.style.width=n},onValidated:function(){},onDataRendered:function(t,e,i,n){},calculateSumWidth:function(){return 0},_addCheckBox:function(t,e,i){var n=this.__checkBoxPool.get();return n.keepDefault=!0,n.type="checkbox",n.style.margin="0px 2px",n.style.verticalAlign="middle",n._checkData=e,n.checked=i,n.disabled=!1,t.appendChild(n),n},_addIcon:function(t,e,i,n){var o,s=Oe.getImageAsset(i),a=this.getInnerColor(e),r=this.getOuterColor(e),h=this.getAlarmFillColor(e);if(s&&s.getImage()){var l=s.getWidth(),c=s.getHeight();o=this.__canvasPool.get(),o.style.verticalAlign="middle",o.setAttribute("width",l),o.setAttribute("height",c);var d=o.getContext("2d");d.clearRect(0,0,l,c);var u={x:0,y:0,width:l,height:c};Vi(d,i,a,u,e,this),r&&(d.lineWidth=2,d.strokeStyle=r,d.beginPath(),d.rect(0,0,l,c),d.closePath(),d.stroke()),h&&(d.fillStyle=Ke.createRadialGradient(d,h,"white",1,c-9,8,8,.75,.25),d.beginPath(),d.arc(5,c-5,4,0,2*Math.PI,!0),d.closePath(),d.fill())}else o=this.__imagePool.get(),o.style.verticalAlign="middle",o.setAttribute("src",Oe.getImageSrc(i));o.style.margin="0px 1px 0px 1px",o._selectData=n,t.appendChild(o)},_addLine:function(t,e,i,n){{var o,s,a=this.__linePool.get(),r=Oe.getImageAsset(i),h=this.getToggleImage(e),l=this._levelMap[e.getId()],c=this._indent,d=c,u=c,_=0;this.isCheckable(e),"disabled"===this.getUncheckableStyle()}_=2,r&&(d=r.getWidth(),u=r.getHeight()),n?(o=(l+_-1)*c+d,s=this.getRowHeight()):(o=(l+_-1)*c+d,s=this.getRowHeight()),t.style.width=(l+_-1)*c+"px",t.style.height=s+"px";{var g=this.getLineType(),f=this.getLineColor(),v=this.getLineAlpha(),m=this.getLineThickness(),p=this.getLineDash();Oe.getImageSrc(h)}a.style.verticalAlign="top",a.style.margin="0px 0px 0px 0px",a.style.zIndex=-1,a.setAttribute("width",o),a.setAttribute("height",s);var y=a.getContext("2d");y.lineWidth=m,y.strokeStyle=f,y.globalAlpha=v,"dotted"===g&&y.setLineDash(p);var w=2*(l+_);if(n){var A=e,x=A.getParent();y.clearRect(0,0,o,s);null===x&&0!==e.getChildrenSize()&&this.isExpanded(e)&&(y.moveTo((l+_+1)*o/w,s/2+u/2),y.lineTo((l+_+1)*o/w,s),y.stroke());for(var E=2*l-1;E>=1;E-=2){if(A.getClient("isLast")){if(A=x,x=A.getParent(),(E+1)/2!=l)continue}else A=x,x=A.getParent();E==2*l-1?(y.moveTo((E+_)*o/w,0),y.lineTo((E+_)*o/w,s/2),y.stroke(),y.moveTo((E+_)*o/w,s/2),y.lineTo((E+_+1)*o/w,s/2),y.stroke(),0!==e.getChildrenSize()&&this.isExpanded(e)&&(y.moveTo((E+_+2)*o/w,s/2+u/2),y.lineTo((E+_+2)*o/w,s),y.stroke())):(y.moveTo((E+_)*o/w,0),y.lineTo((E+_)*o/w,s),y.stroke())}}else{var A=e,x=A.getParent();y.clearRect(0,0,o,s);for(var E=2*l-1;E>=1;E-=2){if(A.getClient("isLast")){if(A=x,x=A.getParent(),(E+1)/2!=l)continue}else A=x,x=A.getParent();y.moveTo((E+_)*o/w,0),y.lineTo((E+_)*o/w,s),y.stroke(),E==2*l-1&&(y.moveTo((E+_)*o/w,s/2),y.lineTo((E+_+1)*o/w,s/2),y.stroke(),0!==e.getChildrenSize()&&this.isExpanded(e)&&(y.moveTo((E+_+2)*o/w,s/2+u/2),y.lineTo((E+_+2)*o/w,s),y.stroke()))}}return t.appendChild(a),a},isVisible:function(t){return this._box.contains(t)?this._visibleFunction?this._visibleFunction(t):!0:!1},handleDataBoxChange:function(t){this.invalidateModel()},handlePropertyChange:function(t){"parent"===t.property?this.invalidateModel():this.invalidateData(t.source)},handleHierarchyChange:function(t){this.invalidateModel()},handleSelectionChange:function(t){t.datas.forEach(function(t){this.invalidateData(t)},this),this.onSelectionChanged(t)},getRowIndexAt:function(t){var e=this.getLogicalPoint(t);if(!e)return-1;var i=parseInt(e.y/this._rowHeight);return i>=0&&i<this._rowDatas.size()?i:-1},getDataAt:function(t){var e=this.getRowIndexAt(t);return e>=0?this._rowDatas.get(e):null},getCurrentSortFunction:function(){return this._sortFunction},validateModel:function(){this._rowDatas.clear(),this._dataRowMap={},this._buildChildren(this._box.getRoots()),this._rowDatas=this._rowDatas.toList(this.isVisible,this);var t=this.getCurrentSortFunction();t&&this._rowDatas.sort(t);for(var e=this._rowDatas.size(),i=0;e>i;i++)this._dataRowMap[this._rowDatas.get(i).getId()]=i},_buildChildren:function(t){t.forEach(function(t){this._rowDatas.add(t),this._buildChildren(t.getChildren())},this)},_handlePressSelection:function(t,e){var i=this.getSelectionModel();if(Oe.isCtrlDown(e))i.contains(t)?i.removeSelection(t):i.appendSelection(t);else if(e.shiftKey&&i.getLastData()){var n=i.getLastData(),o=this.getRowIndexByData(n),s=this.getRowIndexByData(t),a=new fn;for(a.add(this.getRowDatas().get(o));o!==s;)o+=s>o?1:-1,a.add(this.getRowDatas().get(o));i.setSelection(a)}else 1===i.size()&&i.contains(t)||i.setSelection(t);this.fireInteractionEvent({kind:2===e.detail?"doubleClick":"click",data:t})},_handleClick:function(t){this.isFocusOnClick()&&Me.Util.setFocus(this._view);var e=this.getDataAt(t);if(e){if(this.isCheckMode()&&!t.target._checkData){var i=this.getRowIndexByData(e);if(this._focusedRow!==i){var n=this._rowDatas.get(this._focusedRow);this._focusedRow=i,n&&this.invalidateData(n),this.invalidateData(e)}}this.isCheckMode()||this._handlePressSelection(e,t)}if(this._currentEditor&&this.commitEditValue(this._currentEditor._editInfo,this._currentEditor),this.updateCurrentEditor){var o=this;setTimeout(function(){o.updateCurrentEditor(t)},0)}},handleChange:function(t){if(!this._isCanceling&&!this._isValidating){var e=t.target._checkData;if(e){var i=this.isSelected(e),n=this.getSelectionModel();i?n.removeSelection(e):n.appendSelection(e)}t.target._editInfo&&this.commitEditValue&&this.commitEditValue(t.target._editInfo,t.target)}},scrollToData:function(t){if(t){var e=this.getRowIndexById(t.getId());if(!(0>e)){var i=e*this._rowHeight*this._zoom,n=i+this._rowHeight*this._zoom,o=this._view.scrollTop;this._view.scrollTop>i&&(o=i),this._view.scrollTop+this._view.clientHeight<n&&(o=n-this._view.clientHeight),this._view.scrollTop!=o&&(this._view.scrollTop=o,this.invalidate())}}},makeVisible:function(t){this.isVisible(t)&&(this.expand&&this.expand(t),Oe.callLater(this.scrollToData,this,[t],2*Rn.CALL_LATER_DELAY))},onSelectionChanged:function(t){this._makeVisibleOnSelected&&("append"===t.kind||"set"===t.kind||"all"===t.kind)&&(this.expand&&this.getSelectionModel().getSelection().forEach(function(t){t.getParent()&&this.expand(t.getParent())},this),Oe.callLater(this.scrollToData,this,[this.getSelectionModel().getLastData()],2*Rn.CALL_LATER_DELAY))},onShareSelectionModelChanged:function(){this.invalidateModel()}}),Me.controls.TableBase=function(t){this._columnBox=new Me.ColumnBox,this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this),Me.controls.TableBase.superClass.constructor.apply(this,arguments),this._cellPool=new Me.Pool("div",20),this._stringPool=new Me.Pool("span",20),this._booleanPool=new Me.Pool("input",20),this._colorPool=new Me.Pool("div",20),this._pools.add(this._cellPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool)},Oe.ext("twaver.controls.TableBase",Me.controls.ListBase,{getColumnBox:function(){return this._columnBox},handleColumnBoxChange:function(t){this.invalidateDisplay()},handleColumnPropertyChange:function(t){t.source!==this._sortColumn||"sortDirection"!==t.property&&"sortFunction"!==t.property&&"sortable"!==t.property?this.invalidateDisplay():this.invalidateModel()},handleColumnHierarchyChange:function(t){this.invalidateDisplay()},renderData:function(t,e,i,n){for(var o,s=this._columnBox.getRoots(),a=s.size(),r=0,h=this._rowHeight-this._rowLineWidth+"px",l=0;a>l;l++){var c=s.get(l),d=c.getWidth();0>d&&(d=0);var u=Math.min(this._columnLineWidth,d);if(c.isVisible()){var _=this._cellPool.get();o=_.style,o.position="absolute",o.whiteSpace="nowrap",o.verticalAlign="middle",o.textAlign=c.getHorizontalAlign(),o.overflow="hidden",o.textOverflow="ellipsis",o.left=r+"px",o.width=d-u+"px",o.height=h,o.borderStyle="solid",o.borderWidth="0px",o.borderRightWidth=u+"px",o.borderRightColor=this._columnLineColor,0===l?(o.borderLeftWidth=u+"px",o.borderLeftColor=this._columnLineColor):o.borderLeftWidth="0px",t.appendChild(_);var g={data:e,value:this.getValue(e,c),div:_,view:this,column:c,rowIndex:i,selected:n};this.renderCell(g),this.onCellRendered(g),r+=d}}o=t.style,o.width=r+"px",o.height=h,o.backgroundColor=this.isCheckMode()&&this._focusedRow===i||!this.isCheckMode()&&n?this.getSelectColor(e):""},adjustRowSize:function(){},onCellRendered:function(t){},calculateSumWidth:function(){for(var t=this._columnBox.getRoots(),e=t.size(),i=0,n=0;e>n;n++){var o=t.get(n),s=o.getWidth();0>s&&(s=0),i+=s}return i},getCurrentSortFunction:function(){var t=this._sortColumn;if(t){var e=t.getSortFunction();if(e){var i=this,n="asc"===t.getSortDirection()?1:-1;return function(o,s){var a=i.getValue(o,t),r=i.getValue(s,t);return e.call(i,a,r,o,s)*n}}}return this._sortFunction},renderCell:function(t){var e=t.column;if(e.renderCell)return void e.renderCell(t);var i=t.value,n=e.getEnumInfo(t.rowIndex);n&&!Array.isArray(n)&&(i=n.map[i]),t.view.isCellEditable(t.data,e)&&(t.enumInfo=n,t.div._editInfo=t),ki.render(e.getValueType(),i,t.div,t.view,e.isInnerText())},getValue:function(t,e){return e.getValue(t,this)},setValue:function(t,e,i){e.setValue(t,i,this)},getColumnAt:function(t){var e=this.getLogicalPoint(t);if(!e)return null;for(var i=this._columnBox.getRoots(),n=0,o=i.size(),s=0;o>n;n++){var a=i.get(n),r=a.getWidth();if(0>r&&(r=0),e.x>s&&e.x<s+r)return a;s+=r}return null},isCellEditable:function(t,e){return this.isEditable()&&e.isEditable()},commitEditValue:function(t,e){if(!this._isCanceling){var i;i="checkbox"===e.type?e.checked:e.value;var n=t.column,o=n.getValueType();if("int"===o&&"string"==typeof i)i=parseInt(i);else if("number"===o&&"string"==typeof i)i=parseFloat(i);else if("list.points"===o){for(var s=i.replace(/\]/g,"").replace(/\[/g,"").split(","),a=new Me.List,r=0;r<s.length;r+=2)r+1>=s.length||a.add({x:parseInt(s[r]),y:parseInt(s[r+1])});i=a}if(this.setValue(t.data,n,i),this._currentEditor){var h=this._currentEditor.parentNode,l=this._currentEditor;delete this._currentEditor,h&&h.removeChild(l),Me.Util.setFocus(this._view)}delete this._isCommitting}},cancelEditing:function(){if(this._currentEditor){this._isCanceling=!0;var t=this._currentEditor.parentNode,e=this._currentEditor;delete this._currentEditor,t&&t.removeChild(e),Me.Util.setFocus(this._view),delete this._isCanceling}},renderEditor:function(t){},onEditorRendered:function(t){},getEditorValue:function(t){var e=t.column.getValueType(),i=t.value,n="";if("list.points"===e){var o=i._as?i._as:i;o.forEach(function(t,e){n+=e==o.length-1?"["+t.x+","+t.y+"]":"["+t.x+","+t.y+"],"})}else n=i;return n},updateCurrentEditor:function(t){var e=t.target;if(e!==this._currentEditor&&e.parentNode!==this._currentEditor){for(var i;e&&e!==this._view&&!(i=e._editInfo);)e=e.parentNode;if(i&&e===i.div){var n=this.renderEditor&&this.renderEditor(i);n?(this._currentEditor=n.view,null!=i.value&&(this._currentEditor.value=this.getEditorValue(i))):i.enumInfo?this._currentEditor=je.createSelect(i.enumInfo,i.value):(this._currentEditor=Ve.createElement("input"),null!=i.value&&(this._currentEditor.value=this.getEditorValue(i)));var o=this;if(i.column&&i.column.renderEditor){var n="function"==typeof i.column.renderEditor?i.column.renderEditor(o,i):i.column.renderEditor;n&&(o._currentEditor=n)}if(this._currentEditor){if(n&&n.onKeyDown){var s=n.onKeyDown;s&&Array.isArray(s)&&o._currentEditor.addEventListener("keydown",function(t){for(var e=0;e<s.length;e++)if(s[e].combKey){var i=null;switch(s[e].combKey){case"ctrlKey":i=t.ctrlKey;break;case"shiftKey":i=t.shiftKey;break;case"altKey":i=t.altKey}t.keyCode===s[e].keyCode&&i&&s[e].handlerEvent&&s[e].handlerEvent(t)}else t.keyCode===s[e].keyCode&&s[e].handlerEvent&&s[e].handlerEvent(t)})}else this._currentEditor.addEventListener("keydown",function(t){var e=t.target._editInfo.view;13===t.keyCode&&t.shiftKey||(13===t.keyCode?e.commitEditValue(t.target._editInfo,t.target):27===t.keyCode&&e.cancelEditing())},!1);if(this._currentEditor.addEventListener("blur",function(t){var e=t.target._editInfo.view;e._isCanceling||e.commitEditValue(t.target._editInfo,t.target)},!1),this._currentEditor.keepDefault=!0,this._currentEditor._editInfo=i,!this._currentEditor.parentNode){var a=this._currentEditor.style;a.position="absolute",a.margin="0px",a.border="0px",a.padding="0px",a.left=i.div.style.left,a.top=i.div.parentNode.style.top,a.width=i.div.style.width,a.height=i.div.style.height,this._rootDiv.appendChild(this._currentEditor)}Me.Util.setFocus(this._currentEditor)}}}},onColumnSorted:function(t){},getCurrentEditor:function(){return this._currentEditor}}),Me.controls.List=function(t){Me.controls.List.superClass.constructor.apply(this,arguments)},Oe.ext("twaver.controls.List",Me.controls.ListBase,{__accessor:["rowHeight","indent","rowLineWidth","rowLineColor","sortFunction","visibleFunction"],__bool:["makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_checkMode:!1,_rowHeight:Rn.LIST_ROW_HEIGHT,_indent:Rn.LIST_INDENT,_rowLineWidth:Rn.LIST_ROW_LINE_WIDTH,_rowLineColor:Rn.LIST_ROW_LINE_COLOR,_makeVisibleOnSelected:Rn.LIST_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Rn.LIST_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Rn.LIST_KEYBOARD_SELECT_ENABLED,isCheckMode:function(){return this._checkMode},setCheckMode:function(t){delete this._focusedRow;var e=this._checkMode;this._checkMode=t,this.firePropertyChange("checkMode",e,t)},isCheckable:function(t){return this._checkMode===!0},renderData:function(t,e,i,n){var o;this._indent>0&&(o=this.__spanPool.get(),o.style.width=this._indent+"px",o.style.display="inline-block",t.appendChild(o));var s=this.isCheckable(e);s&&this._addCheckBox(t,e,n);var a=this.getIcon(e);a&&this._addIcon(t,e,a);var r=this.getLabel(e);if(r){o=this.__textPool.get();var h=o.style;h.whiteSpace="nowrap",h.verticalAlign="middle",h.padding="1px 2px 1px 2px",h.display="inline-block",Oe.setText(o,r,this._innerText),this.onLabelRendered(o,e,r,i,n),t.appendChild(o)}t.style.backgroundColor=this.isCheckMode()?this._focusedRow===i?this.getSelectColor(e):"":n?this.getSelectColor(e):""},onLabelRendered:function(t,e,i,n,o){}}),Me.controls.ListBaseInteraction=function(t){this.listBase=t,this.view=t._view,this.clickTimer=0,this.doubleClickInterval=300;var e=this;this.view.addEventListener("scroll",function(t){e.handleScroll(t)},!1),this.view.addEventListener("mouseup",function(t){e.handleMouseUp(t)},!1),this.view.addEventListener("keydown",function(t){e.handleKeyDown(t)},!1)},Oe.ext("twaver.controls.ListBaseInteraction",Object,{handleMouseUp:function(t){var e=this.listBase,i=this;t.target!==e._currentEditor&&t.target.parentNode!==e._currentEditor&&(i.clickTimer?(clearTimeout(i.clickTimer),i.clickTimer=0,e._handleDoubleClick(t)):(e._handleClick(t),i.clickTimer=setTimeout(function(){clearTimeout(i.clickTimer),i.clickTimer=0},300)))},handleKeyDown:function(t){var e=this.listBase;if(!e._currentEditor)if(Oe.isCtrlDown(t)&&65==t.keyCode)e.isKeyboardSelectEnabled()&&e.selectAll().size()>0&&e.fireInteractionEvent({kind:"selectAll"}),je.preventDefault(t);else if(46==t.keyCode)e.isKeyboardRemoveEnabled()&&e.removeSelection()&&e.fireInteractionEvent({kind:"removeElement"}),je.preventDefault(t);else if(e.isCheckMode()||38!==t.keyCode&&40!==t.keyCode&&37!==t.keyCode&&39!==t.keyCode)Oe.showVersion(t);else{var i=e.getSelectionModel().getLastData();if(i)if(38===t.keyCode||40===t.keyCode){var n=e.getRowDatas(),o=e.getRowIndexByData(i);o>=0&&(38===t.keyCode?0!==o&&(i=n.get(o-1),e.getSelectionModel().setSelection(i)):o!==n.size()-1&&(i=n.get(o+1),e.getSelectionModel().setSelection(i)))}else!e.expand||37!==t.keyCode&&39!==t.keyCode||i.hasChildren()&&(37===t.keyCode?e.collapse(i):e.expand(i));else e.getRowDatas().size()>0&&(i=e.getRowDatas().get(0),e.getSelectionModel().setSelection(i))}},handleScroll:function(t){this.listBase.invalidate()}}),Me.controls.ListBaseTouchInteraction=function(t){this.listBase=t,this.view=t._view,je.addEventListener("touchstart","handleTouchstart",this.view,this)},Oe.ext("twaver.controls.ListBaseTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t),this.startPoint=this.lastPoint=this.listBase.getLogicalPoint(t),je.addEventListener("touchmove","handleTouchmove",this.view,this),je.addEventListener("touchend","handleTouchend",this.view,this),bi.isMultiTouch(t)&&(this.distance=bi.getDistance(t),this.zoom=this.listBase._zoom)},handleTouchmove:function(t){je.preventDefault(t);var e=this.listBase.getLogicalPoint(t);if(!(Ze.getDistance(this.startPoint,e)<20))if(this.moved||(this.moved=!0),bi.isSingleTouch(t)){if(this.lastPoint){var i=this.lastPoint.x-e.x,n=this.lastPoint.y-e.y,o=this.listBase.panByOffset(i,n);this.listBase.invalidate(),this.lastPoint.x-=i-o.x,this.lastPoint.y-=n-o.y}}else if(this.distance){var s=bi.getDistance(t)/this.distance;this.listBase.setZoom(this.zoom*s,!1)}},handleTouchend:function(t){je.preventDefault(t),this.moved||t.target===this.listBase._currentEditor||t.target.parentNode===this.listBase._currentEditor||this.listBase._handleClick(t),delete this.startPoint,delete this.lastPoint,delete this.moved,delete this.distance,delete this.zoom,je.removeEventListener("touchmove",this.view,this),je.removeEventListener("touchend",this.view,this)}}),Me.controls.ListBaseMSTouchInteraction=function(t){Me.controls.ListBaseMSTouchInteraction.superClass.constructor.apply(this,arguments),this._pointerMap={},this._pointerIdArray=[],je.addEventListener("MSPointerDown","handleTouchstart",this.view,this),je.addEventListener("MSPointerMove","handleTouchmove",this.view,this),je.addEventListener("MSPointerUp","handleTouchend",this.view,this),je.addEventListener("MSPointerCancel","handleTouchend",this.view,this),this.superHandleMouseDown=Me.controls.ListBaseMSTouchInteraction.superClass.handleMouseDown},Oe.ext("twaver.controls.ListBaseMSTouchInteraction",Me.controls.ListBaseInteraction,{handleMouseDown:function(t){},handleTouchstart:function(t){t.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),this._pointerMap[t.pointerId]||null==this.listBase.getLogicalPoint(t)||(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length&&t.pointerType==t.MSPOINTER_TYPE_MOUSE&&this.superHandleMouseDown(t),1==this._pointerIdArray.length?(this._startTouchPoint=this.listBase.getLogicalPoint(t),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.listBase.getZoom())},handleTouchmove:function(t){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ze.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10))if(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length){var e=this._getDistance()/this._distance;this.listBase.setZoom(this._zoom*e,!1)}else if(1==this._pointerIdArray.length&&t.pointerType!=t.MSPOINTER_TYPE_MOUSE&&this._startTouchPoint){var i=this.listBase.getLogicalPoint(t);if(null==i)return;var n=this._startTouchPoint.x-i.x,o=this._startTouchPoint.y-i.y,s=this.listBase.panByOffset(n,o);this.listBase.invalidate(),this._startTouchPoint.x-=n-s.x,this._startTouchPoint.y-=o-s.y}},handleTouchend:function(t){if(this._startTouchPoint&&1==this._pointerIdArray.length&&t.pointerType!=t.MSPOINTER_TYPE_MOUSE){var e=this.listBase.getLogicalPoint(t);if(e){var i=new Date;i.getTime()-this._startTouchTime.getTime()<=500&&Ze.getDistance(this._startTouchPoint,e)<=20&&this.superHandleMouseDown(t)}}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Ze.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Me.controls.Tree=function(t){this._interactionDispatcher=new Me.EventDispatcher,this._initTree(t),Me.controls.Tree.superClass.constructor.apply(this,arguments)},Oe.ext("twaver.controls.Tree",Me.controls.ListBase,{__tree:1,__accessor:["rootData","sortFunction","visibleFunction","indent","rowHeight","rowLineWidth","rowLineColor","expandIcon","collapseIcon","uncheckableStyle","lineType","lineColor","lineThickness","lineAlpha","lineDash"],__bool:["rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_checkMode:!1,_indent:Rn.TREE_INDENT,_rowHeight:Rn.TREE_ROW_HEIGHT,_rowLineWidth:Rn.TREE_ROW_LINE_WIDTH,_rowLineColor:Rn.TREE_ROW_LINE_COLOR,_makeVisibleOnSelected:Rn.TREE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Rn.TREE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Rn.TREE_KEYBOARD_SELECT_ENABLED,_expandIcon:Rn.TREE_EXPAND_ICON,_collapseIcon:Rn.TREE_COLLAPSE_ICON,_uncheckableStyle:"none",_lineType:Rn.TREE_LINE_TYPE,_lineColor:Rn.TREE_LINE_COLOR,_lineThickness:Rn.TREE_LINE_THICKNESS,_lineAlpha:Rn.TREE_LINE_ALPHA,_lineDash:Rn.TREE_LINE_DASH,getCheckMode:function(){return this._checkMode},setCheckMode:function(t){delete this._focusedRow;var e=this._checkMode;this._checkMode=t,this.firePropertyChange("checkMode",e,t)},renderData:function(t,e,i,n){this._renderTree(t,e,i,n)},getToolTip:function(t){return t.getToolTip()||t.getName()}}),Me.controls.Table=function(t){this._checkColumn=new Me.Column,this._checkColumn.setName("check"),this._checkColumn.setEditable(!0),this._checkColumn.setWidth(40),this._checkColumn.setHorizontalAlign("center"),this._checkColumn.renderCell=this.renderCheckCell;var e=this;this._checkColumn.getValue=function(t,i){return e.isSelected(t)},Me.controls.Table.superClass.constructor.apply(this,arguments)},Oe.ext("twaver.controls.Table",Me.controls.TableBase,{__accessor:["rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","sortFunction","visibleFunction","sortColumn"],__bool:["editable","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:Rn.TABLE_EDITABLE,_rowHeight:Rn.TABLE_ROW_HEIGHT,_rowLineWidth:Rn.TABLE_ROW_LINE_WIDTH,_rowLineColor:Rn.TABLE_ROW_LINE_COLOR,_columnLineWidth:Rn.TABLE_COLUMN_LINE_WIDTH,_columnLineColor:Rn.TABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:Rn.TABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Rn.TABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Rn.TABLE_KEYBOARD_SELECT_ENABLED,getCheckColumn:function(){return this._checkColumn},isCheckMode:function(){return this._columnBox.contains(this._checkColumn)},setCheckMode:function(t){t!==this.isCheckMode()&&(delete this._focusedRow,t?this._columnBox.add(this._checkColumn,0):this._columnBox.remove(this._checkColumn),this.firePropertyChange("checkMode",!t,t))},renderCheckCell:function(t){var e=t.view._booleanPool.get();e.disabled=!1,e.type="checkbox",e.style.margin="0px 2px",e.style.verticalAlign="middle",e.checked=t.selected;var i=t.div;i.appendChild(e),""===i.style.textAlign&&(i.style.textAlign="center"),e._checkData=t.data}}),Me.controls.TableHeader=function(t){Me.controls.TableHeader.superClass.constructor.apply(this,arguments),this._invalidateScroll=!1,this._invalidateDisplay=!1,this._divPool=new Me.Pool("div"),this._imagePool=new Me.Pool("img"),this._textPool=new Me.Pool("span"),this._resizePool=new Me.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._imagePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this._table=t,this._tableView=t.getView(),this._columnBox=t.getColumnBox(),this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this);var e=this;t.getView().addEventListener("scroll",function(t){e.invalidateScroll()},!1),t.addPropertyChangeListener(function(t){e.invalidateDisplay()},this),this._view=je.createView("hidden"),this._view.tabIndex=-1,this._view.style.background=Rn.TABLEHEADER_BACKGROUND,this._rootDiv=je.createDiv(),this._view.appendChild(this._rootDiv),this.invalidateDisplay(),He.isTouchable&&new Me.controls.TableHeaderTouchInteraction(this),new Me.controls.TableHeaderInteraction(this)},Oe.ext("twaver.controls.TableHeader",Me.controls.ControlBase,{__accessor:["height","moveBackground","insertBackground","columnLineColor","resizeTolerance","sortDescIcon","sortAscIcon","sortIconPosition"],_height:Rn.TABLEHEADER_HEIGHT,_moveBackground:Rn.TABLEHEADER_MOVE_BACKGROUND,_insertBackground:Rn.TABLEHEADER_INSERT_BACKGROUND,_columnLineColor:Rn.TABLEHEADER_COLUMN_LINE_COLOR,_resizeTolerance:Rn.TABLEHEADER_RESIZE_TOLERANCE,_sortDescIcon:Rn.TABLEHEADER_SORT_DESC_ICON,_sortAscIcon:Rn.TABLEHEADER_SORT_ASC_ICON,_sortIconPosition:Rn.TABLEHEADER_SORT_ICON_POSITION,getRootDiv:function(){return this._rootDiv},handleColumnBoxChange:function(t){this.invalidateDisplay()},handleColumnPropertyChange:function(t){this.invalidateDisplay()},handleColumnHierarchyChange:function(t){this.invalidateDisplay()},onPropertyChanged:function(t){this.invalidateDisplay()},invalidateScroll:function(){this._invalidateScroll||(this._invalidateScroll=!0,this.invalidate())},invalidateDisplay:function(){this._invalidateDisplay||(this._invalidateDisplay=!0,this._invalidateScroll=!0,this.invalidate())},validate:function(){this._invalidate&&(this._invalidate=!1,this._invalidateDisplay&&(this._invalidateDisplay=!1,this.validateDisplay()),this._invalidateScroll&&(this._invalidateScroll=!1,this._rootDiv.style.left=-this._tableView.scrollLeft+"px"))},validateDisplay:function(){je.release(this._rootDiv);for(var t=this._table.getZoom(),e=this.getHeight()+"px",i=this.getHeight()-2+"px",n=this._table.getColumnBox().getRoots(),o=n.size(),s=0,a=this._table._columnLineWidth*t,r=0;o>r;r++){var h=n.get(r);if(h.isVisible()){var l=h.getWidth()*t;0>l&&(l=0);var c=Math.min(a,l),d=this._divPool.get();d._column=h;var u=d.style;u.position="absolute",u.whiteSpace="nowrap",u.lineHeight=i,u.overflow="hidden",u.textOverflow="ellipsis",u.backgroundPosition=this._sortIconPosition?this._sortIconPosition:"",u.backgroundRepeat="no-repeat",u.backgroundImage="",u.textAlign=h.getHorizontalAlign(),u.borderStyle="solid",u.borderWidth="0px",u.borderRightWidth=c+"px",u.borderRightColor=this._columnLineColor,0===r?(u.borderLeftWidth=c+"px",u.borderLeftColor=this._columnLineColor):u.borderLeftWidth="0px",u.left=s+"px",u.width=l-c+"px",u.height=e,d._x=s,d._width=l-c,this._rootDiv.insertBefore(d,this._rootDiv.firstChild),this.renderColumn(d,h),this.onColumnRendered(d,h),s+=l,h.isResizable()&&(d=this._resizePool.get(),d._resizeColumn=h,u=d.style,u.position="absolute",u.backgroundColor="white",u.opacity=0,u.left=s-c-this._resizeTolerance+"px",u.width=c+2*this._resizeTolerance+"px",u.height=e,this._rootDiv.appendChild(d))}}this._pools.forEach(function(t){t.clear()}),this._rootDiv.style.width=s+"px",this._rootDiv.style.height=e},renderColumn:function(t,e){if(e.renderHeader)e.renderHeader(t);else{var i=this._textPool.get();if(i.style.whiteSpace="nowrap",i.style.verticalAlign="middle",i.style.padding="1px 2px 1px 2px",i.innerHTML=e.getName()?e.getName():e.getPropertyName(),i.setAttribute("title",i.innerHTML),t.appendChild(i),He.isOpera){var n=t.cloneNode(!1);n.style.left="0px",n.style.top="0px",n.style.opacity=0,t.appendChild(n)}}if(this._table.getSortColumn()===e&&e.isSortable()){var o="asc"===e.getSortDirection()?this._sortAscIcon:this._sortDescIcon,s=Oe.getImageSrc(o);if(this._sortIconPosition&&""!==this._sortIconPosition)t.style.backgroundImage="url("+s+")";else{var a=this._imagePool.get();a.setAttribute("src",s),a.style.verticalAlign="middle",t.appendChild(a)}}},onColumnRendered:function(t,e){}}),Me.controls.TableHeaderInteraction=function(t){this.header=t,this.table=t._table,this.view=t._view;var e=this;this.view.addEventListener("mousedown",function(t){e.handleMouseDown(t)},!1),this.view.addEventListener("mousemove",function(t){e.handleMouseMove(t)},!1)},Oe.ext("twaver.controls.TableHeaderInteraction",Object,{handleMouseDown:function(t){if(0===t.button){if(this.movableDiv)return void this.handleMouseUp(t);this.resizeColumn=t.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(t)),this.changeCursor(t),this._startClient=je.getClientPoint(t),this.lastX=this.getX(t),this._startLogicalX=this.lastX,je.handle_mousedown(this,t)}},changeCursor:function(t){var e="";if(t.target._resizeColumn)e="ew-resize";else{var i=this.getColumnAt(t);i&&(i.isMovable()||i.isSortable())&&(e="pointer")}this.view.style.cursor=e},handleMouseMove:function(t){if(null==this.lastX)return void this.changeCursor(t);if(je.target===this){var e=this._startLogicalX+t.clientX-this._startClient.x;if(this.resizeColumn){if(null!=this.stopX){if(e<this.stopX)return;delete this.stopX}var i=this.resizeColumn.getWidth()+(e-this.lastX)/this.table.getZoom();10>i&&(i=10,this.stopX=e),this.resizeColumn.setWidth(i),this.lastX=e}else if(this.movableDiv){var n=e-this.lastX;if(!this.cloneDiv){if(Math.abs(n)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=je.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var o=this.cloneDiv._x+n;this.cloneDiv.style.left=o+"px",this.cloneDiv._x=o,this.lastX=e,this.columnInfo=this.getColumnInfoAt(t),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}}},handleMouseUp:function(t){if(0===t.button){var e;if(this.resizeColumn);else if(this.movableDiv&&this.columnInfo){e=this.movableDiv._column;var i=this.columnInfo.index;this.table.getColumnBox().moveTo(e,i)}else if(e=this.getColumnAt(t),e&&e.isSortable()){var n=e.getSortDirection();this.table.getSortColumn()===e?("desc"===n&&this.table.setSortColumn(null),e.setSortDirection("asc"===n?"desc":"asc")):this.table.setSortColumn(e),this.table.onColumnSorted(this.table.getSortColumn())}this.clear()}},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX,delete this._startClient,delete this._startLogicalX},getColumnAt:function(t){t=t.target;for(var e;t&&t!==this.view&&!(e=t._column);)t=t.parentNode;return e},getMovableDivAt:function(t){t=t.target;for(var e;t&&t!==this.view&&!(e=t._column);)t=t.parentNode;return e&&e.isMovable()?t:null},getX:function(t){var e=je.getLogicalPoint(this.view,t);return e?e.x:null},getColumnInfoAt:function(t){for(var e=this._startLogicalX+t.clientX-this._startClient.x+this.table.getView().scrollLeft,i=this.table.getColumnBox().getRoots(),n=i.size(),o=this.table.getZoom(),s=0,a=!1,r=0;n>r;r++){var h=i.get(r);if(h===this.movableDiv._column&&(a=!0),h.isVisible()){var l=h.getWidth()*o;if(0>=l)continue;if(e>=s&&s+l>=e){var c=s+l/2>e;!a||h===this.movableDiv._column&&c||r--;var d=c?Math.max(0,r):Math.min(r+1,n),u=c?s:s+l;return u=Math.max(0,u-1),{index:d,column:h,position:u+"px"}}s+=l}}return this.columnInfo}}),Me.controls.TableHeaderTouchInteraction=function(t){this.header=t,this.table=t._table,this.view=t._view,je.addEventListener("touchstart","handleTouchstart",this.view,this)},Oe.ext("twaver.controls.TableHeaderTouchInteraction",Object,{handleTouchstart:function(t){return je.preventDefault(t),this.movableDiv?void this.handleTouchend(t):(this.resizeColumn=t.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(t)),this.lastX=this.getX(t),je.addEventListener("touchmove","handleTouchmove",this.view,this),void je.addEventListener("touchend","handleTouchend",this.view,this))},handleTouchmove:function(t){if(je.preventDefault(t),null!=this.lastX){var e;if(this.resizeColumn){if(e=this.getX(t),null!=this.stopX){if(e<this.stopX)return;delete this.stopX}var i=this.resizeColumn.getWidth()+(e-this.lastX)/this.table.getZoom();0>i&&(i=0,this.stopX=e),this.resizeColumn.setWidth(i),this.lastX=e}else if(this.movableDiv){e=this.getX(t);var n=e-this.lastX;if(!this.cloneDiv){if(Math.abs(n)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=je.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var o=this.cloneDiv._x+n;this.cloneDiv.style.left=o+"px",this.cloneDiv._x=o,this.lastX=e,this.columnInfo=this.getColumnInfoAt(t),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}}},handleTouchend:function(t){je.preventDefault(t);var e;if(this.resizeColumn);else if(this.movableDiv&&this.columnInfo){e=this.movableDiv._column;var i=this.columnInfo.index;this.table.getColumnBox().moveTo(e,i)}else if(e=this.getColumnAt(t),e&&e.isSortable()){var n=e.getSortDirection();this.table.getSortColumn()===e?("desc"===n&&this.table.setSortColumn(null),e.setSortDirection("asc"===n?"desc":"asc")):this.table.setSortColumn(e)}this.clear(),je.removeEventListener("touchmove",this.view,this),je.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX},getColumnAt:function(t){t=t.target;for(var e;t&&t!==this.view&&!(e=t._column);)t=t.parentNode;return e},getMovableDivAt:function(t){t=t.target;for(var e;t&&t!==this.view&&!(e=t._column);)t=t.parentNode;return e&&e.isMovable()?t:null},getX:function(t){var e=je.getLogicalPoint(this.view,t);return e?e.x:null},getColumnInfoAt:function(t){for(var e=this.getX(t)+this.table.getView().scrollLeft,i=this.table.getColumnBox().getRoots(),n=i.size(),o=this.table.getZoom(),s=0,a=!1,r=0;n>r;r++){var h=i.get(r);if(h===this.movableDiv._column&&(a=!0),h.isVisible()){var l=h.getWidth()*o;if(0>=l)continue;if(e>=s&&s+l>=e){var c=s+l/2>e;!a||h===this.movableDiv._column&&c||r--;var d=c?Math.max(0,r):Math.min(r+1,n),u=c?s:s+l;return u=Math.max(0,u-1),{index:d,column:h,position:u+"px"}}s+=l}}return this.columnInfo}}),Me.controls.TablePane=function(t,e){Me.controls.TablePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._table=t,this._tableHeader=e?e:new Me.controls.TableHeader(t),this._view=je.createView("hidden",!0),this._view.tabIndex=-1,this._view.appendChild(this._tableHeader.getView()),this._view.appendChild(this._table.getView());var i=this;this._tableHeader.addPropertyChangeListener(function(t){"height"===t.property&&i.invalidate()})},Oe.ext("twaver.controls.TablePane",Me.controls.ControlBase,{onPropertyChanged:function(t){this.invalidate()},getTable:function(){return this._table},getTableHeader:function(){return this._tableHeader},validateImpl:function(){var t=this._view.offsetWidth,e=this._view.offsetHeight,i=this._tableHeader.getHeight();this._tableHeader.adjustBounds({x:0,y:0,width:t,height:i}),this._table.adjustBounds({x:0,y:i,width:t,height:Math.max(0,e-i)})}}),Me.controls.TreeTable=function(t){this._treeColumn=new Me.Column,this._treeColumn.setName("tree"),this._treeColumn.setWidth(120),this._treeColumn.renderCell=this.renderTreeCell,this._treeColumn.getValue=this.getTreeValue,this._treeColumn.setValue=this.setTreeValue,this._initTree(t),Me.controls.TreeTable.superClass.constructor.apply(this,arguments),this._columnBox.add(this._treeColumn)},Oe.ext("twaver.controls.TreeTable",Me.controls.TableBase,{__tree:1,__accessor:["sortFunction","visibleFunction","checkMode","rootData","sortColumn","indent","rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","expandIcon","collapseIcon","uncheckableStyle","lineType","lineColor","lineThickness","lineAlpha","lineDash"],__bool:["editable","rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:Rn.TREETABLE_EDITABLE,_indent:Rn.TREETABLE_INDENT,_rowHeight:Rn.TREETABLE_ROW_HEIGHT,_rowLineWidth:Rn.TREETABLE_ROW_LINE_WIDTH,_rowLineColor:Rn.TREETABLE_ROW_LINE_COLOR,_columnLineWidth:Rn.TREETABLE_COLUMN_LINE_WIDTH,_columnLineColor:Rn.TREETABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:Rn.TREETABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Rn.TREETABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Rn.TREETABLE_KEYBOARD_SELECT_ENABLED,_expandIcon:Rn.TREETABLE_EXPAND_ICON,_collapseIcon:Rn.TREETABLE_COLLAPSE_ICON,_lineType:Rn.TREE_LINE_TYPE,_lineColor:Rn.TREE_LINE_COLOR,_lineThickness:Rn.TREE_LINE_THICKNESS,_lineAlpha:Rn.TREE_LINE_ALPHA,_lineDash:Rn.TREE_LINE_DASH,getTreeColumn:function(){return this._treeColumn},renderTreeCell:function(t){t.view._renderTree(t.div,t.data,t.rowIndex,t.selected)},getTreeValue:function(t,e){return e.getLabel(t)},setTreeValue:function(t,e,i){t.setName(e)}}),Me.controls.PropertySheet=function(t){Me.controls.PropertySheet.superClass.constructor.apply(this,arguments),this._currentRowIndex=-1,this._currentEditor=null,this._currentData=null,this._invalidate=!1,this._resizeDiv=je.createDiv(),this._resizeDiv.style.backgroundColor="white",this._resizeDiv.style.opacity=0,this._resizeDiv.style.top="0px",this._categoryList=new fn,this._categoryMap={},this._rowList=new fn,this._propertyBox=new Me.PropertyBox,this._propertyBox.addDataBoxChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addDataPropertyChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addHierarchyChangeListener(this.invalidatePropertyBox,this),this.__divPool=new Me.Pool("div",2),this.__cellPool=new Me.Pool("div",2),this.__imagePool=new Me.Pool("img",2),this.__textPool=new Me.Pool("span",2),this._stringPool=new Me.Pool("span",2),this._booleanPool=new Me.Pool("input",2),this._colorPool=new Me.Pool("div",2),this._pools.add(this.__divPool),this._pools.add(this.__cellPool),this._pools.add(this.__imagePool),this._pools.add(this.__textPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool),this._view=je.createView("auto"),this._rootDiv=je.createDiv(),this._dataDiv=je.createDiv(),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(t?t:new Me.DataBox);var e=this;this._view.addEventListener("change",function(t){e.handleChange(t)},!1),He.isTouchable?He.isMSTouchable?new Me.controls.PropertySheetMSTouchInteraction(this):(new Me.controls.PropertySheetTouchInteraction(this),new Me.controls.PropertySheetInteraction(this)):new Me.controls.PropertySheetInteraction(this)},Oe.ext("twaver.controls.PropertySheet",Me.controls.View,{__accessor:["indent","rowHeight","sumWidth","propertyNameWidth","propertyNameHorizontalAlign","autoAdjustable","rowLineWidth","columnLineWidth","borderColor","categorizable","resizeTolerance","editable","selectColor","expandIcon","collapseIcon","sortFunction","visibleFunction"],_autoAdjustable:Rn.PROPERTYSHEET_AUTO_ADJUSTABLE,_selectColor:Rn.SELECT_COLOR,_categorizable:Rn.PROPERTYSHEET_CATEGORIZABLE,_editable:Rn.PROPERTYSHEET_EDITABLE,_propertyNameWidth:Rn.PROPERTYSHEET_PROPERTY_NAME_WIDTH,_propertyNameHorizontalAlign:Rn.PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN,_sumWidth:Rn.PROPERTYSHEET_SUM_WIDTH,_indent:Rn.PROPERTYSHEET_INDENT,_rowHeight:Rn.PROPERTYSHEET_ROW_HEIGHT,_rowLineWidth:Rn.PROPERTYSHEET_ROW_LINE_WIDTH,_columnLineWidth:Rn.PROPERTYSHEET_COLUMN_LINE_WIDTH,_borderColor:Rn.PROPERTYSHEET_BORDER_COLOR,_expandIcon:Rn.PROPERTYSHEET_EXPAND_ICON,_collapseIcon:Rn.PROPERTYSHEET_COLLAPSE_ICON,_resizeTolerance:Rn.PROPERTYSHEET_RESIZE_TOLERANCE,getPropertyBox:function(){return this._propertyBox},getCurrentData:function(){return this._currentData},getDataDiv:function(){return this._dataDiv},getDataBox:function(){return this._box},setDataBox:function(t){if(!t)throw"DataBox can not be null";if(this._box!==t){var e=this._box;e&&(e.removeDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel||e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=t,this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel?this._selectionModel._setDataBox(t):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidate(),this.firePropertyChange("dataBox",e,this._box)}},invalidatePropertyBox:function(){this._isValidating||this.invalidate()},onPropertyChanged:function(t){"zoom"!==t.property&&this.invalidate()},isVisible:function(t){return t.isVisible&&!t.isVisible(this._currentData,this)?!1:this._visibleFunction?this._visibleFunction(t):!0},handlePropertyChange:function(t){this._currentData===t.source&&this.invalidate()},handleSelectionChange:function(t){this._currentData!==this.getSelectionModel().getLastData()&&(this._currentRowIndex=-1,this.invalidate())},isExpanded:function(t){if(!t)return!0;var e=this._categoryMap[t];return e?e.isExpanded:Rn.PROPERTYSHEET_EXPAND_CATEGORY},expand:function(t){if(t){var e=this._categoryMap[t];e&&!e.isExpanded&&(e.isExpanded=!0,this.invalidate())}},expandAll:function(){for(var t in this._categoryMap){var e=this._categoryMap[t];e&&(e.isExpanded=!0)}this.invalidate()},collapse:function(t){if(t){var e=this._categoryMap[t];e&&e.isExpanded&&(e.isExpanded=!1,this.invalidate())}},collapseAll:function(){for(var t in this._categoryMap){var e=this._categoryMap[t];e&&(e.isExpanded=!1)}this.invalidate()},getCategoryName:function(t){if(!this.isCategorizable())return"null";var e=t.getCategoryName();return e?e:"null"},validateModel:function(){this._rowList.clear(),this._categoryList.clear();var t,e,i,n,o,s={},a=new fn,r=this._currentData?this._propertyBox.getRoots():new fn;for(n=r.size(),t=0;n>t;t++)o=r.get(t),this.isVisible(o)&&(a.add(o),i=this.getCategoryName(o),s[i]||(this._categoryList.add(i),s[i]={isExpanded:this.isExpanded(i),properties:new fn}));for(this._sortFunction&&a.sort(this._sortFunction),this._categoryMap=s,n=a.size(),t=0;t<this._categoryList.size();t++){i=this._categoryList.get(t),"null"!==i&&this._rowList.add(i);var h=s[i];if(h.isExpanded)for(e=0;n>e;e++)o=a.get(e),this.getCategoryName(o)===i&&(h.properties.add(o),this._rowList.add({view:this,data:this._currentData,property:o,value:this._currentData?this.getValue(this._currentData,o):null}))}},adjustWidth:function(){var t=this._view.offsetWidth,e=this._view.offsetHeight;t<=this._indent||0>=e||(t-=this._indent,this._rowList.size()*this._rowHeight>e&&(t-=Rn.SCROLL_BAR_WIDTH,0>=t)||(this._propertyNameWidth=0===this._sumWidth||this._propertyNameWidth>this._sumWidth?t/2:t*(this._propertyNameWidth/this._sumWidth),this._sumWidth=t,this._view.style.overflowX="hidden",this._view.style.overflowY="auto"))},validateDisplay:function(){var t=this._rowList.size(),e=this._borderColor,i=this._indent,n=this._rowHeight,o=this._propertyNameWidth,s=Math.max(0,this._sumWidth-o),a=this._rowLineWidth,r=this._columnLineWidth,h=n-a+"px",l=n-a-2+"px",c=i+"px",d=o-r+"px",u=s-r+"px",_=o+s+"px",g=a+"px",f=r+"px",v=o+"px",m=this._dataDiv,p=m.style;p.height=t*n+"px",p.width=i+o+s+"px";var y=this.__divPool.get();p=y.style,p.position="absolute",p.left="0px",p.top="0px",p.width=c,p.height=m.style.height,p.borderWidth="0px",p.backgroundColor=e,m.appendChild(y);for(var w=0;t>w;w++){var A=this._rowList.get(w),x=w*n+"px",E=this.__divPool.get();if(A.rowDiv=E,p=E.style,p.position="absolute",p.whiteSpace="nowrap",p.overflow="hidden",p.textOverflow="ellipsis",p.left=c,p.top=x,p.width=_,p.height=h,p.lineHeight=l,p.borderStyle="solid",p.borderWidth="0px",p.borderBottomWidth=g,p.borderBottomColor=e,m.appendChild(E),"string"==typeof A){p.backgroundColor=e,y=this.__divPool.get(),p=y.style,p.position="absolute",p.left="0px",p.top=x,p.width=c,p.height=h,p.lineHeight=l,p.borderWidth="0px",m.appendChild(y);var T=this.__imagePool.get(),C=this.isExpanded(A)?this._expandIcon:this._collapseIcon;T.setAttribute("src",Oe.getImageSrc(C)),p=T.style,p.verticalAlign="middle",T._expandData=A,y.appendChild(T),this.renderCategory(E,A),this.onCategoryRendered(E,A)}else{var b=A.property,k=this.__cellPool.get();A.nameRender=k,p=k.style,this._currentRowIndex===w&&(p.backgroundColor=this.getSelectColor()),p.position="absolute",p.verticalAlign="middle",p.textAlign=this._propertyNameHorizontalAlign,p.overflow="hidden",p.textOverflow="ellipsis",p.whiteSpace="nowrap",p.left="0px",p.top="0px",p.width=d,p.height=h,p.borderStyle="solid",p.borderWidth="0px",p.borderRightWidth=f,p.borderRightColor=e,E.appendChild(k),this.renderName(A),this.onNameRendered(A),k=this.__cellPool.get(),A.valueRender=k,p=k.style,p.position="absolute",p.verticalAlign="middle",p.textAlign=b.getHorizontalAlign(),p.whiteSpace="nowrap",p.overflow="hidden",p.textOverflow="ellipsis",p.left=v,p.top="0px",p.width=u,p.height=h,p.borderStyle="solid",p.borderWidth="0px",p.borderRightWidth=f,p.borderRightColor=e,E.appendChild(k),this.renderValue(A),this.onValueRendered(A)}}p=this._resizeDiv.style,p.left=i+o-r-this._resizeTolerance+"px",p.width=r+2*this._resizeTolerance+"px",p.height=m.style.height,m.appendChild(this._resizeDiv)},renderCategory:function(t,e){var i=this.__textPool.get(),n=i.style;n.fontWeight="bold",n.whiteSpace="nowrap",n.overflow="hidden",n.textOverflow="ellipsis",n.verticalAlign="middle",n.padding="1px 2px 1px 2px",i.innerHTML=e,i.setAttribute("title",e),t.appendChild(i)},onCategoryRendered:function(t,e){},renderName:function(t){if(t.property.renderName)return void t.property.renderName(t);var e=this.__textPool.get(),i=e.style;i.fontWeight="",i.whiteSpace="nowrap",i.verticalAlign="middle",i.padding="1px 2px 1px 2px";var n=t.property.getName();n||(n=t.property.getPropertyName()),e.innerHTML=n,e.setAttribute("title",n),t.nameRender.appendChild(e)},onNameRendered:function(t){},renderValue:function(t){var e=t.property;if(e.renderValue)return void e.renderValue(t);var i=t.value,n=e.getEnumInfo(this._currentData);n&&!Array.isArray(n)&&(i=n.map[i]),t.view.isCellEditable(t.data,e)&&(t.enumInfo=n,t.valueRender._editInfo=t),t.valueRender.innerHTML="",ki.render(e.getValueType(),i,t.valueRender,t.view,e.isInnerText())},onValueRendered:function(t){},renderEditor:function(t){},onEditorRendered:function(t){},updateCurrentData:function(){this._currentData=this.getSelectionModel().getLastData()},validateImpl:function(){var t=this._view.scrollLeft,e=this._view.scrollTop;je.release(this._dataDiv),this.updateCurrentData(),this.validateModel(),this.isAutoAdjustable()&&this.adjustWidth(),this.validateDisplay(),this._pools.forEach(function(t){t.clear()}),this._view.scrollLeft!==t&&(this._view.scrollLeft=t),this._view.scrollTop!==e&&(this._view.scrollTop=e)},getValue:function(t,e){return t?e.getValue(t,this):null},setValue:function(t,e,i){t&&e.setValue(t,i,this)},isCellEditable:function(t,e){return t?this.isEditable()&&e.isEditable():!1},getRowIndexAt:function(t){var e=this.getLogicalPoint(t);if(!e)return-1;var i=parseInt(e.y/this._rowHeight);return i>=0&&i<this._rowList.size()?i:-1},handleChange:function(t){this._isCommitting||this._isCanceling||this._isValidating||t.target._editInfo&&this.commitEditValue&&this.commitEditValue(t.target._editInfo,t.target)},commitEditValue:function(t,e){var i;i="checkbox"===e.type?e.checked:e.value;var n=t.property,o=n.getValueType();if("int"===o&&"string"==typeof i)i=parseInt(i);else if("number"===o&&"string"==typeof i)i=parseFloat(i);else if("array.string"===o)i=i.split(",");else if("array.number"===o){i=i.split(",");for(var s=0,a=i.length;a>s;s++)i[s]=parseFloat(i[s])}else if("list.points"===o){for(var r=i.replace(/\]/g,"").replace(/\[/g,"").split(","),h=new Me.List,s=0;s<r.length;s+=2)s+1>=r.length||h.add({x:parseInt(r[s]),y:parseInt(r[s+1])});i=h}if(e._rowInfo&&(e._rowInfo.value=i,this.renderValue(e._rowInfo)),this.setValue(t.data,n,i),Me.Util.setFocus(this._view),this._currentEditor){var l=this._currentEditor.parentNode;l&&l.removeChild(this._currentEditor),delete this._currentEditor}delete this._isCommitting},cancelEditing:function(){if(this._currentEditor){var t=this._currentEditor.parentNode;t&&t.removeChild(this._currentEditor),delete this._currentEditor,delete this._isCanceling}},getEditorValue:function(t){var e=t.valueRender._editInfo,i=e.property.getValueType(),n=t.valueRender._editInfo.value,o="";if("list.points"===i){var s=n._as?n._as:n;s.forEach(function(t,e){o+=e==s.length-1?"["+t.x+","+t.y+"]":"["+t.x+","+t.y+"],"})}else o=n;return o},updateCurrentRowIndex:function(t){var e=this._rowList.size();(0>t||t>=e)&&(t=-1);var i,n=this._currentRowIndex;if(t!==n&&(n>=0&&e>n&&(i=this._rowList.get(n),i.nameRender&&(i.nameRender.style.backgroundColor="")),this._currentRowIndex=t),t>=0&&(i=this._rowList.get(t),i.nameRender&&(i.nameRender.style.backgroundColor=this.getSelectColor(),!this._currentEditor&&i.valueRender&&i.valueRender._editInfo))){var o=i.valueRender._editInfo,s=this.renderEditor&&this.renderEditor(i);s?(this._currentEditor=s.view,null!=o.value&&(this._currentEditor.value=this.getEditorValue(i))):o.enumInfo?this._currentEditor=je.createSelect(o.enumInfo,o.value):(this._currentEditor=Ve.createElement("input"),null!=o.value&&(this._currentEditor.value=this.getEditorValue(i)));var a=this;if(i.property&&i.property.renderEditor){var s="function"==typeof i.property.renderEditor?i.property.renderEditor(a,i):i.property.renderEditor;s&&(a._currentEditor=s)}if(this._currentEditor){if(s&&s.onKeyDown){var r=s.onKeyDown;r&&Array.isArray(r)&&a._currentEditor.addEventListener("keydown",function(t){for(var e=0;e<r.length;e++)if(r[e].combKey){var i=null;switch(r[e].combKey){case"ctrlKey":i=t.ctrlKey;break;case"shiftKey":i=t.shiftKey;break;case"altKey":i=t.altKey}t.keyCode===r[e].keyCode&&i&&r[e].handlerEvent&&r[e].handlerEvent(t)}else t.keyCode===r[e].keyCode&&r[e].handlerEvent&&r[e].handlerEvent(t)})}else this._currentEditor.addEventListener("keydown",function(t){var e=t.target._editInfo.view;if(13!==t.keyCode||!t.shiftKey)if(13===t.keyCode){if(e._isCommitting)return;e._isCommitting=!0,e.commitEditValue(t.target._editInfo,t.target)}else 27===t.keyCode&&(e._isCanceling=!0,e.cancelEditing())},!1);if(this._currentEditor.addEventListener("blur",function(t){var e=t.target._editInfo.view;e._isCommitting||e._isCanceling||(e._isCommitting=!0,e.commitEditValue(t.target._editInfo,t.target))},!1),this._currentEditor.keepDefault=!0,this._currentEditor._rowInfo=i,this._currentEditor._editInfo=o,!this._currentEditor.parentNode){var h=this._currentEditor.style;h.position="absolute",h.margin="0px",h.border="0px",h.padding="0px",h.left=this._indent+this._propertyNameWidth+"px",h.top=i.rowDiv.style.top,h.width=i.valueRender.style.width,h.height=i.valueRender.style.height,this._rootDiv.appendChild(this._currentEditor)}Me.Util.setFocus(this._currentEditor),this.onEditorRendered&&this.onEditorRendered(i)}}}}),Me.controls.PropertySheetInteraction=function(t){this.sheet=t,this.view=t._view,this.resizeDiv=t._resizeDiv;var e=this;this.view.addEventListener("mousedown",function(t){0===t.button&&e.handleMouseDown(t)},!1),this.view.addEventListener("mousemove",function(t){e.handleMouseMove(t)},!1)},Oe.ext("twaver.controls.PropertySheetInteraction",Object,{minGap:10,handleMouseDown:function(t){if(t.target!==this.sheet._currentEditor&&t.target.parentNode!==this.sheet._currentEditor&&(this.sheet.isFocusOnClick()&&Me.Util.setFocus(this.view),!this.sheet._isValidating))if(t.target._expandData){var e=t.target._expandData;this.sheet.isExpanded(e)?this.sheet.collapse(e):this.sheet.expand(e)}else if(t.target===this.resizeDiv)this.lastX=this.getX(t),je.handle_mousedown(this,t);else{this.sheet._currentEditor&&!this.sheet._isCommitting&&(this.sheet._isCommitting=!0,this.sheet.commitEditValue(this.sheet._currentEditor._editInfo,this.sheet._currentEditor));var i=this.sheet.getRowIndexAt(t);this.sheet.updateCurrentRowIndex(i)}},handleMouseMove:function(t){if(null==this.lastX&&!je.target)return void this.changeCursor(t);if(je.target===this&&null!=this.lastX){var e=this.getX(t);if(null!=this.stopLeft){if(e<this.stopLeft)return;delete this.stopLeft}if(null!=this.stopRight){if(e>this.stopRight)return;delete this.stopRight}var i=this.sheet.getPropertyNameWidth()+(e-this.lastX);i<this.minGap?(i=this.minGap,this.stopLeft=e):i>this.sheet.getSumWidth()-this.minGap&&(i=this.sheet.getSumWidth()-this.minGap,this.stopRight=e),this.sheet.setPropertyNameWidth(i),this.lastX=e}},handleMouseUp:function(t){0===t.button&&(this.view.style.cursor="default",delete this.stopLeft,delete this.stopRight,delete this.lastX)},changeCursor:function(t){this.view.style.cursor=t.target===this.resizeDiv?"ew-resize":"default"},getX:function(t){return t.clientX/this.sheet.getZoom()}}),Me.controls.PropertySheetTouchInteraction=function(t){this.sheet=t,this.view=t._view,this.resizeDiv=t._resizeDiv,je.addEventListener("touchstart","handleTouchstart",this.view,this)},Oe.ext("twaver.controls.PropertySheetTouchInteraction",Object,{minGap:10,handleTouchstart:function(t){je.preventDefault(t),t.target!==this.sheet._currentEditor&&t.target.parentNode!==this.sheet._currentEditor&&(this.sheet.isFocusOnClick()&&Me.Util.setFocus(this.view),this.sheet._isValidating||(t.target===this.resizeDiv&&(this.lastX=this.getX(t)),this.lastPoint=this.sheet.getLogicalPoint(t),bi.isMultiTouch(t)&&(this.distance=bi.getDistance(t),this.zoom=this.sheet.getZoom()),je.addEventListener("touchmove","handleTouchmove",this.view,this),je.addEventListener("touchend","handleTouchend",this.view,this)))},handleTouchmove:function(t){if(je.preventDefault(t),this.moved||(this.moved=!0),null!=this.lastX){var e=this.getX(t);if(null!=this.stopLeft){if(e<this.stopLeft)return;delete this.stopLeft}if(null!=this.stopRight){if(e>this.stopRight)return;delete this.stopRight}var i=this.sheet.getPropertyNameWidth()+(e-this.lastX);i<this.minGap?(i=this.minGap,this.stopLeft=e):i>this.sheet.getSumWidth()-this.minGap&&(i=this.sheet.getSumWidth()-this.minGap,this.stopRight=e),this.sheet.setPropertyNameWidth(i),this.lastX=e}else if(bi.isSingleTouch(t)){if(this.lastPoint){var n=this.sheet.getLogicalPoint(t),o=this.lastPoint.x-n.x,s=this.lastPoint.y-n.y,a=this.sheet.panByOffset(o,s);this.lastPoint.x-=o-a.x,this.lastPoint.y-=s-a.y}}else if(this.distance){var r=bi.getDistance(t)/this.distance;this.sheet.setZoom(this.zoom*r,!1)}},handleTouchend:function(t){if(je.preventDefault(t),!this.moved)if(t.target._expandData){var e=t.target._expandData;this.sheet.isExpanded(e)?this.sheet.collapse(e):this.sheet.expand(e)}else if(t.target===this.resizeDiv);else{var i=this.sheet.getRowIndexAt(t);this.sheet.updateCurrentRowIndex(i)}delete this.stopLeft,delete this.stopRight,delete this.lastX,delete this.lastPoint,delete this.distance,delete this.zoom,delete this.moved,je.removeEventListener("touchmove",this.view,this),je.removeEventListener("touchend",this.view,this)},getX:function(t){var e=t.changedTouches[0];return e.clientX}}),Me.controls.PropertySheetMSTouchInteraction=function(t){this.sheet=t,this.view=t._view,this.resizeDiv=t._resizeDiv,this._pointerMap={},this._pointerIdArray=[],je.addEventListener("MSPointerDown","handleTouchstart",this.view,this),je.addEventListener("MSPointerMove","handleTouchmove",this.view,this),je.addEventListener("MSPointerUp","handleTouchend",this.view,this),je.addEventListener("MSPointerCancel","handleTouchend",this.view,this),this.superHandleMouseDown=Me.controls.PropertySheetMSTouchInteraction.superClass.handleMouseDown},Oe.ext("twaver.controls.PropertySheetMSTouchInteraction",Me.controls.PropertySheetInteraction,{handleMouseDown:function(t){},handleTouchstart:function(t){t.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),this._pointerMap[t.pointerId]||null==this.sheet.getLogicalPoint(t)||(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length&&t.pointerType==t.MSPOINTER_TYPE_MOUSE&&this.superHandleMouseDown(t),1==this._pointerIdArray.length?(this._startTouchPoint=this.sheet.getLogicalPoint(t),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.sheet.getZoom())},handleTouchmove:function(t){if(0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ze.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10))if(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length){var e=this._getDistance()/this._distance;this.sheet.setZoom(this._zoom*e,!1)}else if(1==this._pointerIdArray.length&&t.pointerType!=t.MSPOINTER_TYPE_MOUSE&&this._startTouchPoint){var i=this.sheet.getLogicalPoint(t);if(null==i)return;var n=this._startTouchPoint.x-i.x,o=this._startTouchPoint.y-i.y,s=this.sheet.panByOffset(n,o);this._startTouchPoint.x-=n-s.x,this._startTouchPoint.y-=o-s.y}},handleTouchend:function(t){if(1==this._pointerIdArray.length&&t.pointerType!=t.MSPOINTER_TYPE_MOUSE){var e=this.sheet.getLogicalPoint(t),i=new Date;i.getTime()-this._startTouchTime.getTime()<=500&&Ze.getDistance(this._startTouchPoint,e)<=20&&this.superHandleMouseDown(t)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Ze.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Me.controls.SplitPane=function(t,e,i,n){Me.controls.SplitPane.superClass.constructor.apply(this,arguments),this._view=je.createView("hidden",!0),this._view.tabIndex=-1,this._dividerDiv=je.createDiv(),this._dividerDiv.tabIndex=-1,this._view.appendChild(this._dividerDiv),t&&this.setFirstView(t),e&&this.setNextView(e),i&&this.setOrientation(i),null!=n&&this.setPosition(n),this.setDividerDraggable(!0),this.setExpandable(!1),this.invalidate(),He.isTouchable&&new Me.controls.SplitPaneTouchInteraction(this),new Me.controls.SplitPaneInteraction(this)},Oe.ext("twaver.controls.SplitPane",Me.controls.ControlBase,{__accessor:["orientation","dividerWidth","dividerBackground","dividerOpacity","maskBackground","upExpandIcon","downExpandIcon","leftExpandIcon","rightExpandIcon"],__bool:["dividerDraggable","expandable"],_position:Rn.SPLITPANE_POSITION,_orientation:Rn.SPLITPANE_ORIENTATION,_dividerWidth:Rn.SPLITPANE_DIVIDER_WIDTH,_dividerBackground:Rn.SPLITPANE_DIVIDER_BACKGROUND,_dividerOpacity:Rn.SPLITPANE_DIVIDER_OPACITY,_maskBackground:Rn.SPLITPANE_MASK_BACKGROUND,_upExpandIcon:Rn.SPLITPANE_UP_EXPAND_ICON,_downExpandIcon:Rn.SPLITPANE_DOWN_EXPAND_ICON,_leftExpandIcon:Rn.SPLITPANE_LEFT_EXPAND_ICON,_rightExpandIcon:Rn.SPLITPANE_RIGHT_EXPAND_ICON,onPropertyChanged:function(t){this.invalidate()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(t){if(0>t&&(t=0),t>1&&(t=1),t!==this._position){var e=this._position;this._position=t,this.firePropertyChange("position",e,t),null==this.lastDividerLocation&&(this.lastDividerLocation=t)}},setFirstView:function(t){if(this._firstView!==t){var e=this._firstView;e&&this._view.removeChild(e.getView?e.getView():e),this._firstView=t,t&&(t.getView?this._view.insertBefore(t.getView(),this._dividerDiv):this._view.insertBefore(t,this._dividerDiv)),this.firePropertyChange("firstView",e,t)}},getFirstView:function(){return this._firstView},setNextView:function(t){if(this._nextView!==t){var e=this._nextView;e&&this._view.removeChild(e.getView?e.getView():e),this._nextView=t,t&&(t.getView?this._view.insertBefore(t.getView(),this._dividerDiv):this._view.insertBefore(t,this._dividerDiv)),this.firePropertyChange("nextView",e,t)}},getNextView:function(){return this._nextView},validateImpl:function(){var t,e=this._position,i=this._view.offsetWidth,n=this._view.offsetHeight,o=this._dividerWidth;if(o>=8||0===o?this._coverDiv&&(this._dividerDiv.removeChild(this._coverDiv),delete this._coverDiv):this._coverDiv||(this._coverDiv=je.createDiv(),this._coverDiv.tabIndex=-1,this._dividerDiv.appendChild(this._coverDiv)),"horizontal"===this._orientation){o>i&&(o=i);var s=(i-o)*e,a=i-o-s+1;Oe.setViewBounds(this._firstView,{x:0,y:0,width:s,height:n}),Oe.setViewBounds(this._nextView,{x:s+o,y:0,width:a,height:n}),Oe.setViewBounds(this._dividerDiv,{x:s,y:0,width:o,height:n}),this._dividerDiv.position=s,this._coverDiv&&Oe.setViewBounds(this._coverDiv,{x:o/2-4,y:0,width:8,height:n}),this._expandable&&(this._expandCvs1||(t=Oe.html.createDiv(),t.tabIndex=-1,Oe.setViewBounds(t,{x:0,y:0,width:o,height:11}),this._expandCvs1=Oe.html.createImg(Oe.getImageSrc(this._leftExpandIcon)),this._expandCvs1.style.left=o/2-3+"px",t.appendChild(this._expandCvs1),this._dividerDiv.appendChild(t)),this._expandCvs2||(t=Oe.html.createDiv(),t.tabIndex=-1,Oe.setViewBounds(t,{x:0,y:15,width:o,height:11}),this._expandCvs2=Oe.html.createImg(Oe.getImageSrc(this._rightExpandIcon)),this._expandCvs2.style.left=o/2-3+"px",t.appendChild(this._expandCvs2),this._dividerDiv.appendChild(t)))}else{o>n&&(o=n);var r=(n-o)*e,h=n-o-r;Oe.setViewBounds(this._firstView,{x:0,y:0,width:i,height:r}),Oe.setViewBounds(this._nextView,{x:0,y:r+o,width:i,height:h}),Oe.setViewBounds(this._dividerDiv,{x:0,y:r,width:i,height:o}),this._dividerDiv.position=r,this._coverDiv&&Oe.setViewBounds(this._coverDiv,{x:0,y:o/2-4,width:i,height:8}),this._expandable&&(this._expandCvs1||(t=Oe.html.createDiv(),t.tabIndex=-1,Oe.setViewBounds(t,{x:0,y:0,width:11,height:o}),this._expandCvs1=Oe.html.createImg(Oe.getImageSrc(this._upExpandIcon)),this._expandCvs1.style.top=o/2-3+"px",t.appendChild(this._expandCvs1),this._dividerDiv.appendChild(t)),this._expandCvs2||(t=Oe.html.createDiv(),t.tabIndex=-1,Oe.setViewBounds(t,{x:15,y:0,width:11,height:o}),this._expandCvs2=Oe.html.createImg(Oe.getImageSrc(this._downExpandIcon)),this._expandCvs2.style.top=o/2-3+"px",t.appendChild(this._expandCvs2),this._dividerDiv.appendChild(t)))}var l=this._dividerDiv.style;l.background=this._dividerBackground}}),Me.controls.SplitPaneInteraction=function(t){this.splitPane=t,this.view=t._view,this.dividerDiv=t._dividerDiv;var e=this;this.view.addEventListener("mousedown",function(t){0===t.button&&e.handleMouseDown(t)},!1),this.view.addEventListener("mousemove",function(t){e.handleMouseMove(t)},!1)},Oe.ext("twaver.controls.SplitPaneInteraction",Object,{handleMouseDown:function(t){if(this.splitPane.isExpandable()){var e,i,n=this.splitPane._dividerWidth;if(t.target===this.splitPane._expandCvs1)return void("horizontal"===this.splitPane._orientation?(e=this.view.clientWidth,n>e&&(n=e),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(i=this.view.clientHeight,n>i&&(n=i),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())));if(t.target===this.splitPane._expandCvs2)return void("horizontal"===this.splitPane._orientation?(e=this.view.clientWidth,n>e&&(n=e),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(i=this.view.clientHeight,n>i&&(n=i),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())))}if(this.splitPane.isDividerDraggable())if(this.resizeDiv)this.clear(t);else if(t.target===this.dividerDiv||t.target===this.splitPane._coverDiv){this.resizeDiv=je.createDiv();var o=this.resizeDiv.style;o.left=this.dividerDiv.style.left,o.top=this.dividerDiv.style.top,o.width=this.dividerDiv.style.width,o.height=this.dividerDiv.style.height,o.opacity=this.splitPane.getDividerOpacity(),o.background=this.splitPane.getDividerBackground(),this.resizeDiv.lastPosition="horizontal"===this.splitPane._orientation?t.clientX:t.clientY,this.resizeDiv.maskDiv=je.createDiv(),o=this.resizeDiv.maskDiv.style,o.left="0px",o.top="0px",o.width=this.view.clientWidth+"px",o.height=this.view.clientHeight+"px",o.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv),je.handle_mousedown(this,t),t.preventDefault()}},handleMouseMove:function(t){if((!this.splitPane.isExpandable()||t.target!==this.splitPane._expandCvs1&&t.target!==this.splitPane._expandCvs2)&&this.splitPane.isDividerDraggable())if(this.resizeDiv||je.target)this.resizeDiv&&je.target===this&&("horizontal"===this.splitPane._orientation?this.resizeDiv.style.left=this.dividerDiv.position+t.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+t.clientY-this.resizeDiv.lastPosition+"px");else{var e="horizontal"===this.splitPane._orientation?"ew-resize":"ns-resize";this.view.style.cursor=t.target===this.dividerDiv||t.target===this.splitPane._coverDiv?e:"default"}},handleMouseUp:function(t){(!this.splitPane.isExpandable()||t.target!==this.splitPane._expandCvs1&&t.target!==this.splitPane._expandCvs2)&&this.splitPane.isDividerDraggable()&&0===t.button&&this.clear(t)},clear:function(t){if(this.resizeDiv){var e,i=this.splitPane._dividerWidth;if("horizontal"===this.splitPane._orientation){var n=this.view.clientWidth;i>n&&(i=n),e=this.dividerDiv.position+t.clientX-this.resizeDiv.lastPosition,this.splitPane.setPosition(e/(n-i))}else{var o=this.view.clientHeight;i>o&&(i=o),e=this.dividerDiv.position+t.clientY-this.resizeDiv.lastPosition,this.splitPane.setPosition(e/(o-i))}this.splitPane.lastDividerLocation=this.splitPane.getPosition(),this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),Me.controls.SplitPaneTouchInteraction=function(t){this.splitPane=t,this.view=t._view,this.dividerDiv=t._dividerDiv,je.addEventListener("touchstart","handleTouchstart",this.view,this)},Oe.ext("twaver.controls.SplitPaneTouchInteraction",Object,{handleTouchstart:function(t){if(je.preventDefault(t),this.splitPane.isExpandable()){var e,i,n=this.splitPane._dividerWidth;if(t.target===this.splitPane._expandCvs1)return void("horizontal"===this.splitPane._orientation?(e=this.view.clientWidth,n>e&&(n=e),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(i=this.view.clientHeight,n>i&&(n=i),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())));if(t.target===this.splitPane._expandCvs2)return void("horizontal"===this.splitPane._orientation?(e=this.view.clientWidth,n>e&&(n=e),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(i=this.view.clientHeight,n>i&&(n=i),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())))}if(this.resizeDiv)this.clear(t);else if(t.target===this.dividerDiv||t.target===this.splitPane._coverDiv){this.resizeDiv=je.createDiv();var o=this.resizeDiv.style;o.left=this.dividerDiv.style.left,o.top=this.dividerDiv.style.top,o.width=this.dividerDiv.style.width,o.height=this.dividerDiv.style.height,o.opacity=this.splitPane.getDividerOpacity(),o.background=this.splitPane.getDividerBackground();var s=t.changedTouches[0];this.resizeDiv.lastPosition="horizontal"===this.splitPane._orientation?s.clientX:s.clientY,this.resizeDiv.maskDiv=je.createDiv();var o=this.resizeDiv.maskDiv.style;o.left="0px",o.top="0px",o.width=this.view.clientWidth+"px",o.height=this.view.clientHeight+"px",o.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv)}je.addEventListener("touchmove","handleTouchmove",this.view,this),je.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(t){if(je.preventDefault(t),!this.splitPane.isExpandable()||t.target!==this.splitPane._expandCvs1&&t.target!==this.splitPane._expandCvs2)if(this.resizeDiv){var e=t.changedTouches[0];"horizontal"===this.splitPane._orientation?this.resizeDiv.style.left=this.dividerDiv.position+e.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+e.clientY-this.resizeDiv.lastPosition+"px"}else;},handleTouchend:function(t){(!this.splitPane.isExpandable()||t.target!==this.splitPane._expandCvs1&&t.target!==this.splitPane._expandCvs2)&&(je.removeEventListener("touchmove",this.view,this),je.removeEventListener("touchend",this.view,this),this.clear(t))},clear:function(t){var e=t.changedTouches[0];if(this.resizeDiv){var i=this.splitPane._dividerWidth;if("horizontal"===this.splitPane._orientation){var n=this.view.clientWidth;i>n&&(i=n);var o=this.dividerDiv.position+e.clientX-this.resizeDiv.lastPosition;this.splitPane.setPosition(o/(n-i))}else{var s=this.view.clientHeight;i>s&&(i=s);var o=this.dividerDiv.position+e.clientY-this.resizeDiv.lastPosition;this.splitPane.setPosition(o/(s-i))}this.splitPane.lastDividerLocation=this.splitPane.getPosition(),this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),Me.controls.TabPane=function(){Me.controls.TabPane.superClass.constructor.apply(this,arguments),this._tabBox=new Me.TabBox,this._tabBox.addDataBoxChangeListener(this.handleTabChange,this),this._tabBox.addDataPropertyChangeListener(this.handleTabChange,this),this._tabBox.addHierarchyChangeListener(this.handleTabChange,this),this._tabBox.getSelectionModel().addSelectionChangeListener(this.handleTabChange,this),this._view=je.createView("hidden",!0),this._tabDiv=je.createDiv(),this._tabDiv.onmousedown=je.preventDefault,this._tabDiv.onkeydown=je.preventDefault,this._contentDiv=je.createDiv(),this._view.appendChild(this._tabDiv),this._view.appendChild(this._contentDiv),this._divPool=new Me.Pool("div"),this._iconPool=new Me.Pool("img"),this._closePool=new Me.Pool("img"),this._textPool=new Me.Pool("span"),this._resizePool=new Me.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._closePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this.invalidateTab(),He.isTouchable&&new Me.controls.TabPaneTouchInteraction(this),new Me.controls.TabPaneInteraction(this)},Oe.ext("twaver.controls.TabPane",Me.controls.ControlBase,{__accessor:["tabGap","tabRadius","tabHeight","horizontalAlign","tabOrientation","resizeTolerance","tabBackground","selectBackground","moveBackground","insertBackground","closeIcon","disabledColor"],__bool:["selectNextOnClose","selectNextOnInVisible"],_tabGap:Rn.TABPANE_TAB_GAP,_tabRadius:Rn.TABPANE_TAB_RADIUS,_tabHeight:Rn.TABPANE_TAB_HEIGHT,_resizeTolerance:Rn.TABPANE_RESIZE_TOLERANCE,_tabOrientation:Rn.TABPANE_TAB_ORIENTATION,_tabBackground:Rn.TABPANE_TAB_BACKGROUND,_disabledColor:Rn.TABPANE_DISABLED_COLOR,_selectBackground:Rn.TABPANE_SELECT_BACKGROUND,_moveBackground:Rn.TABPANE_MOVE_BACKGROUND,_insertBackground:Rn.TABPANE_INSERT_BACKGROUND,_horizontalAlign:Rn.TABPANE_HORIZONTAL_ALIGN,_closeIcon:Rn.TABPANE_CLOSE_ICON,_selectNextOnClose:Rn.TABPANE_SELECT_NEXT_ON_CLOSE,_selectNextOnInVisible:Rn.TABPANE_SELECT_NEXT_ON_INVISIBLE,onPropertyChanged:function(t){this.invalidateTab()},getTabBox:function(){return this._tabBox},getTabDiv:function(){return this._tabDiv},getContentDiv:function(){return this._contentDiv},handleTabChange:function(t){if(this._selectNextOnInVisible&&"visible"===t.property&&!t.newValue&&this._tabBox.getSelectionModel().contains(t.source)){for(var e,i,n=t.source,o=this._tabBox.getRoots().indexOf(n),s=this._tabBox.getRoots(),a=s.size(),r=o;a-1>r;)if(e=s.get(++r),e.isVisible()&&!e.isDisabled()){i=e;break}if(!i)for(r=o;r>0;)if(e=s.get(--r),e.isVisible()&&!e.isDisabled()){i=e;break}this._tabBox.getSelectionModel().setSelection(i)}this.invalidateTab()},invalidateTab:function(t){this._invalidateTab||(this._invalidateTab=!0,this.invalidate(t))},validateImpl:function(){this._invalidateTab&&(this._invalidateTab=!1,this.validateTab());var t,e=this._view.offsetWidth,i=this._view.offsetHeight;"top"===this._tabOrientation?(this._tabDiv.style.top="0px",t={x:0,y:this._tabHeight,width:e,height:Math.max(0,i-this._tabHeight)}):(this._tabDiv.style.top=i-this._tabHeight+"px",t={x:0,y:0,width:e,height:Math.max(0,i-this._tabHeight)}),this._currentView&&Oe.setViewBounds(this._currentView,t)},getCurrentTab:function(){return this._currentTab},getCurrentView:function(){return this._currentView},onViewRemoved:function(t){},onViewAdded:function(t){},validateTab:function(){this._currentTab=this._tabBox.getSelectionModel().getLastData();var t=this._currentTab?this._currentTab.getView():null;if(t!==this._currentView){var e,i;this._currentView&&(e=this._currentView.getView?this._currentView.getView():this._currentView,e.style.visibility="hidden",this.onViewRemoved(this._currentView)),t&&(i=t.getView?t.getView():t,i.style.visibility="inherit",i.parentNode||this._contentDiv.appendChild(i),this.onViewAdded(t)),this._currentView=t}je.release(this._tabDiv);for(var n=this._tabBox.getRoots(),o=this._tabHeight+"px",s=this._tabHeight-2+"px",a=this._tabRadius+"px",r=n.size(),h=0,l=0;r>l;l++){var c=n.get(l);if(c.isVisible()){var d=this._currentTab===c,u=c.getWidth();0>u&&(u=0);var _=Math.min(this._tabGap,u),g=this._divPool.get();g._tab=c;var f=g.style;f.position="absolute",f.whiteSpace="nowrap",f.lineHeight=s,f.overflow="hidden",f.textOverflow="ellipsis",f.background=d?this._selectBackground:this._tabBackground,f.textAlign=this._horizontalAlign,"top"===this._tabOrientation?(f.borderTopLeftRadius=a,f.borderTopRightRadius=a,f.borderBottomLeftRadius="0px",f.borderBottomRightRadius="0px"):(f.borderTopLeftRadius="0px",f.borderTopRightRadius="0px",f.borderBottomLeftRadius=a,f.borderBottomRightRadius=a),f.left=h+"px",f.width=u-_+"px",f.height=o,g._x=h,g._width=u-_,this.renderTab(g,c),this.onTabRendered(g,c),this._tabDiv.insertBefore(g,this._tabDiv.firstChild),h+=u,c.isResizable()&&(g=this._resizePool.get(),g._resizeTab=c,f=g.style,f.position="absolute",f.backgroundColor="white",f.opacity=0,f.left=h-_-this._resizeTolerance+"px",f.width=_+2*this._resizeTolerance+"px",f.height=o,this._tabDiv.appendChild(g))}}this._tabDiv.style.left="0px",this._tabDiv.style.width=h+"px",this._tabDiv.style.height=this._tabHeight+"px",this._pools.forEach(function(t){t.clear()})},renderTab:function(t,e){if(e.renderTab)e.renderTab(t);else{var i=e.getIcon();if(i){var n=this._iconPool.get();n.setAttribute("src",Oe.getImageSrc(i)),n.style.paddingLeft="4px",n.style.verticalAlign="middle",t.appendChild(n)}var o=e.getName();if(o){var s=this._textPool.get();s.style.whiteSpace="nowrap",s.style.verticalAlign="middle",s.style.padding="2px 4px",s.innerHTML=o,t.appendChild(s)}if(He.isOpera){var a=t.cloneNode(!1);a.style.left="0px",a.style.top="0px",a.style.opacity=0,t.appendChild(a)}}if(e.isClosable()){var r=this._tabRadius/4+2,n=this._closePool.get();n._closeTab=e,n.setAttribute("src",Oe.getImageSrc(this._closeIcon)),n.style.position="absolute",n.style.top=r+"px",n.style.right=r+"px",t.appendChild(n)}t.style.color=e.isDisabled()?this.getDisabledColor():""},onTabRendered:function(t,e){}}),Me.controls.TabPaneInteraction=function(t){this.tabPane=t,this.view=t.getTabDiv();var e=this;this.view.addEventListener("mousedown",function(t){e.handleMouseDown(t)},!1),this.view.addEventListener("mousemove",function(t){e.handleMouseMove(t)},!1)},Oe.ext("twaver.controls.TabPaneInteraction",Object,{handleMouseDown:function(t){if(0===t.button){if(this.movableDiv)return void this.handleMouseUp(t);this.resizeTab=t.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(t)),this.changeCursor(t),this.lastX=this.getX(t),this._startClient=je.getClientPoint(t),this._startLogicalX=this.lastX,je.handle_mousedown(this,t)}},changeCursor:function(t){var e="";if(t.target._resizeTab)e="ew-resize";else{var i=this.getTabAt(t);!i||i.isDisabled()&&!i.isMovable()||(e="pointer")}this.view.style.cursor=e},handleMouseMove:function(t){if(null==this.lastX)return void this.changeCursor(t);if(je.target===this){var e=this._startLogicalX+t.clientX-this._startClient.x;if(this.resizeTab){if(null!=this.stopX){if(e<this.stopX)return;delete this.stopX}var i=this.resizeTab.getWidth()+(e-this.lastX);10>i&&(i=10,this.stopX=e),this.resizeTab.setWidth(i),this.lastX=e}else if(this.movableDiv){var n=e-this.lastX;if(!this.cloneDiv){if(Math.abs(n)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=je.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var o=this.cloneDiv._x+n;this.cloneDiv.style.left=o+"px",this.cloneDiv._x=o,this.lastX=e,this.tabInfo=this.getTabInfoAt(t),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}}},handleMouseUp:function(t){if(0===t.button){if(this.resizeTab);else if(this.movableDiv&&this.tabInfo){var e=this.movableDiv._tab,i=this.tabInfo.index;this.tabPane.getTabBox().moveTo(e,i)}else{var n=this.tabPane.getTabBox(),e=t.target._closeTab;if(e)if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===e){var o=n.getRoots(),i=o.indexOf(e);n.remove(e),o.size()>0&&(i>=o.size()&&(i=o.size()-1),n.getSelectionModel().setSelection(o.get(i)))}else n.remove(e);else{var e=this.getTabAt(t);e&&!e.isDisabled()&&n.getSelectionModel().setSelection(e)}}this.clear()}},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX,delete this._startLogicalX,delete this._startClient},getTabAt:function(t){t=t.target;for(var e;t&&t!==this.view&&!(e=t._tab);)t=t.parentNode;return e},getMovableDivAt:function(t){t=t.target;for(var e;t&&t!==this.view&&!(e=t._tab);)t=t.parentNode;return e&&e.isMovable()?t:null},getX:function(t){var e=je.getLogicalPoint(this.view,t);return e?e.x:null},getTabInfoAt:function(t){for(var e=this._startLogicalX+t.clientX-this._startClient.x,i=this.tabPane.getTabBox().getRoots(),n=i.size(),o=0,s=!1,a=0;n>a;a++){var r=i.get(a);if(r===this.movableDiv._tab&&(s=!0),r.isVisible()){var h=r.getWidth();if(0>=h)continue;if(e>=o&&o+h>=e){var l=o+h/2>e;!s||r===this.movableDiv._tab&&l||a--;var c=l?Math.max(0,a):Math.min(a+1,n),d=l?o:o+h;return d=Math.max(0,d-1),{index:c,tab:r,position:d+"px"}}o+=h}}return this.tabInfo}}),Me.controls.TabPaneTouchInteraction=function(t){this.tabPane=t,this.view=t.getTabDiv(),je.addEventListener("touchstart","handleTouchstart",this.view,this)},Oe.ext("twaver.controls.TabPaneTouchInteraction",Object,{handleTouchstart:function(t){return je.preventDefault(t),this.movableDiv?void this.handleTouchend(t):(this.resizeTab=t.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(t)),this.lastX=this.getX(t),je.addEventListener("touchmove","handleTouchmove",this.view,this),void je.addEventListener("touchend","handleTouchend",this.view,this))},handleTouchmove:function(t){if(null!=this.lastX)if(this.resizeTab){var e=this.getX(t);if(null!=this.stopX){if(e<this.stopX)return;delete this.stopX}var i=this.resizeTab.getWidth()+(e-this.lastX);0>i&&(i=0,this.stopX=e),this.resizeTab.setWidth(i),this.lastX=e}else if(this.movableDiv){var e=this.getX(t),n=e-this.lastX;if(!this.cloneDiv){if(Math.abs(n)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=je.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var o=this.cloneDiv._x+n;this.cloneDiv.style.left=o+"px",this.cloneDiv._x=o,this.lastX=e,this.tabInfo=this.getTabInfoAt(t),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}},handleTouchend:function(t){if(this.resizeTab);else if(this.movableDiv&&this.tabInfo){var e=this.movableDiv._tab,i=this.tabInfo.index;this.tabPane.getTabBox().moveTo(e,i)}else{var n=this.tabPane.getTabBox(),e=t.target._closeTab;if(e)if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===e){var o=n.getRoots(),i=o.indexOf(e);n.remove(e),o.size()>0&&(i>=o.size()&&(i=o.size()-1),n.getSelectionModel().setSelection(o.get(i)))}else n.remove(e);else{var e=this.getTabAt(t);e&&!e.isDisabled()&&n.getSelectionModel().setSelection(e)}}this.clear(),je.removeEventListener("touchmove",this.view,this),je.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX},getTabAt:function(t){t=t.target;for(var e;t&&t!==this.view&&!(e=t._tab);)t=t.parentNode;return e},getMovableDivAt:function(t){t=t.target;for(var e;t&&t!==this.view&&!(e=t._tab);)t=t.parentNode;return e&&e.isMovable()?t:null},getX:function(t){var e=je.getLogicalPoint(this.view,t);return e?e.x:null},getTabInfoAt:function(t){for(var e=this.getX(t),i=this.tabPane.getTabBox().getRoots(),n=i.size(),o=0,s=!1,a=0;n>a;a++){var r=i.get(a);if(r===this.movableDiv._tab&&(s=!0),r.isVisible()){var h=r.getWidth();if(0>=h)continue;if(e>=o&&o+h>=e){var l=o+h/2>e;!s||r===this.movableDiv._tab&&l||a--;var c=l?Math.max(0,a):Math.min(a+1,n),d=l?o:o+h;return d=Math.max(0,d-1),{index:c,tab:r,position:d+"px"}}o+=h}}return this.tabInfo}}),Me.controls.TitlePane=function(t,e,i){Me.controls.TitlePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._titleDiv=je.createDiv(),this._titleDiv.tabIndex=-1,this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.fontWeight="bold",this._titleDiv.style.textOverflow="ellipsis",this._titleDiv.style.overflow="hidden",this._titleDiv.style.whiteSpace="nowrap",this._titleDiv.onmousedown=je.preventDefault,this._span=Ve.createElement("span"),this._span.style.verticalAlign="middle",this._span.style.paddingLeft="4px",this._span.style.paddingRight="4px",this._img=Ve.createElement("img"),this._img.style.verticalAlign="middle",this._img.style.paddingLeft="4px",this._view=je.createView("hidden",!0),this._view.tabIndex=-1,this._view.appendChild(this._titleDiv),e&&this.setTitle(e),t&&this.setContent(t),i&&this.setIcon(i)},Oe.ext("twaver.controls.TitlePane",Me.controls.ControlBase,{__accessor:["icon","title","titleHeight","titleHorizontalAlign","titleBackground"],_titleHeight:Rn.TITLEPANE_TITLE_HEIGHT,_titleBackground:Rn.TITLEPANE_TITLE_BACKGROUND,_titleHorizontalAlign:Rn.TITLEPANE_TITLE_HORIZONTAL_ALIGN,onPropertyChanged:function(t){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getContent:function(){return this._content},setContent:function(t){if(this._content!==t){var e=this._content;e&&this._view.removeChild(e.getView?e.getView():e),this._content=t,t&&this._view.appendChild(t.getView?t.getView():t),this.firePropertyChange("content",e,t)}},validateImpl:function(){var t=this._view.offsetWidth,e=this._view.offsetHeight,i=this._titleDiv.style;i.textAlign=this._titleHorizontalAlign,i.lineHeight=this._titleHeight-2+"px",i.background=this._titleBackground,je.clear(this._titleDiv),this._icon&&(this._img.setAttribute("src",Oe.getImageSrc(this._icon)),this._titleDiv.appendChild(this._img)),this._title&&(this._span.innerHTML=this._title,this._span.setAttribute("title",this._title),this._titleDiv.appendChild(this._span));var i=this._titleDiv.style;i.left="0px",i.top="0px",i.width=t+"px",i.height=this._titleHeight+"px",Oe.setViewBounds(this._content,{x:0,y:this._titleHeight,width:t,height:Math.max(e-this._titleHeight,0)})}}),Me.controls.Accordion=function(){Me.controls.Accordion.superClass.constructor.apply(this,arguments),this._titleMap={},this._titleList=new fn,this._currentTitle=null,this._currentView=null,this._view=je.createView("hidden",!0),this.invalidate();var t=this;this._view.addEventListener("mousedown",function(e){t.handleMouseDown(e)},!1)},Oe.ext("twaver.controls.Accordion",Me.controls.ControlBase,{__accessor:["expandIcon","collapseIcon","titleHeight","titleBackground","borderBottomColor","iconPosition"],_expandIcon:Rn.ACCORDION_EXPAND_ICON,_collapseIcon:Rn.ACCORDION_COLLAPSE_ICON,_titleHeight:Rn.ACCORDION_TITLE_HEIGHT,_titleBackground:Rn.ACCORDION_TITLE_BACKGROUND,_borderBottomColor:Rn.ACCORDION_BORDER_BOTTOM_COLOR,_iconPosition:Rn.ACCORDION_ICON_POSITION,onPropertyChanged:function(t){this.invalidate()},handleMouseDown:function(t){if(0===t.button){var e=t.target._title;e||(e=t.target.parentNode._title),e&&(this._currentTitle===e?this.collapse():this.expand(e))}},getTitles:function(){return this._titleList},getCurrentTitle:function(){return this._currentTitle},add:function(t,e){if(this._titleMap[t])throw"Title ' + title + ' already exists";var i=je.createDiv();i._title=t,i.onmousedown=je.preventDefault,i.style.cursor="pointer",i.style.textAlign="left",i.style.textOverflow="ellipsis",i.style.whiteSpace="nowrap",i.style.overflow="hidden",i.style.borderBottomWidth="1px",i.style.borderBottomStyle="solid";var n=Ve.createElement("img");n.style.verticalAlign="middle",n.style.paddingLeft="4px";var o=Ve.createElement("span");if(o.style.verticalAlign="middle",o.style.paddingLeft="4px",o.innerHTML=t,o.setAttribute("title",t),this._view.appendChild(i),i.appendChild(n),i.appendChild(o),"right"==this._iconPosition){var s=n.style,a=(this._titleHeight-8)/2;s.marginTop=a+"px",s.right="15px",s.position="absolute"}this._titleMap[t]={content:e,titleDiv:i,span:o,img:n},this._titleList.add(t),this.invalidate()},remove:function(t){var e=this._titleMap[t];e&&this._view.removeChild(e.titleDiv),delete this._titleMap[t],this._titleList.remove(t),this.invalidate()},clear:function(){var t=this;Object.keys(t._titleMap).forEach(function(e){t._view.removeChild(t._titleMap[e].titleDiv)}),t._titleMap={},t._titleList.clear(),t.invalidate()},expand:function(t){this._titleMap[t]&&this._currentTitle!==t&&(this._currentTitle=t,this.onExpanded(t),this.invalidate())},onExpanded:function(t){},collapse:function(){this._currentTitle&&(this.onCollapsed(this._currentTitle),this._currentTitle=null,this.invalidate())},onCollapsed:function(t){},validateImpl:function(){var t=this._currentView;this._currentView=null;for(var e=this._view.offsetWidth,i=this._view.offsetHeight,n=this._titleList.size(),o=0,s=0;n>s;s++){var a=this._titleList.get(s),r=this._titleMap[a],h=r.titleDiv.style;h.lineHeight=this._titleHeight-3+"px",h.background=this._titleBackground,h.borderBottomColor=this._borderBottomColor,h.left="0px",h.top=o+"px",h.width=e+"px",h.height=this._titleHeight-1+"px";var l=this._currentTitle===a,c=l?this._expandIcon:this._collapseIcon;if(r.img.setAttribute("src",Oe.getImageSrc(c)),l){var d=Math.max(0,i-n*this._titleHeight);r.content&&(this._currentView=r.content.getView?r.content.getView():r.content,Oe.setViewBounds(r.content,{x:0,y:o+this._titleHeight,width:e,height:d}),r.content.style.overflowY="auto"),o+=this._titleHeight+d}else o+=this._titleHeight}this._currentView&&this._currentView!==t&&this._view.appendChild(this._currentView),t&&t!==this._currentView&&this._view.removeChild(t)}}),Me.controls.BorderPane=function(t,e,i,n,o){Me.controls.BorderPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._view=je.createView("hidden",!0),this._view.tabIndex=-1,t&&this.setCenter(t),e&&this.setTop(e),i&&this.setRight(i),n&&this.setBottom(n),o&&this.setLeft(o)},Oe.ext("twaver.controls.BorderPane",Me.controls.ControlBase,{__accessor:["hGap","vGap","topHeight","bottomHeight","leftWidth","rightWidth"],_hGap:Rn.BORDERPANE_HGAP,_vGap:Rn.BORDERPANE_VGAP,_topHeight:0,_bottomHeight:0,_leftWidth:0,_rightWidth:0,onPropertyChanged:function(t){this.invalidate()},getCenter:function(){return this._center},setCenter:function(t){this._setContent("center",t)},getTop:function(){return this._top},setTop:function(t){this._setContent("top",t)},getRight:function(){return this._right},setRight:function(t){this._setContent("right",t)},getBottom:function(){return this._bottom},setBottom:function(t){this._setContent("bottom",t)},getLeft:function(){return this._left},setLeft:function(t){this._setContent("left",t)},_setContent:function(t,e){var i=this["_"+t];if(i!==e){if(i){var n=i.getView?i.getView():i;this._view.contains(n)&&this._view.removeChild(n)}this["_"+t]=e,e&&this._view.appendChild(e.getView?e.getView():e),this.firePropertyChange(t,i,e)}},validateImpl:function(){var t=this._view.offsetWidth,e=this._view.offsetHeight,i=0,n=0,o=t,s=e,a=0,r=0,h=0,l=0;this._top&&(a=this._topHeight||(this._top.getView?this._top.getView().offsetHeight:this._top.offsetHeight),n=a+this._vGap),this._bottom&&(r=this._bottomHeight||(this._bottom.getView?this._bottom.getView().offsetHeight:this._bottom.offsetHeight),s=e-r-this._vGap),this._left&&(h=this._leftWidth||(this._left.getView?this._left.getView().offsetWidth:this._left.offsetWidth),i=h+this._hGap),this._right&&(l=this._rightWidth||(this._right.getView?this._right.getView().offsetWidth:this._right.offsetWidth),o=t-l-this._hGap);var c=Math.max(0,o-i),d=Math.max(0,s-n);this._top&&Oe.setViewBounds(this._top,{x:0,y:0,width:t,height:a}),this._bottom&&Oe.setViewBounds(this._bottom,{x:0,y:s,width:t,height:r}),this._left&&Oe.setViewBounds(this._left,{x:0,y:n,width:h,height:d}),this._right&&Oe.setViewBounds(this._right,{x:o,y:n,width:l,height:d}),this._center&&Oe.setViewBounds(this._center,{x:i,y:n,width:c,height:d})}}),Me.controls.PopupMenu=function(t){this._view=je.createDiv(),this._view.style.zIndex=100001,this._items=[],this._itemsMap={},this.setContextView(t);var e=this._view,i=this;e.addEventListener("mouseover",function(t){i._mouseOver=!0},!1),e.addEventListener("mouseout",function(t){i._mouseOver=!1},!1),e.oncontextmenu=function(t){t.preventDefault()},je.addEventListener("mousedown","_handleClick",e,this)},Oe.ext("twaver.controls.PopupMenu",Object,{_width:200,_xOffset:0,_yOffset:0,_menuItemHeight:25,_background:"#F9F9F9",_border:"2px outset white",_disabledColor:"#BABBBC",_focusColor:"white",_focusBackground:"#C2CFF1",_color:"black",_subMenuEnableIcon:Rn.POPUPMENU_SUBNENU_ENABLE_ICON,_subMenuDisableIcon:Rn.POPUPMENU_SUBNENU_DISABLE_ICON,_checkboxSelectedIcon:Rn.POPUPMENU_CHECKBOX_SELECTED_ICON,_checkboxUnselectedIcon:Rn.POPUPMENU_CHECKBOX_UNSELECTED_ICON,_radiobuttonSelectedIcon:Rn.POPUPMENU_RADIOBUTTON_SELECTED_ICON,_radiobuttonUnselectedIcon:Rn.POPUPMENU_RADIOBUTTON_UNSELECTED_ICON,getView:function(){return this._view},getContextView:function(){return this._contextView},setContextView:function(t){if(this._removeContextmenuListener(),this._contextView=t,t){var e=t.getView?t.getView():t;He.isTouchable?(e.addEventListener("touchstart",this._getTouchStartListener(),!1),e.addEventListener("touchmove",this._getTouchMoveListener(),!1),e.addEventListener("touchend",this._getTouchEndListener(),!1),je.addEventListener("contextmenu","_handleContextmenu",e,this)):je.addEventListener("contextmenu","_handleContextmenu",e,this)}},getMenuItems:function(){return this._items},setMenuItems:function(t){if(this._items=[],this._itemsMap={},t)for(var e=0,i=t.length;i>e;e++)this.addMenuItem(t[e])},addMenuItem:function(t){t.separator!==!0&&(this._itemsMap[t.id||t.label]=t),this._items.push(t)},getMenuItem:function(t){return this._itemsMap[t]},addSeparator:function(){this.addMenuItem({separator:!0})},getMenuItemById:function(t){return this._itemsMap[t]},isVisible:function(t){return t.visible!==!1},isEnabled:function(t){return t.enabled!==!1},show:function(t){this.hide();var e,i,n=this._view,o=this._view.style;if(He.isTouchable?(e=t.changedTouches&&t.changedTouches[0].clientX||t.clientX,i=t.changedTouches&&t.changedTouches[0].clientY||t.clientY):(e=t.clientX,i=t.clientY),je.clear(n),this.renderMenu(n,this._items),0!==this._height){He.isTouchable&&je.addEventListener("touchstart","_handleBodyClicked",Ve.body,this),je.addEventListener("mousedown","_handleBodyClicked",Ve.body,this);var s=je.windowWidth()-this._width-10,a=je.windowHeight()-this._height-10;e=e>s?s:e,i=i>a?a:i,e=0>e?0:e,i=0>i?0:i,o.left=e+bi.scrollLeft()+this._xOffset+"px",o.top=i+bi.scrollTop()+this._yOffset+"px",Ve.body.appendChild(n)}},_showMenuItem:function(t,e){this._hideMenuItem(e);var i=Ve.createElement("div");e.menuItem.childrenDiv=i;var n=i.style;n.color="#000000",n.position="absolute";var o=this._width,s=e.offsetTop,a=e.menuItem.items;if(this._itemsShow=!0,e._itemsShow=!0,je.clear(i),this.renderMenu(i,a),0!==this._height){var r=je.windowWidth()-this._width-10,h=je.windowHeight()-10,l=this._getPosition(this._view);o=l.left+this._width>r?-this._width:o,s=l.top+s+a.length*this._menuItemHeight>h?s-(a.length-1)*this._menuItemHeight:s,n.left=o+"px",n.top=s+"px",e.appendChild(i)}},hide:function(){Ve.body.contains(this._view)&&Ve.body.removeChild(this._view),delete this._mouseOver,delete this._itemsShow,He.isTouchable&&je.removeEventListener("touchstart",Ve.body,this),je.removeEventListener("mousedown",Ve.body,this)},_hideMenuItem:function(t){var e=t.menuItem.childrenDiv;e&&t.contains(e)&&t.removeChild(e),this._itemsShow=!1,t._itemsShow=!1},dispose:function(){this._removeContextmenuListener(),this.hide()},onMenuShowing:function(t){return!0},onAction:function(t){},renderMenu:function(t,e){var i=t.style;i.background=this._background,i.border=this._border,i.width=this._width+"px",this._height=0,delete this._separator,t.menuItems=e;for(var n,o=0,s=e.length;s>o;o++)if(n=e[o],this.isVisible(n))if(n.separator===!0)this._separator=!0;else{var a=Ve.createElement("div");this.isEnabled(n)&&this._addMouseoverListener(a,n),a._itemsShow=!1,a.menuItem=n,t.appendChild(a),this.renderMenuItem(a,n),this.onMenuItemRendered(a,n),this._separator=!1,this._height+=this._menuItemHeight}},renderMenuItem:function(t,e){var i=t.style;i.height=this._menuItemHeight+"px",this._separator&&(i.borderTop="1px solid gray"),this.isEnabled(e)||(i.color=this._disabledColor);var n=Ve.createElement("span");i=n.style,i.position="absolute",i.width="25px",i.height=this._menuItemHeight+"px",i.lineHeight=this._menuItemHeight+"px",i.textAlign="center",t.appendChild(n);var o;if("check"===e.type?o=e.selected?this._checkboxSelectedIcon:this._checkboxUnselectedIcon:"radio"===e.type?o=e.selected?this._radiobuttonSelectedIcon:this._radiobuttonUnselectedIcon:e.icon&&(o=e.icon),o){var s=new Ue;s.src=Oe.getImageSrc(o),s.style.verticalAlign="middle",n.appendChild(s)}var a=Ve.createElement("label");if(Oe.setText(a,e.label,!0),i=a.style,i.position="absolute",i.height=this._menuItemHeight+"px",i.lineHeight=this._menuItemHeight+"px",i.left="25px",t.appendChild(a),e.items&&t.parentNode){var r=Ve.createElement("img");i=r.style,this.isEnabled(e)?r.setAttribute("src",Oe.getImageSrc(this._subMenuEnableIcon)):r.setAttribute("src",Oe.getImageSrc(this._subMenuDisableIcon));var h=(this._menuItemHeight-8)/2;i.marginTop=h+"px",i.right="5px",i.position="absolute",t.appendChild(r)}},onMenuItemRendered:function(t,e){},_addMouseoverListener:function(t,e){{var i=this;this._contextView}He.isTouchable&&(t.addEventListener("touchstart",function(n){t.style.background=i._focusBackground,t.style.color=i._focusColor,this===n.relatedTarget||this.contains(n.relatedTarget)||e.items&&!i._itemsShow&&t.parentNode==i._view&&i._showMenuItem(n,t)},!1),t.addEventListener("touchend",function(n){if(t.style.background=i._background,t.style.color=i._color,this!==n.relatedTarget&&!this.contains(n.relatedTarget)&&e.items&&t.parentNode===i._view){var o=n.clientX,s=n.clientY,a=e.childrenDiv,r=i._getPosition(a);(o<r.left+2||o>r.left+a.offsetWidth-2||s<r.top+2||s>r.top+a.offsetHeight-2)&&i._hideMenuItem(t)}},!1)),t.addEventListener("mouseenter",function(n){t.style.background=i._focusBackground,t.style.color=i._focusColor,this===n.relatedTarget||this.contains(n.relatedTarget)||e.items&&!this._itemsShow&&this.parentNode&&i._showMenuItem(n,this)},!1),t.addEventListener("mouseleave",function(t){if(this.style.background=i._background,this.style.color=i._color,this!==t.relatedTarget&&!this.contains(t.relatedTarget)&&e.items&&this.parentNode){var n=t.clientX,o=t.clientY,s=e.childrenDiv,a=i._getPosition(s);(n<a.left+2||n>a.left+s.offsetWidth-2||o<a.top+2||o>a.top+s.offsetHeight-2)&&i._hideMenuItem(this)}},!1)},_getPosition:function(t){for(var e=0,i=0;t;)i+=t.offsetLeft,e+=t.offsetTop,t=t.offsetParent;return{left:i,top:e}},_removeContextmenuListener:function(){var t=this._contextView;t&&(t=t.getView?t.getView():t,He.isTouchable?(t.removeEventListener("touchstart",this._getTouchStartListener(),!1),t.removeEventListener("touchmove",this._getTouchMoveListener(),!1),t.removeEventListener("touchend",this._getTouchEndListener(),!1),je.removeEventListener("contextmenu",t,this)):je.removeEventListener("contextmenu",t,this))},_handleContextmenu:function(t){this.onMenuShowing(t)===!0&&this.show(t),t.preventDefault()},_handleBodyClicked:function(t){if(He.isTouchable){for(var e=t.target;e&&e!==this._view;)e=e.parentElement;e!==this._view&&this.hide()}else this._mouseOver||this.hide()},_handleClick:function(t){if(0===t.button){for(var e=t.target;!e.menuItem&&e.parentElement;)e=e.parentElement;var i=e?e.menuItem:null;i&&this.isEnabled(i)&&("check"===i.type&&(i.selected=!i.selected),"radio"===i.type&&(i.groupName?(i.selected=!0,this._items.forEach(function(t){i!==t&&t.groupName===i.groupName&&(t.selected=!1),t.items&&t.items.forEach(function(t){i!==t&&t.groupName===i.groupName&&(t.selected=!1)})})):i.selected=!i.selected),i.action&&i.action(i),this.onAction(i),i.items&&i.items.length>0||this.hide())}},_getTouchStartListener:function(){if(!this._touchStartListener){var t=this;this._touchStartListener=function(e){t._touchMoved=!1,t._lastTouch=new Date}}return this._touchStartListener},_getTouchMoveListener:function(){if(!this._touchMoveListener){var t=this;this._touchMoveListener=function(e){t._touchMoved=!0}}return this._touchMoveListener},_getTouchEndListener:function(){if(!this._touchEndListener){var t=this;this._touchEndListener=function(e){!t._touchMoved&&(new Date).getTime()-t._lastTouch.getTime()>1e3&&t._handleContextmenu(e)}}return this._touchEndListener},getWidth:function(){return this._width},setWidth:function(t){this._width=t},getMenuItemHeight:function(){return this._menuItemHeight},setMenuItemHeight:function(t){this._menuItemHeight=t},getBackground:function(){return this._background},setBackground:function(t){this._background=t},getBorder:function(){return this._border},setBorder:function(t){this._border=t},getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(t){this._disabledColor=t},getFocusColor:function(){return this._focusColor},setFocusColor:function(t){this._focusColor=t},getFocusBackground:function(){return this._focusBackground},setFocusBackground:function(t){this._focusBackground=t},getColor:function(){return this._color},setColor:function(t){this._color=t},getSubMenuEnableIcon:function(){return this._subMenuEnableIcon},setSubMenuEnableIcon:function(t){this._subMenuEnableIcon=t},getSubMenuDisableIcon:function(){return this._subMenuDisableIcon},setSubMenuDisableIcon:function(t){this._subMenuDisableIcon=t},getCheckboxSelectedIcon:function(){return this._checkboxSelectedIcon},setCheckboxSelectedIcon:function(t){this._checkboxSelectedIcon=t},getCheckboxUnselectedIcon:function(){return this._checkboxUnselectedIcon},setCheckboxUnselectedIcon:function(t){this._checkboxUnselectedIcon=t},getRadiobuttonSelectedIcon:function(){return this._radiobuttonSelectedIcon},setRadiobuttonSelectedIcon:function(t){this._radiobuttonSelectedIcon=t},getRadiobuttonUnselectedIcon:function(){return this._radiobuttonUnselectedIcon},setRadiobuttonUnselectedIcon:function(t){this._radiobuttonUnselectedIcon=t},getXOffset:function(){return this._xOffset},setXOffset:function(t){this._xOffset=t},getYOffset:function(){return this._yOffset},setYOffset:function(t){this._yOffset=t}}),Me.charts.IS_INVALIDATE_PROPERTY={xZoom:1,xTranslate:1,yZoom:1,yTranslate:1},Me.charts.ChartBase=function(t){Me.charts.ChartBase.superClass.constructor.apply(this,arguments),this._uniqueColors={},this._nonDataColors={},this._publishedDatas=new fn,this._view=je.createView("hidden"),this._canvas=je.createCanvas(),this._view.appendChild(this._canvas),this.setDataBox(t?t:new Me.ElementBox),this.invalidate(),He.isTouchable?He.isMSTouchable?new Me.charts.ChartMSTouchInteraction(this):(new Me.charts.ChartTouchInteraction(this),new Me.charts.ChartInteraction(this)):new Me.charts.ChartInteraction(this),this.setToolTipEnabled(Rn.CHART_TOOLTIP_ENABLED)},Oe.ext("twaver.charts.ChartBase",Me.controls.ViewBase,{__accessor:["xGap","yGap","xTranslate","yTranslate","valueVisible","sortFunction","visibleFunction","xTranslateEnabled","yTranslateEnabled","xZoomEnabled","yZoomEnabled","selectTolerance","backgroundVisible","backgroundFill","backgroundFillColor","backgroundOutlineWidth","backgroundOutlineColor","backgroundGradient","backgroundGradientColor","outerZoom"],__bool:["doubleClickToReset","focusOnClick"],_backgroundVisible:Rn.CHART_BACKGROUND_VISIBLE,_backgroundFill:Rn.CHART_BACKGROUND_FILL,_backgroundFillColor:Rn.CHART_BACKGROUND_FILL_COLOR,_backgroundOutlineWidth:Rn.CHART_BACKGROUND_OUTLINE_WIDTH,_backgroundOutlineColor:Rn.CHART_BACKGROUND_OUTLINE_COLOR,_backgroundGradient:Rn.CHART_BACKGROUND_GRADIENT,_backgroundGradientColor:Rn.CHART_BACKGROUND_GRADIENT_COLOR,_selectTolerance:Rn.CHART_SELECT_TOLERANCE,_doubleClickToReset:Rn.CHART_DOUBLE_CLICK_TO_RESET,_focusOnClick:Rn.FOCUS_ON_CLICK,_sortFunction:null,_visibleFunction:null,_canvasWidth:0,_canvasHeight:0,_outerZoomL:1,_xGap:Rn.CHART_XGAP,_yGap:Rn.CHART_YGAP,_xTranslate:0,_yTranslate:0,_xTranslateEnabled:Rn.CHART_XTRANSLATE_ENABLED,_yTranslateEnabled:Rn.CHART_YTRANSLATE_ENABLED,_xZoom:1,_yZoom:1,_maxZoom:Rn.ZOOM_MAX,_minZoom:Rn.ZOOM_MIN,_xZoomEnabled:Rn.CHART_XZOOM_ENABLED,_yZoomEnabled:Rn.CHART_YZOOM_ENABLED,_valueVisible:Rn.CHART_VALUE_VISIBLE,_valueFont:Rn.CHART_VALUE_FONT,isToolTipEnabled:function(){return this._toolTipListener?!0:!1},setToolTipEnabled:function(t){if(t){if(!this._toolTipListener){var e=this;this._toolTipListener=function(t){Si.showToolTip(t,e.getToolTip(t))},this._canvas.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Si.hideToolTip(),this._canvas.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},getToolTip:function(t){if(this._toolTipInfos){var e=this.getLogicalPoint(t);e.x-=this._xTranslate,e.y-=this._yTranslate;for(var i=this._toolTipInfos.size(),n=i-1;n>=0;n--){var o=this._toolTipInfos.get(n);if(o.rect&&Ze.containsPoint(o.rect,e))return this.getToolTipByData(o.data,o)}}else{var s=this.tryGetDataAt(t);if(s)return this.getToolTipByData(s,{value:this.getValue(s)})}return null},getToolTipByData:function(t,i){return i.value!==e?this.formatValueText(i.value,t):null},addToolTipInfo:function(t,e,i,n,o,s,a){this._toolTipInfos&&this._toolTipInfos.add({data:s,rect:{x:t,y:e,width:i,height:n},value:o,index:a})},getLogicalPoint:function(t){return je.getLogicalPoint(this._canvas,t,this._outerZoom)},getTextSize:function(t,e){var i=Ke.getTextSize(t,e);return i.width&&(i.width+=4),i},getUniqueColor:function(t,i){if(null==t)return null;var n;if(!i&&(n=this._nonDataColors[t]))return n;var o=Ke.getColorArray(t);if(!i)return n=255!=o[3]?t:"rgba("+o[0]+","+o[1]+","+o[2]+",0.99)",this._nonDataColors[t]=n,n;var s="rgb("+o[0]+","+o[1]+","+o[2]+")";if(this._uniqueColors[s]===e||this._uniqueColors[s]===i);else{var a=1,r=-1,h=1;for(He.isOpera&&(o=[o[0],o[1],o[2]]);;){if(o[0]+=a,o[0]>=255?(o[0]=255,a=-1):o[0]<=0&&(o[0]=0,a=1),s="rgb("+o[0]+","+o[1]+","+o[2]+")",this._uniqueColors[s]===e||this._uniqueColors[s]===i)break;if(o[1]+=r,o[1]>=255?(o[1]=255,r=-1):o[1]<=0&&(o[1]=0,r=1),s="rgb("+o[0]+","+o[1]+","+o[2]+")",this._uniqueColors[s]===e||this._uniqueColors[s]===i)break;if(o[2]+=h,o[2]>=255?(o[2]=255,h=-1):o[2]<=0&&(o[2]=0,h=1),s="rgb("+o[0]+","+o[1]+","+o[2]+")",this._uniqueColors[s]===e||this._uniqueColors[s]===i)break}}return this._uniqueColors[s]=i,s},tryGetDataAt:function(t,e){if((null==e||0>e)&&(e=this._selectTolerance),t.target&&(t=je.getLogicalPoint(this._canvas,arguments[0],this._outerZoom)),!t)return null;var i=t.x-e,n=t.y-e,o=2*e+1,s=2*e+1;try{for(var a=this._canvas.getContext("2d").getImageData(i,n,o,s).data,r=0,h=a.length;h>r;r+=4)if(255===a[r+3]){var l="rgb("+a[r]+","+a[r+1]+","+a[r+2]+")",c=this._uniqueColors[l];if(c)return c}}catch(t){}return null},_getPoint:function(){var t,e;if(2===arguments.length)t=arguments[0],e=arguments[1];else if(arguments[0].target){var i=je.getLogicalPoint(this._canvas,arguments[0],this._outerZoom);if(!i)return null;t=i.x,e=i.y}else t=arguments[0].x,e=arguments[0].y;return{x:t,y:e}},getDataAt:function(){var t=this._getPoint.apply(this,arguments),e=t.x,i=t.y;if(0>e||0>i||e>this._canvasWidth||i>this._canvasHeight)return null;try{var n=this._canvas.getContext("2d").getImageData(e,i,1,1).data;if(255===n[3]){var o="rgb("+n[0]+","+n[1]+","+n[2]+")",s=this._uniqueColors[o];if(s)return s}}catch(t){}return null},getBackgroundRect:function(){return this._backgroundRect},drawBackground:function(t,e){this._backgroundRect=Oe.clone(e),null!=e&&e.width>0&&e.height>0&&this._backgroundVisible&&(this._backgroundFill&&Ke.fill(t,this.getUniqueColor(this._backgroundFillColor),this._backgroundGradient,this.getUniqueColor(this._backgroundGradientColor),e),this._backgroundOutlineWidth>0&&(t.lineWidth=this._backgroundOutlineWidth,t.strokeStyle=this._backgroundOutlineColor),t.beginPath(),t.rect(e.x,e.y,e.width,e.height),t.closePath(),this._backgroundFill&&t.fill(),this._backgroundOutlineWidth>0&&t.stroke())},getName:function(t){return t.getName()},getColor:function(t){return t.getStyle?t.getStyle("chart.color"):t.getClient("chart.color")},getValue:function(t){return t.getStyle?t.getStyle("chart.value"):0},getValueColor:function(t){return t.getStyle?t.getStyle("chart.value.color"):Me.Styles.getStyle("chart.value.color")},setValueFont:function(t){if(t!==this._valueFont){var e=t;this._valueFont=t,this.firePropertyChange("valueFont",e,t)}},getValueFont:function(t){if(t){var e=t.getStyle?t.getStyle("chart.value.font"):Me.Styles.getStyle("chart.value.font");if(e)return e}return this._valueFont},formatValueText:function(t,e){return t},getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this.canvasHeight},getCanvas:function(){return this._canvas},isVisible:function(t){return this._internalVisibleFunction&&!this._internalVisibleFunction(t)?!1:this._visibleFunction?this._visibleFunction(t):!0},onPropertyChanged:function(t){Me.charts.IS_INVALIDATE_PROPERTY[t.property]?this.invalidate():this.invalidateModel()},getDataBox:function(){return this._box},setDataBox:function(t){if(!t)throw"DataBox can not be null";if(this._box!==t){var e=this._box;e&&(e.removeDataBoxChangeListener(this.handleDataBoxChange,this),e.removeDataPropertyChangeListener(this.handlePropertyChange,this),e.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=t,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(t):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",e,this._box)}},handleDataBoxChange:function(t){this.invalidateModel()},handlePropertyChange:function(t){this.invalidateModel()},handleHierarchyChange:function(t){this.invalidateModel()},handleSelectionChange:function(t){this.invalidateModel()},getUnfilteredDatas:function(){return this._unfilteredDatas?this._unfilteredDatas:this._publishedDatas},getPublishedDatas:function(){return this._publishedDatas},createPublishedDatas:function(){return this._unfilteredDatas=new fn,this._buildChildren(this._box.getRoots(),this._unfilteredDatas),this._sortFunction&&this._unfilteredDatas.sort(this._sortFunction),this._unfilteredDatas.toList(this.isVisible,this)},_buildChildren:function(t,e){t.forEach(function(t){e.add(t),this._buildChildren(t.getChildren(),e)},this)},invalidateModel:function(){this._invalidateModel||(this._invalidateModel=!0,this.invalidate())},validateImpl:function(){this._invalidateModel&&(this._invalidateModel=!1,this._uniqueColors={},this._nonDataColors={},this._publishedDatas=this.createPublishedDatas(),this._publishedDatas.forEach(function(t){t.IStyle?t.getStyle("chart.color")||t.setStyle("chart.color",Oe.nextColor()):t.getClient("chart.color")||t.setClient("chart.color",Oe.nextColor())}),this.validateModel());var t=this._canvas.getContext("2d");this._canvasWidth=this._view.clientWidth,this._canvasHeight=this._view.clientHeight,this._canvas.setAttribute("width",this._canvasWidth),this._canvas.setAttribute("height",this._canvasHeight),t.clearRect(0,0,this._canvasWidth,this._canvasHeight),Me.Util.makeHighRes(this._canvas),this._canvasWidth>0&&this._canvasHeight>0&&(t.translate(this._xTranslate,this._yTranslate),this._valueTexts=this._valueVisible?new fn:null,this.validateDisplay(t,this._canvasWidth*this._xZoom,this._canvasHeight*this._yZoom),delete this._valueTexts,t.translate(-this._xTranslate,-this._yTranslate))},adjustBounds:function(t){Me.charts.ChartBase.superClass.adjustBounds.apply(this,arguments)},validateModel:function(){},validateDisplay:function(t,e,i){},drawLine:function(t,e,i,n,o,s,a){i>0&&(t.lineWidth=i,t.strokeStyle=this.getUniqueColor(e),t.beginPath(),t.moveTo(n,o),t.lineTo(s,a),t.stroke())},drawValueTexts:function(t){this._valueTexts&&this._valueTexts.forEach(function(e){Ke.drawText(t,e.text,e,e.font,e.color)})},drawVerticalText:function(t,e,i,n,o){o=this.getUniqueColor(o),t.translate(i.x,i.y),t.rotate(-Math.PI/2),Ke.drawText(t,e,null,n,o),t.rotate(Math.PI/2),t.translate(-i.x,-i.y)},_getValueTextInfo:function(t,e){if(this._valueTexts){var i=this.formatValueText(e,t);if(i&&""!==i){var n=this.getValueColor(t),o={text:i,font:this.getValueFont(t),color:this.getUniqueColor(n,t)};return this._valueTexts.add(o),o}}return null},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(t){if(!(0>t)){var e=this._maxZoom;this._maxZoom=t,this.firePropertyChange("maxZoom",e,t),this.getXZoom()>t&&this.setXZoom(t,!1),this.getYZoom()>t&&this.setYZoom(t,!1)}},getMinZoom:function(){return this._minZoom},setMinZoom:function(t){if(!(0>t)){var e=this._minZoom;this._minZoom=t,this.firePropertyChange("minZoom",e,t),this.getXZoom()<t&&this.setXZoom(t),this.getYZoom()<t&&this.setYZoom(t)}},zoomIn:function(t){null==t&&(t=Rn.ZOOM_ANIMATE),t?Me.animate.AnimateManager.start(new Me.animate.AnimateXYZoom(this,this._xZoom*Rn.ZOOM_INCREMENT,this._yZoom*Rn.ZOOM_INCREMENT)):(this.xZoomIn(!1),this.yZoomIn(!1))},zoomOut:function(t){null==t&&(t=Rn.ZOOM_ANIMATE),t?Me.animate.AnimateManager.start(new Me.animate.AnimateXYZoom(this,this._xZoom/Rn.ZOOM_INCREMENT,this._yZoom/Rn.ZOOM_INCREMENT)):(this.xZoomOut(!1),this.yZoomOut(!1))},zoomReset:function(t){null==t&&(t=Rn.ZOOM_ANIMATE),t?Me.animate.AnimateManager.start(new Me.animate.AnimateXYZoom(this,1,1)):(this.xZoomReset(!1),this.yZoomReset(!1))},getXZoom:function(){return this._xZoom},onXZoomChanged:function(t,e){},xZoomIn:function(t){this.setXZoom(this._xZoom*Rn.ZOOM_INCREMENT,t)},xZoomOut:function(t){this.setXZoom(this._xZoom/Rn.ZOOM_INCREMENT,t)},xZoomReset:function(t){this.setXZoom(1,t)},setXZoom:function(t,e){if(Oe.num(t)&&!(0>=t)&&(t<this._minZoom&&(t=this._minZoom),t>this._maxZoom&&(t=this._maxZoom),t!==this.xZoom))if(null==e&&(e=Rn.ZOOM_ANIMATE),e)Me.animate.AnimateManager.start(new Me.animate.AnimateXZoom(this,t));else{var i=this._xZoom,n=this._xTranslate-(this._canvasWidth/2-this._xTranslate)/i*(t-i);this._xZoom=t,this.firePropertyChange("xZoom",i,t),this.onXZoomChanged(i,t),this.setXTranslate(n)}},getYZoom:function(){return this._yZoom},onYZoomChanged:function(t,e){},yZoomIn:function(t){this.setYZoom(this._yZoom*Rn.ZOOM_INCREMENT,t)},yZoomOut:function(t){this.setYZoom(this._yZoom/Rn.ZOOM_INCREMENT,t)},yZoomReset:function(t){this.setYZoom(1,t)},setYZoom:function(t,e){if(Oe.num(t)&&!(0>=t)&&(t<this._minZoom&&(t=this._minZoom),t>this._maxZoom&&(t=this._maxZoom),t!==this.YZoom))if(null==e&&(e=Rn.ZOOM_ANIMATE),e)Me.animate.AnimateManager.start(new Me.animate.AnimateYZoom(this,t));else{var i=this._yZoom,n=this._yTranslate-(this._canvasHeight/2-this._yTranslate)/i*(t-i);this._yZoom=t,this.firePropertyChange("yZoom",i,t),this.onYZoomChanged(i,t),this.setYTranslate(n)}}}),Me.charts.ScaleChart=function(t){Me.charts.ScaleChart.superClass.constructor.apply(this,arguments)},Oe.ext("twaver.charts.ScaleChart",Me.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","xAxisText","xAxisLineColor","xAxisLineWidth","xAxisTextColor","xAxisTextFont","yAxisText","yAxisLineColor","yAxisLineWidth","yAxisTextColor","yAxisTextFont","xScaleTexts","xScaleTextFont","xScaleTextColor","xScaleTextOrientation","yScaleTextVisible","yScaleTextColor","yScaleTextFont","yScaleLineColor","yScaleLineWidth","yScaleValueGap","yScalePixelGap","yScaleMinTextVisible","valueSpanCount"],_reset:function(){this._map={},this._max=0,this._min=0,this._columnCount=this._xScaleTexts?this._xScaleTexts.size():0,null!=this._upperLimit&&(this._max=this._upperLimit),null!=this._lowerLimit&&(this._min=this._lowerLimit)},getMin:function(){return this._min},getMax:function(){return this._max},getRange:function(){return this._range},getColumnCount:function(){return this._columnCount},getColumnWidth:function(){return this._columnWidth},getValues:function(t){return t.getStyle?t.getStyle("chart.values"):null},formatYScaleText:function(t){return t.toFixed(2)},_initRange:function(){null==this._lowerLimit&&(this._min>=this._max&&(this._min=this._max-.1*Math.abs(this._max)),this._min=this._min-.1*(this._max-this._min)),this._range=this._max-this._min},_initValuesProportion:function(){this._publishedDatas.forEach(function(t){var e=this._map[t.getId()];e.values.forEach(function(t){e.proportions.add(null==t?null:0==this._range?0:t/this._range)},this)},this)},_commonValidateModel:function(){this._publishedDatas.forEach(function(t){var e=new fn(this.getValues(t));e.size()>this._columnCount&&(this._columnCount=e.size());var i={data:t,values:e,proportions:new fn,color:this.getUniqueColor(this.getColor(t),t)};this._initInfo&&this._initInfo(t,i),this._map[t.getId()]=i,(null==this._upperLimit||null==this._lowerLimit)&&e.forEach(function(t){null!=t&&(null==this._upperLimit&&t>this._max&&(this._max=t),null==this._lowerLimit&&t<this._min&&(this._min=t))},this)},this),this._initRange(),this._initValuesProportion()},validateDisplay:function(t,e,i){var n=0;this._xAxisText&&(n=this.getTextSize(this._xAxisTextFont,this._xAxisText).height);var o=0;this._xScaleTexts&&this._xScaleTexts.forEach(function(t){var e=this.getTextSize(this._xScaleTextFont,t),i="vertical"===this._xScaleTextOrientation?e.width:e.height;i>o&&(o=i)},this);var s=i-this._yGap-n-o,a=s-this._yGap,r=null==this._upperLimit?.9*a:a,h=0;this._yAxisText&&(h=this.getTextSize(this._yAxisTextFont,this._yAxisText).height);var l,c;this._yScaleValueGap>0?(l=Math.max(this._yScaleValueGap/this._range*r,1),c=this._yScaleValueGap):(l=Math.max(this._yScalePixelGap,1),c=this._range*(l/r));var d,u,_=0,g=new fn;if(this._yScaleTextVisible){d=this._yScaleMinTextVisible?0:l;for(var f=this._min+(this._yScaleMinTextVisible?0:c);a+1>=d;){if(u=this.formatYScaleText(f)){var v=this.getTextSize(this._yScaleTextFont,u);v.width>_&&(_=v.width),g.add({text:u,size:v,cursor:d})}d+=l,f+=c}}var m={x:this._xGap+h+_,y:this._yGap,width:e-this._xGap-h-_-this._xGap,height:i-this._yGap-o-n-this._yGap};if(this.drawBackground(t,m),this._columnWidth=this._columnCount>0?m.width/(3*this._columnCount+1)*2:m.width/2,0===this._columnWidth&&(this._columnWidth=1),this._yScaleLineWidth>0)for(d=0;a+1>=d;)this.drawLine(t,this._yScaleLineColor,this._yScaleLineWidth,m.x,s-d,m.x+m.width,s-d),d+=l;this._xAxisText&&Ke.drawText(t,this._xAxisText,{x:m.x+m.width/2,y:s+o+n/2},this._xAxisTextFont,this.getUniqueColor(this._xAxisTextColor)),this._yAxisText&&this.drawVerticalText(t,this._yAxisText,{x:this._xGap+h/2,y:a/2+this._yGap},this._yAxisTextFont,this.getUniqueColor(this._yAxisTextColor)),this.drawLine(t,this._yAxisLineColor,this._yAxisLineWidth,m.x,m.y+m.height,m.x,m.y);var p=this.getUniqueColor(this._yScaleTextColor);g.forEach(function(e){var i={x:this._xGap+h+_-e.size.width/2,y:s-e.cursor};Ke.drawText(t,e.text,i,this._yScaleTextFont,p)},this);var y=m.y+m.height+o/2;p=this.getUniqueColor(this._xScaleTextColor);for(var w=this._xScaleLineWidth>0?this.getUniqueColor(this._xScaleLineColor):null,A=0;A<this._columnCount;A++){var x=m.x+this._columnWidth*(1+1.5*A);if(this._xScaleTexts&&A<this._xScaleTexts.size()&&(u=this._xScaleTexts.get(A))){var E={x:x,y:y};"vertical"===this._xScaleTextOrientation?this.drawVerticalText(t,u,E,this._yScaleTextFont,p):this._valueSpanCount?A%this._valueSpanCount==0&&Ke.drawText(t,u,E,this._xScaleTextFont,p):Ke.drawText(t,u,E,this._xScaleTextFont,p)}"default"!==this._type&&w&&(this._valueSpanCount?A%this._valueSpanCount==0&&this.drawLine(t,w,this._xScaleLineWidth,x,m.y+m.height,x,m.y):this.drawLine(t,w,this._xScaleLineWidth,x,m.y+m.height,x,m.y))}var T=s+this._min/c*l;this._publishedDatas.size()>0&&this._columnCount>0&&this.drawContent(t,m,r,T),this.drawLine(t,this._xAxisLineColor,this._xAxisLineWidth,m.x,m.y+m.height,m.x+m.width,m.y+m.height)}}),Me.charts.PieChart=function(t){this._sum=0,this._map={},Me.charts.PieChart.superClass.constructor.apply(this,arguments)},Oe.ext("twaver.charts.PieChart",Me.charts.ChartBase,{__accessor:["type","selectOffset","startAngle","shadowColor","shadowOffset","lineRate","donutRate","valuePosition"],_type:Rn.PIECHART_TYPE,_lineRate:Rn.PIECHART_LINE_RATE,_donutRate:Rn.PIECHART_DONUT_RATE,_startAngle:Rn.PIECHART_START_ANGLE,_shadowColor:Rn.PIECHART_SHADOW_COLOR,_shadowOffset:Rn.PIECHART_SHADOW_OFFSET,_selectOffset:Rn.PIECHART_SELECT_OFFSET,_valuePosition:Rn.PIECHART_VALUE_POSITION,getSum:function(){return this._sum},validateModel:function(){this._sum=0,this._map={},this._publishedDatas.forEach(function(t){var e=this.getValue(t);this._map[t.getId()]={data:t,value:e,color:this.getUniqueColor(this.getColor(t),t)},this._sum+=e},this);var t=this._startAngle;this._publishedDatas.forEach(function(e){var i=this._map[e.getId()];i.proportion=0===this._sum?0:i.value/this._sum,"line"!==this._type&&(i.startAngle=t,i.arc=i.proportion*Math.PI*2,t+=i.arc)},this)},validateDisplay:function(t,e,i){var n={x:this._xGap,y:this._yGap,width:e-2*this._xGap,height:i-2*this._yGap};if(this.drawBackground(t,n),Ze.grow(n,-4,-4),!(n.width<=0||n.height<=0)){var o=this._shadowOffset;if(o>0&&(t.shadowOffsetX=o,t.shadowOffsetY=o,t.shadowBlur=1.5*o,t.shadowColor=this._shadowColor),"oval"===this._type||"circle"===this._type){var s=n.x+n.width/2,a=n.y+n.height/2,r=n.width/2,h=n.height/2;"circle"===this._type&&(r=h=Math.min(r,h)),this._publishedDatas.forEach(function(e){var i=this._map[e.getId()];if(0!==i.arc){var n=0,o=0;if(this.isSelected(e)){var l=i.startAngle+i.arc/2;n=Math.cos(l)*this._selectOffset,o=Math.sin(l)*this._selectOffset*h/r}t.fillStyle=i.color,t.beginPath(),t.moveTo(s+n,a-o),Ke.drawArc(t,s+n,a-o,i.startAngle,i.arc,r,h,!0),t.closePath(),t.fill();var c=this._getValueTextInfo(e,i.value);if(c){var l=i.startAngle+i.arc/2;c.x=s+n+Math.cos(l)*r*this._valuePosition,c.y=a-o-Math.sin(l)*h*this._valuePosition}}},this)}else if("donut"===this._type||"ovalDonut"===this._type){var s=n.x+n.width/2,a=n.y+n.height/2,r=n.width/2,h=n.height/2;"donut"===this._type&&(r=h=Math.min(r,h)),this._publishedDatas.forEach(function(e){var i=this._map[e.getId()];if(0!==i.arc){var n=0,o=0;if(this.isSelected(e)){var l=i.startAngle+i.arc/2;n=Math.cos(l)*this._selectOffset,o=Math.sin(l)*this._selectOffset*h/r}var c=s+Math.cos(i.startAngle)*r*this._donutRate,d=a-Math.sin(i.startAngle)*h*this._donutRate,u=s+Math.cos(i.startAngle+i.arc)*r*this._donutRate,_=a-Math.sin(i.startAngle+i.arc)*h*this._donutRate;t.fillStyle=i.color,t.beginPath(),t.moveTo(c+n,d-o),Ke.drawArc(t,s+n,a-o,i.startAngle,i.arc,r,h,!0),t.lineTo(u+n,_-o),Ke.drawArc(t,s+n,a-o,i.startAngle+i.arc,-i.arc,r*this._donutRate,h*this._donutRate,!0),t.closePath(),t.fill();var g=this._getValueTextInfo(e,i.value);if(g){var l=i.startAngle+i.arc/2,f=this._donutRate+(1-this._donutRate)*this._valuePosition;g.x=s+n+Math.cos(l)*r*f,g.y=a-o-Math.sin(l)*h*f}}},this)}else if("line"===this._type){var l=n.height*this._lineRate;n.y=n.y+n.height/2-l/2,n.height=l;var c=n.x;this._publishedDatas.forEach(function(e){var i=this._map[e.getId()],o=n.width*i.proportion;if(0!==o){t.beginPath(),t.fillStyle=i.color;var s=this.isSelected(e)?-this._selectOffset:0;t.rect(c,n.y+s,o,n.height),t.closePath(),t.fill();var a=this._getValueTextInfo(e,i.value);a&&(a.x=c+o/2,a.y=n.y+n.height+s-n.height*this._valuePosition),c+=o}},this)}this._shadowOffset>0&&(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0),this.drawValueTexts(t)}}}),Me.charts.BarChart=function(t){Me.charts.BarChart.superClass.constructor.apply(this,arguments)},Oe.ext("twaver.charts.BarChart",Me.charts.ScaleChart,{__accessor:["type"],_upperLimit:Rn.BARCHART_UPPER_LIMIT,_lowerLimit:Rn.BARCHART_LOWER_LIMIT,_type:Rn.BARCHART_TYPE,_xAxisText:null,_xAxisTextColor:Rn.BARCHART_XAXIS_TEXT_COLOR,_xAxisTextFont:Rn.BARCHART_XAXIS_TEXT_FONT,_xAxisLineColor:Rn.BARCHART_XAXIS_LINE_COLOR,_xAxisLineWidth:Rn.BARCHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:Rn.BARCHART_YAXIS_TEXT_COLOR,_yAxisTextFont:Rn.BARCHART_YAXIS_TEXT_FONT,_yAxisLineColor:Rn.BARCHART_YAXIS_LINE_COLOR,_yAxisLineWidth:Rn.BARCHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:Rn.BARCHART_XSCALE_TEXT_FONT,_xScaleTextColor:Rn.BARCHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:Rn.BARCHART_XSCALE_TEXT_ORIENTATION,_yScaleTextVisible:Rn.BARCHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:Rn.BARCHART_YSCALE_TEXT_COLOR,_yScaleTextFont:Rn.BARCHART_YSCALE_TEXT_FONT,_yScaleLineColor:Rn.BARCHART_YSCALE_LINE_COLOR,_yScaleLineWidth:Rn.BARCHART_YSCALE_LINE_WIDTH,_yScaleValueGap:Rn.BARCHART_YSCALE_VALUE_GAP,_yScalePixelGap:Rn.BARCHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:Rn.BARCHART_YSCALE_MIN_TEXT_VISIBLE,validateModel:function(){var t=this._type+"ValidateModel";this[t]&&(this._reset(),this[t]())},defaultValidateModel:function(){this._columnCount=this._publishedDatas.size(),this._publishedDatas.forEach(function(t){var e=this.getValue(t);null==this._upperLimit&&e>this._max&&(this._max=e),null==this._lowerLimit&&e<this._min&&(this._min=e),this._map[t.getId()]={data:t,value:e,color:this.getUniqueColor(this.getColor(t),t)}},this),this._initRange(),this._publishedDatas.forEach(function(t){var e=this._map[t.getId()];e.proportion=0==this._range?0:e.value/this._range},this)},layerValidateModel:function(){this._commonValidateModel()},groupValidateModel:function(){this._commonValidateModel()},stackValidateModel:function(){if(this._publishedDatas.forEach(function(t){var e=new fn(this.getValues(t));e.size()>this._columnCount&&(this._columnCount=e.size());var i={data:t,values:e,proportions:new fn,color:this.getUniqueColor(this.getColor(t),t)};this._map[t.getId()]=i},this),null==this._upperLimit||null==this._lowerLimit)for(var t=0;t<this._columnCount;t++){var e=0,i=0;this._publishedDatas.forEach(function(n){var o=this._map[n.getId()];if(o.values.size()>t){var s=o.values.get(t);null!=s&&(s>=0?e+=s:i+=s)}},this),null==this._upperLimit&&e>this._max&&(this._max=e),null==this._lowerLimit&&i<this._min&&(this._min=i)}this._initRange(),this._initValuesProportion()},percentValidateModel:function(){this._publishedDatas.forEach(function(t){var e=new fn(this.getValues(t));e.size()>this._columnCount&&(this._columnCount=e.size());var i={data:t,values:e,proportions:new fn,color:this.getUniqueColor(this.getColor(t),t)};this._map[t.getId()]=i},this);for(var t=new fn,e=0;e<this._columnCount;e++){var i=0;this._publishedDatas.forEach(function(t){var n=this._map[t.getId()];if(n.values.size()>e){var o=n.values.get(e);null!=o&&(i+=o)}},this),t.add(i)}for(var e=0;e<this._columnCount;e++)this._publishedDatas.forEach(function(i){var n=this._map[i.getId()],o=t.get(e);if(0!==o&&n.values.size()>e){var s=n.values.get(e);if(null!=s)return void n.proportions.add(s/o)}n.proportions.add(null)},this);this._min=0,this._max=1,this._range=1},drawRect:function(t,e,i,n,o,s,a){t.fillStyle=e,i&&this._selectInfos.add({x:n,y:o,w:s,h:a,color:this.getUniqueColor(Ke.darker(e))}),t.beginPath(),t.rect(n,o,s,a),t.closePath(),t.fill()},drawContent:function(t,e,i,n){this._selectInfos=new fn,this._toolTipInfos=this.isToolTipEnabled()?new fn:null,"default"===this._type?this.drawDefaultContent(t,e,i,n):"group"===this._type?this.drawGroupContent(t,e,i,n):"percent"===this._type?this.drawPercentContent(t,e,i,n):"stack"===this._type?this.drawStackContent(t,e,i,n):"layer"===this._type&&this.drawLayerContent(t,e,i,n),this.drawValueTexts(t),this._selectInfos.forEach(function(e){t.lineWidth=2,t.strokeStyle=e.color,t.beginPath(),t.rect(e.x,e.y,e.w,e.h),t.closePath(),t.stroke()},this),delete this._selectInfos},drawDefaultContent:function(t,e,i,n){for(var o=this._publishedDatas.size(),s=this._columnWidth,a=0;o>a;a++){var r=this._publishedDatas.get(a),h=this._map[r.getId()],l=e.x+s*(.5+1.5*a),c=Math.abs(i*h.proportion),d=h.proportion>0?n-c:n;this.drawRect(t,h.color,this.isSelected(r),l,d,s,c),this.addToolTipInfo(l,d,s,c,h.value,r);var u=this._getValueTextInfo(r,h.value);if(u){var _=this.getTextSize(u.font,u.text);u.x=l+s/2,u.y=d-_.height/2+1}}},drawPercentContent:function(t,e,i,n){this.drawStackContent(t,e,i,n)},drawStackContent:function(t,e,i,n){for(var o=this._columnCount,s=this._columnWidth,a=0;o>a;a++){var r=n,h=e.x+s*(.5+1.5*a);this._publishedDatas.forEach(function(e){var n=this._map[e.getId()];if(a<n.proportions.size()){var o=n.proportions.get(a);if(null!=o){var l=i*o;r-=l,this.drawRect(t,n.color,this.isSelected(e),h,r,s,l),this.addToolTipInfo(h,r,s,l,n.values.get(a),e);var c=this._getValueTextInfo(e,n.values.get(a));c&&(c.x=h+s/2,c.y=r+l/2)}}},this)}},drawLayerContent:function(t,e,i,n){for(var o=this._publishedDatas.size(),s=this._columnCount,a=this._columnWidth,r=3*a/8/o,h=0;s>h;h++){var l=e.x+a*(.5+1.5*h),c=0;this._publishedDatas.forEach(function(e){var s=this._map[e.getId()];if(h<s.proportions.size()){var d=s.proportions.get(h);if(null!=d){var u=i*d,_=n-u,g=l+a/2-a/8-r*(o-c),f=2*(a/8+r*(o-c));this.drawRect(t,s.color,this.isSelected(e),g,_,f,u),this.addToolTipInfo(g,_,f,u,s.values.get(h),e);var v=this._getValueTextInfo(e,s.values.get(h));if(v){var m=this.getTextSize(v.font,v.text);v.x=g+f/2,v.y=_-m.height/2+1}}}c++},this)}},drawGroupContent:function(t,e,i,n){for(var o=this._publishedDatas.size(),s=this._columnCount,a=this._columnWidth,r=a/o,h=0;s>h;h++){var l=e.x+a*(.5+1.5*h),c=0;this._publishedDatas.forEach(function(e){var o=this._map[e.getId()];if(h<o.proportions.size()){var s=o.proportions.get(h);if(null!=s){var a=i*s,d=n-a;this.drawRect(t,o.color,this.isSelected(e),l+r*c,d,r,a),this.addToolTipInfo(l+r*c,d,r,a,o.values.get(h),e);var u=this._getValueTextInfo(e,o.values.get(h));if(u){var _=this.getTextSize(u.font,u.text);u.x=l+r*c+r/2,u.y=d-_.height/2+1}}}c++},this)}}}),Me.charts.LineChart=function(t){Me.charts.LineChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},Oe.ext("twaver.charts.LineChart",Me.charts.ScaleChart,{__accessor:["xScaleLineColor","xScaleLineWidth","interruptable"],_interruptable:Rn.LINECHART_INTERRUPTABLE,_upperLimit:Rn.LINECHART_UPPER_LIMIT,_lowerLimit:Rn.LINECHART_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:Rn.LINECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:Rn.LINECHART_XAXIS_TEXT_FONT,_xAxisLineColor:Rn.LINECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:Rn.LINECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:Rn.LINECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:Rn.LINECHART_YAXIS_TEXT_FONT,_yAxisLineColor:Rn.LINECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:Rn.LINECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:Rn.LINECHART_XSCALE_TEXT_FONT,_xScaleTextColor:Rn.LINECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:Rn.LINECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:Rn.LINECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:Rn.LINECHART_XSCALE_LINE_WIDTH,_valueSpanCount:Rn.LINECHART_VALUESPANCOUNT,_yScaleTextVisible:Rn.LINECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:Rn.LINECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:Rn.LINECHART_YSCALE_TEXT_FONT,_yScaleLineColor:Rn.LINECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:Rn.LINECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:Rn.LINECHART_YSCALE_VALUE_GAP,_yScalePixelGap:Rn.LINECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:Rn.LINECHART_YSCALE_MIN_TEXT_VISIBLE,getLineWidth:function(t){return t.getStyle?t.getStyle("chart.line.width"):Me.Styles.getStyle("chart.line.width")},getMarkerShape:function(t){return t.getStyle?t.getStyle("chart.marker.shape"):Me.Styles.getStyle("chart.marker.shape")},getMarkerSize:function(t){return t.getStyle?t.getStyle("chart.marker.size"):Me.Styles.getStyle("chart.marker.size")},_initInfo:function(t,e){e.markerShape=this.getMarkerShape(t),e.markerSize=this.getMarkerSize(t),e.lineWidth=this.getLineWidth(t),this.isSelected(t)&&(e.lineWidth+=2)},validateModel:function(){this._reset(),this._commonValidateModel()},getPointIndexAt:function(){var t=this._getPoint.apply(this,arguments),e=this.tryGetDataAt(t);if(!e)return-1;for(var i,n=this._map[e.getId()],o=n.points,s=n.markerSize,a=0,r=o.size();r>a;a++)if(i=o.get(a),i&&Ze.getDistance(t,i)<=s)return a;return-1},drawContent:function(t,e,i,n){this._toolTipInfos=this.isToolTipEnabled()?new fn:null,this._publishedDatas.forEach(function(o){var s=this._map[o.getId()],a=s.markerSize>0?new fn:null;t.strokeStyle=s.color,t.lineWidth=s.lineWidth,t.beginPath();var r=s.proportions,h=null,l=r.size(),c=new fn;s.points=c;for(var d=0;l>d;d++){var u=r.get(d);if(null!=u){var _={x:e.x+this._columnWidth*(1+1.5*d),y:n-i*u};c.add(_),null==h?t.moveTo(_.x,_.y):t.lineTo(_.x,_.y);var g=s.values.get(d),f=this._getValueTextInfo(o,g);if(f){var v=this.getTextSize(f.font,f.text);f.x=_.x,f.y=_.y-v.height/2+2}a&&a.add({point:_,value:g,data:o,index:d}),h=_}else this._interruptable&&(h=null,c.add(null))}if(t.stroke(),a){var m=s.markerSize/2;a.forEach(function(e){t.fillStyle=s.color;var i=e.point.x-m,n=e.point.y-m,o=s.markerSize,a=s.markerSize;Ke.drawVector(t,s.markerShape,null,i,n,o,a),t.fill(),this.addToolTipInfo(i,n,o,a,e.value,e.data,e.index)},this)}},this),this.drawValueTexts(t)}}),Me.charts.BubbleChart=function(t){Me.charts.BubbleChart.superClass.constructor.apply(this,arguments)},Oe.ext("twaver.charts.BubbleChart",Me.charts.ScaleChart,{__accessor:["xAxisUpperLimit","xAxisLowerLimit","xScaleLineColor","xScaleLineWidth","selectShadowColor","selectShadowOffset"],_upperLimit:Rn.BUBBLECHART_UPPER_LIMIT,_lowerLimit:Rn.BUBBLECHART_LOWER_LIMIT,_xAxisUpperLimit:Rn.BUBBLECHART_XAXIS_UPPER_LIMIT,_xAxisLowerLimit:Rn.BUBBLECHART_XAXIS_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:Rn.BUBBLECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:Rn.BUBBLECHART_XAXIS_TEXT_FONT,_xAxisLineColor:Rn.BUBBLECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:Rn.BUBBLECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:Rn.BUBBLECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:Rn.BUBBLECHART_YAXIS_TEXT_FONT,_yAxisLineColor:Rn.BUBBLECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:Rn.BUBBLECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:Rn.BUBBLECHART_XSCALE_TEXT_FONT,_xScaleTextColor:Rn.BUBBLECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:Rn.BUBBLECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:Rn.BUBBLECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:Rn.BUBBLECHART_XSCALE_LINE_WIDTH,_yScaleTextVisible:Rn.BUBBLECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:Rn.BUBBLECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:Rn.BUBBLECHART_YSCALE_TEXT_FONT,_yScaleLineColor:Rn.BUBBLECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:Rn.BUBBLECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:Rn.BUBBLECHART_YSCALE_VALUE_GAP,_yScalePixelGap:Rn.BUBBLECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:Rn.BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE,_selectShadowColor:Rn.BUBBLECHART_SELECT_SHADOW_COLOR,_selectShadowOffset:Rn.BUBBLECHART_SELECT_SHADOW_OFFSET,_resetX:function(){this._xMax=0,this._xMin=0,null!=this._xAxisUpperLimit&&(this._xMax=this._xAxisUpperLimit),null!=this._xAxisLowerLimit&&(this._xMin=this._xAxisLowerLimit)},getXMin:function(){return this._xMin},getXMax:function(){return this._xMax},getXRange:function(){return this._xRange},getShape:function(t){return t.getStyle?t.getStyle("chart.bubble.shape"):Me.Styles.getStyle("chart.bubble.shape")},getSize:function(t,e){return e},getNames:function(t){return t.getStyle?t.getStyle("chart.names"):Me.Styles.getStyle("chart.names")},getXAxisValues:function(t){return t.getStyle?t.getStyle("chart.xaxis.values"):Me.Styles.getStyle("chart.xaxis.values")},getYAxisValues:function(t){return t.getStyle?t.getStyle("chart.yaxis.values"):Me.Styles.getStyle("chart.yaxis.values")},_initXRange:function(){null==this._xAxisLowerLimit&&(this._xMin>=this._xMax&&(this._xMin=this._xMax-.1*Math.abs(this._xMax)),this._xMin=this._xMin-.1*(this._xMax-this._xMin)),this._xRange=this._xMax-this._xMin},_initXYValuesProportion:function(){this._publishedDatas.forEach(function(t){var e=this._map[t.getId()];e.xAxisValues.forEach(function(t){e.xAxisProportions.add(null==t?null:0==this._xRange?0:t/this._xRange)},this),e.yAxisValues.forEach(function(t){e.yAxisProportions.add(null==t?null:0==this._range?0:t/this._range)},this)},this)},validateModel:function(){this._reset(),this._resetX(),this._columnCount=null==this._xScaleTexts?0:this._xScaleTexts.size(),this._publishedDatas.forEach(function(t){var e=new fn(this.getYAxisValues(t)),i=new fn(this.getXAxisValues(t)),n=new fn(this.getValues(t));n.size()>this._columnCount&&(this._columnCount=n.size());var o={data:t,values:n,yAxisValues:e,xAxisValues:i,yAxisProportions:new fn,xAxisProportions:new fn,color:this.getUniqueColor(this.getColor(t),t),anchorShape:this.getShape(t)};this._map[t.getId()]=o,(null==this._upperLimit||null==this._lowerLimit)&&e.forEach(function(t){null!=t&&(null==this._upperLimit&&t>this._max&&(this._max=t),null==this._lowerLimit&&t<this._min&&(this._min=t))},this),(null==this._upperLimit||null==this._lowerLimit)&&i.forEach(function(t){null!=t&&(null==this._xAxisUpperLimit&&t>this._xMax&&(this._xMax=t),null==this._xAxisLowerLimit&&t<this._xMin&&(this._xMin=t))},this)},this),this._initRange(),this._initXRange(),this._initXYValuesProportion()},drawContent:function(t,e,i,n){this._toolTipInfos=this.isToolTipEnabled()?new fn:null,this._publishedDatas.forEach(function(o){var s=this._map[o.getId()],a=s.yAxisProportions,r=s.xAxisProportions,h=s.values,l=s.yAxisProportions.size(),c=this._selectShadowOffset;this.isSelected(o)&&c>0?(t.shadowOffsetX=c,t.shadowOffsetY=c,t.shadowBlur=2*c,t.shadowColor=this._selectShadowColor):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,t.shadowColor=s.color),t.fillStyle=s.color;for(var d=0;l>d;d++){var u=a.get(d),_=r.get(d);if(null!=u){var g={x:e.x+e.width*_,y:n-i*u},f=h.get(d),v=this.getSize(o,f),c=v/2,m=g.x-c,p=g.y-c,y=v,w=v;Ke.drawVector(t,s.anchorShape,null,m,p,y,w),t.fill(),this.addToolTipInfo(m,p,y,w,f,o,d);var A=this._getValueTextInfo(o,f);if(A){var v=this.getTextSize(A.font,A.text);A.x=g.x,A.y=g.y}}}},this),this.drawValueTexts(t)}}),Me.charts.DialChart=function(t){Me.charts.DialChart.superClass.constructor.apply(this,arguments)},Oe.ext("twaver.charts.DialChart",Me.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","startAngle","endAngle","innerRadius","colorRangeFillColor","outlineWidth","outlineColor","majorScaleCount","majorScaleLineWidth","majorScaleLineLength","majorScaleLineColor","minorScaleCount","minorScaleLineWidth","minorScaleLineLength","minorScaleLineColor","scaleTextVisible","scaleUpperLimitTextVisible","scaleLowerLimitTextVisible","scaleTextFont","scaleTextColor","pivotRadius","pivotFillColor","pivotOutlineWidth","pivotOutlineColor","pivotGradient","pivotGradientColor","valuePosition","colorRangeList","innerDarkerRadius","outerBrighterRadius","selectShadowColor","selectShadowOffset"],__bool:["scaleInside","pivotFill"],_upperLimit:Rn.DIALCHART_UPPER_LIMIT,_lowerLimit:Rn.DIALCHART_LOWER_LIMIT,_startAngle:Rn.DIALCHART_START_ANGLE,_endAngle:Rn.DIALCHART_END_ANGLE,_innerRadius:Rn.DIALCHART_INNER_RADIUS,_colorRangeFillColor:Rn.DIALCHART_COLOR_RANGE_FILL_COLOR,_outlineWidth:Rn.DIALCHART_OUTLINE_WIDTH,_outlineColor:Rn.DIALCHART_OUTLINE_COLOR,_scaleInside:Rn.DIALCHART_SCALE_INSIDE,_majorScaleCount:Rn.DIALCHART_MAJOR_SCALE_COUNT,_majorScaleLineWidth:Rn.DIALCHART_MAJOR_SCALE_LINE_WIDTH,_majorScaleLineLength:Rn.DIALCHART_MAJOR_SCALE_LINE_LENGTH,_majorScaleLineColor:Rn.DIALCHART_MAJOR_SCALE_LINE_COLOR,_minorScaleCount:Rn.DIALCHART_MINOR_SCALE_COUNT,_minorScaleLineWidth:Rn.DIALCHART_MINOR_SCALE_LINE_WIDTH,_minorScaleLineLength:Rn.DIALCHART_MINOR_SCALE_LINE_LENGTH,_minorScaleLineColor:Rn.DIALCHART_MINOR_SCALE_LINE_COLOR,_scaleTextVisible:Rn.DIALCHART_SCALE_TEXT_VISIBLE,_scaleUpperLimitTextVisible:Rn.DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE,_scaleLowerLimitTextVisible:Rn.DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE,_scaleTextFont:Rn.DIALCHART_SCALE_TEXT_FONT,_scaleTextColor:Rn.DIALCHART_SCALE_TEXT_COLOR,_pivotRadius:Rn.DIALCHART_PIVOT_RADIUS,_pivotFill:Rn.DIALCHART_PIVOT_FILL,_pivotFillColor:Rn.DIALCHART_PIVOT_FILL_COLOR,_pivotOutlineWidth:Rn.DIALCHART_PIVOT_OUTLINE_WIDTH,_pivotOutlineColor:Rn.DIALCHART_PIVOT_OUTLINE_COLOR,_pivotGradient:Rn.DIALCHART_PIVOT_GRADIENT,_pivotGradientColor:Rn.DIALCHART_PIVOT_GRADIENT_COLOR,_valuePosition:Rn.DIALCHART_VALUE_POSITION,_innerDarkerRadius:Rn.DIALCHART_INNER_DARKER_RADIUS,_outerBrighterRadius:Rn.DIALCHART_OUTER_BRIGHTER_RADIUS,_selectShadowColor:Rn.DIALCHART_SELECT_SHADOW_COLOR,_selectShadowOffset:Rn.DIALCHART_SELECT_SHADOW_OFFSET,formatScaleText:function(t){return t.toFixed(2)},validateModel:function(){this._map={},this._valueRange=this._upperLimit-this._lowerLimit;var t=this._startAngle;0!=t&&(t=(t%360+360)%360,0==t&&(t=360)),this._positiveStartAngle=t;var e=this._endAngle;0!=e&&(e=(e%360+360)%360,0==e&&(e=360)),this._positiveEndAngle=e,this._whole=360==Math.abs(t-e),this._startAngleByRadian=t*Math.PI/180,this._endAngleByRadian=e*Math.PI/180,this._clockwise=this._startAngleByRadian>this._endAngleByRadian,this._angleRange=Math.abs(this._startAngleByRadian-this._endAngleByRadian),this._publishedDatas.forEach(function(t){var e=this.getValue(t);this._map[t.getId()]={data:t,value:e,color:this.getUniqueColor(this.getColor(t),t),angle:this._startAngleByRadian+(this._clockwise?-1:1)*e/this._valueRange*this._angleRange}},this)},validateDisplay:function(t,e,i){var n={x:this._xGap,y:this._yGap,width:e-2*this._xGap,height:i-2*this._yGap};if(this.drawBackground(t,n),this._startAngleByRadian!=this._endAngleByRadian){var o,s,a=this._lowerLimit,r=this._majorScaleCount>1?this._valueRange/(this._majorScaleCount-1):0,h=0,l=0,c=null,d=null;if(this._scaleTextVisible)for(c=new fn,o=0;o<this._majorScaleCount;o++)0==o&&!this._scaleLowerLimitTextVisible||o==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible?(s=null,c.add({text:"",size:{width:0,height:0}})):(d=this.formatScaleText(a),s=this.getTextSize(this._scaleTextFont,d),c.add({text:d,size:s})),this._scaleInside||null==s||(s.width>h&&(h=s.width),s.height>l&&(l=s.height)),a+=r;if(this._angleRange<=Math.PI&&(h=Math.max(h,this._pivotRadius),l=Math.max(l,this._pivotRadius)),Ze.grow(n,-h,-l),this._calcluateCenterAndRadius(n),t.lineWidth=0,null==this._colorRangeList||0==this._colorRangeList.size())this._drawArcGroup(t,this._startAngleByRadian,this._endAngleByRadian,this.getUniqueColor(this._colorRangeFillColor)),this._drawArcOutLine(t,this._startAngleByRadian,this._endAngleByRadian,!0,!0);else{var u=this._angleRange/this._colorRangeList.size(),_=this._startAngleByRadian;for(o=0;o<this._colorRangeList.size();o++){var g=this.getUniqueColor(this._colorRangeList.get(o)),f=_+(this._clockwise?-1:1)*u;this._drawArcGroup(t,_,f,g),this._drawArcOutLine(t,_,_+(this._clockwise?-1:1)*u,0==o,o==this._colorRangeList.size()-1),_+=(this._clockwise?-1:1)*u}}var v,m,p,y,w,A,x,E,T=this._startAngleByRadian,C=this._majorScaleCount>1?this._angleRange/(this._majorScaleCount-1):0;for(A=this._scaleInside?this._innerRadiusByPixel:this._outerRadius,x=A+this._majorScaleLineLength*(this._scaleInside?1:-1),E=A+this._minorScaleLineLength*(this._scaleInside?1:-1),o=0;o<this._majorScaleCount;o++){if(m=this._center.x+Math.cos(T)*A,p=this._center.y+Math.sin(-T)*A,y=this._center.x+Math.cos(T)*x,w=this._center.y+Math.sin(-T)*x,t.lineWidth=this._majorScaleLineWidth,t.strokeStyle=this.getUniqueColor(this._majorScaleLineColor),t.beginPath(),t.moveTo(m,p),t.lineTo(y,w),t.closePath(),t.stroke(),this._scaleTextVisible)if(0==o&&!this._scaleLowerLimitTextVisible||o==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible);else{var b=c.get(o);if(b){var k=this.getScaleTextPosition(T/Math.PI*180,m,p,b.size.width,b.size.height);b.x=k.x,b.y=k.y}}if(this._whole||!this._whole&&o<this._majorScaleCount-1){var S=T,I=this._minorScaleCount>0?C/(this._minorScaleCount+1):0;for(v=0;v<this._minorScaleCount;v++)S+=(this._clockwise?-1:1)*I,m=this._center.x+Math.cos(S)*A,p=this._center.y+Math.sin(-S)*A,y=this._center.x+Math.cos(S)*E,w=this._center.y+Math.sin(-S)*E,t.lineWidth=this._minorScaleLineWidth,t.strokeStyle=this.getUniqueColor(this._minorScaleLineColor),t.beginPath(),t.moveTo(m,p),t.lineTo(y,w),t.closePath(),t.stroke()}T+=(this._clockwise?-1:1)*C}this._pivotFill&&Ke.fill(t,this.getUniqueColor(this._pivotFillColor),this._pivotGradient,this._pivotGradientColor,this._center.x-this._pivotRadius,this._center.y-this._pivotRadius,2*this._pivotRadius,2*this._pivotRadius),t.lineWidth=this._pivotOutlineWidth,t.strokeStyle=this.getUniqueColor(this._pivotOutlineColor),t.beginPath(),t.arc(this._center.x,this._center.y,this._pivotRadius,0,2*Math.PI,!0),t.closePath(),this._pivotFill&&t.fill(),c&&c.forEach(function(e){e&&Ke.drawText(t,e.text,e,this._scaleTextFont,this._scaleTextColor)},this),this._publishedDatas.forEach(function(e){var i=this._map[e.getId()],n=this._getDataStyle("dialchart.rear.extension",e),o=this._getDataStyle("dialchart.base.width",e),s=this._getDataStyle("dialchart.top.width",e),a=this._getDataStyle("dialchart.radius",e);a>=-1&&1>=a&&(a*=this._innerRadiusByPixel),t.fillStyle=i.color,t.lineWidth=0;var r=Ze.createMatrix(-i.angle,this._center.x,this._center.y),h=r.transform(this._center.x+a,this._center.y+s/2),l=r.transform(this._center.x+a,this._center.y-s/2),c=r.transform(this._center.x-n,this._center.y-o/2),d=r.transform(this._center.x-n,this._center.y+o/2),u=this._selectShadowOffset;this.isSelected(e)&&u>0?(t.shadowOffsetX=u,t.shadowOffsetY=u,t.shadowBlur=2*u,t.shadowColor=this._selectShadowColor):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,t.shadowColor=i.color),t.beginPath(),t.moveTo(h.x,h.y),t.lineTo(l.x,l.y),t.lineTo(c.x,c.y),t.lineTo(d.x,d.y),t.lineTo(h.x,h.y),t.closePath(),t.fill();var _=this._getValueTextInfo(e,i.value);if(_){var g=r.transform(this._center.x+a*this._valuePosition,this._center.y);_.x=g.x,_.y=g.y}},this),this.drawValueTexts(t)}},_getDataStyle:function(t,e){return e.getStyle?e.getStyle(t):e.getClient(t)},_calcluateCenterAndRadius:function(t){{var e=this._clockwise?this._positiveEndAngle:this._positiveStartAngle,i=this._clockwise?this._positiveStartAngle:this._positiveEndAngle;Math.abs(this._positiveEndAngle-this._positiveStartAngle)}e>=0&&90>e?i>=0&&90>=i?(this._outerRadius=Math.min(t.width,t.height),this._center={x:t.x+(t.width-this._outerRadius)/2,y:t.y+(t.height+this._outerRadius)/2}):i>90&&180>=i?(this._outerRadius=Math.min(t.width/2,t.height),this._center={x:t.x+t.width/2,y:t.y+(t.height+this._outerRadius)/2}):(this._center={x:t.x+t.width/2,y:t.y+t.height/2},this._outerRadius=Math.min(t.width,t.height)/2):e>=90&&180>e?i>=90&&180>=i?(this._outerRadius=Math.min(t.width,t.height),this._center={x:t.x+(t.width+this._outerRadius)/2,y:t.y+(t.height+this._outerRadius)/2}):i>180&&270>=i?(this._outerRadius=Math.min(t.width,t.height/2),this._center={x:t.x+(t.width+this._outerRadius)/2,y:t.y+t.height/2}):(this._center={x:t.x+t.width/2,y:t.y+t.height/2},this._outerRadius=Math.min(t.width,t.height)/2):e>=180&&270>e?i>=180&&270>=i?(this._outerRadius=Math.min(t.width,t.height),this._center={x:t.x+(t.width+this._outerRadius)/2,y:t.y+(t.height-this._outerRadius)/2}):(this._outerRadius=Math.min(t.width/2,t.height),this._center={x:t.x+t.width/2,y:t.y+(t.height-this._outerRadius)/2}):(this._outerRadius=Math.min(t.width,t.height),this._center={x:t.x+(t.width-this._outerRadius)/2,y:t.y+(t.height-this._outerRadius)/2}),this._innerRadiusByPixel=this._innerRadius>1?this._innerRadius:this._outerRadius*this._innerRadius,this._innerDarkerRadiusByPixel=this._innerDarkerRadius>1?this._innerDarkerRadius:this._outerRadius*this._innerDarkerRadius,this._outerBrighterRadiusByPixel=this._outerBrighterRadius>1?this._outerBrighterRadius:this._outerRadius*this._outerBrighterRadius},_drawArcOutLine:function(t,e,i,n,o){if(!(this._outlineWidth<=0)){var s=Math.abs(e-i),a=this._center.x+Math.cos(e)*this._innerRadiusByPixel,r=this._center.y+Math.sin(-e)*this._innerRadiusByPixel,h=this._center.x+Math.cos(e)*this._outerRadius,l=this._center.y+Math.sin(-e)*this._outerRadius,c=this._center.x+Math.cos(i)*this._innerRadiusByPixel,d=this._center.y+Math.sin(-i)*this._innerRadiusByPixel,u=this._center.x+Math.cos(i)*this._outerRadius,_=this._center.y+Math.sin(-i)*this._outerRadius;this._clockwise?(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor),t.beginPath(),t.moveTo(this._center.x,this._center.y),Ke.drawArc(t,this._center.x,this._center.y,i,s,this._outerRadius,this._outerRadius,!1),t.stroke(),!this._whole&&n?(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor)):t.lineWidth=0,t.lineTo(a,r),t.stroke(),t.beginPath(),t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor),t.moveTo(this._center.x,this._center.y),Ke.drawArc(t,this._center.x,this._center.y,e,-s,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),t.stroke(),!this._whole&&o?(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor)):t.lineWidth=0,t.lineTo(u,_),t.stroke()):(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor),t.beginPath(),t.moveTo(this._center.x,this._center.y),Ke.drawArc(t,this._center.x,this._center.y,e,s,this._outerRadius,this._outerRadius,!1),t.stroke(),!this._whole&&o?(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor)):t.lineWidth=0,t.lineTo(c,d),t.stroke(),t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor),t.beginPath(),t.moveTo(this._center.x,this._center.y),Ke.drawArc(t,this._center.x,this._center.y,i,-s,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),t.stroke(),!this._whole&&n?(t.lineWidth=this._outlineWidth,t.strokeStyle=this.getUniqueColor(this._outlineColor)):t.lineWidth=0,t.lineTo(h,l),t.stroke())}},_drawArcGroup:function(t,e,i,n){0!=this._outerBrighterRadiusByPixel&&this._drawArc(t,e,i,this._outerRadius-this._outerBrighterRadiusByPixel,this._outerRadius,Ke.brighter(n)),this._drawArc(t,e,i,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,this._outerRadius-this._outerBrighterRadiusByPixel,n),0!=this._innerDarkerRadiusByPixel&&this._drawArc(t,e,i,this._innerRadiusByPixel,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,Ke.darker(n,20))},_drawArc:function(t,e,i,n,o,s){var a=Math.abs(e-i);t.lineWidth=0,t.fillStyle=s;{var r=this._center.x+Math.cos(e)*n,h=this._center.y+Math.sin(-e)*n,l=(this._center.x+Math.cos(e)*o,this._center.y+Math.sin(-e)*o,this._center.x+Math.cos(i)*n),c=this._center.y+Math.sin(-i)*n;this._center.x+Math.cos(i)*o,this._center.y+Math.sin(-i)*o}t.beginPath(),this._clockwise?(t.moveTo(l,c),Ke.drawArc(t,this._center.x,this._center.y,i,a,o,o,!0),t.lineTo(r,h),Ke.drawArc(t,this._center.x,this._center.y,e,-a,n,n,!0),t.closePath()):(t.moveTo(r,h),Ke.drawArc(t,this._center.x,this._center.y,e,a,o,o,!0),t.lineTo(l,c),Ke.drawArc(t,this._center.x,this._center.y,i,-a,n,n,!0),t.closePath()),t.fill()},getScaleTextPosition:function(t,e,i,n,o){t=(t%360+360)%360;var s={x:e,y:i};return 0==t&&(s=this._scaleInside?{x:e-n/2,y:i}:{x:e+n/2,y:i}),180==t&&(s=this._scaleInside?{x:e+n/2,y:i}:{x:e-n/2,y:i}),90==t&&(s=this._scaleInside?{x:e,y:i+o/2}:{x:e,y:i-o/2}),270==t&&(s=this._scaleInside?{x:e,y:i-o/2}:{x:e,y:i+o/2}),t>270&&360>t&&(s=this._scaleInside?{x:e-n/2,y:i-o/2}:{x:e+n/2,y:i+o/2}),t>180&&270>t&&(s=this._scaleInside?{x:e+n/2,y:i-o/2}:{x:e-n/2,y:i+o/2}),t>90&&180>t&&(s=this._scaleInside?{x:e+n/2,y:i+o/2}:{x:e-n/2,y:i-o/2}),t>0&&90>t&&(s=this._scaleInside?{x:e-n/2,y:i+o/2}:{x:e+n/2,y:i-o/2}),s}}),Me.charts.RadarChart=function(t){Me.charts.RadarChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},Oe.ext("twaver.charts.RadarChart",Me.charts.ChartBase,{__accessor:["axisTextVisible","axisTextFont","axisTextColor","scaleTextVisible","scaleTextFont","scaleTextColor","axisVisible","axisLineColor","axisLineWidth","axisStartAngle","ringVisible","ringType","ringLineColor","ringLineWidth","scaleCount","scaleMaxValue","scaleMinValue","anchorVisible","areaFillAlpha","areaSelectFillAlpha","axisList"],__bool:["areaFill"],_axisTextVisible:Rn.RADARCHART_AXIS_TEXT_VISIBLE,_axisTextFont:Rn.RADARCHART_AXIS_TEXT_FONT,_axisTextColor:Rn.RADARCHART_AXIS_TEXT_COLOR,_scaleTextVisible:Rn.RADARCHART_SCALE_TEXT_VISIBLE,_scaleTextFont:Rn.RADARCHART_SCALE_TEXT_FONT,_scaleTextColor:Rn.RADARCHART_SCALE_TEXT_COLOR,_axisVisible:Rn.RADARCHART_AXIS_VISIBLE,_axisLineColor:Rn.RADARCHART_AXIS_LINE_COLOR,_axisLineWidth:Rn.RADARCHART_AXIS_LINE_WIDTH,_axisStartAngle:Rn.RADARCHART_AXIS_START_ANGLE,_ringVisible:Rn.RADARCHART_RING_VISIBLE,_ringType:Rn.RADARCHART_RING_TYPE,_ringLineColor:Rn.RADARCHART_RING_LINE_COLOR,_ringLineWidth:Rn.RADARCHART_RING_LINE_WIDTH,_scaleCount:Rn.RADARCHART_SCALE_COUNT,_scaleMaxValue:Rn.RADARCHART_SCALE_MAXVALUE,_scaleMinValue:Rn.RADARCHART_SCALE_MINVALUE,_anchorVisible:Rn.RADARCHART_ANCHOR_VISIBLE,_areaFill:Rn.RADARCHART_AREA_FILL,_areaFillAlpha:Rn.RADARCHART_AREA_FILL_ALPHA,_areaSelectFillAlpha:Rn.RADARCHART_AREA_SELECT_FILL_ALPHA,getAxisCount:function(){return this._axisCount},formatScaleText:function(t,e){return t.toFixed(2)},getAnchorSize:function(t){return t.getStyle?t.getStyle("chart.marker.size"):Me.Styles.getStyle("chart.marker.size")},getAnchorShape:function(t){return t.getStyle?t.getStyle("chart.marker.shape"):Me.Styles.getStyle("chart.marker.shape")},getLineWidth:function(t){return t.getStyle?t.getStyle("chart.line.width"):Me.Styles.getStyle("chart.line.width")},getValues:function(t){return t.getStyle?t.getStyle("chart.values"):null},tryGetDataAt:function(t,e){if((null==e||0>e)&&(e=this._selectTolerance),t.target&&(t=je.getLogicalPoint(this._canvas,arguments[0],1)),!t)return null;if(!this._areaFill){var i=t.x-e,n=t.y-e,o=2*e+1,s=2*e+1;try{for(var a=this._canvas.getContext("2d").getImageData(i,n,o,s).data,r=0,h=a.length;h>r;r+=4)if(255===a[r+3]){var l="rgb("+a[r]+","+a[r+1]+","+a[r+2]+")",c=this._uniqueColors[l];if(c)return c}}catch(t){}return null}if(!this._center)return null;t={x:t.x-this._xTranslate,y:t.y-this._yTranslate};for(var r=this._publishedDatas.size()-1;r>=0;r--){var c=this._publishedDatas.get(r),d=this._map[c.getId()],u=Ze.isPointInPolygon(d.points,t);if(u)return c}return null},getDataAt:function(){var t,e;if(2===arguments.length)t=arguments[0],e=arguments[1];else if(arguments[0].target){var i=je.getLogicalPoint(this._canvas,arguments[0],1);if(!i)return;t=i.x,e=i.y}else t=arguments[0].x,e=arguments[0].y;if(0>t||0>e||t>this._canvasWidth||e>this._canvasHeight)return null;if(!this._areaFill){try{var n=this._canvas.getContext("2d").getImageData(t,e,1,1).data;if(255===n[3]){var o="rgb("+n[0]+","+n[1]+","+n[2]+")",s=this._uniqueColors[o];if(s)return s}}catch(t){}return null}for(var a=this._publishedDatas.size()-1;a>=0;a--){var s=this._publishedDatas.get(a),r=this._map[s.getId()],h=Ze.isPointInPolygon(r.points,{x:t-this._xTranslate,y:e-this._yTranslate});if(h)return s}return null},validateModel:function(){if(this._map={},this._axisTexts=new fn,this._axisMaxValues=new fn,this._axisMinValues=new fn,this._axisRangeValues=new fn,this._axisCount=null==this._axisList?0:this._axisList.size(),0!=this._axisCount){this._averageAngleByRadian=2*Math.PI/this._axisCount,this._averageAngle=360/this._axisCount,this._axisList.forEach(function(t){if("string"==typeof t)this._axisTexts.add(t),this._axisMaxValues.add(this._scaleMaxValue),this._axisMinValues.add(this._scaleMinValue),this._axisRangeValues.add(this._scaleMaxValue-this._scaleMinValue);else{this._axisTexts.add(t.text);var e=isNaN(t.max)?this._scaleMaxValue:t.max,i=isNaN(t.min)?this._scaleMinValue:t.min;this._axisMaxValues.add(e),this._axisMinValues.add(i),this._axisRangeValues.add(e-i)}},this),this._publishedDatas.forEach(function(t){var e=new fn(this.getValues(t)),i={data:t,values:e,proportions:new fn,color:this.getUniqueColor(this.getColor(t),t),anchorShape:this.getAnchorShape(t),anchorSize:this.getAnchorSize(t),lineWidth:this.getLineWidth(t),points:new fn};this.isSelected(t)&&(i.lineWidth+=2),this._map[t.getId()]=i},this);for(var t=0;t<this._axisCount;t++)this._publishedDatas.forEach(function(e){var i=this._map[e.getId()],n=0;if(i.values.size()>t){var o=i.values.get(t),s=this._axisMinValues.get(t),a=this._axisRangeValues.get(t);a>0&&(n=(o-s)/a)}i.proportions.add(n)},this)}},validateDisplay:function(t,e,i){var n={x:this._xGap,y:this._yGap,width:e-2*this._xGap,height:i-2*this._yGap};if(this.drawBackground(t,n),!(n.width<=0||n.height<=0||this._axisCount<3)){var o=0,s=0,a=0,r=null,h=null,l=null,c=null;if(this._axisTextVisible)for(c=new fn,a=0;a<this._axisCount;a++)l=this._axisTexts.get(a),r=this.getTextSize(this._axisTextFont,l),c.add({text:l,size:r}),r.width>o&&(o=r.width),r.height>s&&(s=r.height);var d=n.width/2-o>n.height/2-s?n.height/2-2*s:n.width/2-o,u={x:n.x+n.width/2,y:n.y+n.height/2};this._center={x:u.x+this._xTranslate,y:u.y+this._yTranslate};var _=null;this._scaleTextVisible&&(_=new fn);var g=this._axisStartAngle/180*Math.PI;for(a=0;a<this._axisCount;a++){var f=180*g/Math.PI,v=u.x+Math.cos(g)*d,m=u.y+Math.sin(-g)*d,p=null;_&&(p=new fn,_.add(p)),this._ringVisible&&this._ringLineWidth>0&&(t.lineWidth=this._ringLineWidth,t.strokeStyle=this._ringLineColor);for(var y=1;y<=this._scaleCount;y++){var w=y/this._scaleCount,A=d*w,x=u.x+Math.cos(g)*A,E=u.y+Math.sin(-g)*A;if(this._ringVisible&&this._ringLineWidth>0){var T=u.x+Math.cos(g+this._averageAngleByRadian)*A,C=u.y+Math.sin(-g-this._averageAngleByRadian)*A;"line"==this._ringType?this.drawLine(t,this._ringLineColor,this._ringLineWidth,x,E,T,C):"arc"==this._ringType&&(t.beginPath(),t.moveTo(u.x,u.y),Ke.drawArc(t,u.x,u.y,g,this._averageAngleByRadian,A,A,!0),t.closePath(),t.stroke())}p&&(l=this.formatScaleText(this._axisMinValues.get(a)+this._axisRangeValues.get(a)*w,a),r=this.getTextSize(this._scaleTextFont,l),h=this.getScaleTextPosition(f,x,E,r.width,r.height),p.add({text:l,x:h.x,y:h.y}))}if(this._axisVisible&&this.drawLine(t,this._axisLineColor,this._axisLineWidth,u.x,u.y,v,m),c){var b=c.get(a);h=this.getAxisTextPosition(f,v,m,b.size.width,b.size.height),b.x=h.x,b.y=h.y}g+=this._averageAngleByRadian}this._publishedDatas.forEach(function(e){var i=this._map[e.getId()];i.points.clear();var n=i.anchorSize>0?new fn:null,o=i.proportions;if(t.lineWidth=0,t.globalAlpha=this.isSelected(e)?this._areaSelectFillAlpha:this._areaFillAlpha,this._areaFill&&(t.fillStyle=i.color),this._drawItem(t,o,u,d,n,i),this._areaFill&&t.fill(),t.lineWidth=i.lineWidth,t.strokeStyle=i.color,t.globalAlpha=1,this._drawItem(t,o,u,d),t.lineWidth=0,null!=n&&n.size()>0){var s=i.anchorSize/2;n.forEach(function(e){t.fillStyle=i.color,Ke.drawVector(t,i.anchorShape,null,e.x-s,e.y-s,i.anchorSize,i.anchorSize),t.fill()})}},this),_&&_.forEach(function(e){e.forEach(function(e){Ke.drawText(t,e.text,e,this._scaleTextFont,this._scaleTextColor)},this)},this),c&&c.forEach(function(e){Ke.drawText(t,e.text,e,this._axisTextFont,this._axisTextColor)},this)}},_drawItem:function(t,e,i,n,o,s){var a=this._axisStartAngle/180*Math.PI,r=null;t.beginPath();for(var h=0;h<this._axisCount;h++){var l=e.get(h),c={x:i.x+Math.cos(a)*n*l,y:i.y+Math.sin(-a)*n*l};null==r?t.moveTo(c.x,c.y):t.lineTo(c.x,c.y),null!=o&&this._anchorVisible&&o.add(c),s&&s.points.add(c),0==h&&(r=c),a+=this._averageAngleByRadian}null!=r&&t.lineTo(r.x,r.y),t.closePath(),t.stroke()},getAxisTextPosition:function(t,e,i,n,o){t=(t%360+360)%360;var s={x:e,y:i};return 0==t&&(s={x:e+n/2,y:i}),180==t&&(s={x:e-n/2,y:i}),90==t&&(s={x:e,y:i-o/2}),270==t&&(s={x:e,y:i+o/2}),t>270&&360>t&&(s={x:e+n/2,y:i+o/2}),t>180&&270>t&&(s={x:e-n/2,y:i+o/2}),t>90&&180>t&&(s={x:e-n/2,y:i-o/2}),t>0&&90>t&&(s={x:e+n/2,y:i-o/2}),s},getScaleTextPosition:function(t,e,i,n,o){t=(t%360+360)%360;var s={x:e,y:i};return 0==t&&(s={x:e,y:i+o/2}),180==t&&(s={x:e-n/2,y:i+o/2}),90==t&&(s={x:e+n/2,y:i}),270==t&&(s={x:e+n/2,y:i}),t>270&&360>t&&(s={x:e+n/2,y:i-o/2}),t>180&&270>t&&(s={x:e-n/2,y:i-o/2}),t>90&&180>t&&(s={x:e-n/2,y:i+o/2}),t>0&&90>t&&(s={x:e+n/2,y:i+o/2}),s}}),Me.charts.LegendPane=function(t){Me.charts.LegendPane.superClass.constructor.apply(this,arguments),this._divPool=new Me.Pool("div"),this._iconPool=new Me.Pool("div"),this._textPool=new Me.Pool("span"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._textPool),this._chart=t,this._chart.addViewListener(this.handleViewChange,this),this._view=je.createView("hidden"),this._view.style.verticalAlign="middle",this._legendDiv=je.createDiv(),this._legendDiv.style.whiteSpace="nowrap",this._legendDiv.style.verticalAlign="middle",this._legendDiv.style.position="",this._view.appendChild(this._legendDiv),this._hiddenMap={};var e=this;this._chart._internalVisibleFunction=function(t){return!e.isHidden(t)},He.isTouchable&&new Me.charts.LegendPaneTouchInteraction(this),new Me.charts.LegendPaneInteraction(this)},Oe.ext("twaver.charts.LegendPane",Me.controls.ControlBase,{__accessor:["iconWidth","iconHeight","iconRadius","rowHeight","orientation","hiddenColor","selectBackgroundColor","selectForegroundColor"],_iconWidth:Rn.LEGENDPANE_ICON_WIDTH,_iconHeight:Rn.LEGENDPANE_ICON_HEIGHT,_iconRadius:Rn.LEGENDPANE_ICON_RADIUS,_rowHeight:Rn.LEGENDPANE_ROW_HEIGHT,_orientation:Rn.LEGENDPANE_ORIENTATION,_hiddenColor:Rn.LEGENDPANE_HIDDEN_COLOR,_selectBackgroundColor:Rn.LEGENDPANE_SELECT_BACKGROUND_COLOR,_selectForegroundColor:Rn.LEGENDPANE_SELECT_FOREGROUND_COLOR,onPropertyChanged:function(t){this.invalidate()},getChart:function(){return this._chart},isHidden:function(t){return null!=this._hiddenMap[t.getId()]},handleViewChange:function(t){"validateEnd"===t.kind&&(this._invalidate=!0,this.validate())},validate:function(){if(this._invalidate){this._invalidate=!1,je.release(this._legendDiv),Oe.keys(this._hiddenMap).forEach(function(t){this._chart.getDataBox().containsById(t)||delete this._hiddenMap[t]},this);for(var t=new fn(this._chart.getUnfilteredDatas()),e=0;e<t.size();e++){var i=t.get(e);this._chart.isVisible(i)||this.isHidden(i)||(t.removeAt(e),e--)}var n=t.size(),o=this._view.style,s="horizontal"===this._orientation;for(s?(o.textAlign="center",o.height=this._rowHeight+"px"):(o.textAlign="",o.height=this._rowHeight*n+"px"),o.lineHeight=this._rowHeight-2+"px",e=0;n>e;e++){var i=t.get(e),a=this._divPool.get();a._data=i,a.style.cursor="pointer",a.style.height=this._rowHeight+"px",a.style.display=s?"inline-block":"block",this._legendDiv.appendChild(a),this.renderLegend(a,i),this.onLegendRendered(a,i)}this._pools.forEach(function(t){t.clear()})}},renderLegend:function(t,e){var i=!this.isHidden(e),n=this._chart.isSelected(e),o=this._iconPool.get(),s=o.style;s.display="inline-block",s.verticalAlign="middle",s.marginLeft="4px",s.width=this.getIconWidth()+"px",s.height=this.getIconHeight()+"px",s.backgroundColor=i?this._chart.getColor(e):this.getHiddenColor(),t.appendChild(o);var a=this._textPool.get();s=a.style,s.paddingLeft="2px",s.paddingRight="4px",s.display="inline-block",s.verticalAlign="middle",s.color=i?n?this._selectForegroundColor:"":this.getHiddenColor(),a.innerHTML=this._chart.getName(e),t.appendChild(a),t.style.backgroundColor=i&&n?this._selectBackgroundColor:""},onLegendRendered:function(t,e){}}),Me.charts.ChartPane=function(t,e,i,n){Me.charts.ChartPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._chart=t,this._legendPane=new Me.charts.LegendPane(t),this._titleDiv=je.createDiv(),this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.whiteSpace="nowrap",this._view=je.createView("hidden"),this._view.appendChild(this._titleDiv),this._view.appendChild(this._legendPane.getView()),this._view.appendChild(this._chart.getView());var o=this;this._legendPane.addPropertyChangeListener(function(t){("rowHeight"===t.property||"orientation"===t.porperty)&&o.invalidate()}),arguments.length>1&&this.setTitle(e),arguments.length>2&&this.setLegendOrientation(i),arguments.length>3&&this.setLegendWidth(n)},Oe.ext("twaver.charts.ChartPane",Me.controls.ControlBase,{__accessor:["title","titleHorizontalAlign","titleHeight","legendWidth"],_title:null,_titleHeight:Rn.CHARTPANE_TITLE_HEIGHT,_titleHorizontalAlign:Rn.CHARTPANE_TITLE_HORIZONTAL_ALIGN,_legendOrientation:Rn.CHARTPANE_LEGEND_ORIENTATION,_legendWidth:Rn.CHARTPANE_LEGEND_WIDTH,getLegendOrientation:function(){return this._legendOrientation},setLegendOrientation:function(t){if(this._legendOrientation!==t){var e=this._legendOrientation;this._legendOrientation=t,this.firePropertyChange("orientation",e,t),this._adjustLegendOrientation()}},_adjustLegendOrientation:function(){this._legendPane.setOrientation("left"===this._legendOrientation||"right"===this._legendOrientation?"vertical":"horizontal")},onPropertyChanged:function(t){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getChart:function(){return this._chart},getLegendPane:function(){return this._legendPane},validateImpl:function(){this._adjustLegendOrientation();var t,e=this._view.offsetWidth,i=this._view.offsetHeight,n=this._legendPane.getRowHeight();this._title&&""!==this._title?(t=this._titleHeight,this._titleDiv.innerHTML=this._title):(t=0,this._titleDiv.innerHTML=""),this._titleDiv.innerHTML=this._title?this._title:"",this._titleDiv.style.textAlign=this._titleHorizontalAlign,this._titleDiv.style.lineHeight=this._titleHeight-2+"px";var o=this._titleDiv.style;o.left="0px",o.top="0px",o.width=e+"px",o.height=t+"px";var s,a;"bottom"===this._legendOrientation?(s={x:0,y:t,width:e,height:Math.max(i-t-n,0)},a={x:0,y:Math.max(i-n,0),width:e,height:n}):"right"===this._legendOrientation?(s={x:0,y:t,width:Math.max(e-this._legendWidth,0),height:Math.max(i-t,0)},a={x:Math.max(e-this._legendWidth,0),y:t,width:this._legendWidth,height:Math.max(i-t,0)}):"top"===this._legendOrientation?(s={x:0,y:t+n,width:e,height:Math.max(i-t-n,0)},a={x:0,y:t,width:e,height:n}):"left"===this._legendOrientation&&(s={x:this._legendWidth,y:t,width:Math.max(e-this._legendWidth,0),height:Math.max(i-t,0)},a={x:0,y:t,width:this._legendWidth,height:Math.max(i-t,0)}),s&&this._chart.adjustBounds(s),a&&this._legendPane.adjustBounds(a)}}),Me.charts.ChartInteraction=function(t){this.chart=t,this.canvas=t._canvas;var e=this;this.canvas.addEventListener("mousedown",function(t){0===t.button&&e.handleMouseDown(t),t.preventDefault()},!1);var i=He.isFirefox?"DOMMouseScroll":"mousewheel";this.canvas.addEventListener(i,function(t){e.handleMouseWheel(t)},!1)},Oe.ext("twaver.charts.ChartInteraction",Object,{handleMouseDown:function(t){this.chart.isFocusOnClick()&&Me.Util.setFocus(this.canvas),this.lastPoint=this.chart.getLogicalPoint(t);var e=this.chart.tryGetDataAt(t);2===t.detail&&null==e?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0)):(this._startLogical=this.lastPoint,this._startClient=je.getClientPoint(t),je.handle_mousedown(this,t))},handleMouseMove:function(t){if(this.lastPoint){var e={x:this._startLogical.x+t.clientX-this._startClient.x,y:this._startLogical.y+t.clientY-this._startClient.y};!this.startPan&&Ze.getDistance(this.lastPoint,e)>3&&(this.startPan=!0,this.lastPoint=e),this.startPan&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+e.x-this.lastPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+e.y-this.lastPoint.y),this.lastPoint=e)}},handleMouseUp:function(t){if(!this.startPan&&1===t.detail){var e=this.chart.tryGetDataAt(t),i=this.chart.getSelectionModel();e?Oe.isCtrlDown(t)?i.contains(e)?i.removeSelection(e):i.appendSelection(e):i.contains(e)||i.setSelection(e):Oe.isCtrlDown(t)||i.clearSelection()}delete this.lastPoint,delete this.startPan,delete this._startClient,delete this._startLogical},handleMouseWheel:function(t){je.preventDefault(t);var e=He.isFirefox?-t.detail:t.wheelDelta;e>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(1.1*this.chart.getXZoom(),!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(1.1*this.chart.getYZoom(),!1)):0>e&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))}}),Me.charts.ChartTouchInteraction=function(t){this.chart=t,this.canvas=t._canvas,je.addEventListener("touchstart","handleTouchstart",this.canvas,this)},Oe.ext("twaver.charts.ChartTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t),this.chart.isFocusOnClick()&&Me.Util.setFocus(this.canvas),this.endPoint=this.chart.getLogicalPoint(t),bi.isMultiTouch(t)&&(this.distance=bi.getDistance(t),this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom()),je.addEventListener("touchmove","handleTouchmove",this.canvas,this),je.addEventListener("touchend","handleTouchend",this.canvas,this)},handleTouchmove:function(t){if(je.preventDefault(t),this.endPoint){var e=this.chart.getLogicalPoint(t);if(!this.moved&&Ze.getDistance(this.endPoint,e)>10&&(this.moved=!0,this.lastPoint=e),this.moved)if(bi.isSingleTouch(t))this.endPoint&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+e.x-this.endPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+e.y-this.endPoint.y),this.endPoint=e);else if(this.distance){var i=bi.getDistance(t)/this.distance,n=this.xZoom*i,o=this.yZoom*i;this.chart.isXZoomEnabled()&&this.chart.setXZoom(n,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(o,!1)}}},handleTouchend:function(t){if(je.preventDefault(t),!this.moved){this.endPoint=this.chart.getLogicalPoint(t);var e=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;e?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date);var i=this.chart.tryGetDataAt(t);if(e&&null==i)this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0));else{var n=this.chart.getSelectionModel();i?n.contains(i)||n.setSelection(i):n.clearSelection()}}delete this.endPoint,delete this.distance,delete this.xZoom,delete this.yZoom,delete this.moved,je.removeEventListener("touchmove",this.canvas,this),je.removeEventListener("touchend",this.canvas,this)}}),Me.charts.ChartMSTouchInteraction=function(t){this.chart=t,this.canvas=t._canvas,this._pointerMap={},this._pointerIdArray=[],je.addEventListener("MSPointerDown","handleTouchstart",this.canvas,this),je.addEventListener("MSPointerMove","handleTouchmove",this.canvas,this),je.addEventListener("MSPointerUp","handleTouchend",this.canvas,this),je.addEventListener("MSPointerCancel","handleTouchend",this.canvas,this);var e=He.isFirefox?"DOMMouseScroll":"mousewheel";this.canvas.addEventListener(e,function(t){self.handleMouseWheel(t)},!1)},Oe.ext("twaver.charts.ChartMSTouchInteraction",Object,{handleTouchstart:function(t){this.chart.isFocusOnClick()&&Me.Util.setFocus(this.canvas);var e=this.chart.getLogicalPoint(t);t.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[t.pointerId]&&e&&(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t);var i=this.chart.tryGetDataAt(t);if(1==this._pointerIdArray.length&&e){var n=this._startTouchPoint&&this._startTouchTime&&(new Date).getTime()-this._startTouchTime.getTime()<=500&&Ze.getDistance(this._startTouchPoint,e)<=10;n&&null==i?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0),this._startTouchPoint=null,this._startTouchTime=null,this._startClientPoint=null):(this._startTouchPoint=e,this._startTouchTime=new Date,this._startClientPoint={x:t.clientX,y:t.clientY},je.handle_mousedown(this,t))}else 2==this._pointerIdArray.length&&(this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom(),this._distance=this._getDistance())},handleTouchmove:function(t){if(0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ze.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=3)&&(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length)){var e=this._getDistance()/this._distance,i=this.xZoom*e,n=this.yZoom*e;this.chart.isXZoomEnabled()&&this.chart.setXZoom(i,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(n,!1)}},handleTouchend:function(t){var e=this.chart.getLogicalPoint(t);if(1==this._pointerIdArray.length&&e&&!this.moved){var i=this.chart.tryGetDataAt(t),n=this._startTouchPoint&&this._startTouchTime&&(new Date).getTime()-this._startTouchTime.getTime()<=500&&Ze.getDistance(this._startTouchPoint,e)<=10,o=this.chart.getSelectionModel();i&&n?Oe.isCtrlDown(t)?o.contains(i)?o.removeSelection(i):o.appendSelection(i):o.contains(i)||o.setSelection(i):Oe.isCtrlDown(t)||o.clearSelection()}this.moved=!1,this._pointerMap={},this._pointerIdArray=[]},handleMouseWheel:function(t){je.preventDefault(t);var e=He.isFirefox?-t.detail:t.wheelDelta;e>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(1.1*this.chart.getXZoom(),!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(1.1*this.chart.getYZoom(),!1)):0>e&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))},handle_mousemove:function(t){if(1==this._pointerIdArray.length&&this._startTouchPoint&&this._startClientPoint){var e={x:this._startTouchPoint.x+(t.clientX-this._startClientPoint.x)/this.chart.getXZoom(),y:this._startTouchPoint.y+(t.clientY-this._startClientPoint.y)/this.chart.getYZoom()};Ze.getDistance(this._startTouchPoint,e)>3&&(this.moved=!0,this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+e.x-this._startTouchPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+e.y-this._startTouchPoint.y),this._startClientPoint.x=t.clientX,this._startClientPoint.y=t.clientY)}},handle_mouseup:function(t){this.handleTouchend(t)},_getDistance:function(){return Ze.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Me.charts.LegendPaneInteraction=function(t){this.legendPane=t;var e=this;this.legendPane._legendDiv.addEventListener("mousedown",function(t){e.handleMouseDown(t)},!1)},Oe.ext("twaver.charts.LegendPaneInteraction",Object,{handleMouseDown:function(t){if(0===t.button){var e=t.target._data;e||(e=t.target.parentNode._data),e&&(this.legendPane._hiddenMap[e.getId()]?delete this.legendPane._hiddenMap[e.getId()]:this.legendPane._hiddenMap[e.getId()]=e,this.legendPane._chart.invalidateModel())}}}),Me.charts.LegendPaneTouchInteraction=function(t){this.legendPane=t,je.addEventListener("touchstart","handleTouchstart",this.legendPane._legendDiv,this)},Oe.ext("twaver.charts.LegendPaneTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t);var e=t.target._data;e||(e=t.target.parentNode._data),e&&(this.legendPane._hiddenMap[e.getId()]?delete this.legendPane._hiddenMap[e.getId()]:this.legendPane._hiddenMap[e.getId()]=e,this.legendPane._chart.invalidateModel())}}),Me.network.Network=function(t){Me.network.Network.superClass.constructor.apply(this,arguments),this._elementUIMap={},this._layerMap={},this._layerList=new fn,this._view=je.createView("auto"),this._rootDiv=je.createDiv(),this._topDiv=je.createDiv(),this._attachmentDiv=je.createDiv(),this._layersDiv=je.createDiv(),this._bottomDiv=je.createDiv(),this._rootDiv.appendChild(this._bottomDiv),this._rootDiv.appendChild(this._layersDiv),this._rootDiv.appendChild(this._attachmentDiv),this._rootDiv.appendChild(this._topDiv),this._view.appendChild(this._rootDiv),this.setElementBox(t?t:new Me.ElementBox),He.isTouchable?He.isMSTouchable?this.setMSTouchInteractions():this.setTouchInteractions():this.setDefaultInteractions(!1);var e=this;this._flowLink=function(){if(!(e.isMovingElement()||e.isSelectingElement()||e.isEditingElement()||e._box._layoutMovingElements)){e._flowLinkQuickFinder||(e._flowLinkQuickFinder=new Me.QuickFinder(e._box,"link.flow","style"));var t=e._flowLinkQuickFinder.find(!0);t.forEach(function(t){t._styleMap["link.flow.offset"]=e.getLinkFlowOffset(t);var i=e.getElementUI(t);i.drawBody()})}},this.setToolTipEnabled(Rn.NETWORK_TOOLTIP_ENABLED),this._view.addEventListener("scroll",function(t){gi.twm(e)}),this.addPropertyChangeListener(function(t){"zoom"===t.property&&gi.twm(e)}),Me.imageUtil.addEventListener(this.invalidateElementUIs,this)},Oe.ext("twaver.network.Network",Me.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","selectionTolerance"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable"],_viewRect:{x:0,y:0,width:0,height:0},_currentSubNetwork:null,_selectMode:Rn.NETWORK_SELECT_MODE,_noAgentLinkVisible:Rn.NETWORK_NO_AGENT_LINK_VISIBLE,_makeVisibleOnSelected:Rn.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Rn.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Rn.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:Rn.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_subNetworkAnimate:Rn.NETWORK_SUBNETWORK_ANIMATE,_transparentSelectable:Rn.NETWORK_TRANSPARENT_SELECTABLE,_removeElementUIOnInvisible:Rn.NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE,_elementUIFunction:Rn.ELEMENTUI_FUNCTION,_doubleClickToUpSubNetwork:Rn.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:Rn.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:Rn.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:Rn.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:Rn.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_sendToTopOnSelected:Rn.NETWORK_SENDTOTOP_ON_SELECTED,_selectOutlineColor:Rn.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:Rn.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:Rn.NETWORK_SELECT_FILL_COLOR,_lazyMoveOutlineColor:Rn.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:Rn.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:Rn.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:Rn.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:Rn.NETWORK_LAZYMOVE_ANIMATE,_editPointSize:Rn.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:Rn.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:Rn.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:Rn.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:Rn.NETWORK_EDIT_LINE_COLOR,_editLineWidth:Rn.NETWORK_EDIT_LINE_WIDTH,_resizePointSize:Rn.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:Rn.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:Rn.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:Rn.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:Rn.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:Rn.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:Rn.NETWORK_RESIZE_ANIMATE,_rotatePointSize:Rn.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:Rn.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:Rn.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:Rn.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:Rn.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:Rn.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:Rn.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:Rn.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:Rn.NETWORK_ROTATE_SCALE_FONT_COLOR,_limitElementInPositiveLocation:Rn.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_linkFlowInterval:Rn.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:Rn.NETWORK_SELECTION_TOLERANCE,_invalidate:!1,_invalidateElementVisibility:!1,_invalidateElementIndex:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_transparentSelectionEnable:Me.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,getLabel:function(t){return t.getStyle("network.label")||t.getName()},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(t){if(this._toolTipEnabled=t,t){if(!this._toolTipListener){var e=this;this._toolTipListener=function(t){var i=e.getElementAt(t);if(e._preElement!==i)if(e._preElement=i,i){var n=e.getToolTip(i);Si.showToolTip({x:t.pageX,y:t.pageY},n);var o=Si.getToolTipDiv();if(o.children.length>0){var s=e._view.getBoundingClientRect(),a=o.getBoundingClientRect();a.width+a.left>s.width+s.left&&(o.style.left=s.width+s.left-a.width+(Ve.documentElement.scrollLeft||Ve.body.scrollLeft)+"px"),a.height+a.top>s.height+s.top&&(o.style.top=s.height+s.top-a.height+(Ve.documentElement.scrollTop||Ve.body.scrollTop)+"px")}}else Si.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Si.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(t){t?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(t){var e=this._linkFlowInterval;this._linkFlowInterval=t,this.firePropertyChange("linkFlowInterval",e,t),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getTopDiv:function(){return this._topDiv},getAttachmentDiv:function(){return this._attachmentDiv},getLayersDiv:function(){return this._layersDiv},getBottomDiv:function(){return this._bottomDiv},validateImpl:function(){if(gi.twm(this),this.__lics__){var t=0,e=null,i=null,n=null,o=this._invalidateElementVisibility;if(this._invalidateElementVisibility&&(this._invalidateElementVisibility=!1,this._removeElementUIOnInvisible&&(this._invalidateElementIndex=!0),this.forEachElementUI(function(o){o.validate();var s=o.getElement();if(o.setVisible(this.isVisible(s)),this._removeElementUIOnInvisible){if(e=this.getLayerDivByElement(s),o.isVisible()){if(o.getView().parentNode!==e)for(e.appendChild(o.getView()),i=o.getAttachments(),t=0;t<i.size();t++)n=i.get(t),n.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(n.getView())}else if(o.getView().parentNode===e)for(e.removeChild(o.getView()),i=o.getAttachments(),t=0;t<i.size();t++)n=i.get(t),n.isShowInAttachmentDiv()&&this._attachmentDiv.removeChild(n.getView())}else if(!o.getView().parentNode)for(e=this.getLayerDivByElement(s),e.appendChild(o.getView()),i=o.getAttachments(),t=0;t<i.size();t++)n=i.get(t),n.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(n.getView())},null,this)),this._invalidateElementIndex){this._invalidateElementIndex=!1;var s,a=this;this._box.getLayerBox().forEachByDepthFirst(function(t){var e,i=a._layerMap[t.getId()];a._box.forEachByLayer(function(t){var n=a._elementUIMap[t.getId()];if(n&&n.getView().parentNode===i){e=je.insertAfter(n.getView(),e);for(var o=n.getAttachments(),r=0;r<o.size();r++){var h=o.get(r);h.getView().parentNode===a._attachmentDiv&&(s=je.insertAfter(h.getView(),s))}}},t)})}if(o&&!this._invalidateElementVisibility){var r;for(var h in this._elementUIMap){var l=this._elementUIMap[h];l.isVisible()&&(r=Ze.unionRect(r,l.getViewRect()))}if(r=r?{x:0,y:0,width:r.x+r.width,height:r.y+r.height}:{x:0,y:0,width:0,height:0},r.x!==this._viewRect.x||r.y!==this._viewRect.y||r.width!==this._viewRect.width||r.height!==this._viewRect.height){var c=this._viewRect;this._viewRect=r,this._rootDiv.style.left="0px",this._rootDiv.style.top="0px",this._rootDiv.style.width=r.width+"px",this._rootDiv.style.height=r.height+"px",this.firePropertyChange("viewRect",c,r)}}}},setInteractions:function(t){var e=this._interactions;e&&e.forEach(function(t){t.tearDown()}),this._interactions=t,t&&t.forEach(function(t){t.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",e,t)},getInteractions:function(){return this._interactions},upSubNetwork:function(t,e){this._currentSubNetwork&&this.setCurrentSubNetwork(xi.getSubNetwork(this._currentSubNetwork),t,e)},sendToTop:function(t){if(this.isVisible(t)){for(var e=t;this.isVisible(e.getParent())&&(e=e.getParent()););e!==t&&this._box.adjustElementIndex(e),this._box.adjustElementIndex(t)}},invalidateElementIndex:function(){this._invalidateElementIndex||(this._invalidateElementIndex=!0,this.invalidate())},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},updateLayers:function(){je.clear(this._layersDiv),je.clear(this._attachmentDiv),this._layerMap={},this._layerList.clear();var t=this;this._box.getLayerBox().forEachByDepthFirst(function(e){var i=je.createDiv();je.setVisible(i,e.isVisible()),t._layerMap[e.getId()]=i,t._layersDiv.appendChild(i),t._layerList.add(e)}),this._box.forEach(this.createElementUI,this)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(t,e,i){var n=Me.animate.AnimateManager;if(n.endAnimate(),e){if(this._currentSubNetwork===t)return;if(t&&!this._box.contains(t))throw t+" is not contained in this network's elementBox";n.start(new Me.animate.AnimateSubNetwork(this,t,i))}else this._setCurrentSubNetwork(t),i&&i()},_setCurrentSubNetwork:function(t){if(this._currentSubNetwork!==t){if(t&&!this._box.contains(t))throw t+" is not contained in this network's elementBox";var e=this._currentSubNetwork;this._currentSubNetwork=t,this.firePropertyChange("currentSubNetwork",e,t),this.invalidateElementVisibility()}},isVisible:function(t){if(!this._box.contains(t))return!1;if(!t.isVisible())return!1;if(this._visibleFunction&&!this._visibleFunction(t))return!1;if(!this._box.getLayerBox().getLayerByElement(t).isVisible())return!1;if(xi.getSubNetwork(t)!==this._currentSubNetwork)return!1;if(t instanceof Me.Link){if(!this.isNoAgentLinkVisible()){if(!t.getFromAgent()||!t.getToAgent())return!1;if(!this.isVisible(t.getFromAgent())||!this.isVisible(t.getToAgent()))return!1}if(t.getBundleIndex()>0&&t.getBundleCount()>1&&!t.getStyle("link.bundle.expanded"))return!1}else for(var e=t.getParent();e&&!e.ISubNetwork;){if(e instanceof Un&&(!e.isExpanded()||!this.isVisible(e)))return!1;e=e.getParent()}return t.IDummy?!1:!0},isMovable:function(t){return this._box.contains(t)?t instanceof Me.Link?!1:this._movableFunction&&!this._movableFunction(t)?!1:this._box.getLayerBox().getLayerByElement(t).isMovable():!1},isEditable:function(t){return this._box.contains(t)?this._editableFunction&&!this._editableFunction(t)?!1:this._box.getLayerBox().getLayerByElement(t).isEditable():!1},isRotatable:function(t){return this._rotatableFunction&&!this._rotatableFunction(t)?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(t){var e=this._visibleFunction;this._visibleFunction=t,this.firePropertyChange("visibleFunction",e,t),this.invalidateElementVisibility()},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(t){var e=this._editableFunction;this._editableFunction=t,this.firePropertyChange("editableFunction",e,t),this.invalidateSelectedElementUIs(!0)},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(t){var e=this._rotatableFunction;this._rotatableFunction=t,this.firePropertyChange("rotatableFunction",e,t),this.invalidateSelectedElementUIs(!0)},isLinkable:function(t){return null==this._linkableFunction||this._linkableFunction(t)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(t){var e=this._linkableFunction;this._linkableFunction=t,this.firePropertyChange("linkableFunction",e,t),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getElementBox:function(){return this._box},setElementBox:function(t){if(!t)throw"ElementBox can not be null";if(this._box!==t){var e=this._box;e&&(e.removeDataBoxChangeListener(this.handleElementBoxChange,this),e.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),e.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),e.removeIndexChangeListener(this.handleIndexChange,this),e.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),e.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),e.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=t,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new Me.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(t):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this.updateLayers(),this.invalidateElementVisibility(),this.firePropertyChange("elementBox",e,this._box)}},invalidateElementUI:function(t,e){var i=this.getElementUI(t);i&&i.invalidate(e)},invalidateElementUIs:function(t){for(var e in this._elementUIMap){var i=this._elementUIMap[e];i.invalidate(t)}},invalidateSelectedElementUIs:function(t){this.getSelectionModel().getSelection().forEach(function(e){this.invalidateElementUI(e,t)},this)},getElementUI:function(t){return t?this._elementUIMap[t.getId()]:null},getLayerDivByElement:function(t){var e=this._box.getLayerBox().getLayerByElement(t);return e?this._layerMap[e.getId()]:null},createElementUI:function(t){var e=this._elementUIMap[t.getId()];if(e||(e=this._elementUIFunction(this,t),e&&(this._elementUIMap[t.getId()]=e)),e){var i=this.getLayerDivByElement(t);e.getView().parentNode!==i&&(i.appendChild(e.getView()),e.getAttachments().forEach(function(t){t.isShowInAttachmentDiv()&&t.getView().parentNode!==this._attachmentDiv&&this._attachmentDiv.appendChild(t.getView())},this)),this.invalidateElementIndex()}},invalidateBundleLink:function(t){if(t instanceof Me.Link&&t._bundleLinks){var e=this._elementUIMap;t._bundleLinks.forEachSiblingLink(function(i){if(i!==t){var n=e[i._id];n&&n.invalidate(!1)}},this)}},handleLayerBoxChange:function(t){this.updateLayers(),this.invalidateElementVisibility()},handleLayerPropertyChange:function(t){var e=t.source;if("visible"===t.property){var i=this._layerMap[e.getId()];je.setVisible(i,e.isVisible())}else"editable"===t.property&&this.invalidateSelectedElementUIs(!0);this.invalidateElementVisibility()},handleLayerHierarchyChange:function(t){var e;this._layerList.clear(),this._box.getLayerBox().forEachByDepthFirst(function(t){var i=this._layerMap[t.getId()];e=je.insertAfter(i,e),this._layerList.add(t)},null,this),this.invalidateElementVisibility()},handleSelectionChange:function(t){t.datas.forEach(function(e){var i=this.getElementUI(e);i&&i.handleSelectionChange(t)},this),this.invalidateElementVisibility();var e=this.getSelectionModel().getLastData();e&&("append"===t.kind||"set"===t.kind)&&(this.isMakeVisibleOnSelected()&&this.makeVisible(e),this.isSendToTopOnSelected()&&this.sendToTop(e))},makeVisible:function(t){var e=this.getElementUI(t);if(e){var i=xi.getSubNetwork(t);if(i!==this._currentSubNetwork){var n=this;return void this.setCurrentSubNetwork(i,this.isSubNetworkAnimate(),function(){Oe.callLater(n.makeVisible,n,[t])})}for(var o=t;(o=o.getParent())&&o!==i;)o instanceof Un&&o.setExpanded(!0);var s=e.getUnionBodyBounds();if(s){var a={x:this._view.scrollLeft/this._zoom,y:this._view.scrollTop/this._zoom,width:this._view.clientWidth/this._zoom,height:this._view.clientHeight/this._zoom};Ze.intersects(a,s)||this.isVisible(t)&&Oe.callLater(this.centerByLogicalPoint,this,[s.x+s.width/2,s.y+s.height/2])}}},handleElementBoxChange:function(t){var e=t.data;if("add"===t.kind)this.createElementUI(e),this.invalidateBundleLink(e);else if("remove"===t.kind){var i=this.getElementUI(e);if(i){var n=this._box.getLayerBox().getLayerByElement(e),o=this._layerMap[n.getId()];i.getView().parentNode===o&&o.removeChild(i.getView()),i.dispose(),delete this._elementUIMap[e.getId()]}e===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null)}else"clear"===t.kind&&(this.forEachElementUI(function(t){t.dispose()}),this._elementUIMap={},this.updateLayers(),null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null));this.invalidateElementVisibility()},handleElementPropertyChange:function(t){var e=t.source,i=this.getElementUI(e);if(i&&(i.handlePropertyChange(t),"layerId"===t.property)){var n=this._box.getLayerBox().getLayerByElement(e),o=this._layerMap[n.getId()];i.getView().parentNode!==o&&(o.appendChild(i.getView()),this.invalidateElementIndex())}this.invalidateBundleLink(e),this.invalidateElementVisibility()},handleElementBoxPropertyChange:function(t){this.invalidateElementVisibility()},handleIndexChange:function(t){this.invalidateElementIndex()},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(t){if(!t)throw"ElementUIFunction can not be null";if(this._elementUIFunction!==t){var e=this._elementUIFunction;this._elementUIFunction=t,this.firePropertyChange("elementUIFunction",e,t),this._box.isEmpty()||this.updateLayers()}},getIconsNames:function(t){return t.getStyle("icons.names")},getIconsColors:function(t){return t.getStyle("icons.colors")},getLinkHandlerLabel:function(t){return t.isBundleAgent()?"+("+t.getBundleCount()+")":null},getSelectColor:function(t){return t.getStyle("select.color")},getShadowColor:function(t){var e=t.getStyle("shadow.color");return!e&&this.isSelected(t)&&"shadow"===t.getStyle("select.style")?t.getStyle("select.color"):e},getAlarmLabel:function(t){var e=t.getAlarmState().getHighestNewAlarmSeverity();if(e){var i=t.getAlarmState().getNewAlarmCount(e)+e.nickName;return t.getAlarmState().hasLessSevereNewAlarms()&&(i+="+"),i}return null},isRemoveElementUIOnInvisible:function(){return this._removeElementUIOnInvisible},setRemoveElementUIOnInvisible:function(t){var e=this._removeElementUIOnInvisible;this._removeElementUIOnInvisible=t,this.firePropertyChange("removeElementUIOnInvisible",e,t),this.invalidateElementVisibility()},setDefaultInteractions:function(t,e){var i=[new Me.network.interaction.SelectInteraction(this),new Me.network.interaction.MoveInteraction(this,t),new Me.network.interaction.DefaultInteraction(this)];e&&i.push(new Me.network.interaction.MoveLinkInteraction(this,t)),this.setInteractions(i)},setPanInteractions:function(){this.setInteractions([new Me.network.interaction.PanInteraction(this),new Me.network.interaction.DefaultInteraction(this)])},setEditInteractions:function(t,e){var i=[new Me.network.interaction.SelectInteraction(this),new Me.network.interaction.EditInteraction(this,t),new Me.network.interaction.MoveInteraction(this,t),new Me.network.interaction.DefaultInteraction(this)];e&&i.push(new Me.network.interaction.MoveLinkInteraction(this,t)),this.setInteractions(i)},setCreateElementInteractions:function(t){this.setInteractions([new Me.network.interaction.CreateElementInteraction(this,t),new Me.network.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(t){this.setInteractions([new Me.network.interaction.CreateLinkInteraction(this,t),new Me.network.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(t){this.setInteractions([new Me.network.interaction.CreateShapeLinkInteraction(this,t),new Me.network.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(t){this.setInteractions([new Me.network.interaction.CreateShapeNodeInteraction(this,t),new Me.network.interaction.DefaultInteraction(this)])},setTouchInteractions:function(){var t=[new Me.network.interaction.SelectInteraction(this),new Me.network.interaction.MoveInteraction(this,!1),new Me.network.interaction.DefaultInteraction(this),new Me.network.interaction.TouchInteraction(this)];this.setInteractions(t)},setMSTouchInteractions:function(){this.setInteractions([new Me.network.interaction.MSTouchInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new Me.network.interaction.SelectInteraction(this),new Me.network.interaction.MoveInteraction(this),new Me.network.interaction.DefaultInteraction(this),new Me.network.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(t){var e=this._hasEditInteraction;this._hasEditInteraction=t,this.firePropertyChange("hasEditInteraction",e,t)},moveSelectedElements:function(t,e,i,n){if(0!==t||0!==e){var o=this.getMovableSelectedElementsRect();null!=o&&(this._limitElementInPositiveLocation&&(o.x+t<0&&(t=-o.x),o.y+e<0&&(e=-o.y)),Me.Util.moveElements(this.getMovableSelectedElements(),t,e,i,n,this))}},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(t){return this.isMovable(t)},this)},hasMovableSelectedElements:function(){for(var t=this.getSelectionModel().getSelection(),e=0;e<t.size();e++){var i=t.get(e);if(this.isMovable(i))return!0}return!1},getMovableSelectedElementsRect:function(){var t=this.getMovableSelectedElements();if(0===t.size())return null;for(var e=null,i=0,n=t.size();n>i;i++){var o=t.get(i);if(o instanceof Fn){var s=this.getElementUI(o);s&&(e=Ze.unionRect(e,s.getViewRect()))}}return e},getLayerByElement:function(t){return this._box.getLayerBox().getLayerByElement(t)},getPosition:function(t,e,i,n,o){var s,a=e instanceof Me.network.ElementUI?e:this.getElementUI(e);if(a)if("from"===t||"to"===t){if(a.getFromPosition&&(s="from"===t?a.getFromPosition(n,o):a.getToPosition(n,o)))return{x:s.x-i.width/2,y:s.y-i.height/2}}else s="hotspot"===t?a.getHotSpot():Xe.get(t,a.getBodyRect(),i);if(!s&&e.getRect&&(s=Xe.get(t,e.getRect(),i)),s)return{x:s.x+n,y:s.y+o};throw"position '"+t+"' object '"+e+"'"},getViewRect:function(){return this._viewRect?Oe.clone(this._viewRect):{x:0,y:0,width:0,height:0}},forEachElementUI:function(t,e,i){e?this._box.forEachReverse(function(n){if(this.getLayerByElement(n)===e){var o=this.getElementUI(n);o&&(i?t.call(i,o):t(o))}},this):this._layerList.forEachReverse(function(e){this.forEachElementUI(t,e,i)},this)},findFirstElement:function(t,e){for(var i=this._layerList.size()-1,n=this._box.size()-1,o=i;o>=0;o--)for(var s=this._layerList.get(o),a=n;a>=0;a--){var r=this._box.getDataAt(a);if(this.getLayerByElement(r)===s)if(e){if(t.call(e,r)===!0)return r}else if(t(r)===!0)return r}return null},getElementAt:function(t,e){if(1===arguments.length&&(e=!0),!this.isValidEvent(t))return null;t=this._getPoint(t),t||console.log("null");var i=t.x,n=t.y,o=this._selectionTolerance;if(o&&o>0){var s={x:i,y:n,width:0,height:0};Ze.grow(s,o,o)}return this.findFirstElement(function(t){if(e&&!this.isSelectable(t))return!1;var o=this.getElementUI(t);return o?s?!!o.intersectsTest(s):!!o.hitTest(i,n):!1},this)},_getPoint:function(t){return t?t.target?this.getLogicalPoint(t):t:null},getElementsAtRect:function(t,i,n,o){var s=new fn;return o=o===e?!0:o,this.forEachElementUI(function(e){e.isVisible()&&(!n||n(e._element))&&(o&&this.isSelectable(e._element)||!o)&&(i?e.intersectsTest(t)&&s.add(e._element):Ze.contains(t,e.getViewRect())&&s.add(e._element))},null,this),s},hitTest:function(t){var e=this.getElementAt(t);if(!e)return null;var i=this.getElementUI(e);return i?(t=this._getPoint(t),i.hitTest(t.x,t.y)):null},addElementByInteraction:function(t){t.getParent()||t.setParent(this._currentSubNetwork),this._box.add(t),this.getSelectionModel().setSelection(t),this.fireInteractionEvent({kind:"createElement",element:t})},getLinkFlowStepping:function(t){var e=parseInt(t.getStyle("link.flow.stepping"));return e||(e=Rn.NETWORK_LINK_FLOW_STEPPING),e},getLinkFlowOffset:function(t){var e=t.getStyle("link.flow.offset");return isNaN(e)&&(e=0),e+this.getLinkFlowStepping(t)},toCanvas:function(t,e,i){i||(i=je.createCanvas()),i.setAttribute("width",t),i.setAttribute("height",e),i._viewRect?(i._viewRect.width=t,i._viewRect.height=e):i._viewRect={x:0,y:0,width:t,height:e};var n=i.getContext("2d");if(n.clearRect(0,0,t,e),0===this._view.clientWidth||0===this._view.clientHeight)return i;var o=t/this._view.scrollWidth*this._zoom,s=e/this._view.scrollHeight*this._zoom;return n.scale(o,s),je.forEach(this._view,function(t){if(("CANVAS"===t.tagName||"IMG"===t.tagName)&&!t._isIgnored){var e=t._viewRect;if(e)try{n.drawImage(t,e.x,e.y,e.width,e.height)}catch(t){}}}),i},toCanvasByRegion:function(t,e,i){i||(i=je.createCanvas());var n=t.width*e,o=t.height*e;i.setAttribute("width",n),i.setAttribute("height",o);var s=i.getContext("2d");return s.clearRect(0,0,n,o),0===this._view.clientWidth||0===this._view.clientHeight?i:(s.save(),s.scale(e,e),je.forEach(this._view,function(e){if(("CANVAS"===e.tagName||"IMG"===e.tagName)&&!e._isIgnored){var i=e._viewRect;if(i&&Ze.intersects(i,t))try{s.drawImage(e,i.x-t.x,i.y-t.y,i.width,i.height)}catch(e){}}}),s.restore(),i)},getGroupChildrenRects:function(t){var e=new fn;return t.getChildren().forEach(function(t){if(t instanceof Fn){var i=this.getElementUI(t);if(i){var n=i.getViewRect();n&&e.add(n)}}},this),e},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(t){var e=this._linkPathFunction;this._linkPathFunction=t,this.firePropertyChange("linkPathFunction",e,t),this.invalidateElementUIs()},onClickElement:function(t,e){},onClickBackground:function(t){},onDoubleClickElement:function(t,e){},onDoubleClickBackground:function(t){},onLongClickElement:function(t,e){},onLongClickBackground:function(t){},onMouseMove:function(t,e){},onMouseEnter:function(t,e){},onMouseLeave:function(t,e){},setMovingElement:function(t){if(t!=this._movingElement){var e=this._movingElement;this._movingElement=t,this.firePropertyChange("movingElement",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},setEditingElement:function(t){if(t!=this._editingElement){var e=this._editingElement;this._editingElement=t,this.firePropertyChange("editingElement",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},dispose:function(){Me.imageUtil.removeEventListener(this.invalidateElementUIs,this)}}),Me.network.Overview=function(t){Me.network.Overview.superClass.constructor.apply(this,arguments),this._view=je.createView(),this._rootDiv=je.createDiv(),this._imageCanvas=je.createCanvas(),this._imageDiv=je.createDiv(),this._maskCanvas=je.createCanvas(),this._selectDiv=je.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,je.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this.setNetwork(t),He.isTouchable?He.isMSTouchable?new Me.network.OverviewMSTouchInteraction(this):(new Me.network.OverviewTouchInteraction(this),new Me.network.OverviewInteraction(this)):new Me.network.OverviewInteraction(this)},Oe.ext("twaver.network.Overview",Me.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:Rn.OVERVIEW_FILL_COLOR,_outlineColor:Rn.OVERVIEW_OUTLINE_COLOR,_outlineWidth:Rn.OVERVIEW_OUTLINE_WIDTH,_selectColor:Rn.OVERVIEW_SELECT_COLOR,_selectWidth:Rn.OVERVIEW_SELECT_WIDTH,_padding:Rn.OVERVIEW_PADDING,_animate:Rn.OVERVIEW_ANIMATE,_maxPackingWidth:Rn.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:Rn.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(t){this._invalidateMask()},setNetwork:function(t){t!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),je.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=t,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),je.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate())},_handleNetworkPropertyChange:function(t){("zoom"===t.property||"currentSubNetwork"===t.property||"elementBox"===t.property||"dataBox"===t.property)&&this.invalidate()},_handleNetworkViewChange:function(t){"validateEnd"===t.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(t){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),Oe.callLater(this.validate,this,null,t))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,Oe.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network._view.clientWidth&&0!==this._network._view.clientHeight){var t,e=this._maxPackingWidth>0&&this._maxPackingHeight>0;t=e?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},Ze.grow(t,-this._padding,-this._padding);var i=Math.min(t.width/this._network._view.scrollWidth,t.height/this._network._view.scrollHeight);e&&(je.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),t.width=this._imageDiv._viewRect.width,t.height=this._imageDiv._viewRect.height);var n=this._network._view.scrollWidth*i,o=this._network._view.scrollHeight*i,s=t.x+(t.width-n)/2,a=t.y+(t.height-o)/2;if(this._isNetworkDirty){var r={x:s,y:a,width:n,height:o};this._network.toCanvas(r.width,r.height,this._imageCanvas),je.setDiv(this._imageDiv,r,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var h={x:this._network._view.scrollLeft*i,y:this._network._view.scrollTop*i,width:n*this._network._view.clientWidth/this._network._view.scrollWidth,height:o*this._network._view.clientHeight/this._network._view.scrollHeight},l=je.setCanvas(this._maskCanvas,s,a,n,o);l.lineWidth=0,l.fillStyle=this._fillColor,l.beginPath(),Ke.drawVector(l,"rectangle",null,s,a,n,o),l.fill(),l.clearRect(s+h.x,a+h.y,h.width,h.height);var c=this._outlineWidth<0?0:this._outlineWidth;l.lineWidth=c,l.strokeStyle=this._outlineColor,l.beginPath(),Ke.drawVector(l,"rectangle",null,s+h.x+c,a+h.y+c,h.width-2*c,h.height-2*c),c>=0&&l.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(t){return je.getLogicalPoint(this._view,t,1,this._rootDiv)},centerNetwork:function(t,e){var i=this._imageDiv._viewRect;Ze.containsPoint(i,t)&&(this._network.centerByLogicalPoint((t.x-i.x)/i.width*this._network._view.scrollWidth/this._network.getZoom(),(t.y-i.y)/i.height*this._network._view.scrollHeight/this._network.getZoom(),e),this._invalidateMask())}}),Me.network.OverviewTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,je.addEventListener("touchstart","handleTouchstart",this.view,this)},Oe.ext("twaver.network.OverviewTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t),this.clear(),this.endPoint=this.overview.getLogicalPoint(t),bi.isMultiTouch(t)&&(this.distance=bi.getDistance(t),this.zoom=this.network.getZoom()),je.addEventListener("touchmove","handleTouchmove",this.view,this),je.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(t){if(je.preventDefault(t),this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(t),bi.isSingleTouch(t))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var e=bi.getDistance(t)/this.distance;this.network.setZoom(this.zoom*e,!1)}},handleTouchend:function(t){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(t);var e=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;e?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),e?Oe.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,je.removeEventListener("touchmove",this.view,this),je.removeEventListener("touchend",this.view,this)),this.moved=!1}}),Me.network.OverviewInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,je.addEventListener("mousedown","handleMousedown",this.view,this)},Oe.ext("twaver.network.OverviewInteraction",Object,{handleMousedown:function(t){0===t.button&&(this.clear(),this.endPoint=this.overview.getLogicalPoint(t),Oe.isCtrlDown(t)&&(this.startPoint=this.endPoint,je.setVisible(this.overview._selectDiv,!0)),je.addEventListener("mousemove","handleMousemove",this.view,this),je.addEventListener("mouseup","handleMouseup",this.view,this))},handleMouseup:function(t){if(this.endPoint=this.overview.getLogicalPoint(t),"detail"in t&&2===t.detail)Oe.callLater(this.network.zoomReset,this.network,[this.overview._animate]);else if(je.isVisible(this.overview._selectDiv)&&this.startPoint){var e=this.overview._imageDiv._viewRect,i=this.overview._selectDiv._viewRect.x,n=this.overview._selectDiv._viewRect.y,o=e.width/this.overview._selectDiv._viewRect.width,s=e.height/this.overview._selectDiv._viewRect.height,a=Math.min(o,s),r=this.network._view.scrollWidth/this.network.getZoom()*((i-e.x+this.overview._selectDiv._viewRect.width/2)/e.width),h=this.network._view.scrollHeight/this.network.getZoom()*((n-e.y+this.overview._selectDiv._viewRect.height/2)/e.height);this.network.setZoom(a*Math.min(this.network._view.clientWidth/this.network._view.scrollWidth,this.network._view.clientHeight/this.network._view.scrollHeight)*this.network.getZoom(),!1),Oe.callLater(this.network.centerByLogicalPoint,this.network,[r,h,this.overview._animate]),je.setVisible(this.overview._selectDiv,!1),je.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(t){var e=this.overview.getLogicalPoint(t);if(this.endPoint=e,je.isVisible(this.overview._selectDiv)&&this.startPoint){var i=e.x>this.startPoint.x?this.startPoint.x:e.x,n=e.x>this.startPoint.x?this.startPoint.y:e.y;e.x>this.startPoint.x&&e.y<this.startPoint.y&&(n=e.y),e.x<this.startPoint.x&&e.y>this.startPoint.y&&(n=this.startPoint.y);var o=this.overview._imageDiv._viewRect;i<o.x&&(i=o.x),i>o.x+o.width&&(i=o.x+o.width),n<o.y&&(n=o.y),n>o.y+o.height&&(n=o.y+o.height);var s=Math.abs(e.x-this.startPoint.x),a=Math.abs(e.y-this.startPoint.y);i+s>o.x+o.width&&(s=o.x+o.width-i),n+a>o.y+o.height&&(a=o.y+o.height-n),je.setDiv(this.overview._selectDiv,{x:i,y:n,width:s,height:a},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(e,!1)},clear:function(){this.endPoint&&(this.endPoint=null,je.removeEventListener("mousemove",this.view,this),je.removeEventListener("mouseup",this.view,this))}}),Me.network.OverviewMSTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,this._pointerMap={},this._pointerIdArray=[],je.addEventListener("MSPointerDown","handleTouchstart",this.view,this),je.addEventListener("MSPointerMove","handleTouchmove",this.view,this),je.addEventListener("MSPointerUp","handleTouchend",this.view,this),je.addEventListener("MSPointerCancel","handleTouchend",this.view,this)},Oe.ext("twaver.network.OverviewMSTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t),t.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[t.pointerId]&&this.overview.getLogicalPoint(t)&&(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(t),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(t){if(0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ze.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10))if(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length){var e=this._getDistance()/this._distance;this.network.setZoom(this._zoom*e,!1)}else if(1==this._pointerIdArray.length&&this._startTouchPoint){var i=this.overview.getLogicalPoint(t);if(null==i)return;this._startTouchPoint=i,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(t){var e=this.overview.getLogicalPoint(t);if(1==this._pointerIdArray.length&&e){var i=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&Ze.getDistance(this._endTouchPoint,e)<=10;i?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=e,this._endTouchTime=new Date),i?Oe.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Ze.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Me.network.ElementUI=function(t,e){this._view=je.createDiv(),this._bodyView=je.createDiv(),this._view.appendChild(this._bodyView),this._network=t,this._element=e,this._attachments=new fn,this._bodyBounds=new fn,this.invalidate(!0)},Oe.ext("twaver.network.ElementUI",Object,{_invalidateFlag:!1,_invalidateAttachmentsFlag:!1,getElement:function(){return this._element},getNetwork:function(){return this._network},getAttachments:function(){return this._attachments},getStyle:function(t){return this._element.getStyle(t)},getFont:function(t){var e=this._element.getStyle(t);return e?e:Rn.FONT},getDyeColor:function(t){return this._innerColor?this._innerColor:this.getStyle(t)},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},getHotSpot:function(){return this._hotSpot?Oe.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(t){this._hotSpot=t},getUnionBodyBounds:function(){return Oe.clone(this._unionBodyBounds)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),Oe.clone(this._bodyRect)},invalidate:function(t){t===e&&(t=!0),t&&(this._invalidateAttachmentsFlag=!0),this._invalidateFlag||(this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility())},updateMeasure:function(){},validate:function(){if(this._invalidateFlag){this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this._bodyBounds.clear(),je.clear(this._bodyView),this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this.updateMeasure();var t=this._element.getStyle("whole.alpha");this._view.style.opacity=t,this._attachments.forEach(function(e){e.updateMeasure();var i=e.getAlpha();e._view.style.opacity=e.isShowInAttachmentDiv()?i*t:i});var e;this._bodyBounds.forEach(function(t){e=Ze.unionRect(e,t)}),this._unionBodyBounds=Oe.clone(e),this._attachments.forEach(function(t){e=Ze.unionRect(e,t.getViewRect())}),this._viewRect=e}},cleanUp:function(t){for(var e=t.length,i=0;e>i;i++){var n=t[i],o=this[n];o&&!o.parentNode&&(this[n]=null)}},setVisible:function(t){this.isVisible()!==t&&(je.setVisible(this._view,t),this._attachments.forEach(function(e){e.isShowInAttachmentDiv()&&je.setVisible(e._view,t)}),this.invalidate(!0))},isVisible:function(){return je.isVisible(this._view)},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var t=this._network.getLabel(this._element);null!=t&&""!==t?this._labelAttachment||(this._labelAttachment=new Me.network.LabelAttachment(this,Rn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var t=this._network.getAlarmLabel(this._element);null!=t&&""!==t?this._alarmAttachment||(this._alarmAttachment=new Me.network.AlarmAttachment(this,Rn.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var t=this._network.getIconsNames(this._element);t&&t.length>0?this._iconsAttachment||(this._iconsAttachment=new Me.network.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this.isEditable()&&this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)?this._editAttachment||(this._editAttachment=new Me.network.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},isEditable:function(){return!0},handlePropertyChange:function(t){this.invalidate(!0)},handleSelectionChange:function(t){this.invalidate(!0)},dispose:function(){this._attachments.forEach(function(t){t.getView().parentNode&&t.getView().parentNode.removeChild(t.getView()),t.dispose()}),this._attachments.clear()},addAttachment:function(t){this._attachments.add(t),t.isShowInAttachmentDiv()?this._network.getAttachmentDiv().appendChild(t.getView()):this._view.appendChild(t.getView()),this.invalidate(!1)},removeAttachment:function(t){this._attachments.remove(t),t.getView().parentNode&&t.getView().parentNode.removeChild(t.getView()),t.dispose(),this.invalidate(!1)},addBodyBounds:function(t){t&&this._bodyBounds.add(t)},addComponent:function(t){this._bodyView.appendChild(t)},getBodyView:function(){return this._bodyView},getView:function(){return this._view},getViewRect:function(){return Oe.clone(this._viewRect)},setShadow:function(t,e,i){var n=t.isShadowable()&&this._shadowColor&&!this._editAttachment;n&&(this._shadowXOffset>0?i.width+=this._shadowXOffset:(i.x+=this._shadowXOffset,i.width+=-this._shadowXOffset),this._shadowYOffset>0?i.height+=this._shadowYOffset:(i.y+=this._shadowYOffset,i.height+=-this._shadowYOffset),Ze.grow(i,this._shadowBlur,this._shadowBlur));var o=je.setCanvas(e,i);return n&&(o.shadowOffsetX=this._shadowXOffset,o.shadowOffsetY=this._shadowYOffset,o.shadowBlur=this._shadowBlur,o.shadowColor=this._shadowColor),o},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&"shadow"===this._element.getStyle("select.style")?!0:!1},hit:function(t,e){return!1},hitCanvas:function(t,e,i){for(var n=i.length,o=0;n>o;o++){var s=i[o],a=this[s];if(Ke.hit(a,t,e,this._network.getSelectionTolerance()))return!0}return!1},hitComponent:function(t,e,i){for(var n=i.length,o=0;n>o;o++){var s=i[o],a=this[s];if(a&&Ze.containsPoint(a._viewRect,t,e))return!0}return!1},hitTest:function(t,e){if(!this.isVisible()||!Ze.containsPoint(this._viewRect,t,e))return null;var i,n,o=this._attachments.size();for(i=o-1;i>=0;i--)if(n=this._attachments.get(i),n.isShowInAttachmentDiv()&&n.hit(t,e))return n;for(i=o-1;i>=0;i--)if(n=this._attachments.get(i),!n.isShowInAttachmentDiv()&&n.hit(t,e))return n;return Ze.containsPoint(this._unionBodyBounds,t,e)&&this.hit(t,e)?this:null},intersects:function(t){return!1},intersectsComponent:function(t,e){for(var i=e.length,n=0;i>n;n++){var o=e[n],s=this[o];if(s&&Ze.intersects(s._viewRect,t))return!0}return!1},intersectsCanvas:function(t,e){for(var i=e.length,n=0;i>n;n++){var o=e[n],s=this[o];if(Ke.intersects(s,t))return!0}return!1},intersectsTest:function(t){if(!this.isVisible()||!Ze.intersects(this._viewRect,t))return null;var e,i,n=this._attachments.size();for(e=n-1;e>=0;e--)if(i=this._attachments.get(e),i.isShowInAttachmentDiv()&&i.intersects(t))return i;for(e=n-1;e>=0;e--)if(i=this._attachments.get(e),!i.isShowInAttachmentDiv()&&i.intersects(t))return i;return Ze.intersects(this._unionBodyBounds,t)&&this.intersects(t)?this:null}}),Me.network.Attachment=function(t,e){this._view=je.createDiv(),this._ui=t,this._element=this._ui.getElement(),this._network=t.getNetwork(),this._isShowInAttachmentDiv=e===!0,this._isShowInAttachmentDiv&&je.setVisible(this._view,t.isVisible())},Oe.ext("twaver.network.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},getStyle:function(t){return this._ui.getStyle(t)},getFont:function(t){return this._ui.getFont(t)},isShowInAttachmentDiv:function(){return this._isShowInAttachmentDiv},getView:function(){return this._view},getViewRect:function(){return Oe.clone(this._viewRect)},getAlpha:function(){return 1},updateMeasure:function(){},dispose:function(){},hit:function(t,e){return Ze.containsPoint(this._viewRect,t,e)},intersects:function(t){return Ze.intersects(this._viewRect,t)}}),Me.network.BasicAttachment=function(t,e){Me.network.BasicAttachment.superClass.constructor.call(this,t,e),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._attachmentCanvas=je.createCanvas(),this._view.insertBefore(this._attachmentCanvas,this._view.firstChild)},Oe.ext("twaver.network.BasicAttachment",Me.network.Attachment,{calculateMeasure:function(){var t=this.getContentWidth(),e=this.getContentHeight(),i=this.getCornerRadius(),n=this.getPointerLength(),o=this.getPointerWidth(),s=this.getPosition(),a=this.getXOffset(),r=this.getYOffset(),h=this._roundRect;h.width=t+2*i,h.height=e;var l;if(n>0){var c=this.getDirection();l=this._network.getPosition(s,this._ui,null,a,r);var d;if("aboveleft"===c)h.y=l.y-n-h.height,h.x=l.x-(h.width-i),d=Math.max(l.x-o,h.x+i/2),this._pointers=[l,{x:l.x,y:l.y-n},{x:d,y:l.y-n}];else if("aboveright"===c)h.y=l.y-n-h.height,h.x=l.x-i,d=Math.min(l.x+o,h.x+h.width-i/2),this._pointers=[l,{x:l.x,y:l.y-n},{x:d,y:l.y-n}];else if("belowleft"===c)h.y=l.y+n,h.x=l.x-(h.width-i),d=Math.max(l.x-o,h.x+i/2),this._pointers=[l,{x:l.x,y:l.y+n},{x:d,y:l.y+n}];else if("belowright"===c)h.y=l.y+n,h.x=l.x-i,d=Math.min(l.x+o,h.x+h.width-i/2),this._pointers=[l,{x:l.x,y:l.y+n},{x:d,y:l.y+n}];else if("leftabove"===c)h.y=l.y+i-h.height,h.x=l.x-n-h.width,d=Math.max(l.y-o,h.y+i/2),this._pointers=[l,{x:l.x-n,y:l.y},{x:l.x-n,y:d}];else if("leftbelow"===c)h.y=l.y-i,h.x=l.x-n-h.width,d=Math.min(l.y+o,h.y+h.height-i/2),this._pointers=[l,{x:l.x-n,y:l.y},{x:l.x-n,y:d}];else if("rightabove"===c)h.y=l.y+i-h.height,h.x=l.x+n,d=Math.max(l.y-o,h.y+i/2),this._pointers=[l,{x:l.x+n,y:l.y},{x:l.x+n,y:d}];else if("rightbelow"===c)h.y=l.y-i,h.x=l.x+n,d=Math.min(l.y+o,h.y+h.height-i/2),this._pointers=[l,{x:l.x+n,y:l.y},{x:l.x+n,y:d}];else if("above"===c)h.y=l.y-n-h.height,h.x=l.x-h.width/2,d=Math.min(t/2,o/2),this._pointers=[l,{x:l.x-d,y:l.y-n},{x:l.x+d,y:l.y-n}];else if("below"===c)h.y=l.y+n,h.x=l.x-h.width/2,d=Math.min(t/2,o/2),this._pointers=[l,{x:l.x-d,y:l.y+n},{x:l.x+d,y:l.y+n}];else if("left"===c)h.y=l.y-h.height/2,h.x=l.x-n-h.width,d=Math.min(e/2,o/2),this._pointers=[l,{x:l.x-n,y:l.y+d},{x:l.x-n,y:l.y-d}];else{if("right"!==c)throw"Can not resolve '"+c+"' attachment direction";h.y=l.y-h.height/2,h.x=l.x+n,d=Math.min(e/2,o/2),this._pointers=[l,{x:l.x+n,y:l.y+d},{x:l.x+n,y:l.y-d}]}}else l=this._network.getPosition(s,this._ui,{width:h.width,height:h.height},a,r),h.x=l.x,h.y=l.y,this._pointers=null;this._contentRect.x=h.x+(h.width-t)/2,this._contentRect.y=h.y+(h.height-e)/2,this._contentRect.width=t,this._contentRect.height=e;var u=this.getPadding();0!=u&&Ze.grow(h,u,u),u=this.getPaddingLeft(),0!=u&&(h.x-=u,h.width+=u),u=this.getPaddingRight(),0!=u&&(h.width+=u),u=this.getPaddingTop(),0!=u&&(h.y-=u,h.height+=u),u=this.getPaddingBottom(),0!=u&&(h.height+=u),h.width<0&&(h.width=h.width,h.x-=h.width),h.height<0&&(h.height=-h.height,h.y-=h.height)},updateMeasure:function(){Me.network.BasicAttachment.superClass.updateMeasure.call(this),this.calculateMeasure();var t=this.isFill(),e=this.getOutlineWidth();this._viewRect=Ze.getRect(this._pointers),this._viewRect=Ze.unionRect(this._viewRect,this._roundRect),e>0&&Ze.grow(this._viewRect,e/2,e/2);var i=this._ui.setShadow(this,this._attachmentCanvas,this._viewRect);if((e>0||t)&&(i.beginPath(),Ke.drawRoundRect(i,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(i.moveTo(this._pointers[0].x,this._pointers[0].y),i.lineTo(this._pointers[1].x,this._pointers[1].y),i.lineTo(this._pointers[2].x,this._pointers[2].y)),i.closePath(),e>0&&(i.lineWidth=e,i.strokeStyle=this.getOutlineColor(),i.lineCap=this.getCap(),i.lineJoin=this.getJoin(),i.stroke()),t)){var n=this.getFillColor(),o=this.getGradient();o?Ke.fill(i,n,o,this.getGradientColor(),this._viewRect):i.fillStyle=n,i.fill()}return i},getRoundRect:function(){return Oe.clone(this._roundRect)},getContentRect:function(){return Oe.clone(this._contentRect)},getContent:function(){return this._content},setContent:function(t){this._content!==t&&(this._content&&this._view.removeChild(this._content),this._content=t,t&&this._view.appendChild(t))},getContentWidth:function(){return Rn.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return Rn.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return Rn.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return Rn.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return Rn.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return Rn.ATTACHMENT_POSITION},getXOffset:function(){return Rn.ATTACHMENT_XOFFSET},getYOffset:function(){return Rn.ATTACHMENT_YOFFSET},getPadding:function(){return Rn.ATTACHMENT_PADDING},getPaddingLeft:function(){return Rn.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return Rn.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return Rn.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return Rn.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return Rn.ATTACHMENT_DIRECTION},isFill:function(){return Rn.ATTACHMENT_FILL},getFillColor:function(){return Rn.ATTACHMENT_FILL_COLOR},getGradient:function(){return Rn.ATTACHMENT_GRADIENT},getGradientColor:function(){return Rn.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return Rn.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return Rn.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return Rn.ATTACHMENT_CAP},getJoin:function(){return Rn.ATTACHMENT_JOIN},isShadowable:function(){return Rn.ATTACHMENT_SHADOWABLE},hit:function(t,e){return Ze.containsPoint(this._viewRect,t,e)?Ze.containsPoint(this._contentRect,t,e)?!0:Ke.hit(this._attachmentCanvas,t,e):!1},intersects:function(t){return Ze.intersects(this._viewRect,t)?Ze.intersects(this._contentRect,t)?!0:Ke.intersects(this._attachmentCanvas,t):!1}}),Me.network.LabelAttachment=function(t,e){Me.network.LabelAttachment.superClass.constructor.call(this,t,e)},Oe.ext("twaver.network.LabelAttachment",Me.network.BasicAttachment,{updateMeasure:function(){var t,e=this.getFont("label.font"),i=this.getLabel(),n=Oe.g.getTextSize(e,i),o=this.getMaxLength();0!==o&&n.width>o?(t=Oe.g.getCollapseTextInLength(e,i,o),this._textSize=Oe.g.getTextSize(e,t)):(t=i,this._textSize=n);var s=Me.network.LabelAttachment.superClass.updateMeasure.call(this),a=this._element.getStyle("label.align");Ke.drawText(s,t,this._contentRect,e,this.getStyle("label.color"),a)},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},getMaxLength:function(){return this.getStyle("label.maxlength")},isShadowable:function(){return this.getStyle("label.shadowable")}}),Me.network.AlarmAttachment=function(t,e){Me.network.AlarmAttachment.superClass.constructor.call(this,t,e)},Oe.ext("twaver.network.AlarmAttachment",Me.network.BasicAttachment,{updateMeasure:function(){var t=this.getFont("alarm.font"),e=this._network.getAlarmLabel(this._element);this._textSize=Ke.getTextSize(t,e),this._fillColor=this._network.getAlarmFillColor(this._element);var i=Me.network.AlarmAttachment.superClass.updateMeasure.call(this);Ke.drawText(i,e,this._contentRect,t,this.getStyle("alarm.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),Me.network.LinkHandlerAttachment=function(t,e){Me.network.LinkHandlerAttachment.superClass.constructor.call(this,t,e)},Oe.ext("twaver.network.LinkHandlerAttachment",Me.network.BasicAttachment,{updateMeasure:function(){var t=this.getFont("link.handler.font"),e=this._network.getLinkHandlerLabel(this._element);this._textSize=Ke.getTextSize(t,e);var i=Me.network.LabelAttachment.superClass.updateMeasure.call(this);Ke.drawText(i,e,this._contentRect,t,this.getStyle("link.handler.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),Me.network.EditAttachment=function(t,e){Me.network.EditAttachment.superClass.constructor.call(this,t,e),this._attachmentDiv=je.createDiv(),this._view.appendChild(this._attachmentDiv)},Oe.ext("twaver.network.EditAttachment",Me.network.Attachment,{updateMeasure:function(){Me.network.EditAttachment.superClass.updateMeasure.call(this),this._viewRect=null,this._element instanceof Fn&&this._addResizingPoint(this._element),!(this._network.isRotatable(this._element)&&this._element instanceof Fn)||this._element instanceof Me.ShapeNode||this._element instanceof Me.Grid||this._element instanceof Me.Group||this._addRotatePoint(this._element),this._element instanceof Me.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof Me.network.ShapeLinkUI&&this._addShapeLinkPoints(this._ui),this._ui instanceof Me.network.LinkUI&&this._addLinkControlPoint(this._ui)},_addRotatePoint:function(t){var e=this._network.getRotatePointSize();if(!(0>=e)){var i=t.getOriginalRect();if(!this._rotateDiv){var n=je.createDiv();this._attachmentDiv.appendChild(n),this._rotateDiv=n}var o,s=this._network.getRotatePointOutlineWidth(),a=this._network.getRotatePointOutlineColor(),r=this._network.getRotatePointFillColor(),e=this._network.getRotatePointSize(),h=2*e,l={x:i.x+i.width/2-e,y:i.y-this._network.getRotatePointOffset()-h,width:h,height:h};o=0==t.angle?l:this._getRotateRect(l,t.getAngle(),{x:i.x+i.width/2,y:i.y+i.height/2});var c=Ze.unionRect(t.getRect(),o);this._viewRect=Ze.unionRect(c,this._viewRect),je.setDiv(this._rotateDiv,l,r,s,a),this._rotateDiv._viewRect=o,je.setBorderRaidus(this._rotateDiv,h+"px"),this._rotateAttachments(this._rotateDiv,h/2,s)}},_addResizingPoint:function(t){var e=this._network.getResizePointSize();if(!(0>=e)){var i=t.getOriginalRect(),n=new fn([{x:i.x,y:i.y},{x:i.x+i.width/2,y:i.y},{x:i.x+i.width,y:i.y},{x:i.x,y:i.y+i.height/2},{x:i.x+i.width,y:i.y+i.height/2},{x:i.x,y:i.y+i.height},{x:i.x+i.width/2,y:i.y+i.height},{x:i.x+i.width,y:i.y+i.height}]);if(!this._resizeDivs){this._resizeDivs=new Array;for(var o=0;8>o;o++){var s=je.createDiv();this._attachmentDiv.appendChild(s),this._resizeDivs[o]=s}}if(this._resizeDivs){this._resizeRects=new Array;for(var o=0;8>o;o++){var a,r=n.get(o),h={x:r.x-e,y:r.y-e,width:2*e,height:2*e};a=0==t.getAngle()?h:this._getRotateRect(h,t.getAngle(),{x:i.x+i.width/2,y:i.y+i.height/2}),this._resizeRects[o]=a}}var l=this._network.getResizePointOutlineWidth(),c=this._network.getResizePointOutlineColor(),d=this._network.getResizePointFillColor();this._addPoints(t.getRect(),n,l,c,d,!0)}},_addPoints:function(t,e,i,n,o,s){var a=s?this._network.getResizePointSize():this._network.getEditPointSize();if(!(0>=a)){var r=a+i;Ze.grow(t,r,r),this._viewRect=Ze.unionRect(t,this._viewRect);var h,l,c,d,u=2*a,_=new fn;for(h=0,l=e.size();l>h;h++)c=e.get(h),d={x:c.x-a,y:c.y-a,width:u,height:u},_.add(d);var g;if(s)g=this._resizeDivs;else{if(this._controlDivs||(this._controlDivs=new Array),this._controlDivs.length<l)for(h=this._controlDivs.length;l>h;h++){var f=je.createDiv();this._attachmentDiv.appendChild(f),this._controlDivs[h]=f}else if(this._controlDivs.length>l){for(h=l;h<this._controlDivs.length;h++)this._attachmentDiv.removeChild(this._controlDivs[h]);this._controlDivs.splice(l)}g=this._controlDivs}for(h=0,l=_.size();l>h;h++)d=_.get(h),je.setDiv(g[h],d,o,i,n),je.setBorderRaidus(g[h],(s?"0":u)+"px"),this._rotateAttachments(g[h],u/2,i,e.get(h))}},_rotateAttachments:function(t,e,i,n){if(this._element instanceof Fn){var o=this._element.getAngle();if(0==o)return;{var s=this._element.getOriginalRect(),a=t.style.left.split("px")[0],r=t.style.top.split("px")[0];s.x+s.width/2,s.y+s.height/2}n||(n={x:parseFloat(a)+e+i,y:parseFloat(r)+e+i});var h=Ze.createMatrix(o*Math.PI/180,s.x+s.width/2,s.y+s.height/2),l=h.transform(n);t.style.webkitTransform="rotate("+o+"deg)",t.style.mozTransform="rotate("+o+"deg)",t.style.OTransform="rotate("+o+"deg)",t.style.msTransform="rotate("+o+"deg)",t.style.transform="rotate("+o+"deg)",t.style.left=l.x-e-i+"px",t.style.top=l.y-e-i+"px"}},_addShapeLinkPoints:function(t){this._addEditPoints(t._element.getPoints())},_addShapeNodePoint:function(t){this._addEditPoints(t.getPoints())},_addLinkControlPoint:function(t){if(Ti.isOrthogonalLink(t._element)){var e=t.getControlPoint();if(e){var i=new fn;i.add(e),this._addEditPoints(i)}}},_addEditPoints:function(t){var e=Ze.getRect(t);if(e){var i=this._network.getEditPointOutlineWidth(),n=this._network.getEditPointOutlineColor(),o=this._network.getEditPointFillColor();this._addPoints(e,t,i,n,o,!1)}},hit:function(t,e){if(!Ze.containsPoint(this._viewRect,t,e))return!1;var i;if(this._resizeDivs)for(i=this._resizeDivs.length-1;i>=0;i--)if(Ze.containsPoint(this._resizeRects[i],t,e))return!0;if(this._rotateDiv&&Ze.containsPoint(this._rotateDiv._viewRect,t,e))return!0;if(this._controlDivs)for(i=this._controlDivs.length-1;i>=0;i--)if(Ze.containsPoint(this._controlDivs[i]._viewRect,t,e))return!0;return!1},intersects:function(t){if(!Ze.intersects(this._viewRect,t))return!1;var e;if(this._resizeDivs)for(e=this._resizeDivs.length-1;e>=0;e--)if(Ze.intersects(this._resizeRects[e],t))return!0;if(this._rotateDiv&&Ze.containsPoint(this._rotateDiv._viewRect,t))return!0;if(this._controlDivs)for(e=this._controlDivs.length-1;e>=0;e--)if(Ze.intersects(this._controlDivs[e]._viewRect,t))return!0;return Ze.intersects(this._viewRect,t)?!1:!1},_getRotateRect:function(t,e,i){var n=Ze.createMatrix(e*Math.PI/180,i.x,i.y),o={x:t.x+t.width/2,y:t.y+t.height/2},s=n.transform(o),a=new Me.List([{x:s.x-t.width/2,y:s.y-t.height/2},{x:s.x+t.width/2,y:s.y-t.height/2},{x:s.x+t.width/2,y:s.y+t.height/2},{x:s.x-t.width/2,y:s.y+t.height/2}]);return Ze.getRect(a)}}),Me.network.IconsAttachment=function(t,e){Me.network.IconsAttachment.superClass.constructor.call(this,t,e),this._iconsCanvas=null},Oe.ext("twaver.network.IconsAttachment",Me.network.Attachment,{isShadowable:function(){return Rn.ATTACHMENT_SHADOWABLE},updateMeasure:function(){Me.network.IconsAttachment.superClass.updateMeasure.call(this);var t=this._network.getIconsNames(this._element);if(t&&0!=t.length){var e=this._network.getIconsColors(this._element),i=this._element.getStyle("icons.orientation"),n=this._element.getStyle("icons.position"),o=this._element.getStyle("icons.xoffset");o=o instanceof Array?o[0]:o;var s=this._element.getStyle("icons.yoffset");s=s instanceof Array?s[0]:s;var a=this._element.getStyle("icons.xgap");a=a instanceof Array?a[0]:a;var r=this._element.getStyle("icons.ygap");r=r instanceof Array?r[0]:r;var h=this._getIconsSize(t,i,a,r);if(h){var l=this._network.getPosition(n,this._ui,h,o,s);this._viewRect={x:l.x,y:l.y,width:h.width,height:h.height},"top"===i?l.y+=h.height:"left"===i&&(l.x+=h.width),this._iconsCanvas||(this._iconsCanvas=je.createCanvas(),this._view.appendChild(this._iconsCanvas));var c=this._ui.setShadow(this,this._iconsCanvas,Oe.clone(this._viewRect)),d=l.x,u=l.y,_=0;for(var g in t){var f=null,v=null;e&&e.length>_&&(v=e[_++]);var m=Oe.getImageAsset(t[g]);if(null!=m){if("right"===i)f={x:d,y:u,width:m.getWidth(),height:m.getHeight()},d+=f.width+a;else if("left"===i)f={x:d-m.getWidth(),y:u,width:m.getWidth(),height:m.getHeight()},d-=f.width+a;else if("top"===i)f={x:d,y:u-m.getHeight(),width:m.getWidth(),height:m.getHeight()},u-=f.height+r;else{if("bottom"!==i)throw"Can not resolve '"+i+"' orientation";f={x:d,y:u,width:m.getWidth(),height:m.getHeight()},u+=f.height+r}Vi(c,m.getImage(v,f.width,f.height),v,f,this._element,this._network)}}}}},_getIconsSize:function(t,e,i,n){var o=0,s=0,a=null,r=null,h=null;for(var l in t)if(r=Oe.getImageAsset(t[l])){if("right"===e)a={x:o,y:s,width:r.getWidth(),height:r.getHeight()},o+=a.width+i;else if("left"===e)a={x:o-r.getWidth(),y:s,width:r.getWidth(),height:r.getHeight()},o-=a.width+i;else if("top"===e)a={x:o,y:s-r.getHeight(),width:r.getWidth(),height:r.getHeight()},s-=a.height+n;else{if("bottom"!==e)throw"Can not resolve '"+e+"' orientation";a={x:o,y:s,width:r.getWidth(),height:r.getHeight()},s+=a.height+n}h=null==h?Oe.clone(a):Ze.unionRect(h,a)}return h?{width:Math.abs(h.width),height:Math.abs(h.height)}:null}}),Me.network.HTMLBasicAttachment=function(t,e){function i(t,e,i,n,o,s,a){i||(i=this._origin.x),n||(n=this._origin.y),o||(o=this._location.x),s||(s=this._location.y),t=t-i-o,e=e-n-s;var r=Me.Util.transformPoint({x:i+o,y:n+s},a?this._radian:-this._radian,t,e).point;return r}Me.network.HTMLBasicAttachment.superClass.constructor.call(this,t,e),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._triangleDiv=Me.Util.createDiv(),this._roundDiv=Me.Util.createDiv(),this._contentDiv=Me.Util.createDiv(),Me.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Me.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var n=this;this.hit=function(t,e){if(this._radian&&this._origin){var o=i.call(n,t,e);t=o.x,e=o.y}return Me.Util.containsPoint(this._roundRect,t,e)||Me.Util.containsPoint(this._pointerRect,t,e)},this.intersects=function(t){var e={x:t.x,y:t.y},o={x:t.x+t.width,y:t.y},s={x:t.x,y:t.y+t.height},a={x:t.x+t.width,y:t.y+t.height};if(this._radian&&this._origin){if(t.width*t.height>50)return!1;e=i.call(n,e.x,e.y),o=i.call(n,o.x,o.y),s=i.call(n,s.x,s.y),a=i.call(n,a.x,a.y)}return t=Me.Util.getRect([e,o,s,a]),Me.Util.intersects(this._roundRect,t)||Me.Util.intersects(this._pointerRect,t)},this.getContentWidth=function(){return this._contentDiv.scrollWidth||parseInt(Me.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},this.getContentHeight=function(){return this._contentDiv.scrollHeight||parseInt(Me.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},this._view.appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Me.Util.ext("twaver.network.HTMLBasicAttachment",Me.network.BasicAttachment,{calculateMeasure:function(){var t=this.getContentWidth(),e=this.getContentHeight(),i=Math.min(this.getCornerRadius(),e/2),n=this.getPointerLength(),o=this.getPointerWidth(),s=this.getPosition(),a=this.getXOffset(),r=this.getYOffset();this._contentRect.width=t,this._contentRect.height=e,this._contentRect.x=i;var h=this._roundRect;h.width=t+2*i,h.height=e;var l;if(n>0){var c=this.getDirection();l=this._network.getPosition(s,this._ui,null,a,r);if("aboveleft"===c){h.y=l.y-n-h.height,h.x=l.x-(h.width-i),this._pointers=[l,{x:l.x,y:l.y-n},{x:l.x-Math.min(o,t),y:l.y-n}];var d=n/2,u=Math.min(o,t)/2,_=this.getFillColor();this._triangleBorderWidthStyle=d+"px "+u+"px "+d+"px "+u+"px",this._triangleBorderColorStyle=_+" "+_+" transparent transparent",this._triangleDivLocation=this._pointers[2]}else if("aboveright"===c){h.y=l.y-n-h.height,h.x=l.x-i,this._pointers=[l,{x:l.x,y:l.y-n},{x:l.x+Math.min(o,t),y:l.y-n}];var d=n/2,u=Math.min(o,t)/2,_=this.getFillColor();this._triangleBorderWidthStyle=d+"px "+u+"px "+d+"px "+u+"px",this._triangleBorderColorStyle=_+" transparent transparent "+_,this._triangleDivLocation=this._pointers[1]}else if("belowleft"===c){h.y=l.y+n,h.x=l.x-(h.width-i),this._pointers=[l,{x:l.x,y:l.y+n},{x:l.x-Math.min(o,t),y:l.y+n}];var d=n/2,u=Math.min(o,t)/2,_=this.getFillColor();this._triangleBorderWidthStyle=d+"px "+u+"px "+d+"px "+u+"px",this._triangleBorderColorStyle=" transparent "+_+" "+_+" transparent",this._triangleDivLocation={x:this._pointers[2].x,y:l.y}}else if("belowright"===c){h.y=l.y+n,h.x=l.x-i,this._pointers=[l,{x:l.x,y:l.y+n},{x:l.x+Math.min(o,t),y:l.y+n}];var d=n/2,u=Math.min(o,t)/2,_=this.getFillColor();this._triangleBorderWidthStyle=d+"px "+u+"px "+d+"px "+u+"px",this._triangleBorderColorStyle="transparent transparent "+_+" "+_,this._triangleDivLocation=this._pointers[0]}else if("above"===c){h.y=l.y-n-h.height,h.x=l.x-h.width/2,this._pointers=[l,{x:l.x-Math.min(o,t)/2,y:l.y-n},{x:l.x+Math.min(o,t)/2,y:l.y-n}];var d=n,u=Math.min(o,t)/2,_=this.getFillColor();this._triangleBorderWidthStyle=d+"px "+u+"px 0px "+u+"px",this._triangleBorderColorStyle=_+" transparent transparent transparent",this._triangleDivLocation=this._pointers[1]}else if("below"===c){h.y=l.y+n,h.x=l.x-h.width/2,this._pointers=[l,{x:l.x-Math.min(o,t)/2,y:l.y+n},{x:l.x+Math.min(o,t)/2,y:l.y+n}];var d=n,u=Math.min(o,t)/2,_=this.getFillColor();this._triangleBorderWidthStyle="0px "+u+"px "+d+"px "+u+"px",this._triangleBorderColorStyle="transparent transparent "+_+" transparent ",this._triangleDivLocation={x:this._pointers[1].x,y:l.y}}else if("left"===c){h.y=l.y-h.height/2,h.x=l.x-h.width-n,this._pointers=[l,{x:l.x-n,y:l.y-Math.min(o,e)/2},{x:l.x-n,y:l.y+Math.min(o,e)/2}];var d=Math.min(o,e)/2,u=n,_=this.getFillColor();this._triangleBorderWidthStyle=d+"px 0px "+d+"px "+u+"px",this._triangleBorderColorStyle="transparent transparent  transparent "+_,this._triangleDivLocation=this._pointers[1]}else{if("right"!==c)throw"Can not resolve '"+c+"' attachment direction";h.y=l.y-h.height/2,h.x=l.x+n,this._pointers=[l,{x:l.x+n,y:l.y-Math.min(o,e)/2},{x:l.x+n,y:l.y+Math.min(o,e)/2}];var d=Math.min(o,e)/2,u=n,_=this.getFillColor();this._triangleBorderWidthStyle=d+"px "+u+"px "+d+"px 0px",this._triangleBorderColorStyle="transparent "+_+" transparent  transparent ",this._triangleDivLocation={x:l.x,y:this._pointers[1].y}}}else l=this._network.getPosition(s,this._ui,{width:h.width,height:h.height},a,r),h.x=l.x,h.y=l.y,this._pointers=null;this._location=l},updateMeasure:function(){if(this.calculateMeasure(),this._ui.isShadowable()&&this.isShadowable()?Me.Util.setCSSStyle(this._roundDiv,"text-shadow",this._ui._shadowXOffset+"px "+this._ui._shadowYOffset+"px "+this._ui._shadowBlur+"px "+this._ui._shadowColor):Me.Util.removeCSSStyle(this._roundDiv,"text-shadow"),this._pointerRect=Me.Util.getRect(this._pointers),this._viewRect=Me.Util.unionRect(this._pointerRect,this._roundRect),Me.Util.setCSSStyle(this._contentDiv,"left",this._contentRect.x+"px"),Me.Util.setCSSStyle(this._contentDiv,"top",this._contentRect.y+"px"),Me.Util.setCSSStyle(this._roundDiv,"left",this._roundRect.x+"px"),Me.Util.setCSSStyle(this._roundDiv,"top",this._roundRect.y+"px"),Me.Util.setCSSStyle(this._roundDiv,"width",this._roundRect.width+"px"),Me.Util.setCSSStyle(this._roundDiv,"height",this._roundRect.height+"px"),Me.Util.setCSSStyle(this._roundDiv,"background",this.isFill()?this.getFillColor():null),Me.Util.setCSSStyle(this._roundDiv,"-webkit-border-radius",this.getCornerRadius()+"px"),Me.Util.setCSSStyle(this._roundDiv,"-moz-border-radius",this.getCornerRadius()+"px"),Me.Util.setCSSStyle(this._roundDiv,"border-radius",this.getCornerRadius()+"px"),this._pointers?(Me.Util.setCSSStyle(this._triangleDiv,"left",this._triangleDivLocation.x+"px"),Me.Util.setCSSStyle(this._triangleDiv,"top",this._triangleDivLocation.y+"px"),Me.Util.setCSSStyle(this._triangleDiv,"border-width",this._triangleBorderWidthStyle),Me.Util.setCSSStyle(this._triangleDiv,"border-color",this._triangleBorderColorStyle),this._view.appendChild(this._triangleDiv)):this._triangleDiv.parentNode==this._view&&this._view.removeChild(this._triangleDiv),this._element.getStyle("label.rotatable")&&this.label){var t=this._ui.getFromPoint(),e=this._ui.getToPoint(),i=this._ui.getLinkPoints();i.size()%2==0&&(t=i.get(i.size()/2-1),e=i.get(i.size()/2)),this._radian=t.x>e.x?Me.Util.getRadiansBetweenLines(e,t):Me.Util.getRadiansBetweenLines(t,e),this._origin={x:this._contentRect.width/2,y:0};var n="rotate("+Me.Util.toDegrees(this._radian)+"deg)",o=this._origin.x+"px "+this._origin.y+"px";Me.Util.isChrome||Me.Util.isSafari?(Me.Util.setCSSStyle(this._roundDiv,"-webkit-transform",n),Me.Util.setCSSStyle(this._roundDiv,"-webkit-transform-origin",o)):Me.Util.isIE?(Me.Util.setCSSStyle(this._roundDiv,"-ms-transform",n),Me.Util.setCSSStyle(this._roundDiv,"-ms-transform-origin",o)):(Me.Util.setCSSStyle(this._roundDiv,"transform",n),Me.Util.setCSSStyle(this._roundDiv,"transform-origin",o))}else Me.Util.removeCSSStyle(this._roundDiv,"-webkit-transform"),Me.Util.removeCSSStyle(this._roundDiv,"-webkit-transform-origin"),Me.Util.removeCSSStyle(this._roundDiv,"-ms-transform"),Me.Util.removeCSSStyle(this._roundDiv,"-ms-transform-origin"),Me.Util.removeCSSStyle(this._roundDiv,"transform"),Me.Util.removeCSSStyle(this._roundDiv,"transform-origin"),delete this._origin,delete this._radian}}),Me.network.HTMLLabelAttachment=function(t,e){Me.network.HTMLBasicAttachment.call(this,t,e),this.label=!0},Me.Util.ext("twaver.network.HTMLLabelAttachment",Me.network.LabelAttachment,{updateMeasure:function(){var t=this.getFont("label.font"),e=this.getLabel();this._contentDiv.innerHTML=e,Me.Util.setCSSStyle(this._contentDiv,"font",t),Me.network.HTMLBasicAttachment.prototype.updateMeasure.call(this),Me.Util.removeCSSStyle(this._contentDiv,"font")},calculateMeasure:Me.network.HTMLBasicAttachment.prototype.calculateMeasure}),Me.network.HTMLAlarmAttachment=function(t,e){Me.network.HTMLBasicAttachment.call(this,t,e),this.alarm=!0},Me.Util.ext("twaver.network.HTMLAlarmAttachment",Me.network.AlarmAttachment,{updateMeasure:function(){var t=this.getFont("alarm.font");this._contentDiv.innerHTML=this._network.getAlarmLabel(this._element),Me.Util.setCSSStyle(this._contentDiv,"font",t),this._fillColor=this._network.getAlarmFillColor(this._element),Me.network.HTMLBasicAttachment.prototype.updateMeasure.call(this),Me.Util.removeCSSStyle(this._contentDiv,"font")},calculateMeasure:Me.network.HTMLBasicAttachment.prototype.calculateMeasure}),Me.network.NodeUI=function(t,e){Me.network.NodeUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.network.NodeUI",Me.network.ElementUI,{createBodyRect:function(){return this._element.getRect()},invalidate:function(t){Me.network.NodeUI.superClass.invalidate.call(this,t);var e=this._element.getAgentLinks();e&&e.forEach(function(t){this._network.invalidateElementUI(t,!1)},this)},updateMeasure:function(){Me.network.NodeUI.superClass.updateMeasure.call(this);var t=this.getStyle("vector.shape"),e=this.getBodyRect();this._hotSpot=Ze.getHotSpot(e.x,e.y,e.width,e.height,t),this.drawBody(),this._outerColor&&this.drawOuterBorder(),!this._editAttachment&&"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.drawSelectBorder(),this.cleanUp(["_selectCanvas","_nodeCanvas","_nodeImage","_nodeComponent","_vectorCanvas","_outerCanvas"]);var i=this._element.getParent();i instanceof Un&&this._network.invalidateElementUI(i,!1)},drawBody:function(){var t=this.getStyle("body.type");"default"===t?this.drawDefaultBody():"vector"===t?this.drawVectorBody():"default.vector"===t?(this.drawVectorBody(),this.drawDefaultBody()):"vector.default"===t?(this.drawDefaultBody(),this.drawVectorBody()):this.addBodyBounds({x:this._element.getX(),y:this._element.getY(),width:0,height:0})},drawOuterBorder:function(){var t=this._element,e=t.getStyle("outer.width");if(e>0){var i=this.getBodyRect();Ze.addPadding(i,t,"outer.padding",1),this._outerCanvas||(this._outerCanvas=je.createCanvas());var n=Oe.clone(i);Ze.grow(n,e/2,e/2);var o=je.setCanvas(this._outerCanvas,n);o.lineWidth=e,o.lineCap=t.getStyle("outer.cap"),o.lineJoin=t.getStyle("outer.join"),o.strokeStyle=this._outerColor,Ke.drawVector(o,t.getStyle("outer.shape"),null,i),o.stroke(),this.addComponent(this._outerCanvas),this.addBodyBounds(n)}},drawSelectBorder:function(){var t=this._element,e=t.getStyle("select.width");if(e>0){var i=this.getBodyRect();i=Oe.clone(i);var n=t.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();Ze.addPadding(i,t,"select.padding",1/n),this._selectCanvas||(this._selectCanvas=je.createCanvas()),Ze.grow(i,e/2/n,e/2/n);var o=je.setCanvas(this._selectCanvas,bounds);o.lineWidth=e/n,o.lineCap=t.getStyle("select.cap"),o.lineJoin=t.getStyle("select.join"),o.strokeStyle=t.getStyle("select.color"),Ke.drawVector(o,t.getStyle("select.shape"),null,i),o.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(bounds)}},drawDefaultBody:function(){var t=this._element,e=Oe.getImageAsset(t.getImage()),i=this.getBodyRect();if(!e)return this.addBodyBounds(i),void(this._currentImageAsset=null);if(Ze.addPadding(i,this._element,"image.padding",1),e.getImage()){this._nodeCanvas||(this._nodeCanvas=je.createCanvas());var n=Oe.clone(i),o=this.setShadow(this,this._nodeCanvas,n);0!=t.getAngle()&&(i=t.getOriginalRect(),Me.Util.rotateCanvas(o,i,t.getAngle())),Vi(o,t.getImage(),this.getInnerColor(),i,t,this._network),i=n,this.addComponent(this._nodeCanvas)}else if(e.getSrc())this._nodeImage||(this._nodeImage=je.createImg()),je.setImg(this._nodeImage,e.getSrc(),i),this.addComponent(this._nodeImage);else{if(!e.getFunction())throw"ImageAsset '"+t.getImage()+" ' is empty";this._nodeComponent=this._currentImageAsset!==e?e.getFunction()(this,i):e.getFunction()(this,i,this._nodeComponent),this.addComponent(this._nodeComponent),this._nodeComponent._viewRect=Oe.clone(i)}this.addBodyBounds(i),this._currentImageAsset=e},hit:function(t,e){if(this._network._transparentSelectionEnable){var i=this.getBodyRect();if(Oe.math.containsPoint(i,t,e))return!0}return this.hitCanvas(t,e,["_nodeCanvas","_outerCanvas","_vectorCanvas"])?!0:this.hitComponent(t,e,["_nodeImage","_nodeComponent"])},intersects:function(t){if(this._network._transparentSelectionEnable){var e=this.getBodyRect();if(Oe.math.intersects(e,t))return!0}return this.intersectsCanvas(t,["_nodeCanvas","_outerCanvas","_vectorCanvas"])?!0:this.intersectsComponent(t,["_nodeImage","_nodeComponent"])},drawVectorBody:function(){this._vectorCanvas||(this._vectorCanvas=je.createCanvas());var t=Ke.drawPath(this,this._vectorCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern")),e=this.getStyle("vector.deep"),i=this._vectorCanvas.getContext("2d"),n=this.getBodyRect(),o=this.getStyle("vector.fill.color");if(0!==e&&o){var s=this._element.getAngle();0!=s&&(n=this._element.getOriginalRect(),Me.Util.rotateCanvas(i,n,-s),Me.Util.rotateCanvas(i,n,s)),"rectangle"===this.getStyle("vector.shape")&&Ke.draw3DRect(i,o,e,n)}this.addBodyBounds(t),this.addComponent(this._vectorCanvas)}}),Me.network.LinkUI=function(t,e){Me.network.LinkUI.superClass.constructor.call(this,t,e),this._linkCanvas=je.createCanvas()},Oe.ext("twaver.network.LinkUI",Me.network.ElementUI,{isEditable:function(){return Ti.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},createBodyRect:function(){var t=this.getHotSpot();return t?{x:t.x-1,y:t.y-1,width:2,height:2}:null},hit:function(t,e){return this.hitCanvas(t,e,["_linkCanvas"])},intersects:function(t){return this.intersectsCanvas(t,["_linkCanvas"])},checkAttachments:function(){Me.network.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var t=this._network.getLinkHandlerLabel(this._element);null!=t&&""!==t?this._linkHandlerAttachment||(this._linkHandlerAttachment=new Me.network.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=Ze.calculateLineLength(this._linkPoints)),this._linkPoints},invalidate:function(t){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,Me.network.LinkUI.superClass.invalidate.call(this,t)},getFromPosition:function(t,e){var i=this.getFromPoint();return i?{x:i.x+t,y:i.y+e}:null},getToPosition:function(t,e){var i=this.getToPoint();return i?{x:i.x+t,y:i.y+e}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=Ti.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=Ti.createToPoint(this)),this._toPoint},updateMeasure:function(){Me.network.LinkUI.superClass.updateMeasure.call(this),this.drawBody()},createLinkPoints:function(){var t=this.getFromPoint(),e=this.getToPoint(),i=this.getStyle("link.type"),n=new fn;if(Ti.isOrthogonalOrFlexionalLink(this._element))n=Ti.orthogonalAndFlexional(this,i);else if(this._element.isLooped()){var o=this._network.getElementUI(this._element.getFromAgent());null!=o&&(this._hotSpot=Ti.fillLoopedPoints(this,o.getBodyRect(),n))}else{if("arc"!==i&&"triangle"!==i&&"parallel"!==i)throw"Can not resolve link type '"+i+"'";this._hotSpot=Ti.fillBundlePoints(this,i,t,e,n)}if(this._network._linkPathFunction){var s=this._network._linkPathFunction(this,n);s&&(n=s)}return n},drawLinePoints:function(t,e,i,n,o){if(t.lineWidth=i,t.strokeStyle=n,this._element.getStyle("link.flow")===!0&&o&&o.length>1){var s=new Ai(t,o[0],o[1]),a=this._element.getStyle("link.flow.offset");this._element.getStyle("link.flow.converse")?a<o[0]?s.overflow=o[0]-a:a>=o[0]&&a<=o[0]+o[1]?(s.overflow=o[1]-(a-o[0]),s.overflow&&(s.isLine=!1)):(a-=o[0]+o[1],s.overflow=o[0]-a):a<=o[1]?(s.overflow=a,a&&(s.isLine=!1)):a>o[1]&&a<=o[0]+o[1]?s.overflow=a-o[1]:(a-=o[0]+o[1],a&&(s.isLine=!1),s.overflow=a),this._element._styleMap["link.flow.offset"]=a,t.beginPath(),Ke._drawLine(e,t),t.stroke(),t.shadowColor="transparent",t.beginPath();var r=this._element.getStyle("link.flow.color");r=r?r:Rn.NETWORK_LINK_FLOW_COLOR,t.strokeStyle=r,Ke._drawLine(e,s),t.stroke(),t.shadowColor=this._shadowColor}else t.beginPath(),Ke.drawLinePoints(t,e,o),t.stroke()},drawBody:function(){var t=this.getLinkPoints();if(t&&!(t.size()<2)){var e=this._element,i=Ze.getLineRect(t),n=e.getStyle("link.width"),o=n;if(this._outerColor){var s=e.getStyle("outer.width");o+=2*s}var a=!this._editAttachment&&"border"===e.getStyle("select.style")&&this._network.isSelected(this._element);if(a){var r=e.getStyle("select.width");o+=2*r}Ze.grow(i,o/2,o/2),e.getStyle("arrow.from")&&(i=Ze.unionRect(i,vn.getArrowRect(t,!0,e.getStyle("arrow.from.shape"),e.getStyle("arrow.from.width"),e.getStyle("arrow.from.height"),e.getStyle("arrow.from.xoffset"),e.getStyle("arrow.from.yoffset")))),e.getStyle("arrow.to")&&(i=Ze.unionRect(i,vn.getArrowRect(t,!1,e.getStyle("arrow.to.shape"),e.getStyle("arrow.to.width"),e.getStyle("arrow.to.height"),e.getStyle("arrow.to.xoffset"),e.getStyle("arrow.to.yoffset"))));var h=this.setShadow(this,this._linkCanvas,i);h.lineCap=e.getStyle("link.cap"),h.lineJoin=e.getStyle("link.join");var l=e.getStyle("link.pattern");a&&this.drawLinePoints(h,t,o,e.getStyle("select.color"),l),this._outerColor&&this.drawLinePoints(h,t,n+2*s,this._outerColor,l),this.drawLinePoints(h,t,n,this._innerColor||e.getStyle("link.color"),l),this.addBodyBounds(i),this.addComponent(this._linkCanvas),vn.drawLinkArrow(this,h,t)}},getControlPoint:function(){return Ti.getControlPoint(this._element,this)},setControlPoint:function(t){if(t){var e=this.getStyle("link.type");if(Ti.hasControlPoint(e)){var i=Ti.getLinkSourceBounds(this),n=Ti.getLinkTargetBounds(this);Ti.setParamsByControlPoint(t,i,n,e,this._element)}}},getLineLength:function(){return this._lineLength}}),Me.network.HTMLLinkUI=function(t,e){Me.network.HTMLLinkUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.network.HTMLLinkUI",Me.network.LinkUI,{checkAttachments:function(){Me.network.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var t=this._element.getStyle("attachment.label.style");if(t&&"none"===t)return void Me.network.HTMLLinkUI.superClass.checkLabelAttachment.call(this);var e=this._network.getLabel(this._element);null!=e&&""!==e?this._labelAttachment||(this._labelAttachment=new Me.network.HTMLLabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var t=this._element.getStyle("attachment.alarm.style");if(t&&"none"===t)return void Me.network.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);var e=this._network.getAlarmLabel(this._element);null!=e&&""!==e?this._alarmAttachment||(this._alarmAttachment=new Me.network.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),Me.network.GroupUI=function(t,e){Me.network.GroupUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.network.GroupUI",Me.network.NodeUI,{isEditable:function(){return!this._element.isExpanded()},drawBody:function(){this.getBodyRect();this._shapeRect?this.drawExpandedGroup():Me.network.GroupUI.superClass.drawBody.call(this)},drawExpandedGroup:function(){this._nodeCanvas||(this._nodeCanvas=je.createCanvas());var t=Ke.drawPath(this,this._nodeCanvas,"group",!1,this._element.getStyle("vector.outline.pattern")),e=this.getStyle("group.deep"),i=this.getStyle("group.fill.color");0!==e&&i&&"rectangle"===this.getStyle("group.shape")&&Ke.draw3DRect(this._nodeCanvas.getContext("2d"),i,e,this._bodyRect),this.addBodyBounds(t),this.addComponent(this._nodeCanvas)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var t=this._element;if(t.isExpanded()){var e=this.getChildrenRects();if(!e.isEmpty()){var i=t.getStyle("group.shape"),n=Ge[i];if(!n)throw"Can not resolve group shape '"+i+"'";this._shapeRect=n(e)}}return this._shapeRect?(Ze.addPadding(this._shapeRect,t,"group.padding",1),this._shapeRect):Me.network.GroupUI.superClass.createBodyRect.call(this)}}),Me.network.GridUI=function(t,e){Me.network.GridUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.network.GridUI",Me.network.NodeUI,{drawDefaultBody:function(){this._element.getImage()?Me.network.GridUI.superClass.drawDefaultBody.call(this):this.drawGridBody()},drawGridBody:function(){var t=this.getStyle("grid.fill"),e=this.getStyle("grid.deep"),i=this.getStyle("grid.cell.deep");if(t||0!==e||0!==i){var n=this.getBodyRect(),o=this.getDyeColor("grid.fill.color");this._nodeCanvas||(this._nodeCanvas=je.createCanvas());var s=Oe.clone(n),a=this.setShadow(this,this._nodeCanvas,s);if(a.rect(n.x,n.y,n.width,n.height),this.addComponent(this._nodeCanvas),t&&(a.fillStyle=o,a.fill()),0!=e&&Ke.draw3DRect(a,o,e,n.x,n.y,n.width,n.height),0!=i)for(var r=this.getStyle("grid.row.count"),h=this.getStyle("grid.column.count"),l=0;r>l;l++)for(var c=0;h>c;c++){var d=this._element.getCellRect(l,c);null!=d&&Ke.draw3DRect(a,o,i,d.x,d.y,d.width,d.height)}this.addBodyBounds(s)}}}),Me.network.ShapeNodeUI=function(t,e){Me.network.ShapeNodeUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.network.ShapeNodeUI",Me.network.NodeUI,{drawDefaultBody:function(){if(this._element._points.size()<2)return void this.addBodyBounds({x:this._element.getX(),y:this._element.getY(),width:0,height:0});this._nodeCanvas||(this._nodeCanvas=je.createCanvas());var t=Ke.drawPath(this,this._nodeCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed"));this.addBodyBounds(t),this.addComponent(this._nodeCanvas),vn.drawLinkArrow(this,this._nodeCanvas.getContext("2d"),Ze.getPointObject(this._element._points,this._element._segments))},drawSelectBorder:function(){var t=this._element,e=t.getStyle("select.width");if(e>0){var i=this.getBodyRect();i=Oe.clone(i);var n=t.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();Ze.addPadding(i,t,"select.padding",1/n);var o=t.getStyle("vector.outline.width");o>0&&Ze.grow(i,o/2,o/2),this._selectCanvas||(this._selectCanvas=je.createCanvas()),Ze.grow(i,e/2/n,e/2/n);var s=je.setCanvas(this._selectCanvas,i);s.lineWidth=e/n,s.lineCap=t.getStyle("select.cap"),s.lineJoin=t.getStyle("select.join"),s.strokeStyle=t.getStyle("select.color"),Ke.drawVector(s,t.getStyle("select.shape"),null,i),s.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(bounds)}}}),Me.network.ShapeLinkUI=function(t,e){Me.network.ShapeLinkUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.network.ShapeLinkUI",Me.network.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var t=this.getFromPoint(),e=this.getToPoint(),i=new fn,n=this.getStyle("shapelink.type");i.add(t),null!=this._element._points&&i.addAll(this._element._points),i.add(e);var o=i.size(),s=Math.floor(o/2);if(o%2===0){var a=i.get(s),r=i.get(s-1);this._hotSpot={x:(a.x+r.x)/2,y:(a.y+r.y)/2}}else this._hotSpot=Oe.clone(i.get(s));var h,l,c;if("lineto"===n);else if("quadto"===n){for(h=new fn(i.get(0)),l=1,o=i.size();o>l;l++)h.add(o-1>l?new fn([i.get(l++),i.get(l)]):i.get(l));i=h}else if("cubicto"===n){for(h=new fn(i.get(0)),l=1,o=i.size();o>l;l++)h.add(o-2>l?new fn([i.get(l++),i.get(l++),i.get(l)]):o-1>l?new fn([i.get(l++),i.get(l)]):i.get(l));i=h}else{if("orthogonalto"!==n)throw"Can not resolve shapelink type '"+n+"'";for(c=i.get(0),h=new fn(c),l=1,o=i.size();o>l;l++)if(o-1>l){var d=Oe.clone(i.get(l)),u=d.x,_=d.y,g=u-c.x,f=_-c.y;Math.abs(g)>Math.abs(f)?(d.x=u,d.y=c.y):(d.x=c.x,d.y=_),c=d,h.add(c)}else h.add(i.get(l));i=h}return i}}),Me.network.RotatableNodeUI=function(t,e){Me.network.RotatableNodeUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.network.RotatableNodeUI",Me.network.NodeUI,{isEditable:function(){return!1},drawDefaultBody:function(){var t=this._element,e=Oe.getImageAsset(t.getImage()),i=this.getBodyRect();if(!e)return this.addBodyBounds(i),void(this._currentImageAsset=null);if(Ze.addPadding(i,this._element,"image.padding",1),e.getImage()){this._nodeCanvas||(this._nodeCanvas=je.createCanvas());var n=Oe.clone(i),o=this.setShadow(this,this._nodeCanvas,n),s=this._element._getOrignalWidth(),a=this._element._getOrignalHeight(),r=this._element._getRotateRect();o.save(),o.translate(i.x-r.x+s/2,i.y-r.y+a/2),o.rotate(this._element._angle*Math.PI/180);var i={x:-s/2,y:-a/2,width:s,height:a};Vi(o,e.getImage(this._innerColor,i.width,i.height),this._innerColor,i,t,this._network),o.restore(),this.addComponent(this._nodeCanvas)}else if(e.getSrc());else if(!e.getFunction())throw"ImageAsset '"+t.getImage()+" ' is empty";this.addBodyBounds(i),this._currentImageAsset=e}}),Me.network.HTMLNodeUI=function(t,e){Me.network.HTMLNodeUI.superClass.constructor.call(this,t,e)},Me.Util.ext("twaver.network.HTMLNodeUI",Me.network.NodeUI,{checkAttachments:function(){Me.network.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var t=this._element.getStyle("attachment.label.style");if(t&&"none"===t)return void Me.network.HTMLNodeUI.superClass.checkLabelAttachment.call(this);var e=this._network.getLabel(this._element);null!=e&&""!==e?this._labelAttachment||(this._labelAttachment=new Me.network.HTMLLabelAttachment(this,Rn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var t=this._element.getStyle("attachment.alarm.style");if(t&&"none"===t)return void Me.network.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);var e=this._network.getAlarmLabel(this._element);null!=e&&""!==e?this._alarmAttachment||(this._alarmAttachment=new Me.network.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),Me.network.interaction.BaseInteraction=function(t){this.network=t},Oe.ext("twaver.network.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},addListener:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];je.addEventListener(e,"handle_"+e,this.network.getView(),this)}},removeListener:function(){for(var t=0;t<arguments.length;t++)je.removeEventListener(arguments[t],this.network.getView(),this)},_handle_mousedown:function(t){0===t.button&&(this._startLogical=this.network.getLogicalPoint(t),this._startClient=je.getClientPoint(t),this._startLogical&&je.handle_mousedown(this,t))},_handle_mousemove:function(t){this._endLogical={x:this._startLogical.x+(t.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(t.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(t){delete this._startClient,delete this._startLogical,delete this._endLogical}}),Me.network.interaction.SelectInteraction=function(t){Me.network.interaction.SelectInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.network.interaction.SelectInteraction",Me.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown"),this.end()},handle_mousedown:function(t){if(this._button=t.button,this.network.isValidEvent(t)&&!this.network.isMovingElement()&&!this.network.isEditingElement()&&!t.shiftKey){var e=this.network.getElementAt(t),i=this.network.getSelectionModel();e?Oe.isCtrlDown(t)?i.contains(e)?i.removeSelection(e):i.appendSelection(e):i.contains(e)||i.setSelection(e):(Oe.isCtrlDown(t)||i.clearSelection(),this.end(t),this.network.getLogicalPoint(t)&&this.network.isRectSelectEnabled()&&this._handle_mousedown(t))}},handle_mouseup:function(t){this.end(t)},handle_mousemove:function(t){if(0!==this._button||this.network.isMovingElement()||this.network.isEditingElement())return void this.end(t);this._handle_mousemove(t),this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:t}):(this.mark=je.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:t}));var e=Ze.getRect([this._startLogical,this._endLogical]);je.setDiv(this.mark,e,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())},end:function(t){if(this._startLogical){if(this.mark){if(this._endLogical&&this._startLogical.x!==this._endLogical.x&&this._startLogical.y!==this._endLogical.y){var e=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(e&&e.size()>0){var i=this.network.getSelectionModel(),n=i.toSelection();e.forEach(function(t){i.contains(t)?n.remove(t):n.add(t)},this),i.setSelection(n)}this.network.fireInteractionEvent({kind:"selectEnd",event:t})}var o=this;setTimeout(function(){o.mark&&(o.network.getTopDiv().removeChild(o.mark),o.mark=null)},0),this.network.setSelectingElement(!1)}this._handle_mouseup(t)}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startLogical.x>this._endLogical.x&&this._startLogical.y>this._endLogical.y}}),Me.network.interaction.MoveInteraction=function(t,e){this.lazyMode=e,this.xoffset=0,this.yoffset=0,Me.network.interaction.MoveInteraction.superClass.constructor.call(this,t),this.currentKeyEvent=null},Oe.ext("twaver.network.interaction.MoveInteraction",Me.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","keydown","mouseleave")},tearDown:function(){this.removeListener("mousedown","keydown","mouseleave"),this.end()},handle_keydown:function(t){this.currentKeyEvent=t,this.addListener("keyup")},handle_keyup:function(t){this.currentKeyEvent=null,this.removeListener("keyup")},handle_mouseleave:function(t){this.end(t)},isParenting:function(){return this._startLogical&&null!=this.currentKeyEvent&&80===this.currentKeyEvent.keyCode},parentProcess:function(t,e){var i=null;null!=this.parent&&(i=this.network.getElementUI(this.parent).getViewRect(),this.parent=null);var n=this;if(t=this.network.getLogicalPoint(t),!e&&this.isParenting()){var o={};o.x=t.x-1,o.y=t.y-1,o.width=2,o.height=2;var s=this.network.getElementsAtRect(o,!0);if(s&&s.size()>0)for(var a=s.size(),r=0;a>r;r++){var h=s.get(r);if(!n.network.getElementBox().getSelectionModel().contains(h)){n.parent=h;break}}}null!=this.parent&&(i=this.network.getElementUI(this.parent).getViewRect()),null==i||e?this.parentMark&&(this.network.getTopDiv().removeChild(this.parentMark),this.parentMark=null):(this.parentMark||(this.parentMark=Oe.html.createDiv(),this.network.getTopDiv().appendChild(this.parentMark)),Oe.html.setDiv(this.parentMark,i,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()))},handle_mousedown:function(t){if(0===t.button&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var e=this.network.getElementAt(t);this.network.isMovable(e)&&(this.end(t),this._handle_mousedown(t))}},handle_mouseup:function(t){this.end(t)},handle_mousemove:function(t){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements()||!this._startLogical)return void this.end(t);if(this._handle_mousemove(t),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y,this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:t});else{this.mark=je.createDiv();var e;this.network.getMovableSelectedElements().forEach(function(t){var i=this.getElementUI(t);i&&(e=Ze.unionRect(e,i.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),je.setDiv(this.mark,e,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:t})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else this._startLogical=this._endLogical,this._startClient=je.getClientPoint(t),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t})),this.network.moveSelectedElements(this.xoffset,this.yoffset);this.parentProcess(t,!1)},end:function(t){if(this._startLogical){if(this.lazyMode){if(this.mark){var e=this,i=function(){e.network.fireInteractionEvent({kind:"lazyMoveEnd",event:t}),e.mark&&(e.network.getTopDiv().removeChild(e.mark),e.mark=null,e.network.setMovingElement(!1))};this.network.moveSelectedElements(this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),i)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t}));if(this.isParenting()){null==this.parent&&(this.parent=this.network.getCurrentSubNetwork());var e=this;this.network.getMovableSelectedElements().forEach(function(t){t.setParent(e.parent)},this.network)}this.parentProcess(t,!0),this._handle_mouseup(t)}}}),Me.network.interaction.DefaultInteraction=function(t){Me.network.interaction.DefaultInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.network.interaction.DefaultInteraction",Me.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove","keydown")},tearDown:function(){this.removeListener("mousedown","mousemove","keydown")},handle_mousedown:function(t){if(this.network.isValidEvent(t)){this.network.isFocusOnClick()&&Me.Util.setFocus(this.network.getView());var e=this.network.getElementAt(t);2===t.detail?this.handleDoubleClicked(t,e):this.handleClicked(t,e)}},handleClicked:function(t,e){Ii.handleClicked(this.network,t,e)},handleDoubleClicked:function(t,e){Ii.handleDoubleClicked(this.network,t,e)},handle_keydown:function(t){Ii.handleKeyDown(this.network,t)},handle_mousemove:function(t){var e=this.network.getElementAt(t),i=this._preElement,n=Li(i),o=Li(e);i!==e&&(i&&(n&&n.onMouseLeave&&n.onMouseLeave(i,this.network),this.network.onMouseLeave(i,t)),e&&(o&&o.onMouseEnter&&o.onMouseEnter(e,this.network),this.network.onMouseEnter(e,t))),e&&o&&o.onMouseMove&&o.onMouseMove(e,this.network),this.network.onMouseMove(e,t),this._preElement=e}}),Me.network.interaction.PanInteraction=function(t){Me.network.interaction.PanInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.network.interaction.PanInteraction",Me.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(t){this._startLogical=this.network.getLogicalPoint(t),this._startLogical&&(this._handle_mousedown(t),this.network.getView().style.cursor="pointer")},handle_mouseup:function(t){this._clear()},handle_mousemove:function(t){if(this._startLogical){this._handle_mousemove(t);{var e=this._startLogical.x-this._endLogical.x,i=this._startLogical.y-this._endLogical.y;this.network.panByOffset(e,i)}this._startLogical=this._endLogical,this._startClient=je.getClientPoint(t)}},_clear:function(t){this._startLogical&&(this._handle_mouseup(t),this.network.getView().style.cursor=this._oldCursor)}}),Me.network.interaction.EditInteraction=function(t,e){this.lazyMode=e,this.pointIndex=-1,Me.network.interaction.EditInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.network.interaction.EditInteraction",Me.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear()},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.mouseMoved=!1,this.horizontal=!1,this.vertical=!1,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null),this.rotateScale&&this.network.getTopDiv().contains(this.rotateScale)&&(this.network.getTopDiv().removeChild(this.rotateScale),this.rotateScale=null)},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(t){this.cursorID=t,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(t){if(0===t.button)if(!Oe.isAltDown(t)||this.network.isEditingElement())!this.network.isEditingElement()||this.isStart||this.isStartRotate||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:t,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?Oe.isAltDown(t)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:t,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?Oe.isAltDown(t)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:t,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(t)));else{var e=this.network.getElementAt(t),i=this.network.getLogicalPoint(t);if(e instanceof Me.ShapeNode){var n=this.getPointIndex(e.getPoints(),i,!0);n>0&&(this._handle_mousedown(t),this.pointIndex=n,this.shapeNode=e,e.addPoint(i,n),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:t,element:e,pointIndex:n}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:e,pointIndex:n}))}if(e instanceof Me.ShapeLink){var o=new Me.List(e.getPoints()),s=this.network.getElementUI(e);o.add(s.getFromPoint(),0),o.add(s.getToPoint());var n=this.getPointIndex(o,i)-1;n>0&&(this._handle_mousedown(t),this.pointIndex=n,this.shapeLink=e,e.addPoint(i,n),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:t,element:e,pointIndex:n}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:e,pointIndex:n}))}}},handle_mouseup:function(t){if(this.isStart){var e=Oe.clone(this._endLogical);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var i=this,n=new Me.animate.AnimateBounds(this.node,this.resizingRect,function(){i.network.fireInteractionEvent({kind:"lazyResizeEnd",event:t,element:i.node,resizeDirection:i.resizeDirection}),i.clear()});Me.animate.AnimateManager.start(n)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:t,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:t,element:this.node,resizeDirection:this.resizeDirection});else if(this.shapeNode&&this.pointIndex>=0&&e){var o=this.shapeNode.getPoints().get(this.pointIndex);this.horizontal&&(e.y=o.y),this.vertical&&(e.x=o.x),this.shapeNode.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.shapeNode,pointIndex:this.pointIndex})}else if(this.shapeLink&&this.pointIndex>=0&&e){var o=this.shapeLink.getPoints().get(this.pointIndex);this.horizontal&&(e.y=o.y),this.vertical&&(e.x=o.x),this.shapeLink.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.shapeLink,pointIndex:this.pointIndex})}else this.linkUI&&e&&(this.linkUI.setControlPoint(e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.linkUI._element}))}this._handle_mouseup(t),this.lazyMode||this.clear()},handle_mousemove:function(t){if(this.isStartRotate&&this.node)return this._handleRotateElement(t,this.node),void(this.network.isShowRotateScale()&&this.showRotateScale());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0)return void this._handleMovingShapeNodePoint(t);if(this.shapeLink&&this.pointIndex>=0)return void this._handleMovingShapeLinkPoint(t);if(this.node&&this.resizeDirection)return void this._handleResizing(t);if(this.linkUI)return void this._handleMovingLinkControlPoint(t)}else if(this.network.isValidEvent(t)){if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())return void this.clear();var e=this.network.getElementAt(t),i=this.network.getElementUI(e);if(!i||!i.getEditAttachment())return void this.clear();var n=this.network.getLogicalPoint(t);if(e instanceof Fn){if(this.node=e,this._isEditingShapeNode(n)||this._isResizingNode(n))return void this.network.setEditingElement(!0);if(this._isRotatingElement(n))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(e instanceof Me.ShapeLink){if(this.shapeLink=e,this._isEditingShapeLink(n))return void this.network.setEditingElement(!0)}else if(i instanceof Me.network.LinkUI){var o=this.network.getEditPointSize();if(Ti.isOrthogonalLink(i._element)){this.linkUI=i;var s=this.linkUI.getControlPoint();return void(s&&this._contains(n,s,o)&&(this._setCrossCursor(),this.network.setEditingElement(!0)))}}this.clear()}},_isRotatingElement:function(t){var e=this.network.getRotatePointSize();if(0>=e)return!1;var i=this.node.getOriginalRect(),n=this.node.getAngle();return this._isRotating(t,"crosshair",i,n)},_isRotating:function(t,e,i,n){var o=this.network.getRotatePointSize(),s={x:i.x+i.width/2,y:i.y-this.network.getRotatePointOffset()-o},a=this._rotatePoint(s,n,i),r={x:a.x-o,y:a.y-o,width:2*o,height:2*o};return Ze.containsPoint(r,t)?(this._removeCursor(),this._setCursor(e),!0):!1},_handleRotateElement:function(t,e){this._handle_mousemove(t);var i=this._calculateAngle(this.network.getLogicalPoint(t),e);e.setAngle(i)},_calculateAngle:function(t,e){var i=e.getCenterLocation();return Math.round(180*Math.atan2(i.x-t.x,t.y-i.y)/Math.PI+180)},_handleMovingShapeNodePoint:function(t){if(this._handle_mousemove(t),!this.mouseMoved&&Oe.isCtrlDown(t)){var e=this._endLogical.x-this._startLogical.x,i=this._endLogical.y-this._startLogical.y;this.horizontal=Math.abs(e)>=Math.abs(i),this.vertical=!this.horizontal,this.mouseMoved=!0}var n=this.shapeNode.getPoints().get(this.pointIndex),o=Oe.clone(this._endLogical);this.horizontal&&(o.y=n.y),this.vertical&&(o.x=n.x),this.shapeNode.setPoint(this.pointIndex,o),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(t){if(this._handle_mousemove(t),!this.mouseMoved&&Oe.isCtrlDown(t)){var e=this._endLogical.x-this._startLogical.x,i=this._endLogical.y-this._startLogical.y;this.horizontal=Math.abs(e)>=Math.abs(i),this.vertical=!this.horizontal,this.mouseMoved=!0}var n=this.shapeLink.getPoints().get(this.pointIndex),o=Oe.clone(this._endLogical);this.horizontal&&(o.y=n.y),this.vertical&&(o.x=n.x),this.shapeLink.setPoint(this.pointIndex,o),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(t){this._handle_mousemove(t),this.linkUI.setControlPoint(Oe.clone(this._endLogical)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.linkUI._element})},_handleResizing:function(t){this._handle_mousemove(t);var e=this.node.getAngle(),i=this.node.getLocation(),n=this.node.getWidth()/2,o=this.node.getHeight()/2,s={x:i.x+n,y:i.y+o},a={x:-n,y:-o},r={x:-n,y:o},h={x:n,y:o},l={x:n,y:-o},c={x:0,y:-o},d={x:n,y:0},u={x:0,y:o},_={x:-n,y:0};if("northwest"===this.resizeDirection&&(this._transformPoint(h,s,e),a.x=this._endLogical.x,a.y=this._endLogical.y,s.x=(a.x+h.x)/2,s.y=(a.y+h.y)/2,this._reversPoint(a,s,e),this._reversPoint(h,s,e),this.resizingRect={x:a.x,y:a.y,width:h.x-a.x,height:h.y-a.y}),"north"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,s,e),c.y=g.y-s.y,this._transformPoint(c,s,e),this._transformPoint(u,s,e),s.x=(c.x+u.x)/2,s.y=(c.y+u.y)/2,this._reversPoint(c,s,e),this._reversPoint(u,s,e),this.resizingRect={x:s.x-this.node.getWidth()/2,y:s.y-(u.y-c.y)/2,width:this.node.getWidth(),height:u.y-c.y}}if("northeast"===this.resizeDirection&&(this._transformPoint(r,s,e),l.x=this._endLogical.x,l.y=this._endLogical.y,s.x=(r.x+l.x)/2,s.y=(r.y+l.y)/2,this._reversPoint(r,s,e),this._reversPoint(l,s,e),this.resizingRect={x:r.x,y:l.y,width:l.x-r.x,height:r.y-l.y}),"west"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,s,e),_.x=g.x-s.x,this._transformPoint(d,s,e),this._transformPoint(_,s,e),s.x=(d.x+_.x)/2,s.y=(d.y+_.y)/2,this._reversPoint(d,s,e),this._reversPoint(_,s,e),this.resizingRect={x:s.x-(d.x-_.x)/2,y:s.y-this.node.getHeight()/2,width:d.x-_.x,height:this.node.getHeight()}}if("east"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,s,e),d.x=g.x-s.x,this._transformPoint(d,s,e),this._transformPoint(_,s,e),s.x=(d.x+_.x)/2,s.y=(d.y+_.y)/2,this._reversPoint(d,s,e),this._reversPoint(_,s,e),this.resizingRect={x:s.x-(d.x-_.x)/2,y:s.y-this.node.getHeight()/2,width:d.x-_.x,height:this.node.getHeight()}}if("southwest"===this.resizeDirection&&(this._transformPoint(l,s,e),r.x=this._endLogical.x,r.y=this._endLogical.y,s.x=(r.x+l.x)/2,s.y=(r.y+l.y)/2,this._reversPoint(r,s,e),this._reversPoint(l,s,e),this.resizingRect={x:r.x,y:l.y,width:l.x-r.x,height:r.y-l.y}),"south"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,s,e),u.y=g.y-s.y,this._transformPoint(c,s,e),this._transformPoint(u,s,e),s.x=(c.x+u.x)/2,s.y=(c.y+u.y)/2,this._reversPoint(c,s,e),this._reversPoint(u,s,e),this.resizingRect={x:s.x-this.node.getWidth()/2,y:s.y-(u.y-c.y)/2,width:this.node.getWidth(),height:u.y-c.y}}"southeast"===this.resizeDirection&&(this._transformPoint(a,s,e),h.x=this._endLogical.x,h.y=this._endLogical.y,s.x=(a.x+h.x)/2,s.y=(a.y+h.y)/2,this._reversPoint(a,s,e),this._reversPoint(h,s,e),this.resizingRect={x:a.x,y:a.y,width:h.x-a.x,height:h.y-a.y}),this.lazyMode?(this.mark||(this.mark=je.createDiv(),this.mark.style.webkitTransform="rotate("+e+"deg)",this.mark.style.mozTransform="rotate("+e+"deg)",this.mark.style.OTransform="rotate("+e+"deg)",this.mark.style.msTransform="rotate("+e+"deg)",this.mark.style.transform="rotate("+e+"deg)",this.network.getTopDiv().appendChild(this.mark)),je.setDiv(this.mark,this.resizingRect,null,this.network.getResizeLineWidth(),this.network.getResizeLineColor()),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:t,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:t,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(t){var e=this.network.getEditPointSize();if(this.node instanceof Me.ShapeNode){this.shapeNode=this.node;for(var i=this.shapeNode.getPoints(),n=0,o=i.size();o>n;n++){var s=i.get(n);if(this._contains(t,s,e))return this._setCrossCursor(),this.pointIndex=n,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(t){for(var e=this.shapeLink.getPoints(),i=this.network.getEditPointSize(),n=0,o=e.size();o>n;n++){var s=e.get(n);if(this._contains(t,s,i))return this._setCrossCursor(),this.pointIndex=n,!0}return this.pointIndex=-1,!1},_isResizingNode:function(t){var e=this.network.getResizePointSize();if(0>=e)return!1;var i=this.node.getOriginalRect(),n=this.node.getAngle(),o={x:i.x,y:i.y},s=this._rotatePoint(o,n,i);return this._isResizing(t,s.x,s.y,"northwest","nwse-resize")?!0:(o={x:i.x+i.width/2,y:i.y},s=this._rotatePoint(o,n,i),this._isResizing(t,s.x,s.y,"north","ns-resize")?!0:(o={x:i.x+i.width,y:i.y},s=this._rotatePoint(o,n,i),this._isResizing(t,s.x,s.y,"northeast","nesw-resize")?!0:(o={x:i.x,y:i.y+i.height/2},s=this._rotatePoint(o,n,i),this._isResizing(t,s.x,s.y,"west","ew-resize")?!0:(o={x:i.x+i.width,y:i.y+i.height/2},s=this._rotatePoint(o,n,i),this._isResizing(t,s.x,s.y,"east","ew-resize")?!0:(o={x:i.x,y:i.y+i.height},s=this._rotatePoint(o,n,i),this._isResizing(t,s.x,s.y,"southwest","nesw-resize")?!0:(o={x:i.x+i.width/2,y:i.y+i.height},s=this._rotatePoint(o,n,i),this._isResizing(t,s.x,s.y,"south","ns-resize")?!0:(o={x:i.x+i.width,y:i.y+i.height},s=this._rotatePoint(o,n,i),this._isResizing(t,s.x,s.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(t,e,i){var n=Ze.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2),o=n.transform(t);return o},_isResizing:function(t,e,i,n,o){var s=this.network.getResizePointSize();return this._contains(t,{x:e,y:i},s)?(this.resizeDirection!==n&&(this._removeCursor(),o=this._changeCursorWithAngle(n,this.node.getAngle()),this._setCursor(o),this.resizeDirection=n),!0):!1},_getRect:function(t,e,i,n){var o=i>t?t:i,s=n>e?e:n,a=Math.abs(t-i),r=Math.abs(e-n);return{x:o,y:s,width:a,height:r}},_contains:function(t,e,i){var n={x:e.x-i,y:e.y-i,width:2*i,height:2*i};return Ze.containsPoint(n,t)},getPointIndex:function(t,e,i){if(t.size()<2)return 0;for(var n,o=t.get(0),s=1;s<t.size();s++){if(n=t.get(s),this.isPointOnLine(e,o,n,6))return s;o=n}return o=t.get(0),i&&this.isPointOnLine(e,o,n,6)?t.size():0},showRotateScale:function(){this.rotateScale||(this.rotateScale=Oe.html.createCanvas());var t,e,i,n,o,s=(new Me.List,this.network.getRotateScaleWidth()),a=this.network.getRotateScaleHeight(),r=this.network.getRotatePointSize(),h=this.node.getAngle(),l=this.node.getOriginalRect(),c={x:l.x+l.width/2,y:l.y-this.network.getRotatePointOffset()-r},d=this._rotatePoint(c,h,l),u="13px Arial",_=h+"°";this.node.getAngle()>=0&&this.node.getAngle()<=180?(e={x:d.x+r,y:d.y},i={x:e.x+s,y:e.y},n={x:i.x,y:i.y-a},o={x:e.x,y:n.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(e={x:d.x-r,y:d.y},i={x:e.x-s,y:e.y},n={x:i.x,y:i.y-a},o={x:e.x,y:n.y});var g=new Me.List([e,i,n,o]),t=Oe.math.getRect(g),f=Oe.html.setCanvas(this.rotateScale,t);f.fillStyle=this.network.getRotateScaleFillColor(),f.fillRect(t.x,t.y,t.width,t.height),f.fillStyle=this.network.getRotateScaleFontColor(),f.textBaseline="middle",f.textAlign="center",f.font=u,f.fillText(_,t.x+t.width/2,t.y+t.height/2),this.network.getTopDiv().appendChild(this.rotateScale)},isPointOnLine:function(t,e,i,n){0>n&&(n=0);var o=this.getDistanceFromPointToLine(t,e,i);return n>=o&&t.x>=Math.min(e.x,i.x)-n&&t.x<=Math.max(e.x,i.x)+n&&t.y>=Math.min(e.y,i.y)-n&&t.y<=Math.max(e.y,i.y)+n},getDistanceFromPointToLine:function(t,e,i){if(e.x===i.x)return Math.abs(t.x-e.x);var n=(i.y-e.y)/(i.x-e.x),o=(i.x*e.y-e.x*i.y)/(i.x-e.x);return Math.abs(n*t.x-t.y+o)/Math.sqrt(n*n+1)},_transformPoint:function(t,e,i){var n=Math.cos(i*Math.PI/180),o=Math.sin(i*Math.PI/180),s=t.x,a=t.y,r=s*n-a*o,h=s*o+a*n;t.x=r+e.x,t.y=h+e.y},_reversPoint:function(t,e,i){i*=-1;var n=Math.cos(i*Math.PI/180),o=Math.sin(i*Math.PI/180),s=t.x-e.x,a=t.y-e.y,r=s*n-a*o,h=s*o+a*n;t.x=r+e.x,t.y=h+e.y},_changeCursorWithAngle:function(t,e){var i,n=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(t){case"northwest":i=1;break;case"north":i=2;break;case"northeast":i=3;break;case"east":i=4;break;case"southeast":i=5;break;case"south":i=6;break;case"southwest":i=7;break;case"west":i=8;break;default:i=0}return(e>=360||-360>=e)&&(e%=360),e>22.5&&67.5>=e&&(i+=1),-22.5>e&&e>=-67.5&&(i-=1),e>67.5&&112.5>=e&&(i+=2),-67.5>e&&e>=-112.5&&(i-=2),e>112.5&&157.5>=e&&(i+=3),-112.5>e&&e>=-157.5&&(i-=3),e>157.5&&202.5>=e&&(i+=4),-157.5>e&&e>=-202.5&&(i-=4),e>202.5&&247.5>=e&&(i+=5),-202.5>e&&e>=-247.5&&(i-=5),e>247.5&&292.5>=e&&(i+=6),-247.5>e&&e>=-292.5&&(i-=6),e>292.5&&337.5>=e&&(i+=7),-292.5>e&&e>=-337.5&&(i-=7),i>8&&(i-=8),0>=i&&(i+=8),n[i]}}),Me.network.interaction.MoveLinkInteraction=function(t,e){Me.network.interaction.MoveLinkInteraction.superClass.constructor.call(this,t),this.xoffset=0,this.yoffset=0},Oe.ext("twaver.network.interaction.MoveLinkInteraction",Me.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown"),this.oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown"),this.network.getView().style.cursor=this.oldCursor,this.end()},handle_mousedown:function(t){if(0===t.button&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var e=this.network.getElementAt(t);e instanceof Me.Link&&(this.element=e,this.end(t),this._handle_mousedown(t))}},handle_mouseup:function(t){this.end(t)},handle_mousemove:function(t){if(!this._startLogical||this.network.isSelectingElement()||this.network.isEditingElement())return void this.end(t);if(this._handle_mousemove(t),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y,this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:t,element:this.element});else{this.mark=je.createCanvas();var e;this.network.getMovableSelectedElements().forEach(function(t){var i=this.getElementUI(t);i&&(e=Ze.unionRect(e,i.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),je.setDiv(this.mark,e,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:t,element:this.element})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else{var i=new Me.List([this.element.getFromNode(),this.element.getToNode()]);Me.Util.moveElements(i,this.xoffset,this.yoffset),this._startLogical=this._endLogical,this._startClient=je.getClientPoint(t),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t,element:this.element}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t,element:this.element}))}},end:function(t){if(this._startLogical){if(this.lazyMode){if(this.mark){var e=this,i=function(){e.network.fireInteractionEvent({kind:"lazyMoveEnd",event:t,element:this.element}),e.mark&&(e.network.getTopDiv().removeChild(e.mark),e.mark=null,e.network.setMovingElement(!1))},n=new Me.List([this.element.getFromNode(),this.element.getToNode()]);Me.Util.moveElements(n,this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),i)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t,element:this.element}));this._handle_mouseup(t),delete this.element}}}),Me.network.interaction.CreateElementInteraction=function(t,e){e||(e=Fn),this.elementFunction=Me.Util.isTypeOf(e,Fn)?function(t){var i=new e;return i instanceof Fn&&i.setCenterLocation(t),i}:e,Me.network.interaction.CreateElementInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.network.interaction.CreateElementInteraction",Me.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(t){var e=this.network.getLogicalPoint(t);if(e){var i=this.elementFunction(e);i&&this.network.addElementByInteraction(i)}}}),Me.network.interaction.CreateLinkInteraction=function(t,e){e||(e=Me.Link),this.linkFunction=Me.Util.isTypeOf(e,Me.Link)?function(t,i){var n=new e;return n instanceof Me.Link&&(n.setFromNode(t),n.setToNode(i)),n}:e,Me.network.interaction.CreateLinkInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.network.interaction.CreateLinkInteraction",Me.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){var t=this;setTimeout(function(){t._fromRectangle&&(t.network.getTopDiv().removeChild(t._fromRectangle),t._fromRectangle=null),t._currentRectangle&&(t.network.getTopDiv().removeChild(t._currentRectangle),t._currentRectangle=null),t._line&&(t.network.getTopDiv().removeChild(t._line),t._line=null)}),this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(t){if(this.network.isValidEvent(t))if(this.fromNode){if(this.toNode=this.currentNode,this.toNode){var e=this.createLink();e&&this.network.addElementByInteraction(e)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.updateMark()},handle_mousemove:function(t){var e=this.network.getLogicalPoint(t);if(e){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.clear();var i=null;this.fromNode?(this.currentNode=this.getToNode(t),this.currentPoint=e,this.updateMark()):(i=this.getFromNode(t),this.currentNode!==i&&(this.currentNode=i,this.updateMark()))}},getFromNode:function(t){return this.getNode(t)},getToNode:function(t){return this.getNode(t)},getNode:function(t){var e=this.network.getElementAt(t);return e instanceof Fn&&this.network.isLinkable(e)?e:null},updateMark:function(){var t;this.fromNode&&!this._fromRectangle&&this._currentRectangle&&(this._fromRectangle=this._currentRectangle,this._currentRectangle=null),!this.fromNode&&this._fromRectangle&&(this.network.getTopDiv().removeChild(this._fromRectangle),this._fromRectangle=null),this.currentNode&&!this._currentRectangle&&(t=this.network.getElementUI(this.currentNode),this._currentRectangle=je.createDiv(),this.network.getTopDiv().appendChild(this._currentRectangle),je.setDiv(this._currentRectangle,t._viewRect,null,this.network.getEditLineWidth(),this.network.getEditLineColor())),!this.currentNode&&this._currentRectangle&&(this.network.getTopDiv().removeChild(this._currentRectangle),this._currentRectangle=null),this.updateLine()},updateLine:function(){if(this.currentPoint){var t=this.fromNode.getCenterLocation(),e=t.x,i=t.y,n=this.currentPoint.x,o=this.currentPoint.y;this._line||(this._line=je.createCanvas(),this.network.getTopDiv().appendChild(this._line));var s=je.setCanvas(this._line,Math.min(e,n),Math.min(i,o),Math.abs(e-n),Math.abs(i-o));s.lineWidth=this.network.getEditLineWidth(),s.strokeStyle=this.network.getEditLineColor(),s.beginPath(),s.moveTo(e,i),s.lineTo(n,o),s.stroke()}else this._line&&(this.network.getTopDiv().removeChild(this._line),this._line=null)}}),Me.network.interaction.CreateShapeNodeInteraction=function(t,e){e||(e=Me.ShapeNode),this.shapeNodeFunction=Me.Util.isTypeOf(e,Me.ShapeNode)?function(t){var i=new e;return i instanceof Me.ShapeNode&&t&&i.setPoints(t),i}:e,Me.network.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,t),this.timeStamp=-1},Oe.ext("twaver.network.interaction.CreateShapeNodeInteraction",Me.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){this.network.setEditingElement(!1),this.points=null,this.currentPoint=null,this.lastPoint=null,this.horizontal=!1,this.vertical=!1,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null)},handle_mousedown:function(t){if(0===t.button){var e=this.network.getLogicalPoint(t);if(e){if(2===t.detail||t.timeStamp-this.timeStamp<300){if(this.points){var i=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(i),this.clear();var n=this;setTimeout(function(){n.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new fn),this.points.size()>0){var o=this.points.get(this.points.size()-1);if(o.x===e.x&&o.y===e.y)return}this._handle_mousedown(t),this.points.size()>0&&Oe.isCtrlDown(t)&&(this.horizontal&&(e.y=o.y),this.vertical&&(e.x=o.x),this.horizontal=!1,this.vertical=!1),this.lastPoint=e,this.points.add(e),this.updateMark()}this.timeStamp=t.timeStamp}}},handle_mousemove:function(t){if(this.points){if(this.currentPoint=this.network.getLogicalPoint(t),Oe.isCtrlDown(t)){var e=this.currentPoint.x-this.lastPoint.x,i=this.currentPoint.y-this.lastPoint.y;this.horizontal=Math.abs(e)>=Math.abs(i),this.vertical=!this.horizontal}else this.horizontal=!1,this.vertical=!1;this.horizontal&&(this.currentPoint.y=this.lastPoint.y),this.vertical&&(this.currentPoint.x=this.lastPoint.x),this.updateMark()}},updateMark:function(t){if(this.points&&this.points.size()>0&&this.currentPoint){this.mark||(this.mark=je.createCanvas(),this.network.getTopDiv().appendChild(this.mark));var e=new fn(this.points);e.add(this.currentPoint);var i=Ze.getRect(e),n=this.network.getEditLineWidth();Oe.math.grow(i,n,n);var o=je.setCanvas(this.mark,i);o.lineWidth=n,o.strokeStyle=this.network.getEditLineColor(),o.beginPath(),Ke.drawLinePoints(o,e),o.stroke()}}}),Me.network.interaction.CreateShapeLinkInteraction=function(t,e){Me.network.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,t),e||(e=Me.ShapeLink),this.linkFunction=Me.Util.isTypeOf(e,Me.ShapeLink)?function(t,i,n){var o=new e;return o instanceof Me.ShapeLink&&(o.setFromNode(t),o.setToNode(i),n&&o.setPoints(n)),o}:e},Oe.ext("twaver.network.interaction.CreateShapeLinkInteraction",Me.network.interaction.CreateLinkInteraction,{clear:function(){this.network.setEditingElement(!1),this.points=null,this.polyline&&(this.network.getTopDiv().removeChild(this.polyline),this.polyline=null),Me.network.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(t){if(0===t.button){var e=this.network.getLogicalPoint(t);if(e)if(this.fromNode)if(this.toNode=this.currentNode,this.toNode){var i=this.createLink();i&&this.network.addElementByInteraction(i),this.clear()}else{if(this.points||(this.points=new fn),this.points.size()>0){var n=this.points.get(this.points.size()-1);if(n.x===e.x&&n.y===e.y)return}this.points.add(e),this.updateMark()}else this.fromNode=this.currentNode,this.fromNode&&(this.polyline||(this.polyline=je.createCanvas(),this.network.getTopDiv().appendChild(this.polyline))),this.points=null,this.currentNode=null,this.currentPoint=null,this.updateMark()}},updateLine:function(){if(this.currentPoint&&this.polyline){var t=new fn(this.points);t.add(this.fromNode.getCenterLocation(),0),t.add(this.currentPoint);var e=Ze.getRect(t),i=je.setCanvas(this.polyline,e);i.lineWidth=this.network.getEditLineWidth(),i.strokeStyle=this.network.getEditLineColor(),i.beginPath(),Ke.drawLinePoints(i,t),i.stroke()}}}),Me.network.interaction.CreateOrthogonalLinkInteraction=function(t,e,i,n,o,s){Me.network.interaction.CreateOrthogonalLinkInteraction.superClass.constructor.call(this,t,e),this.linkType=i||"orthogonal",this.isByControlPoint=n,this.splitPercent=o,this.isSplitByPercent=s,this.link=new Me.Link,this.link.setStyle("link.type",this.linkType),this.link.setStyle("link.split.by.percent",this.isSplitByPercent),Ti.isFlexionalTypeLink(this.linkType)||Ti.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=Me.Styles.getStyle("link.extend")),this.link.setStyle("link.extend",this.splitPercent)):Ti.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=Me.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?this.link.setStyle("link.split.percent",this.splitPercent):this.link.setStyle("link.split.value",this.splitPercent))},Oe.ext("twaver.network.interaction.CreateOrthogonalLinkInteraction",Me.network.interaction.CreateLinkInteraction,{clear:function(){this.path&&(this.network.getTopDiv().removeChild(this.path),this.path=null),Me.network.interaction.CreateOrthogonalLinkInteraction.superClass.clear.call(this)},createLink:function(){var t=Me.network.interaction.CreateOrthogonalLinkInteraction.superClass.createLink.call(this);if(t.setStyle("link.type",this.linkType),t.setStyle("link.split.by.percent",this.isSplitByPercent),this.isByControlPoint){var e=Ti.getControlPoint(t);if(e)return t.SetStyle("link.control.point",e),t}else Ti.isFlexionalTypeLink(this.linkType)||Ti.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=Me.Styles.getStyle("link.extend")),t.setStyle("link.extend",this.splitPercent)):Ti.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=Me.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?t.setStyle("link.split.percent",this.splitPercent):t.setStyle("link.split.value",this.splitPercent));return t},updateLine:function(){if(this.currentPoint){if(!this.fromNode||this.currentNode===this.fromNode)return;var t,e=this.network.getElementUI(this.fromNode);if(!e)return;if(t=e.getBodyRect(),null==t)return;var i;if(this.currentNode&&this.currentNode!==this.fromNode){var n=this.network.getElementUI(this.currentNode);if(!n)return;i=n.getBodyRect()}else i={x:this.currentPoint.x,y:this.currentPoint.y,width:1,height:1};if(!i)return;var o=Ti.calculateOrthogonalAndFlexionalLinkPoints(this.linkType,t,i,this.link);if(Ti.drawCorner(o,this.link),o.size()<2)return;this.line||(this.line=je.createCanvas(),this.network.getTopDiv().appendChild(this.line));var s=je.setCanvas(this.line,Ze.getLineRect(o));s.lineWidth=this.network.getEditLineWidth(),s.strokeStyle=this.network.getEditLineColor(),s.beginPath(),Ke.drawLinePoints(s,o),s.stroke()}else this.line&&(this.network.getTopDiv().removeChild(this.line),this.line=null)}}),Me.network.interaction.MagnifyInteraction=function(t,e,i,n,o){Me.network.interaction.MagnifyInteraction.superClass.constructor.call(this,t),this.zoom=e||2,this.xRadius=i||100,this.yRadius=n||100,this.shape=o||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=je.createCanvas(),this.markCanvas._isIgnored=!0},Oe.ext("twaver.network.interaction.MagnifyInteraction",Me.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove")},tearDown:function(){this.removeListener("mousemove"),this._clear()},handle_mousemove:function(t){var e=this.network.getLogicalPoint(t);e&&(this.lastPoint||this.network.getView().appendChild(this.markCanvas),this.lastPoint=e,this.updateMark())},updateMark:function(){var t,e=this.network._zoom,i=this.zoom*e,n=this.lastPoint.x*e-this.xRadius,o=this.lastPoint.y*e-this.yRadius,s=2*this.xRadius,a=2*this.yRadius,r={x:this.lastPoint.x-this.xRadius/i,y:this.lastPoint.y-this.yRadius/i,width:s/i,height:a/i},h=this.borderWidth,l=je.createCanvas();l.width=s,l.height=a,this.network.toCanvasByRegion(r,i,l),je.setCanvas(this.markCanvas,n,o,s,a),t=this.markCanvas.getContext("2d"),t.save(),t.beginPath(),Ke.drawVector(t,this.shape,null,n,o,s,a),t.clip(),t.fillStyle=this.backgroundColor,t.beginPath(),t.rect(n,o,s,a),t.fill(),t.drawImage(l,n,o),t.restore(),t.beginPath(),t.lineWidth=h,Ke.drawVector(t,this.shape,null,n+h/2,o+h/2,s-h,a-h),t.strokeStyle=this.borderColor,t.stroke()},_clear:function(t){this.lastPoint&&(this.network.getView().removeChild(this.markCanvas),this.lastPoint=null)},getZoom:function(){return this.zoom},setZoom:function(t){this.zoom=t,this.updateMark()},getShape:function(){return this.shape},setShape:function(t){this.shape=t,this.updateMark()},getXRadius:function(){return this.xRadius},setXRadius:function(t){this.xRadius=t,this.updateMark()},getYRadius:function(){return this.yRadius},setYRadius:function(t){this.yRadius=t,this.updateMark()},getBorderColor:function(){return this.borderColor},setBorderColor:function(t){this.borderColor=t,this.updateMark()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(t){this.borderWidth=t,this.updateMark()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(t){this.backgroundColor=t,this.updateMark()}}),Me.network.interaction.TouchInteraction=function(t){Me.network.interaction.TouchInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.network.interaction.TouchInteraction",Me.network.interaction.BaseInteraction,{setUp:function(){var t=this.network.getView();je.addEventListener("touchstart","handleTouchstart",t,this),je.addEventListener("touchmove","handleTouchmove",t,this),je.addEventListener("touchend","handleTouchend",t,this),je.addEventListener("touchcancel","handleTouchend",t,this)},tearDown:function(){var t=this.network.getView();je.removeEventListener("touchstart",t,this),je.removeEventListener("touchmove",t,this),je.removeEventListener("touchend",t,this),je.removeEventListener("touchcancel",t,this)},handleTouchstart:function(t){if(je.preventDefault(t),t.touches&&1==t.touches.length){var e=this.network.getLogicalPoint(t),i=this.network.getElementAt(e);this._startTouchTime=new Date,this._startTouchPoint=e;var n=this;i?(this._haveElementUnderTouch=!0,this._startTouchElement=i):(this._haveElementUnderTouch=!1,this._startTouchElement=null),this.timer=setTimeout(function(){Ii.handleLongClicked(n.network,t,i)},1e3)}else t.touches&&2==t.touches.length&&(this._distance=bi.getDistance(t),this._zoom=this.network.getZoom(),this._startTouchPoint={x:t.touches[0].clientX,y:t.touches[0].clientY});this._touchCount=t.touches.length},handleTouchmove:function(t){if(je.preventDefault(t),2==this._touchCount&&t.touches&&2==t.touches.length)if(this.timer&&clearTimeout(this.timer),Math.abs(this._distance-bi.getDistance(t))>=Rn.TOUCH_ZOOM_THRESHOLD||this._zoomFlag){this._zoomFlag=!0;var e=bi.getDistance(t)/this._distance;this.network.setTouchZoom(this._zoom*e,!1)}else{var i=t.touches[0],n=this._startTouchPoint.x-i.clientX,o=this._startTouchPoint.y-i.clientY,s=this.network.panByOffset(n,o);this._startTouchPoint.x-=n-s.x,this._startTouchPoint.y-=o-s.y}else if(1==this._touchCount&&t.touches&&1==t.touches.length)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var a=this.network.getLogicalPoint(t),r=this.network.getElementAt(a);if(this.network.isMovingElement()||null!=this._startTouchElement&&this._startTouchElement==r&&this.network.getMovableSelectedElements().contains(r)){var n=a.x-this._startTouchPoint.x,o=a.y-this._startTouchPoint.y;(Math.abs(n)>=Rn.TOUCH_MOVE_THRESHOLD||Math.abs(o)>=Rn.TOUCH_MOVE_THRESHOLD)&&(this._startTouchPoint=a,this.network.moveSelectedElements(n,o),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t}),this.timer&&clearTimeout(this.timer)))}else{var n=a.x-this._startTouchPoint.x,o=a.y-this._startTouchPoint.y;(Math.abs(n)>=Rn.TOUCH_MOVE_THRESHOLD||Math.abs(o)>=Rn.TOUCH_MOVE_THRESHOLD)&&this.timer&&clearTimeout(this.timer)}}else{this._moveTouchPoint=this.network.getLogicalPoint(t);var n=this._moveTouchPoint.x-this._startTouchPoint.x,o=this._moveTouchPoint.y-this._startTouchPoint.y;if(Math.abs(n)>=Rn.TOUCH_RECT_SELECT_THRESHOLD&&Math.abs(o)>=Rn.TOUCH_RECT_SELECT_THRESHOLD){this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:t}):(this.mark=je.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:t}),this.timer&&clearTimeout(this.timer));var h=Ze.getRect([this._startTouchPoint,this._moveTouchPoint]);je.setDiv(this.mark,h,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())}}},handleTouchend:function(t){if(je.preventDefault(t),this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t});else if(this.network.isSelectingElement()){var e=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(e&&e.size()>0){var i=this.network.getSelectionModel(),n=i.toSelection();e.forEach(function(t){i.contains(t)?n.remove(t):n.add(t)},this),i.setSelection(n)}this.network.fireInteractionEvent({kind:"selectEnd",event:t}),this.network.getTopDiv().removeChild(this.mark),this.mark=null,this.network.setSelectingElement(!1),this.timer&&clearTimeout(this.timer)}else if(this._startTouchPoint){this._zoomFlag=!1;var o=new Date,s=this.network.getLogicalPoint(t),a=this.network.getElementAt(this._startTouchPoint);this._startTouchPoint&&s&&o.getTime()-this._startTouchTime.getTime()<=500&&Ze.getDistance(this._startTouchPoint,s)<=20&&(a?this.network.getSelectionModel().contains(a)||this.network.getSelectionModel().setSelection(a):this.network.getSelectionModel().clearSelection(),Ii.handleClicked(this.network,t,a),this.timer&&clearTimeout(this.timer),this._endTouchTime&&o.getTime()-this._endTouchTime.getTime()<=500&&Ze.getDistance(this._endTouchPoint,s)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Ii.handleDoubleClicked(this.network,t,a),this.timer&&clearTimeout(this.timer)):(this._endTouchTime=o,this._endTouchPoint=s))}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y}}),Me.network.interaction.MSTouchInteraction=function(t){Me.network.interaction.MSTouchInteraction.superClass.constructor.call(this,t),this._pointerMap={},this._pointerIdArray=[]},Oe.ext("twaver.network.interaction.MSTouchInteraction",Me.network.interaction.BaseInteraction,{setUp:function(){var t=this.network.getView();je.addEventListener("MSPointerDown","handleTouchstart",t,this),je.addEventListener("MSPointerMove","handleTouchmove",t,this),je.addEventListener("MSPointerUp","handleTouchend",t,this),je.addEventListener("MSPointerCancel","handleTouchend",t,this)},tearDown:function(){var t=this.network.getView();je.removeEventListener("MSPointerDown",t,this),je.removeEventListener("MSPointerMove",t,this),je.removeEventListener("MSPointerUp",t,this),je.removeEventListener("MSPointerCancel",t,this)},handleTouchstart:function(t){if(this.network.isFocusOnClick()&&Me.Util.setFocus(this.network._view),!this.network.isSelectingElement()||t.pointerType!=t.MSPOINTER_TYPE_MOUSE){var e=this.network.getLogicalPoint(t),i=new Date;if(t.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(t),this._pointerMap[t.pointerId]||(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length){var n=this.network.getElementAt(e);this._startTouchElement=n,this._startClientPoint={x:t.clientX,y:t.clientY},Ii.handleClicked(this.network,t,n),this._startTouchTime&&this._startTouchPoint&&i.getTime()-this._startTouchTime.getTime()<=500&&Ze.getDistance(this._startTouchPoint,e)<=20?(Ii.handleDoubleClicked(this.network,t,n),this._doubleClick=!0):(je.handle_mousedown(this,t),this._startTouchPoint=e,this._startTouchTime=i);var o=this.network.getSelectionModel();n?Oe.isCtrlDown(t)?o.contains(n)?o.removeSelection(n):o.appendSelection(n):o.contains(n)||o.setSelection(n):Oe.isCtrlDown(t)||o.clearSelection()}else 2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())}},handleTouchmove:function(t){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ze.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10)&&(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length)){var e=this._getDistance()/this._distance;this.network.setZoom(this._zoom*e,!1)}},handleTouchend:function(t){if(this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t})),this.network.isSelectingElement()){var e=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(e&&e.size()>0){var i=this.network.getSelectionModel(),n=i.toSelection();e.forEach(function(t){i.contains(t)?n.remove(t):n.add(t)},this),i.setSelection(n)}this.network.fireInteractionEvent({kind:"selectEnd",event:t}),this.network.getTopDiv().removeChild(this.mark),this.mark=null,this.network.setSelectingElement(!1)}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);for(var o=-1,s=0;s<this._pointerIdArray.length;s++)if(this._pointerIdArray[s]==t.pointerId){o=s;break}o>=0&&this._pointerIdArray.splice(o,1),delete this._pointerMap[t.pointerId]},_getDistance:function(){return Ze.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(t){if(this._startTouchPoint&&1==this._pointerIdArray.length){if(this._moveTouchPoint={x:this._startTouchPoint.x+(t.clientX-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(t.clientY-this._startClientPoint.y)/this.network.getZoom()},Ze.getDistance(this._startTouchPoint,this._moveTouchPoint)<3)return;if(null==this._startTouchElement&&this.network.isRectSelectEnabled()){this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:t}):(this.mark=je.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:t}));var e=Ze.getRect([this._startTouchPoint,this._moveTouchPoint]);je.setDiv(this.mark,e,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())}else{var i=this.network.getElementAt(this._moveTouchPoint),n=this._moveTouchPoint.x-this._startTouchPoint.x,o=this._moveTouchPoint.y-this._startTouchPoint.y;if(null!=this._startTouchElement||this.network.isRectSelectEnabled())(this.network.isMovingElement()||null!=this._startTouchElement&&i==this._startTouchElement&&this.network.getMovableSelectedElements().contains(i))&&(this.network.moveSelectedElements(n,o),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t})));else{this.network.panByOffset(-n,-o)}this._startClientPoint.x=t.clientX,this._startClientPoint.y=t.clientY}}},handle_mouseup:function(t){this.handleTouchend(t),this._pointerIdArray=[],this._pointerMap={}}});var Hn={_hitCanvas:null,getHitCanvas:function(t,e){null==this._hitCanvas&&(this._hitCanvas=je.createCanvas()),0==arguments.length&&(t=2,e=2),this._hitCanvas.setAttribute("width",""+t-1),this._hitCanvas.setAttribute("height",""+e-1),this._hitCanvas.setAttribute("width",""+t),this._hitCanvas.setAttribute("height",""+e);var i=this.getCtx(this._hitCanvas);return i.clearRect(0,0,t,e),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(t){return t.getContext("2d")},render:function(t,i,n){i!=e&&(t.fillStyle=i,t.fill()),n!=e&&(t.strokeStyle=n,t.stroke())},text:function(t,e,i,n,o,s){t.textAlign="center",t.textBaseline="middle",null!=o&&(t.fillStyle=o,t.fillText(e,i,n)),s&&(t.strokeStyle=s,t.strokeText(e,i,n))},circle:function(t,e,i,n,o,s){t.arc(e,i,n,0,2*Math.PI,!0),t.closePath(),this.render(t,o,s)},rect:function(t,e,i,n,o,s,a){t.rect(e,i,n,o),t.closePath(),this.render(t,s,a)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(t,e,i,n,o,s){var a=0;return 0>=o?a|=this.OUT_LEFT|this.OUT_RIGHT:i>t?a|=this.OUT_LEFT:t>i+o&&(a|=this.OUT_RIGHT),0>=s?a|=this.OUT_TOP|this.OUT_BOTTOM:n>e?a|=this.OUT_TOP:e>n+s&&(a|=this.OUT_BOTTOM),a},intersectsLine:function(t,e,i,n,o,s,a,r){var h,l;if(0==(l=this.outcode(i,n,o,s,a,r)))return!0;for(;0!=(h=this.outcode(t,e,o,s,a,r));){if(0!=(h&l))return!1;if(0!=(h&(this.OUT_LEFT|this.OUT_RIGHT))){var c=o;0!=(h&this.OUT_RIGHT)&&(c+=a),e+=(c-t)*(n-e)/(i-t),t=c}else{var d=s;0!=(h&this.OUT_BOTTOM)&&(d+=r),t+=(d-e)*(i-t)/(n-e),e=d}}return!0}};Me.canvas={},Me.canvas.interaction={},Me.canvas.Network=function(t){Me.canvas.Network.superClass.constructor.apply(this,arguments),this._rootCanvas=je.createCanvas(),this._topCanvas=je.createCanvas(),this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0},this._zoom=1,this._elementUIMap={},this._visibleMap={},this.viewRect={x:0,y:0,width:0,height:0},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new Me.List,this._topAttachmentList=new Me.List,this.setElementBox(t?t:new Me.ElementBox),ze||(this._view=je.createView("hidden"),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),He.isTouchable?He.isMSTouchable?this.setMSTouchInteractions():this.setTouchInteractions():this.setDefaultInteractions(!1),this.setToolTipEnabled(Me.Defaults.NETWORK_TOOLTIP_ENABLED));var e=this;this._flowLink=function(){if(!(e.isMovingElement()||e.isSelectingElement()||e.isEditingElement()||e._box._layoutMovingElements)){e._flowLinkQuickFinder||(e._flowLinkQuickFinder=new Me.QuickFinder(e._box,"link.flow","style"));var t=e._flowLinkQuickFinder.find(!0);t.forEach(function(t){t._styleMap["link.flow.offset"]=e.getLinkFlowOffset(t);var i=e.getElementUI(t);i.invalidate(!1)})}},Me.imageUtil.addEventListener(this.invalidateElementUIs,this)},Oe.ext("twaver.canvas.Network",Me.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","scrollBarWidth","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","paddingRight","paddingBottom","selectionTolerance"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","scrollBarVisible","limitViewInCanvas","autoValidateCanvasSize","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable","debug","showShadowInEdit"],_currentSubNetwork:null,_subNetworkAnimate:Me.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!0,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:Me.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Me.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Me.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:Rn.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:Me.Defaults.CANVASUI_FUNCTION,_doubleClickToUpSubNetwork:Me.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:Me.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:Me.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:Me.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:Me.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:Me.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:Me.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:Me.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:Me.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:Me.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:Me.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:Me.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:Me.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:Me.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointSize:Me.Defaults.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:Me.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:Me.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:Me.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:Me.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:Me.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:Me.Defaults.NETWORK_RESIZE_ANIMATE,_editPointSize:Me.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:Me.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:Me.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:Me.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:Me.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:Me.Defaults.NETWORK_EDIT_LINE_WIDTH,_rotatePointSize:Me.Defaults.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:Me.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:Me.Defaults.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:Me.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:Me.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:Rn.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:Rn.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:Rn.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:Rn.NETWORK_ROTATE_SCALE_FONT_COLOR,_limitElementInPositiveLocation:Rn.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_linkFlowInterval:Rn.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:Rn.NETWORK_SELECTION_TOLERANCE,_invalidateElementVisibility:!1,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_paddingRight:0,_paddingBottom:0,_transparentSelectionEnable:Me.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,_debug:!1,_showShadowInEdit:!1,adjustBounds:function(t){if(ze)this._rootCanvas=new Ne(t.width,t.height),this._topCanvas=new Ne(t.width,t.height),this.setViewRect(t.x,t.y,t.width,t.height);else{var e=!1,i=this._view.style;if(i.left==t.x+"px"&&i.top==t.y+"px"&&i.width==t.width+"px"&&i.height==t.height+"px"&&(e=!0),Me.canvas.Network.superClass.adjustBounds.apply(this,arguments),1==e)return;var n=this._view.offsetWidth,o=this._view.offsetHeight;this._rootCanvas.setAttribute("width",n),this._rootCanvas.setAttribute("height",o),this._topCanvas.setAttribute("width",n),this._topCanvas.setAttribute("height",o),this.setViewRect(this.viewRect.x,this.viewRect.y,n,o)}"undefined"==typeof Me.gis&&(Me.Util.makeHighRes(this._rootCanvas),Me.Util.makeHighRes(this._topCanvas)),this.invalidateElementVisibility()},getLabel:function(t){return t.getStyle("network.label")||t.getName()},getBackgroundImage:function(){return this._backgroundImage},setBackgroundImage:function(t){if(this._backgroundImage!=t){var e=this._backgroundImage;this._backgroundImage=t;var i=this._backgroundImage;if(i&&!i._viewRect)if(i.width>0)i._viewRect={x:0,y:0,width:i.width,height:i.height},this.validateCanvasSize(),this.firePropertyChange("backgroundImage",e,i);else{var n=this;i.onload=function(){i._viewRect={x:0,y:0,width:i.width,height:i.height},n.validateCanvasSize(),n.firePropertyChange("backgroundImage",e,i),i.onload=null}}else this.firePropertyChange("backgroundImage",e,i),this.validateCanvasSize()}},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){if(!ze&&gi.twm(this),1==this._invalidateElementVisibility){this._invalidateElementVisibility=!1;var t,e,i,n=this.getElementBox().getDatas()._as,o=n.length,s={},a=this._visibleFunction,r=1===this._box._layerBox.size()?this._box._layerBox._defaultLayer:null;for(t=0;o>t;t++)e=n[t],s[e._id]=this.isVisible(e,a,r);if(this._visibleMap)for(t=0;o>t;t++)e=n[t],s[e._id]!==this._visibleMap[e._id]&&(i=this._elementUIMap[e._id],i&&i.invalidate());for(t=0;o>t;t++)e=n[t],i=this._elementUIMap[e._id],i&&i.validate();this._visibleMap=s,this.paintRoot()}this.validateCanvasSize(),1==this._repaintTopFlag&&(this._repaintTopFlag=!1,this.paintTopCanvas())},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(t){t?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(t){var e=this._linkFlowInterval;this._linkFlowInterval=t,this.firePropertyChange("linkFlowInterval",e,t),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getElementBox:function(){return this._box},setElementBox:function(t){if(!t)throw"ElementBox can not be null";if(this._box!==t){var e=this._box;e&&(e.removeDataBoxChangeListener(this.handleElementBoxChange,this),e.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),e.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),e.removeIndexChangeListener(this.handleIndexChange,this),e.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),e.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),e.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=t,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new Me.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(t):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange("elementBox",e,this._box)}},handleElementBoxChange:function(t){var e=t.data;if("add"===t.kind)this.createElementUI(e),this.invalidateBundleLink(e);else if("remove"===t.kind){var i=this.getElementUI(e);i&&(i.dispose(),delete this._elementUIMap[e.getId()]),e===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null)}else if("clear"===t.kind){for(var n in this._elementUIMap)this._elementUIMap[n]&&this._elementUIMap[n].dispose&&this._elementUIMap[n].dispose();this._elementUIMap={},null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null)}this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(t){var e=t.source,i=this.getElementUI(e);i&&i.handlePropertyChange(t),this.invalidateBundleLink(e),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(t){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(t){"editable"===t.property&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(t){t.datas.forEach(function(e){var i=this.getElementUI(e);i&&i.handleSelectionChange(t)},this);var e=this.getSelectionModel().getLastData();e&&("append"===t.kind||"set"===t.kind)&&(this.isMakeVisibleOnSelected()&&this.makeVisible(e),this.isSendToTopOnSelected()&&this.sendToTop(e)),this.invalidateElementVisibility()},sendToTop:function(t){if(this._box.contains(t)){for(var e=t;e._parent&&this.isVisible(e._parent)&&(e=e._parent););e!==t&&this._box.adjustElementIndex(e),this._box.adjustElementIndex(t)}},getScopeRect:function(t){var e=this._zoom;if("viewsize"===t)return{x:this._unionBounds.x-this.viewRect.x,y:this._unionBounds.y-this.viewRect.y,width:this._unionBounds.width,height:this._unionBounds.height};if("viewport"===t){if(this.viewRect)return Oe.cloneRect(this.viewRect)}else if("rootcanvas"===t)return{x:this.viewRect.x,y:this.viewRect.y,width:(Math.abs(this.viewRect.x-this._unionBounds.x)+this._unionBounds.width)*e,height:(Math.abs(this.viewRect.y-this._unionBounds.y)+this._unionBounds.height)*e};return{x:0,y:0,width:0,height:0}},getViewRect:function(){return this.viewRect?Oe.clone(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},getUnionBounds:function(){return this._unionBounds},setViewOffSet:function(t,e){var i=this.viewRect.x,n=this.viewRect.y,o=this.viewRect.width,s=this.viewRect.height;this.setViewRect(i+t,n+e,o,s)},setViewRect:function(t,e,i,n){1==this.isLimitViewInCanvas()&&(0>t&&(t=0),i>this.realWidth?t=0:t+i>this.realWidth&&(t=this.realWidth-i),0>e&&(e=0),n>this.realHeight?e=0:e+n>this.realHeight&&(e=this.realHeight-n));var o=this.viewRect;(null==this.viewRect||t!=this.viewRect.x||e!=this.viewRect.y||i!=this.viewRect.width||n!=this.viewRect.height)&&(this.viewRect={x:t,y:e,width:i,height:n},this.firePropertyChange("viewRect",o,this.viewRect),this.invalidateElementVisibility())},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(t){this.hScrollBarVisible=t},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(t){this.vScrollBarVisible=t},dispose:function(){Me.imageUtil.removeEventListener(this.invalidateElementUIs,this);for(var t in this._elementUIMap){var e=this._elementUIMap[t];e.curInterval&&clearTimeout(e.curInterval)}this.setInteractions(null)},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(t){this._invalidateCanvasSizeFlag||(this._invalidateCanvasSizeFlag=!0,this.invalidate())},validateCanvasSize:function(){0!=this._invalidateCanvasSizeFlag&&(this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize())},_validateCanvasSize:function(){if(!this.isMovingElement()){if(0==this.isAutoValidateCanvasSize())return this.realWidth=0,this.realHeight=0,void(this._unionBounds={x:0,y:0,width:0,height:0});var t=this.getElementBox().getDatas(),e=t.size();if(e>0){for(var i={x:0,y:0,width:0,height:0},n=0;e>n;n++){var o=t.get(n);if(this._visibleMap[o._id]){var s=this._elementUIMap[o._id];s&&(i=Ze.unionRect(i,s._viewRect))}}var a=this.getBackgroundImage();if(a&&(i=Ze.unionRect(i,a._viewRect)),this.realWidth==(i.x+i.width)*this.getZoom()&&this.realHeight==(i.y+i.height)*this.getZoom())return;var r=this.getZoom();this.realWidth=(i.x+i.width)*r+this._paddingRight,this.realHeight=(i.y+i.height)*r+this._paddingBottom,this._unionBounds={x:i.x*r,y:i.y*r,width:i.width*r+this._paddingRight,height:i.height*r+this._paddingRight}}else this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange("canvasSizeChange",null,this.viewRect)}},getElementUI:function(t){return null==t?null:this._elementUIMap[t._id]},createElementUI:function(t){var e=this._elementUIMap[t.getId()];e||(e=this._elementUIFunction(this,t),e&&(this._elementUIMap[t.getId()]=e))},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(t){if(!t)throw"ElementUIFunction can not be null";if(this._elementUIFunction!==t){var e=this._elementUIFunction;this._elementUIFunction=t,this.firePropertyChange("elementUIFunction",e,t),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())}},invalidateElementUI:function(t,e){var i=this.getElementUI(t);i&&i.invalidate(e)},invalidateElementUIs:function(t){for(var e in this._elementUIMap){var i=this._elementUIMap[e];i.invalidate(t)}},invalidateSelectedElementUIs:function(t){this.getSelectionModel().getSelection().forEach(function(e){this.invalidateElementUI(e,t)},this)},invalidateBundleLink:function(t){if(t instanceof Me.Link&&t._bundleLinks){var e=this._elementUIMap;t._bundleLinks.forEachSiblingLink(function(i){if(i!==t){var n=e[i._id];n&&n.invalidate(!1)}},this)}},paintRoot:function(){var t=this._rootCanvas.getContext("2d");if(t.clearRect(0,0,this._rootCanvas.width,this._rootCanvas.height),this.visibleList=new Me.List,this._topAttachmentList=new Me.List,null!=this.getElementBox()){_n.draw(t,this);var i=this.getElementBox().getDatas()._as,n=i.length;t.save(),t.scale(this.getZoom(),this.getZoom()),t.translate(-this.viewRect.x/this.getZoom(),-this.viewRect.y/this.getZoom()),this.paintBottom(t);var o={x:this.viewRect.x/this.getZoom(),y:this.viewRect.y/this.getZoom(),width:this.viewRect.width/this.getZoom(),height:this.viewRect.height/this.getZoom()},s=this.getBackgroundImage(),a=this.getBackgroundImageRect();if(s instanceof Ue&&(a?t.drawImage(s,a.x,a.y,a.width,a.height):t.drawImage(s,0,0,s.width,s.height),s._viewRect={x:0,y:0,width:s.width,height:s.height}),"string"==typeof s){var r=Oe.getImageAsset(s),h={x:0,y:0,width:r.getWidth(),height:r.getHeight()};Vi(t,s,null,h,null,this)}var l,c,d,u,_=this._box._layerBox;if(1===_.size())for(l=0;n>l;l++)c=i[l],this._visibleMap[c._id]&&(d=this._elementUIMap[c._id],null!=d&&this._isInView(d,o)?(d.paint(t),d.setAttachmentVisible&&d.setAttachmentVisible(!0),this.visibleList.add(c)):d.setAttachmentVisible&&d.setAttachmentVisible(!1));else _.forEachByDepthFirst(function(e){for(l=0;n>l;l++)c=i[l],_.getLayerByElement(c)===e&&this._visibleMap[c._id]&&(d=this._elementUIMap[c._id],null!=d&&this._isInView(d,o)?(d.paint(t),d.setAttachmentVisible&&d.setAttachmentVisible(!0),this.visibleList.add(c)):d.setAttachmentVisible&&d.setAttachmentVisible(!1))},null,this);for(n=this._topAttachmentList.size(),l=0;n>l;l++)u=this._topAttachmentList.get(l),u.getElementUI().paintAttachment(t,u);if(this._xyz){var n,g=this._xyz,f=g.markText,v=g.type,m=(g.expired,g.innerHTML),p=0,y=0,w=this.viewRect;t.translate(this.viewRect.x/this.getZoom(),this.viewRect.y/this.getZoom()),t.scale(1/this.getZoom(),1/this.getZoom());{this.getZoom()}f!=e&&null!=f&&""!=f||"2"==v?(t.font="15px Arial sans-serif",n=Oe.g.getTextSize(t.font,m),t.fillStyle="red",p=w.width-n.width,y=w.height-20):(t.font="10px Arial sans-serif",n=Oe.g.getTextSize(t.font,m),p=w.width/2-n.width/2,y=w.height/2),t.fillText(m,p,y)}t.restore()}},paintBottom:function(t){},_isInView:function(t,e){return Ze.intersects(e,t._viewRect)},paintTopCanvas:function(){var t=this._topCanvas.getContext("2d");t.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(t)},paintMarker:function(t){for(var e=this.markerList.size(),i=0;e>i;i++){var n=this.markerList.get(i);n.paint(t)}},getLayerByElement:function(t){return this._box.getLayerBox().getLayerByElement(t)},getLogicalPoint:function(t){var e;if(He.isTouchable&&t.changedTouches&&t.changedTouches.length>0){var i=this._view.getBoundingClientRect(),n=t.changedTouches[0],o=He.isAndroid?0:bi.scrollLeft(),s=He.isAndroid?0:bi.scrollTop();return e={x:(n.clientX+this.viewRect.x-i.left-o)/this._zoom,y:(n.clientY+this.viewRect.y-i.top-s)/this._zoom}}return e=He.isFirefox?{x:(t.layerX+this.viewRect.x)/this.getZoom(),y:(t.layerY+this.viewRect.y)/this.getZoom()}:{x:(t.offsetX+this.viewRect.x)/this.getZoom(),y:(t.offsetY+this.viewRect.y)/this.getZoom()}},getElementAt:function(t,e){if(null==this.visibleList)return null;1===arguments.length&&(e=!0);var i,n;if(t.target?i=this.getLogicalPoint(t):t.event?t.event.target&&(i=this.getLogicalPoint(t.event)):i=t,null!=this._topAttachmentList)for(var o=this._topAttachmentList.size(),s=o-1;s>=0;s--){var a=this._topAttachmentList.get(s);if(n=a.getElement(),(!e||this.isSelectable(n))&&a.hit(i.x,i.y))return n}if(null!=this.visibleList)for(var r=this.visibleList.size(),h=r-1;h>=0;h--){var l=this.visibleList.get(h),c=this.getElementUI(l);if((!e||this.isSelectable(l))&&c&&c.hit(i.x,i.y))return l}return null},hitTest:function(t){var e=this.getElementAt(t);if(!e)return null;var i=this.getElementUI(e);if(!i)return null;var n;return n=t.target?this.getLogicalPoint(t):t,i.hitTest(n.x,n.y)},getElementsAtRect:function(t,i,n,o){var s=new Me.List;if(null==this.visibleList)return s;o=o===e?!0:o;for(var a=this.visibleList.size(),r=a-1;r>=0;r--){var h=this.visibleList.get(r),l=this.getElementUI(h);l&&(!n||n(l._element))&&(o&&this.isSelectable(l._element)||!o)&&(i?l.intersects(t)&&s.add(h):Ze.contains(t,l.getViewRect())&&s.add(h))}return s},getPosition:function(t,e,i,n,o){var s,a=e instanceof Me.canvas.ElementUI?e:this.getElementUI(e);if(a)if("from"===t||"to"===t){if(a.getFromPosition&&(s="from"===t?a.getFromPosition(n,o):a.getToPosition(n,o)))return i?{x:s.x-i.width/2,y:s.y-i.height/2}:s}else s="hotspot"===t?a.getHotSpot():Xe.get(t,a.getBodyRect(),i);if(!s&&e.getRect&&(s=Xe.get(t,e.getRect(),i)),s)return{x:s.x+n,y:s.y+o};throw"position '"+t+"' object '"+e+"'"},isValidEvent:function(t){if(!t)return!1;var e,i;if(t.currentTarget===this._view){if(He.isFirefox?(e=t.layerX,i=t.layerY):(e=t.offsetX,i=t.offsetY),1==this.isHScrollBarVisible()&&i>=this.viewRect.height-this.getScrollBarWidth())return!1;if(1==this.isVScrollBarVisible()&&e>=this.viewRect.width-this.getScrollBarWidth())return!1}return!0},addMarker:function(t){this.markerList.add(t),this.repaintTopCanvas()},removeMarker:function(t){this.markerList.remove(t),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(t){return this._box.contains(t)?t instanceof Me.Link?!1:this._movableFunction&&!this._movableFunction(t)?!1:this.getLayerByElement(t).isMovable():!1},hasMovableSelectedElements:function(){for(var t=this.getSelectionModel().getSelection(),e=0;e<t.size();e++){var i=t.get(e);if(this.isMovable(i))return!0}return!1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(t){return this.isMovable(t)},this)},moveSelectedElements:function(t,e,i,n){if(0!==t||0!==e){var o=this.getMovableSelectedElementsRect();null!=o&&(this._limitElementInPositiveLocation&&(o.x+t<0&&(t=-o.x),o.y+e<0&&(e=-o.y)),Me.Util.moveElements(this.getMovableSelectedElements(),t,e,i,n,this))}},getMovableSelectedElementsRect:function(){var t=this.getMovableSelectedElements();if(0===t.size())return null;for(var e=null,i=0,n=t.size();n>i;i++){var o=t.get(i);if(o instanceof Fn){var s=this.getElementUI(o);s&&(e=Ze.unionRect(e,s.getViewRect()))}}return e},isVisible:function(t,e,i){if(!this._box.contains(t))return!1;if(!t.isVisible())return!1;if(3!==arguments.length&&(e=this._visibleFunction),e&&!e(t))return!1;if(!(i||this._box._layerBox.getLayerByElement(t))._visible)return!1;if(xi.getSubNetwork(t)!==this._currentSubNetwork)return!1;if(t instanceof Me.Link){if(!this._noAgentLinkVisible){if(!t._fromAgent||!t._toAgent)return!1;if(!this.isVisible(t._fromAgent,e,i)||!this.isVisible(t._toAgent,e,i))return!1}if(t.getBundleIndex()>0&&t.getBundleCount()>1&&!t.getStyle("link.bundle.expanded"))return!1}else for(var n=t._parent;n&&!n.ISubNetwork;){if(n instanceof Me.Group&&(!n.isExpanded()||!this.isVisible(n,e,i)))return!1;n=n._parent}return t.IDummy?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(t){var e=this._visibleFunction;this._visibleFunction=t,this.firePropertyChange("visibleFunction",e,t),this.invalidateElementVisibility()},isEditable:function(t){return this._box.contains(t)?this._editableFunction&&!this._editableFunction(t)?!1:this.getLayerByElement(t).isEditable():!1},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(t){var e=this._editableFunction;this._editableFunction=t,this.firePropertyChange("editableFunction",e,t),this.invalidateSelectedElementUIs(!0)},isRotatable:function(t){return this._rotatableFunction&&!this._rotatableFunction(t)?!1:!0},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(t){var e=this._rotatableFunction;this._rotatableFunction=t,this.firePropertyChange("rotatableFunction",e,t),this.invalidateSelectedElementUIs(!0)},isLinkable:function(t){return null==this._linkableFunction||this._linkableFunction(t)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(t){var e=this._linkableFunction;this._linkableFunction=t,this.firePropertyChange("linkableFunction",e,t),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(t){var e=t.getStyle("shadow.color");return!e&&this.isSelected(t)&&"shadow"===t.getStyle("select.style")?t.getStyle("select.color"):e},getSelectColor:function(t){return t.getStyle("select.color")},getAlarmLabel:function(t){var e=t.getAlarmState().getHighestNewAlarmSeverity();if(e){var i=t.getAlarmState().getNewAlarmCount(e)+e.nickName;return t.getAlarmState().hasLessSevereNewAlarms()&&(i+="+"),i}return null},getLinkHandlerLabel:function(t){return t.isBundleAgent()?"+("+t.getBundleCount()+")":null},setInteractions:function(t){var e=this._interactions;e&&e.forEach(function(t){t.tearDown()}),this._interactions=t,t&&t.forEach(function(t){t.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",e,t)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(t){this.setInteractions([new Me.canvas.interaction.DefaultInteraction(this),new Me.canvas.interaction.SelectInteraction(this),new Me.canvas.interaction.MoveInteraction(this,t),new Me.canvas.interaction.ScrollInteraction(this)])},setTouchInteractions:function(){this.setInteractions([new Me.canvas.interaction.DefaultInteraction(this),new Me.canvas.interaction.SelectInteraction(this),new Me.canvas.interaction.MoveInteraction(this,!1),new Me.canvas.interaction.ScrollInteraction(this),new Me.canvas.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new Me.canvas.interaction.ScrollInteraction(this),new Me.canvas.interaction.MSTouchInteraction(this)])},setEditInteractions:function(t){this.setInteractions([new Me.canvas.interaction.DefaultInteraction(this),new Me.canvas.interaction.SelectInteraction(this),new Me.canvas.interaction.EditInteraction(this,t),new Me.canvas.interaction.MoveInteraction(this,t),new Me.canvas.interaction.ScrollInteraction(this)])},setCreateElementInteractions:function(t){this.setInteractions([new Me.canvas.interaction.DefaultInteraction(this),new Me.canvas.interaction.CreateElementInteraction(this,t)])},setCreateLinkInteractions:function(t){this.setInteractions([new Me.canvas.interaction.DefaultInteraction(this),new Me.canvas.interaction.CreateLinkInteraction(this,t),new Me.canvas.interaction.ScrollInteraction(this)])},setCreateShapeLinkInteractions:function(t){this.setInteractions([new Me.canvas.interaction.DefaultInteraction(this),new Me.canvas.interaction.CreateShapeLinkInteraction(this,t),new Me.canvas.interaction.ScrollInteraction(this)])},setCreateShapeNodeInteractions:function(t){this.setInteractions([new Me.canvas.interaction.DefaultInteraction(this),new Me.canvas.interaction.CreateShapeNodeInteraction(this,t),new Me.canvas.interaction.ScrollInteraction(this)])},setPanInteractions:function(){this.setInteractions([new Me.canvas.interaction.DefaultInteraction(this),new Me.canvas.interaction.PanInteraction(this),new Me.canvas.interaction.ScrollInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new Me.canvas.interaction.DefaultInteraction(this),new Me.canvas.interaction.SelectInteraction(this),new Me.canvas.interaction.MoveInteraction(this),new Me.canvas.interaction.ScrollInteraction(this),new Me.canvas.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(t){var e=this._hasEditInteraction;this._hasEditInteraction=t,this.firePropertyChange("hasEditInteraction",e,t)},addElementByInteraction:function(t){t.getParent()||t.setParent(this._currentSubNetwork),this._box.add(t),this.getSelectionModel().setSelection(t),this.fireInteractionEvent({kind:"createElement",element:t})},getToolTip:function(t){if(t){var e=t.getToolTip();return e?e:t.getName()}return null},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(t){if(this._toolTipEnabled=t,t){if(!this._toolTipListener){var e=this;this._toolTipListener=function(t){if(e.isMovingElement())return void Si.hideToolTip();var i=e.getElementAt(t);if(e._preElement!==i)if(e._preElement=i,i){var n=e.getToolTip(i);Si.showToolTip({x:t.pageX,y:t.pageY},n);var o=Si.getToolTipDiv(),o=Si.getToolTipDiv();if(o.children.length>0){var s=e._view.getBoundingClientRect(),a=o.getBoundingClientRect();a.width+a.left>s.width+s.left&&(o.style.left=s.width+s.left-a.width+(Ve.documentElement.scrollLeft||Ve.body.scrollLeft)+"px"),a.height+a.top>s.height+s.top&&(o.style.top=s.height+s.top-a.height+(Ve.documentElement.scrollTop||Ve.body.scrollTop)+"px")}}else Si.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!1),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Si.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!1),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},setZoom:function(t){t=this.checkZoom(t);var e=this._zoom;if(this._zoom!=t){var i={x:(this.viewRect.x+this.viewRect.width/2)/this.getZoom()*t,y:(this.viewRect.y+this.viewRect.height/2)/this.getZoom()*t};this._zoom=t,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.setViewRect(i.x-this.viewRect.width/2,i.y-this.viewRect.height/2,this.viewRect.width,this.viewRect.height),this.firePropertyChange("zoom",e,this._zoom)}},getZoom:function(){return this._zoom},setTouchZoom:function(t){this.setZoom(t,!1)},zoomOverview:function(t){if(!(this.realWidth<=0||this.realHeight<=0)){var e=this.realWidth/this.getZoom(),i=this.realHeight/this.getZoom(),n=this.viewRect.width/e,o=this.viewRect.height/i,s=Math.min(n,o);this.setZoom(s)}},zoomReset:function(){this.setZoom(1)},zoomIn:function(){this.setZoom(1.2*this.getZoom())},zoomOut:function(){this.setZoom(this.getZoom()/1.2)},upSubNetwork:function(t,e){this._currentSubNetwork&&this.setCurrentSubNetwork(xi.getSubNetwork(this._currentSubNetwork),t,e)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(t,e,i){if(Me.animate.AnimateManager.endAnimate(),e){if(this._currentSubNetwork===t)return;if(t&&!this._box.contains(t))throw t+" is not contained in this network's elementBox";var n=new Me.animate.AnimateSubNetwork(this,t,i);Me.animate.AnimateManager.start(n)}else this._setCurrentSubNetwork(t),i&&i()},_setCurrentSubNetwork:function(t){if(this._currentSubNetwork!==t){if(t&&!this._box.contains(t))throw t+" is not contained in this network's elementBox";var e=this._currentSubNetwork;this._currentSubNetwork=t,this.firePropertyChange("currentSubNetwork",e,t),this.invalidateElementVisibility(),this.invalidateCanvasSize()}},makeVisible:function(t){var e=this.getElementUI(t);if(e){var i=xi.getSubNetwork(t);if(i!==this._currentSubNetwork){var n=this;return void this.setCurrentSubNetwork(i,this.isSubNetworkAnimate(),function(){Oe.callLater(n.makeVisible,n,[t])})}for(var o=t;(o=o.getParent())&&o!==i;)o instanceof Me.Group&&o.setExpanded(!0);var s=e.getViewRect();if(s){var a={x:s.x*this.getZoom(),y:s.y*this.getZoom(),width:s.width*this.getZoom(),height:s.height*this.getZoom()};Ze.intersects(this.viewRect,a)||this.isVisible(t)&&Oe.callLater(this.centerByLogicalPoint,this,[a.x+a.width/2,a.y+a.height/2])}}},centerByLogicalPoint:function(t,e,i){var n=t-this.viewRect.width/2,o=e-this.viewRect.height/2;this.setViewRect(n,o,this.viewRect.width,this.viewRect.height)},panByOffset:function(t,e){this.setViewOffSet(t,e)},getIconsNames:function(t){return t.getStyle("icons.names")},getIconsColors:function(t){return t.getStyle("icons.colors")},getLinkFlowStepping:function(t){var e=parseInt(t.getStyle("link.flow.stepping"));return e||(e=Rn.NETWORK_LINK_FLOW_STEPPING),e},getLinkFlowOffset:function(t){var e=t.getStyle("link.flow.offset");return isNaN(e)&&(e=0),e+this.getLinkFlowStepping(t)},toCanvas:function(t,e,i,n,o,s){i||(i=je.createCanvas()),i.setAttribute("width",t),i.setAttribute("height",e),i._viewRect?(i._viewRect.width=t,i._viewRect.height=e):i._viewRect={x:0,y:0,width:t,height:e};var a=i.getContext("2d");if(a.translate(-o,-s),a.clearRect(0,0,t,e),_n.draw(a,this),0===this._view.clientWidth||0===this._view.clientHeight)return i;t/this.realWidth*this.getZoom(),e/this.realHeight*this.getZoom();a.scale(n,n);var r=this.getElementBox().getDatas()._as,h=r.length;this._topAttachmentList=new Me.List;var l,c,d,u,_,g,f=this.getElementBox().getLayerBox(),v=f.getRoots(),m=v.size();if(1===m)for(d=0;h>d;d++)u=r[d],this._visibleMap[u._id]&&(_=this._elementUIMap[u._id],null!=_&&_.paint(a));else for(l=0;m>l;l++)for(c=v.get(l),d=0;h>d;d++)u=r[d],f.getLayerByElement(u)===c&&this._visibleMap[u._id]&&(_=this._elementUIMap[u._id],null!=_&&_.paint(a));for(h=this._topAttachmentList.size(),d=0;h>d;d++)g=this._topAttachmentList.get(d),g.getElementUI().paintAttachment(a,g);return i},toCanvasByRegion:function(t,e,i){i||(i=je.createCanvas());var n=t.width*e,o=t.height*e;i.setAttribute("width",n),i.setAttribute("height",o),i._viewRect?(i._viewRect.width=n,i._viewRect.height=o):i._viewRect={x:0,y:0,width:n,height:o};var s=i.getContext("2d");if(s.clearRect(0,0,n,o),_n.draw(s,this),0===this._view.clientWidth||0===this._view.clientHeight)return i;s.save(),s.scale(e,e),s.beginPath(),s.translate(-t.x,-t.y);var a=this.getElementBox().getDatas()._as,r=a.length;this._topAttachmentList=new Me.List;var h=this.getBackgroundImage();if(h&&h._viewRect&&Ze.intersects(t,h._viewRect)){var t=Ze.intersection(t,h._viewRect),l=h._viewRect;try{s.drawImage(h,l.x,l.y,l.width,l.height)}catch(t){}}var c,d,u,_,g,f,v=this.getElementBox().getLayerBox(),m=v.getRoots(),p=m.size();if(1===p)for(u=0;r>u;u++)_=a[u],this._visibleMap[_._id]&&(g=this._elementUIMap[_._id],null!=g&&Ze.intersects(t,g._viewRect)&&g.paint(s));else for(c=0;p>c;c++)for(d=m.get(c),u=0;r>u;u++)_=a[u],v.getLayerByElement(_)===d&&this._visibleMap[_._id]&&(g=this._elementUIMap[_._id],null!=g&&Ze.intersects(t,g._viewRect)&&g.paint(s));for(r=this._topAttachmentList.size(),u=0;r>u;u++)f=this._topAttachmentList.get(u),f.getElementUI().paintAttachment(s,f);return s.restore(),i},getGroupChildrenRects:function(t){var e=new fn;return t.getChildren().forEach(function(t){if(t instanceof Fn){var i=this.getElementUI(t);if(i){var n=i.getViewRect();n&&e.add(n)}}},this),e},getBackgroundImageRect:function(){return null},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(t){var e=this._linkPathFunction;this._linkPathFunction=t,this.firePropertyChange("linkPathFunction",e,t),this.invalidateElementUIs()},onClickElement:function(t,e){},onClickBackground:function(t){},onDoubleClickElement:function(t,e){},onDoubleClickBackground:function(t){},onLongClickElement:function(t,e){},onLongClickBackground:function(t){},onMouseMove:function(t,e){},onMouseEnter:function(t,e){},onMouseLeave:function(t,e){},setMovingElement:function(t){if(t!=this._movingElement){var e=this._movingElement;this._movingElement=t,this.firePropertyChange("movingElement",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},setEditingElement:function(t){if(t!=this._editingElement){var e=this._editingElement;this._editingElement=t,this.firePropertyChange("editingElement",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}}}),Me.canvas.Overview=function(t){Me.canvas.Overview.superClass.constructor.apply(this,t),this._view=je.createView(),this._rootDiv=je.createDiv(),this._imageCanvas=je.createCanvas(),this._imageDiv=je.createDiv(),this._maskCanvas=je.createCanvas(),this._selectDiv=je.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,je.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this._exportImageCanvas=je.createCanvas(),this._imageCtx=this._imageCanvas.getContext("2d"),this.setNetwork(t),He.isTouchable?He.isMSTouchable?new Me.canvas.OverviewMSTouchInteraction(this):(new Me.canvas.OverviewTouchInteraction(this),new Me.canvas.OverviewInteraction(this)):new Me.canvas.OverviewInteraction(this)},Oe.ext("twaver.canvas.Overview",Me.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:Rn.OVERVIEW_FILL_COLOR,_outlineColor:Rn.OVERVIEW_OUTLINE_COLOR,_outlineWidth:Rn.OVERVIEW_OUTLINE_WIDTH,_selectColor:Rn.OVERVIEW_SELECT_COLOR,_selectWidth:Rn.OVERVIEW_SELECT_WIDTH,_padding:Rn.OVERVIEW_PADDING,_animate:Rn.OVERVIEW_ANIMATE,_maxPackingWidth:Rn.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:Rn.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(t){this._invalidateMask()},setNetwork:function(t){t!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),je.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=t,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),je.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate())},_handleNetworkPropertyChange:function(t){("zoom"===t.property||"currentSubNetwork"===t.property||"elementBox"===t.property||"dataBox"===t.property||"canvasSizeChange"===t.property)&&this.invalidate()},_handleNetworkViewChange:function(t){"validateEnd"===t.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(t){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),Oe.callLater(this.validate,this,null,t))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,Oe.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network.getViewRect().width&&0!==this._network.getViewRect().height&&!this._network._invalidate){var t,e=this._maxPackingWidth>0&&this._maxPackingHeight>0;t=e?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},Ze.grow(t,-this._padding,-this._padding),e&&(je.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),t.width=this._imageDiv._viewRect.width,t.height=this._imageDiv._viewRect.height);var i=this._network.getZoom(),n=this._network._unionBounds;n=Ze.unionRect(n,{x:0,y:0,width:n.x,height:n.y}),n={x:n.x/i,y:n.y/i,width:n.width/i,height:n.height/i};var o={x:this._network.viewRect.x/i,y:this._network.viewRect.y/i,width:this._network.viewRect.width/i,height:this._network.viewRect.height/i},s=Ze.unionRect(n,o),a=Math.min(t.width/s.width,t.height/s.height),r=s.width*a,h=s.height*a,l=s.width*a,c=s.height*a,d=t.x+(t.width-l)/2,u=t.y+(t.height-c)/2;if(this._isNetworkDirty){var _={x:d,y:u,width:l,height:c};this._network.toCanvas(r,h,this._exportImageCanvas,a,s.x*a,s.y*a),this._imageCanvas.setAttribute("width",l),this._imageCanvas.setAttribute("height",c),this._imageCtx.drawImage(this._exportImageCanvas,0,0,r,h),je.setDiv(this._imageDiv,_,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var g={x:(o.x-s.x)*a,y:(o.y-s.y)*a,width:o.width*a,height:o.height*a},f=je.setCanvas(this._maskCanvas,d,u,l,c);f.lineWidth=0,f.fillStyle=this._fillColor,Ke.drawVector(f,"rectangle",null,d,u,l,c),f.closePath(),f.fill(),f.stroke(),f.clearRect(d+g.x,u+g.y,g.width,g.height),f.lineWidth=this._outlineWidth,f.strokeStyle=this._outlineColor;var v=g.width-2*this._outlineWidth,m=g.height-2*this._outlineWidth;v=Math.min(v,l-2-g.x-this._outlineWidth),m=Math.min(m,c-2-g.y-this._outlineWidth),Ke.drawVector(f,"rectangle",null,d+g.x+this._outlineWidth,u+g.y+this._outlineWidth,v,m),f.closePath(),f.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(t){return je.getLogicalPoint(this._view,t,1,this._rootDiv)},centerNetwork:function(t,e){var i=this._imageDiv._viewRect;Ze.containsPoint(i,t)&&(this._network.centerByLogicalPoint((t.x-i.x)/i.width*this._network.getCanvasSize().width,(t.y-i.y)/i.height*this._network.getCanvasSize().height,e),this._invalidateMask())}}),Me.canvas.OverviewTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,je.addEventListener("touchstart","handleTouchstart",this.view,this)},Oe.ext("twaver.canvas.OverviewTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t),this.clear(),this.endPoint=this.overview.getLogicalPoint(t),bi.isMultiTouch(t)&&(this.distance=bi.getDistance(t),this.zoom=this.network.getZoom()),je.addEventListener("touchmove","handleTouchmove",this.view,this),je.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(t){if(this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(t),bi.isSingleTouch(t))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var e=bi.getDistance(t)/this.distance;this.network.setZoom(this.zoom*e,!1)}},handleTouchend:function(t){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(t);var e=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;e?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),e?Oe.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,je.removeEventListener("touchmove",this.view,this),je.removeEventListener("touchend",this.view,this)),this.moved=!1}}),Me.canvas.OverviewMSTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,this._pointerMap={},this._pointerIdArray=[],je.addEventListener("MSPointerDown","handleTouchstart",this.view,this),je.addEventListener("MSPointerMove","handleTouchmove",this.view,this),je.addEventListener("MSPointerUp","handleTouchend",this.view,this),je.addEventListener("MSPointerCancel","handleTouchend",this.view,this)},Oe.ext("twaver.canvas.OverviewMSTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t),t.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[t.pointerId]&&this.overview.getLogicalPoint(t)&&(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(t),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(t){if(0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ze.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10))if(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length){var e=this._getDistance()/this._distance;this.network.setZoom(this._zoom*e,!1)}else if(1==this._pointerIdArray.length&&this._startTouchPoint){var i=this.overview.getLogicalPoint(t);if(null==i)return;this._startTouchPoint=i,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(t){var e=this.overview.getLogicalPoint(t);if(1==this._pointerIdArray.length&&e){var i=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&Ze.getDistance(this._endTouchPoint,e)<=10;i?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=e,this._endTouchTime=new Date),i?Oe.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Ze.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Me.canvas.OverviewInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,je.addEventListener("mousedown","handleMousedown",this.view,this)},Oe.ext("twaver.canvas.OverviewInteraction",Object,{handleMousedown:function(t){0===t.button&&(this.clear(),this.endPoint=this.overview.getLogicalPoint(t),Oe.isCtrlDown(t)&&(this.startPoint=this.endPoint,je.setVisible(this.overview._selectDiv,!0)),je.addEventListener("mousemove","handleMousemove",this.view,this),je.addEventListener("mouseup","handleMouseup",this.view,this))},handleMouseup:function(t){if(this.endPoint=this.overview.getLogicalPoint(t),"detail"in t&&2===t.detail)Oe.callLater(this.network.zoomReset,this.network,[this.overview._animate]);else if(je.isVisible(this.overview._selectDiv)&&this.startPoint){var e=this.overview._imageDiv._viewRect,i=this.overview._selectDiv._viewRect.x,n=this.overview._selectDiv._viewRect.y,o=e.width/this.overview._selectDiv._viewRect.width,s=e.height/this.overview._selectDiv._viewRect.height,a=Math.min(o,s);this.network.setZoom(a*Math.min(this.network.getViewRect().width/this.network.getCanvasSize().width,this.network.getViewRect().height/this.network.getCanvasSize().height)*this.network.getZoom(),!1);var r=this.network.getCanvasSize().width*((i-e.x+this.overview._selectDiv._viewRect.width/2)/e.width),h=this.network.getCanvasSize().height*((n-e.y+this.overview._selectDiv._viewRect.height/2)/e.height);Oe.callLater(this.network.centerByLogicalPoint,this.network,[r,h,this.overview._animate]),je.setVisible(this.overview._selectDiv,!1),je.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(t){var e=this.overview.getLogicalPoint(t);if(this.endPoint=e,je.isVisible(this.overview._selectDiv)&&this.startPoint){var i=e.x>this.startPoint.x?this.startPoint.x:e.x,n=e.x>this.startPoint.x?this.startPoint.y:e.y;e.x>this.startPoint.x&&e.y<this.startPoint.y&&(n=e.y),e.x<this.startPoint.x&&e.y>this.startPoint.y&&(n=this.startPoint.y);var o=this.overview._imageDiv._viewRect;i<o.x&&(i=o.x),i>o.x+o.width&&(i=o.x+o.width),n<o.y&&(n=o.y),n>o.y+o.height&&(n=o.y+o.height);var s=Math.abs(e.x-this.startPoint.x),a=Math.abs(e.y-this.startPoint.y);i+s>o.x+o.width&&(s=o.x+o.width-i),n+a>o.y+o.height&&(a=o.y+o.height-n),je.setDiv(this.overview._selectDiv,{x:i,y:n,width:s,height:a},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(e,!1)},clear:function(){this.endPoint&&(this.endPoint=null,je.removeEventListener("mousemove",this.view,this),je.removeEventListener("mouseup",this.view,this))}}),Me.canvas.ElementUI=function(t,e){this._network=t,this._element=e,this._attachments=new Me.List,this._bodyBounds=new Me.List,this._hitTest=!1,this._hitTest=!1,this._intersectTest=!1,this.invalidate(!0)},Oe.ext("twaver.canvas.ElementUI",Object,{getElement:function(){return this._element},getNetwork:function(){return this._network},handlePropertyChange:function(t){this.invalidate(!0)},handleSelectionChange:function(t){this.invalidate(!0)},invalidate:function(t){t===e&&(t=!0),t&&(this._invalidateAttachmentsFlag=!0),this._invalidateFlag||(this._hotSpot=null,this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility())},updateStyle:function(){this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this._wholeAlpha=this._element.getStyle("whole.alpha")},validate:function(){if(0!=this._invalidateFlag){this._bodyBounds.clear(),this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this.updateStyle(),this.validateImpl(),this._attachments.forEach(function(t){t.validate()});var t;this._bodyBounds.forEach(function(e){t=Ze.unionRect(t,e)}),this._unionBodyBounds=Oe.clone(t),this._attachments.forEach(function(e){t=Ze.unionRect(t,e.getViewRect())}),this._viewRect=t}},validateImpl:function(){},setShadow:function(t,e){var i=t.isShadowable()&&this._shadowColor&&!this._editAttachment;return e.shadowOffsetX===this._shadowXOffset&&e.shadowOffsetY===this._shadowYOffset&&e.shadowBlur===this._shadowBlur?e:((i||this._network._showShadowInEdit)&&(e.shadowOffsetX=this._shadowXOffset,e.shadowOffsetY=this._shadowYOffset,e.shadowBlur=this._shadowBlur,e.shadowColor=this._shadowColor),e)},clearShadow:function(t){(0!=t.shadowOffsetX||0!=t.shadowOffsetY||0!=t.shadowBlur)&&(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0)},appendShadowBound:function(t,e){var i=t.isShadowable()&&this._shadowColor&&!this._editAttachment;return i&&(this._shadowXOffset>0?e.width+=this._shadowXOffset:(e.x+=this._shadowXOffset,e.width+=-this._shadowXOffset),this._shadowYOffset>0?e.height+=this._shadowYOffset:(e.y+=this._shadowYOffset,e.height+=-this._shadowYOffset),Ze.grow(e,this._shadowBlur,this._shadowBlur)),e},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&"shadow"===this._element.getStyle("select.style")?!0:!1},addAttachment:function(t){this._attachments.add(t)},removeAttachment:function(t){this._attachments.remove(t)},getAttachments:function(){return this._attachments},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var t=this._network.getLabel(this._element);null!=t&&""!==t?this._labelAttachment||(this._labelAttachment=new Me.canvas.LabelAttachment(this,Rn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var t=this._network.getAlarmLabel(this._element);null!=t&&""!==t?this._alarmAttachment||(this._alarmAttachment=new Me.canvas.AlarmAttachment(this,Rn.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var t=this._network.getIconsNames(this._element);t&&t.length>0?this._iconsAttachment||(this._iconsAttachment=new Me.canvas.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)&&this.isEditable()?this._editAttachment||(this._editAttachment=new Me.canvas.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},isEditable:function(){return!0},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getDyeColor:function(t){return this._innerColor?this._innerColor:this.getStyle(t)},getStyle:function(t){return this._element.getStyle(t)},getFont:function(t){var e=this._element.getStyle(t);return e?e:Me.Defaults.FONT},paint:function(t){t.save(),t.globalAlpha=this._wholeAlpha,t.beginPath(),this.paintBody(t),this.clearShadow(t),t.closePath(),t.beginPath(),this.paintAttachments(t),t.closePath(),t.restore()},paintBody:function(t){},paintAttachments:function(t){t.beginPath();for(var e=this._attachments.size(),i=0;e>i;i++){var n=this._attachments.get(i);1==this._hitTest&&0==n.isShowOnTop()&&this.paintAttachment(t,n),1==this._intersectTest&&this.paintAttachment(t,n),0==this._hitTest&&0==this._intersectTest&&(n.isShowOnTop()?this._network._topAttachmentList.add(n):this.paintAttachment(t,n))}},paintAttachment:function(t,e){t.beginPath(),e.paint(t),this.clearShadow(t)},getViewRect:function(){return Oe.clone(this._viewRect)},getUnionBodyBounds:function(){return Oe.clone(this._unionBodyBounds)},addBodyBounds:function(t){t&&this._bodyBounds.add(t)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),Oe.clone(this._bodyRect)},getHotSpot:function(){return this._hotSpot?Oe.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(t){this._hotSpot=t},hit:function(t,e){return!1},intersects:function(t){return Ze.contains(t,this.getViewRect())?!0:!1},hitCanvasRectAtBody:function(t){var e=Hn.getHitCanvas(t.width,t.height),i=Hn.getCtx(e);if(i.save(),i.translate(-t.x,-t.y),this._element.getImage){var n=Oe.getImageAsset(this._element.getImage());if(n&&n.getImage()instanceof On)return 1}this.paintBody(i);try{for(var o=i.getImageData(0,0,t.width,t.height),s=o.data,a=0;a<o.width;a++)for(var r=0;r<o.height;r++){var h=4*(r*o.width+a),l=s[h+3];if(0!==l)return i.restore(),1}}catch(e){if(Hn.disposeHitCanvas(),Ze.contains(this.getUnionBodyBounds(),t))return 0}return i.restore(),-1},hitCanvasRectAtAttachments:function(t){var e=Hn.getHitCanvas(t.width,t.height),i=Hn.getCtx(e);i.save(),i.translate(-t.x,-t.y),this.paintAttachments(i);try{for(var n=i.getImageData(0,0,t.width,t.height),o=n.data,s=0;s<n.width;s++)for(var a=0;a<n.height;a++){var r=4*(a*n.width+s),h=o[r+3];if(0!==h)return i.restore(),1}}catch(t){Hn.disposeHitCanvas()}return i.restore(),-1},hitCanvasRect:function(t){this._intersectTest=!0,1==this._hitTest&&(this._intersectTest=!1);var e=Ze.intersection(t,this._viewRect),i=this.hitCanvasRectAtBody(e);if(1==i)return this._intersectTest=!1,!0;var n=this.hitCanvasRectAtAttachments(e);return 1==n?(this._intersectTest=!1,!0):(this._intersectTest=!1,0==i)},hitCanvasPoint:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();if(n&&n>0&&Ze.grow(i,n,n),!Ze.intersects(this._viewRect,i))return!1;this._hitTest=!0;var o=this.hitCanvasRect(i);return this._hitTest=!1,o},hitTest:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();if(n&&n>0&&Ze.grow(i,n,n),!Ze.intersects(this._viewRect,i))return null;var o=Ze.intersection(i,this._viewRect),s=this.hitCanvasRectAtBody(o);if(1==s)return this;for(var a=this._attachments.size(),r=0;a>r;r++){var h=this._attachments.get(r);if(h.hit(t,e))return h}return 0==s?this:null},dispose:function(){this._attachments.forEach(function(t){t.dispose()}),this._attachments.clear()}}),Me.canvas.NodeUI=function(t,e){Me.canvas.NodeUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.canvas.NodeUI",Me.canvas.ElementUI,{invalidate:function(t){Me.canvas.NodeUI.superClass.invalidate.call(this,t),this.curInterval&&clearInterval(this.curInterval);var e=this._element.getAgentLinks();e&&e.forEach(function(t){this._network.invalidateElementUI(t,!1)},this);var i=this._element.getParent();i instanceof Me.Group&&this._network.invalidateElementUI(i,!1)},createBodyRect:function(){return this._element.getRect()},validateImpl:function(){Me.canvas.NodeUI.superClass.validateImpl.call(this);var t=this.getStyle("vector.shape"),e=this.getBodyRect();this._hotSpot=Ze.getHotSpot(e.x,e.y,e.width,e.height,t),this.validateBodyBounds()},validate:function(){0!=this._invalidateFlag&&Me.canvas.NodeUI.superClass.validate.call(this)},validateBodyBounds:function(){var t=this.getStyle("body.type");"default"===t?this.addBodyBounds(this.getDefaultBodyRect()):"vector"===t?this.addBodyBounds(this.getVectorBody()):"default.vector"===t?(this.addBodyBounds(this.getVectorBody()),this.addBodyBounds(this.getDefaultBodyRect())):"vector.default"===t&&(this.addBodyBounds(this.getDefaultBodyRect()),this.addBodyBounds(this.getVectorBody())),this._outerColor&&this.addBodyBounds(this.getOuterBorderRect()),!this._editAttachment&&"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.addBodyBounds(this.getSelectBorderRect())},getDefaultBodyRect:function(){var t=this._element,e=Oe.getImageAsset(t.getImage()),i=this.getBodyRect();if(!e)return i;Ze.addPadding(i,this._element,"image.padding",1),this._defaultRect=i;var n=Oe.clone(i);return this.appendShadowBound(this,n),i=n},getVectorBody:function(){var t=this.getPathRect("vector");return t},getOuterBorderRect:function(){return this._getBorderRect("outer")},getSelectBorderRect:function(){return this._getBorderRect("select")},_getBorderRect:function(t){var e=this._element,i=e.getStyle(t+".width");if(i>0){var n=this.getBodyRect();Ze.addPadding(n,e,t+".padding",1);var o=Oe.clone(n);return Ze.grow(o,i/2,i/2),o}return null},getPathRect:function(t,e){var i=this._element,n=this.getBodyRect();e&&Ze.addPadding(n,i,t+".padding",1);var o=Oe.clone(n),s=i.getStyle(t+".outline.width");return s>0&&Ze.grow(o,s/2,s/2),this.appendShadowBound(this,o),o},paintBody:function(t){this.curInterval&&clearInterval(this.curInterval);var e=this.getStyle("body.type");"default"===e?this.drawDefaultBody(t):"vector"===e?this.drawVectorBody(t):"default.vector"===e?(this.drawVectorBody(t),this.drawDefaultBody(t)):"vector.default"===e&&(this.drawDefaultBody(t),this.drawVectorBody(t)),this._outerColor&&this.drawOuterBorder(t),"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.drawSelectBorder(t)},drawOuterBorder:function(t){var e=this._element,i=e.getStyle("outer.width");if(i>0){var n=this.getBodyRect();Ze.addPadding(n,e,"outer.padding",1),t.lineWidth=i,t.lineCap=e.getStyle("outer.cap"),t.lineJoin=e.getStyle("outer.join"),t.strokeStyle=this._outerColor,Ke.drawVector(t,e.getStyle("outer.shape"),null,n),t.stroke()}},drawDefaultBody:function(t){var e=this._element,i=Oe.getImageAsset(e.getImage()),n=this._defaultRect;if(i&&i.getImage()){0!=e.getAngle()&&(t.save(),n=e.getOriginalRect(),Me.Util.rotateCanvas(t,n,e.getAngle())),this.setShadow(this,t);if(i.getImage()instanceof On){var o,s=i.getImage().frames,a=i.getImage().size,r=0;o=Nn(s,a,0),t.drawImage(o,n.x,n.y,n.width,n.height),this.curInterval=setInterval(function(){r=(r+s.length)%s.length,o=Nn(s,a,r),t.drawImage(o,n.x,n.y,n.width,n.height),r++},100)}else Vi(t,e.getImage(),this.getInnerColor(),n,e,this._network);0!=e.getAngle()&&t.restore()}},drawSelectBorder:function(t){var e=this._element,i=e.getStyle("select.width");if(i>0){var n=this.getBodyRect();n=Oe.clone(n);var o=e.getStyle("select.physicalZoom")?1:this._network.getZoom();Ze.addPadding(n,e,"select.padding",1/o),Ze.grow(n,i/2/o,i/2/o),t.lineWidth=i/o,t.lineCap=e.getStyle("select.cap"),t.lineJoin=e.getStyle("select.join"),t.strokeStyle=e.getStyle("select.color"),Ke.drawVector(t,e.getStyle("select.shape"),null,n),t.stroke()}},drawVectorBody:function(t){this.drawPath(t,"vector",!0,this._element.getStyle("vector.outline.pattern"));var e=this.getStyle("vector.deep"),i=this.getStyle("vector.fill.color"),n=this.getBodyRect();if(0!==e&&i){var o=this._element.getAngle();0!=o&&(t.save(),n=this._element.getOriginalRect(),Me.Util.rotateCanvas(t,n,o)),"rectangle"===this.getStyle("vector.shape")&&Ke.draw3DRect(t,i,e,n),0!=o&&t.restore()}},drawPath:function(t,e,i,n,o,s,a){var r=this._element,h=this.getBodyRect();i&&Ze.addPadding(h,r,e+".padding",1);var l=r.getStyle(e+".outline.width");this.setShadow(this,t),0!=r.getAngle()&&(r instanceof Un||(h=r.getOriginalRect()),t.save(),Me.Util.rotateCanvas(t,h,r.getAngle()));var c,d=r.getStyle(e+".fill");if(d){c=this._innerColor&&!xi.hasDefault(this._element)?this._innerColor:r.getStyle(e+".fill.color");var u=r.getStyle(e+".gradient");u?Ke.fill(t,c,u,r.getStyle(e+".gradient.color"),h):t.fillStyle=c}var _=r.getStyle(e+".shape"),g=r.getStyle("group.shape.roundrect.radius");d&&(t.beginPath(),o?Ke.drawLinePoints(t,o,null,s,a):"roundrect"===_&&"group"===e?Ke.drawVector(t,_,null,h,g):Ke.drawVector(t,_,null,h),t.fill()),l>0&&(t.lineWidth=l,t.lineCap=r.getStyle(e+".cap"),t.lineJoin=r.getStyle(e+".join"),t.strokeStyle=r.getStyle(e+".outline.color"),t.beginPath(),o?Ke.drawLinePoints(t,o,n,s,a):"roundrect"===_&&"group"===e?Ke.drawVector(t,_,n,h,g):Ke.drawVector(t,_,n,h),t.stroke()),0!=r.getAngle()&&t.restore()},hit:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();if(n&&n>0&&Ze.grow(i,n,n),this._network._transparentSelectionEnable){var o=this.getBodyRect();if(Oe.math.intersects(o,i))return!0}return Ze.intersects(this.getViewRect(),i)?this.hitCanvasPoint(t,e):!1},intersects:function(t){var e=Me.canvas.NodeUI.superClass.intersects.apply(this,arguments);if(1==e)return!0;if(this._network._transparentSelectionEnable){var i=this.getBodyRect();if(Oe.math.intersects(i,t))return!0}return Ze.intersects(t,this.getViewRect())?this.hitCanvasRect(t):!1}}),Me.canvas.LinkUI=function(t,e){Me.canvas.LinkUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.canvas.LinkUI",Me.canvas.ElementUI,{isEditable:function(){return Ti.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},invalidate:function(t){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,this._angle=null,Me.canvas.LinkUI.superClass.invalidate.call(this,t)},validateImpl:function(){this.validateBodyBounds(),Me.canvas.LinkUI.superClass.validateImpl.call(this)},validateBodyBounds:function(){var t=this.getLinkPoints();if(t&&!(t.size()<2)){var e=this._element,i=Ze.getLineRect(t),n=e.getStyle("link.width"),o=n;if(this._outerColor){var s=e.getStyle("outer.width");o+=2*s}var a=!this._editAttachment&&"border"===e.getStyle("select.style")&&this._network.isSelected(this._element);if(a){var r=e.getStyle("select.width");o+=2*r}Ze.grow(i,o/2,o/2),e.getStyle("arrow.from")&&(this._network._debug&&(this._arrowFromRect=vn.getArrowRect(this,t,!0,e.getStyle("arrow.from.shape"),e.getStyle("arrow.from.width"),e.getStyle("arrow.from.height"),e.getStyle("arrow.from.xoffset"),e.getStyle("arrow.from.yoffset"))),i=Ze.unionRect(i,vn.getArrowRect(this,t,!0,e.getStyle("arrow.from.shape"),e.getStyle("arrow.from.width"),e.getStyle("arrow.from.height"),e.getStyle("arrow.from.xoffset"),e.getStyle("arrow.from.yoffset")))),e.getStyle("arrow.to")&&(this._network._debug&&(this._arrowToRect=vn.getArrowRect(this,t,!1,e.getStyle("arrow.to.shape"),e.getStyle("arrow.to.width"),e.getStyle("arrow.to.height"),e.getStyle("arrow.to.xoffset"),e.getStyle("arrow.to.yoffset"))),i=Ze.unionRect(i,vn.getArrowRect(this,t,!1,e.getStyle("arrow.to.shape"),e.getStyle("arrow.to.width"),e.getStyle("arrow.to.height"),e.getStyle("arrow.to.xoffset"),e.getStyle("arrow.to.yoffset")))),this.appendShadowBound(this,i),this.addBodyBounds(i)}},createBodyRect:function(){var t=this.getHotSpot();return t?{x:t.x-1,y:t.y-1,width:2,height:2}:null},paintBody:function(t){var e=this._linkPoints;if(e&&!(e.size()<2)){var i=this._element,n=i.getStyle("link.width"),o=n;if(this._outerColor){var s=i.getStyle("outer.width");o+=2*s}var a=!this._editAttachment&&"border"===i.getStyle("select.style")&&this._network.isSelected(this._element);if(a){var r=i.getStyle("select.width");o+=2*r}this.setShadow(this,t),t.lineCap=i.getStyle("link.cap"),t.lineJoin=i.getStyle("link.join");var h=i.getStyle("link.pattern");a&&this.drawLinePoints(t,e,o,i.getStyle("select.color"),h),this._outerColor&&this.drawLinePoints(t,e,n+2*s,this._outerColor,h),this.drawLinePoints(t,e,n,this._innerColor||i.getStyle("link.color"),h),vn.drawLinkArrow(this,t,e)}},drawLinePoints:function(t,e,i,n,o){if(t.lineWidth=i,t.strokeStyle=n,this._element.getStyle("link.flow")===!0&&o&&o.length>1){var s=new Ai(t,o[0],o[1]),a=this._element.getStyle("link.flow.offset"),r=Math.floor(a/(o[0]+o[1]));r>2&&(a-=(o[0]+o[1])*r),this._element.getStyle("link.flow.converse")?a<o[0]?s.overflow=o[0]-a:a>=o[0]&&a<=o[0]+o[1]?(s.overflow=o[1]-(a-o[0]),s.overflow&&(s.isLine=!1)):(a-=o[0]+o[1],s.overflow=o[0]-a):a<=o[1]?(s.overflow=a,a&&(s.isLine=!1)):a>o[1]&&a<=o[0]+o[1]?s.overflow=a-o[1]:(a-=o[0]+o[1],a&&(s.isLine=!1),s.overflow=a),this._element._styleMap["link.flow.offset"]=a,t.beginPath(),Ke._drawLine(e,t),t.stroke(),t.shadowColor="transparent",t.beginPath();var h=this._element.getStyle("link.flow.color");h=h?h:Rn.NETWORK_LINK_FLOW_COLOR,t.strokeStyle=h,Ke._drawLine(e,s),t.stroke(),t.shadowColor=this._shadowColor}else t.beginPath(),Ke.drawLinePoints(t,e,o),t.stroke()},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=Ze.calculateLineLength(this._linkPoints)),this._linkPoints},getFromPosition:function(t,e){var i=this.getFromPoint();return i?{x:i.x+t,y:i.y+e}:null},getToPosition:function(t,e){var i=this.getToPoint();return i?{x:i.x+t,y:i.y+e}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=Ti.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=Ti.createToPoint(this)),this._toPoint},createLinkPoints:function(){var t=this.getFromPoint(),e=this.getToPoint(),i=this.getStyle("link.type"),n=new Me.List;if(Ti.isOrthogonalOrFlexionalLink(this._element))n=Ti.orthogonalAndFlexional(this,i);else if(this._element.isLooped()){var o=this._network.getElementUI(this._element.getFromAgent());null!=o&&(this._hotSpot=Ti.fillLoopedPoints(this,o.getBodyRect(),n))}else{if("arc"!==i&&"triangle"!==i&&"parallel"!==i)throw"Can not resolve link type '"+i+"'";this._hotSpot=Ti.fillBundlePoints(this,i,t,e,n)}if(this._network._linkPathFunction){var s=this._network._linkPathFunction(this,n);s&&(n=s)}return n},checkAttachments:function(){Me.canvas.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var t=this._network.getLinkHandlerLabel(this._element);null!=t&&""!==t?this._linkHandlerAttachment||(this._linkHandlerAttachment=new Me.canvas.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getControlPoint:function(){return Ti.getControlPoint(this._element,this)},setControlPoint:function(t){if(t){var e=this.getStyle("link.type");if(Ti.hasControlPoint(e)){var i=Ti.getLinkSourceBounds(this),n=Ti.getLinkTargetBounds(this);Ti.setParamsByControlPoint(t,i,n,e,this._element)}}},getLineLength:function(){return this._lineLength},hit:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();return n&&n>0&&Ze.grow(i,n,n),Ze.intersects(this.getViewRect(),i)?this.hitCanvasPoint(t,e):!1},intersects:function(t){var e=Me.canvas.LinkUI.superClass.intersects.apply(this,arguments);if(1==e)return!0;if(0==Ze.intersects(t,this.getViewRect()))return!1;var i=this.getLinkPoints(),n=i.size();if(2==n)for(var o=0;n>o;o+=2){var s=i.get(o);if(n>o+1){var a=i.get(o+1);if(Hn.intersectsLine(s.x,s.y,a.x,a.y,t.x,t.y,t.width,t.height))return!0}}return this.hitCanvasRect(t)},getAngle:function(){return!this._angle&&this._fromPoint&&this._toPoint&&(this._angle=Ze.getAngle(this._fromPoint,this._toPoint)),this._angle||0}}),Me.canvas.GroupUI=function(t,e){Me.canvas.GroupUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.canvas.GroupUI",Me.canvas.NodeUI,{isEditable:function(){return!this._element.isExpanded()},paintBody:function(t){this._shapeRect?this.drawExpandedGroup(t):Me.canvas.GroupUI.superClass.paintBody.apply(this,arguments)},validateBodyBounds:function(){this.getBodyRect(),this._shapeRect?this.addBodyBounds(this.getPathRect("group",!1)):Me.canvas.GroupUI.superClass.validateBodyBounds.call(this)},drawExpandedGroup:function(t){this.drawPath(t,"group",!1,this._element.getStyle("vector.outline.pattern"));var e=this.getStyle("group.deep"),i=this.getStyle("group.fill.color");0!==e&&i&&"rectangle"===this.getStyle("group.shape")&&Ke.draw3DRect(t,i,e,this._bodyRect)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var t=this._element,e=this._network;if(t.isExpanded()){t.getChildren().forEach(function(t){var i=e.getElementUI(t);i&&i.validate()});var i=this.getChildrenRects();if(!i.isEmpty()){var n=t.getStyle("group.shape"),o=Ge[n];if(!o)throw"Can not resolve group shape '"+n+"'";this._shapeRect=o(i)}}return this._shapeRect?(Ze.addPadding(this._shapeRect,t,"group.padding",1),this._shapeRect):Me.canvas.GroupUI.superClass.createBodyRect.call(this)}}),Me.canvas.ShapeNodeUI=function(t,e){Me.canvas.ShapeNodeUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.canvas.ShapeNodeUI",Me.canvas.NodeUI,{getDefaultBodyRect:function(){return this._element._points.size()<2?null:this.getPathRect("vector",!0)},drawDefaultBody:function(t){this._element._points.size()<2||(this.drawPath(t,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed")),vn.drawLinkArrow(this,t,Ze.getPointObject(this._element._points,this._element._segments)))},drawSelectBorder:function(t){var e=this._element,i=e.getStyle("select.width");if(i>0){var n=this.getBodyRect();n=Oe.clone(n);var o=e.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();Ze.addPadding(n,e,"select.padding",1/o),Ze.grow(n,i/2,i/2);var s=e.getStyle("vector.outline.width");s>0&&Ze.grow(n,s/2/o,s/2/o),t.lineWidth=i/o,t.lineCap=e.getStyle("select.cap"),t.lineJoin=e.getStyle("select.join"),t.strokeStyle=e.getStyle("select.color"),Ke.drawVector(t,e.getStyle("select.shape"),null,n),t.stroke()}}}),Me.canvas.ShapeLinkUI=function(t,e){Me.canvas.ShapeLinkUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.canvas.ShapeLinkUI",Me.canvas.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var t=this.getFromPoint(),e=this.getToPoint(),i=new Me.List,n=this.getStyle("shapelink.type");i.add(t),null!=this._element._points&&i.addAll(this._element._points),i.add(e);var o,s,a,r,h,l,c,d=Ze.calculateLineLength(i)/2,u=i.size(),_=0,g=0;for(o=0;u>o;o++)if(r=i.get(o),0!=o){if(a=r,a instanceof fn&&(a=a._as),a instanceof Array?(h=Ze.calculateCurveLength(s,a,1),s=a[a.length-1]):(c=r.y-s.y,l=r.x-s.x,h=Math.sqrt(l*l+c*c),s=a),g+=h,d>=_&&g>=d){var f=d-_,v=i.get(o-1);v instanceof fn&&(v=v._as,v instanceof Array&&(v=v[v.length-1]));var m=i.get(o),p=Ze.getPathInfo(m,v,f,0,-1).point;this._hotSpot=Oe.clone(p)}_=g}else s=r;var y,w,A;if("lineto"===n);else if("quadto"===n){for(y=new Me.List(i.get(0)),w=1,pointCount=i.size();w<pointCount;w++)y.add(w<pointCount-1?new Me.List([i.get(w++),i.get(w)]):i.get(w));i=y}else if("cubicto"===n){for(y=new Me.List(i.get(0)),w=1,pointCount=i.size();w<pointCount;w++)y.add(w<pointCount-2?new Me.List([i.get(w++),i.get(w++),i.get(w)]):w<pointCount-1?new Me.List([i.get(w++),i.get(w)]):i.get(w));i=y}else{if("orthogonalto"!==n)throw"Can not resolve shapelink type '"+n+"'";for(A=i.get(0),y=new Me.List(A),w=1,pointCount=i.size();w<pointCount;w++)if(w<pointCount-1){var r=Oe.clone(i.get(w)),x=r.x,E=r.y,l=x-A.x,c=E-A.y;Math.abs(l)>Math.abs(c)?(r.x=x,r.y=A.y):(r.x=A.x,r.y=E),A=r,y.add(A)}else y.add(i.get(w));i=y}return i}}),Me.canvas.GridUI=function(t,e){Me.canvas.GridUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.canvas.GridUI",Me.canvas.NodeUI,{drawDefaultBody:function(t){this._element.getImage()?Me.canvas.GridUI.superClass.drawDefaultBody.apply(this,arguments):this.drawGridBody(t)},validateBodyBounds:function(){if(this._element.getImage())Me.canvas.GridUI.superClass.validateBodyBounds.call(this);else{var t=this.getBodyRect(),e=Oe.clone(t);this.appendShadowBound(this,e),this.addBodyBounds(e)}},drawGridBody:function(t){var e=this.getStyle("grid.fill"),i=this.getStyle("grid.deep"),n=this.getStyle("grid.cell.deep");if(e||0!==i||0!==n){t.beginPath();var o=this._element.getRect(),s=this.getDyeColor("grid.fill.color");if(this.setShadow(this,t),e&&(t.fillStyle=s,t.rect(o.x,o.y,o.width,o.height),t.fill()),t.closePath(),this.clearShadow(t),t.beginPath(),0!=i&&Ke.draw3DRect(t,s,i,o.x,o.y,o.width,o.height),t.closePath(),0!=n)for(var a=this.getStyle("grid.row.count"),r=this.getStyle("grid.column.count"),h=0;a>h;h++)for(var l=0;r>l;l++){var c=this._element.getCellRect(h,l);null!=c&&(t.beginPath(),Ke.draw3DRect(t,s,n,c.x,c.y,c.width,c.height),t.closePath())}}}}),Me.canvas.RotatableNodeUI=function(t,e){Me.canvas.RotatableNodeUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.canvas.RotatableNodeUI",Me.canvas.NodeUI,{isEditable:function(){return!1},getDefaultBodyRect:function(){var t=this._element,e=Oe.getImageAsset(t.getImage()),i=this.getBodyRect();return e?(Ze.addPadding(i,this._element,"image.padding",1),i):i},drawDefaultBody:function(t){var e=this._element,i=Oe.getImageAsset(e.getImage()),n=this.getBodyRect();if(Ze.addPadding(n,this._element,"image.padding",1),i.getImage()){var o=this._element._getOrignalWidth(),s=this._element._getOrignalHeight(),a=this._element._getRotateRect();t.save(),t.translate(n.x-a.x+o/2,n.y-a.y+s/2),t.rotate(this._element._angle*Math.PI/180);var n={x:-o/2,y:-s/2,width:o,height:s};Vi(t,i.getImage(this._innerColor,n.width,n.height),this._innerColor,n,e,this._network),t.restore()}else if(i.getSrc());else if(!i.getFunction())throw"ImageAsset '"+e.getImage()+" ' is empty"}}),Me.canvas.HTMLNodeUI=function(t,e){Me.canvas.HTMLNodeUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.canvas.HTMLNodeUI",Me.canvas.NodeUI,{checkAttachments:function(){Me.canvas.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var t=this._element.getStyle("attachment.label.style");if(t&&"none"===t)return void Me.canvas.HTMLNodeUI.superClass.checkLabelAttachment.call(this);var e=this._network.getLabel(this._element);null!=e&&""!==e?this._labelAttachment||(this._labelAttachment=new Me.canvas.HTMLLabelAttachment(this,Rn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var t=this._element.getStyle("attachment.alarm.style");if(t&&"none"===t)return void Me.canvas.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);var e=this._network.getAlarmLabel(this._element);null!=e&&""!==e?this._alarmAttachment||(this._alarmAttachment=new Me.canvas.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},setAttachmentVisible:function(t){t?(this._labelAttachment&&this._labelAttachment.setVisibility("visible"),this._alarmAttachment&&this._alarmAttachment.setVisibility("visible")):(this._labelAttachment&&this._labelAttachment.setVisibility("hidden"),this._alarmAttachment&&this._alarmAttachment.setVisibility("hidden"))}}),Me.canvas.HTMLLinkUI=function(t,e){Me.canvas.HTMLLinkUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.canvas.HTMLLinkUI",Me.canvas.LinkUI,{checkAttachments:function(){Me.canvas.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var t=this._element.getStyle("attachment.label.style");if(t&&"none"===t)return void Me.canvas.HTMLLinkUI.superClass.checkLabelAttachment.call(this);var e=this._network.getLabel(this._element);null!=e&&""!==e?this._labelAttachment||(this._labelAttachment=new Me.canvas.HTMLLabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var t=this._element.getStyle("attachment.alarm.style");if(t&&"none"===t)return void Me.canvas.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);var e=this._network.getAlarmLabel(this._element);null!=e&&""!==e?this._alarmAttachment||(this._alarmAttachment=new Me.canvas.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),Me.canvas.Attachment=function(t,e){this._ui=t,this._element=this._ui.getElement(),this._network=t.getNetwork(),this._showOnTop=e},Oe.ext("twaver.canvas.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},isShowOnTop:function(){return this._showOnTop===!0},setShowOnTop:function(t){this._showOnTop=t},getStyle:function(t){return this._ui.getStyle(t)},getFont:function(t){return this._ui.getFont(t)},getViewRect:function(){return Oe.clone(this._viewRect)},getAlpha:function(){return 1},validate:function(){},paint:function(t){},hit:function(t,e){return Ze.containsPoint(this._viewRect,t,e)?this.hitCanvasRect({x:t-1,y:e-1,width:2,height:2}):!1},hitCanvasRect:function(t){var e=Hn.getHitCanvas(t.width,t.height),i=Hn.getCtx(e);i.save(),i.translate(-t.x,-t.y),this.paint(i);try{for(var n=i.getImageData(0,0,t.width,t.height),o=n.data,s=0;s<n.width;s++)for(var a=0;a<n.height;a++){var r=4*(a*n.width+s),h=o[r+3];if(0!==h)return i.restore(),!0}}catch(t){Hn.disposeHitCanvas()}return i.restore(),!1},dispose:function(){},_rotatePoint:function(t,e,i){var n=Ze.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2),o=n.transform(t);return o},_rotatePointList:function(t,e,i){var n=this,o=new Me.List;return t.forEach(function(t){o.add(n._rotatePoint(t,e,i))}),o}}),Me.canvas.BasicAttachment=function(t,e){Me.canvas.BasicAttachment.superClass.constructor.call(this,t,e),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0}},Oe.ext("twaver.canvas.BasicAttachment",Me.canvas.Attachment,{paint:function(t){Me.canvas.BasicAttachment.superClass.paint.apply(this,arguments);var e=this.isFill(),i=this.getOutlineWidth();if(this.getElementUI().setShadow(this,t),(i>0||e)&&(Ke.drawRoundRect(t,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(t.moveTo(this._pointers[0].x,this._pointers[0].y),t.lineTo(this._pointers[1].x,this._pointers[1].y),t.lineTo(this._pointers[2].x,this._pointers[2].y)),t.closePath(),i>0&&(t.lineWidth=i,t.strokeStyle=this.getOutlineColor(),t.lineCap=this.getCap(),t.lineJoin=this.getJoin(),t.stroke()),e)){var n=this.getFillColor(),o=this.getGradient();o?Ke.fill(t,n,o,this.getGradientColor(),this._viewRect):t.fillStyle=n,t.fill()}},validate:function(){Me.canvas.BasicAttachment.superClass.validate.call(this),this.calculateMeasure();var t=this.getOutlineWidth();this._viewRect=Ze.getRect(this._pointers),this._viewRect=Ze.unionRect(this._viewRect,this._roundRect),t>0&&Ze.grow(this._viewRect,t/2,t/2),this._viewRect=this._ui.appendShadowBound(this,this._viewRect)},calculateMeasure:function(){var t=this.getContentWidth(),e=this.getContentHeight(),i=this.getCornerRadius(),n=this.getPointerLength(),o=this.getPointerWidth(),s=this.getPosition(),a=this.getXOffset(),r=this.getYOffset(),h=this._roundRect;h.width=t+i,h.height=e;var l;if(this._ui._element instanceof Me.Link){var c,d=this._ui.getLinkPoints();c=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(a)>0&&Math.abs(a)<1?"from"===s?a*=c:"to"===s?a=c*(1-a):(a/=2,a+=.5,a*=c):"from"===s?a=a:"to"===s?a=c-a:a+=c/2;{var u,_=Ze.calculatePointInfoAlongLine(d,!0,a,r),g=_.point;_.angle}u="from"===s?this._ui.getFromPoint():"to"===s?this._ui.getToPoint():this._ui._hotSpot,a=g.x-u.x,r=g.y-u.y}if(n>0){var f=this.getDirection();l=this._network.getPosition(s,this._ui,null,a,r,!1);var v;if("aboveleft"===f)h.y=l.y-n-h.height,h.x=l.x-(h.width-i),v=Math.max(l.x-o,l.x-(h.width-i)+i/2),this._pointers=[l,{x:l.x,y:l.y-n},{x:v,y:l.y-n}];else if("aboveright"===f)h.y=l.y-n-h.height,h.x=l.x-i,v=Math.min(l.x+o,l.x-i+h.width-i/2),this._pointers=[l,{x:l.x,y:l.y-n},{x:v,y:l.y-n}];else if("belowleft"===f)h.y=l.y+n,h.x=l.x-(h.width-i),v=Math.max(l.x-o,l.x-(h.width-i)+i/2),this._pointers=[l,{x:l.x,y:l.y+n},{x:v,y:l.y+n}];else if("belowright"===f)h.y=l.y+n,h.x=l.x-i,v=Math.min(l.x+o,l.x-i+h.width-i/2),this._pointers=[l,{x:l.x,y:l.y+n},{x:v,y:l.y+n}];else if("leftabove"===f)h.y=l.y+i-h.height,h.x=l.x-n-h.width,v=Math.max(l.y-o,l.y+i-h.height+i/2),this._pointers=[l,{x:l.x-n,y:l.y},{x:l.x-n,y:v}];else if("leftbelow"===f)h.y=l.y-i,h.x=l.x-n-h.width,v=Math.min(l.y+o,l.y-i+h.height-i/2),this._pointers=[l,{x:l.x-n,y:l.y},{x:l.x-n,y:v}];else if("rightabove"===f)h.y=l.y+i-h.height,h.x=l.x+n,v=Math.max(l.y-o,l.y+i-h.height+i/2),this._pointers=[l,{x:l.x+n,y:l.y},{x:l.x+n,y:v}];else if("rightbelow"===f)h.y=l.y-i,h.x=l.x+n,v=Math.min(l.y+o,l.y-i+h.height-i/2),this._pointers=[l,{x:l.x+n,y:l.y},{x:l.x+n,y:v}];else if("above"===f)h.y=l.y-n-h.height,h.x=l.x-h.width/2,v=Math.min(t/2,o/2),this._pointers=[l,{x:l.x-v,y:l.y-n},{x:l.x+v,y:l.y-n}];else if("below"===f)h.y=l.y+n,h.x=l.x-h.width/2,v=Math.min(t/2,o/2),this._pointers=[l,{x:l.x-v,y:l.y+n},{x:l.x+v,y:l.y+n}];else if("left"===f)h.y=l.y-h.height/2,h.x=l.x-n-h.width,v=Math.min(e/2,o/2),this._pointers=[l,{x:l.x-n,y:l.y+v},{x:l.x-n,y:l.y-v}];else{if("right"!==f)throw"Can not resolve '"+f+"' attachment direction";h.y=l.y-h.height/2,h.x=l.x+n,v=Math.min(e/2,o/2),this._pointers=[l,{x:l.x+n,y:l.y+v},{x:l.x+n,y:l.y-v}]}}else l=this._network.getPosition(s,this._ui,{width:h.width,height:h.height},a,r,!1),h.x=l.x,h.y=l.y,this._pointers=null;this._contentRect.x=h.x+(h.width-t)/2,this._contentRect.y=h.y+(h.height-e)/2,this._contentRect.width=t,this._contentRect.height=e;var m=this.getPadding();0!=m&&Ze.grow(h,m,m),m=this.getPaddingLeft(),0!=m&&(h.x-=m,h.width+=m),m=this.getPaddingRight(),0!=m&&(h.width+=m),m=this.getPaddingTop(),0!=m&&(h.y-=m,h.height+=m),m=this.getPaddingBottom(),0!=m&&(h.height+=m),h.width<0&&(h.width=h.width,h.x-=h.width),h.height<0&&(h.height=-h.height,h.y-=h.height)},getContentWidth:function(){return Me.Defaults.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return Me.Defaults.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return Me.Defaults.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return Me.Defaults.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return Me.Defaults.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return Me.Defaults.ATTACHMENT_POSITION},getXOffset:function(){return Me.Defaults.ATTACHMENT_XOFFSET},getYOffset:function(){return Me.Defaults.ATTACHMENT_YOFFSET},getPadding:function(){return Me.Defaults.ATTACHMENT_PADDING},getPaddingLeft:function(){return Me.Defaults.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return Me.Defaults.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return Me.Defaults.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return Me.Defaults.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return Me.Defaults.ATTACHMENT_DIRECTION},isFill:function(){return Me.Defaults.ATTACHMENT_FILL},getFillColor:function(){return Me.Defaults.ATTACHMENT_FILL_COLOR},getGradient:function(){return Me.Defaults.ATTACHMENT_GRADIENT},getGradientColor:function(){return Me.Defaults.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return Me.Defaults.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return Me.Defaults.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return Me.Defaults.ATTACHMENT_CAP},getJoin:function(){return Me.Defaults.ATTACHMENT_JOIN},isShadowable:function(){return Me.Defaults.ATTACHMENT_SHADOWABLE},getRoundRect:function(){return Oe.clone(this._roundRect)},getContentRect:function(){return Oe.clone(this._contentRect)}}),Me.canvas.LabelAttachment=function(t,e){Me.canvas.LabelAttachment.superClass.constructor.call(this,t,e)},Oe.ext("twaver.canvas.LabelAttachment",Me.canvas.BasicAttachment,{paint:function(t){var e=this._element instanceof Me.Link&&this._element.getStyle("link.label.rotatable");if(e){t.save();var i=this._viewRect.x+this._viewRect.width/2,n=this._viewRect.y+this._viewRect.height/2;t.translate(i,n),t.rotate(this._network.getElementUI(this._element).getAngle()),t.translate(-i,-n)}Me.canvas.LabelAttachment.superClass.paint.apply(this,arguments);var o=this._element.getStyle("label.align"),s=this._element&&this._element.getStyle("label.rotate.angle");0!==s&&(t.save(),Me.Util.rotateCanvas(t,this._contentRect,s)),Ke.drawText(t,this.text,this._contentRect,this.font,this.getStyle("label.color"),o),(e||0!==s)&&t.restore()},validate:function(){this.font=this.getFont("label.font");var t=this.getLabel(),e=Oe.g.getTextSize(this.font,t),i=this.getMaxLength();0!==i&&e.width>i?(this.text=Oe.g.getCollapseTextInLength(this.font,t,i),this._textSize=Oe.g.getTextSize(this.font,this.text)):(this.text=t,this._textSize=e),Me.canvas.LabelAttachment.superClass.validate.call(this);var n=this._viewRect,o=this._element&&this._element.getStyle("label.rotate.angle");if(0!==o){var s=new Me.List;s.add({x:n.x,y:n.y}),s.add({x:n.x+n.width,y:n.y}),s.add({x:n.x+n.width,y:n.y+n.height}),s.add({x:n.x,y:n.y+n.height}),s=this._rotatePointList(s,o,n);var a=Me.Util.getRect(s);this._viewRect=a}},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},getMaxLength:function(){return this.getStyle("label.maxlength")},isShadowable:function(){return this.getStyle("label.shadowable")}}),Me.canvas.AlarmAttachment=function(t,e){Me.canvas.AlarmAttachment.superClass.constructor.call(this,t,e)},Oe.ext("twaver.canvas.AlarmAttachment",Me.canvas.BasicAttachment,{paint:function(t){Me.canvas.AlarmAttachment.superClass.paint.apply(this,arguments),Ke.drawText(t,this.text,this._contentRect,this.font,this.getStyle("alarm.color"))},validate:function(){this.font=this.getFont("alarm.font"),this.text=this._network.getAlarmLabel(this._element),this._textSize=Ke.getTextSize(this.font,this.text),this._fillColor=this._network.getAlarmFillColor(this._element),Me.canvas.LabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),Me.canvas.LinkHandlerAttachment=function(t,e){Me.canvas.LinkHandlerAttachment.superClass.constructor.call(this,t,e)},Oe.ext("twaver.canvas.LinkHandlerAttachment",Me.canvas.BasicAttachment,{paint:function(t){Me.canvas.LinkHandlerAttachment.superClass.paint.apply(this,arguments),Ke.drawText(t,this.linkHandlerLabel,this._contentRect,this.linkHandlerFont,this.getStyle("link.handler.color"))},validate:function(){this.linkHandlerFont=this.getFont("link.handler.font"),this.linkHandlerLabel=this._network.getLinkHandlerLabel(this._element),this._textSize=Ke.getTextSize(this.linkHandlerFont,this.linkHandlerLabel),Me.canvas.LinkHandlerAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),Me.canvas.IconsAttachment=function(t,e){Me.canvas.IconsAttachment.superClass.constructor.call(this,t,e)},Oe.ext("twaver.canvas.IconsAttachment",Me.canvas.Attachment,{isShadowable:function(){return Me.Defaults.ATTACHMENT_SHADOWABLE},validate:function(){if(Me.canvas.IconsAttachment.superClass.validate.call(this),this.iconsNames=this._network.getIconsNames(this._element),this.iconsNames&&0!=this.iconsNames.length){var t=this._makeGroup(this.iconsNames),e=this._makeGroup(this._network.getIconsColors(this._element));len=t.length,this.iconsOrientation=this._makeArray(this._element.getStyle("icons.orientation"),len,"right"),this.iconsPosition=this._makeArray(this._element.getStyle("icons.position"),len,"topleft.bottomright"),this.iconsXoffset=this._makeArray(this._element.getStyle("icons.xoffset"),len,0),this.iconsYoffset=this._makeArray(this._element.getStyle("icons.yoffset"),len,0),this.iconsXgap=this._makeArray(this._element.getStyle("icons.xgap"),len,1),this.iconsYgap=this._makeArray(this._element.getStyle("icons.ygap"),len,1),this.locations=[],this.iconsSizes=[];var n,o;for(i=0;i<len;i++){var s=t[i],a=this.iconsOrientation[i]||"right",r=this.iconsPosition[i]||"topleft.bottomright",h=this.iconsXgap[i]||1,l=this.iconsYgap[i]||1,c=this.iconsXoffset[i]||0,d=this.iconsYoffset[i]||0;if(this._ui._element instanceof Me.Link){var u,_=this._ui.getLinkPoints();u=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(c)>0&&Math.abs(c)<1?"from"===r?c*=u:"to"===r?c=u*(1-c):(c/=2,c+=.5,c*=u):"from"===r?c=c:"to"===r?c=u-c:c+=u/2;{var g,f=Ze.calculatePointInfoAlongLine(_,!0,c,d),v=f.point;f.angle}g="from"===r?this._ui.getFromPoint():"to"===r?this._ui.getToPoint():this._ui._hotSpot,c=v.x-g.x,d=v.y-g.y}o=null,n=this._getIconsSize(s,a,h,l),n&&(o=this._network.getPosition(r,this._ui,n,c,d),"top"===a?o.y+=n.height:"left"===a&&(o.x+=n.width)),this.locations.push(o),this.iconsSizes.push(n)}var m=null;for(i=0;i<this.locations.length;i++)o=this.locations[i],n=this.iconsSizes[i],null!=o&&(m=null==m?{x:o.x,y:o.y,width:n.width,height:n.height}:Ze.unionRect(m,{x:o.x,y:o.y,width:n.width,height:n.height}));this._viewRect=m||{x:this._element.getLocation().x,y:this._element.getLocation().y,width:0,height:0},this.iconsGroups=t,this.colorGroups=e;var p=this._element instanceof Me.Link&&this._element.getStyle("link.icons.rotatable");for(i=0;i<len;i++)if(p instanceof Array&&p[i]&&this._viewRect){var y=this._viewRect.x+this._viewRect.width/2,w=this._viewRect.y+this._viewRect.height/2,A=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:y-A/2,y:w-A/2,width:A,height:A}}}},_makeGroup:function(t){if(!Array.isArray(t))return[[t]];var e,i,n,o=[],s=!1,a=t.length;for(e=0;a>e;e++)i=t[e],Array.isArray(i)?(s=!0,o.push(i)):(n=[i],o.push(n));return s||(o.length=0,o.push(t)),o},_makeArray:function(t,e,i){if(Array.isArray(t))return t;for(var n=[],o=0;e>o;o++)n.push(t||i);return n},paint:function(t){if(Me.canvas.IconsAttachment.superClass.paint.apply(this,arguments),this.iconsNames&&0!=this.iconsNames.length&&this.locations){var e,i,n,o,s,a,r,h,l,c;for(e=0;e<this.iconsGroups.length;e++)if(i=this.locations[e]){s=i.x,a=i.y,o=this.iconsGroups[e],r=this.colorGroups[e],h=this.iconsOrientation[e],l=this.iconsXgap[e]||1,c=this.iconsYgap[e]||1,n=0;for(var d in o){var u=null,_=null;r&&r.length>n&&(_=r[n++]);var g=Oe.getImageAsset(o[d]);if(null!=g){if("right"===h)u={x:s,y:a,width:g.getWidth(),height:g.getHeight()},s+=u.width+l;else if("left"===h)u={x:s-g.getWidth(),y:a,width:g.getWidth(),height:g.getHeight()},s-=u.width+l;else if("top"===h)u={x:s,y:a-g.getHeight(),width:g.getWidth(),height:g.getHeight()},a-=u.height+c;else{if("bottom"!==h)throw"Can not resolve '"+h+"' orientation";u={x:s,y:a,width:g.getWidth(),height:g.getHeight()},a+=u.height+c}var f=this._element instanceof Me.Link&&this._element.getStyle("link.icons.rotatable");if(f instanceof Array&&f[e]){t.save();var v=u,s=v.x+v.width/2,a=v.y+v.height/2;t.translate(s,a),t.rotate(this._network.getElementUI(this._element).getAngle()),t.translate(-s,-a),Vi(t,g.getImage(_,u.width,u.height),_,u,this._element,this._network),t.restore()}else Vi(t,g.getImage(_,u.width,u.height),_,u,this._element,this._network);if(this._network._debug){var u=this._viewRect;Ke.strokeRect(t,u,"#FCFC00",1),Ke.strokeRect(t,u,"#FCFC00",1)}}}}}},_getIconsSize:function(t,e,i,n){var o=0,s=0,a=null,r=null,h=null;for(var l in t)if(r=Oe.getImageAsset(t[l])){if("right"===e)a={x:o,y:s,width:r.getWidth(),height:r.getHeight()},o+=a.width+i;else if("left"===e)a={x:o-r.getWidth(),y:s,width:r.getWidth(),height:r.getHeight()},o-=a.width+i;else if("top"===e)a={x:o,y:s-r.getHeight(),width:r.getWidth(),height:r.getHeight()},s-=a.height+n;else{if("bottom"!==e)throw"Can not resolve '"+e+"' orientation";a={x:o,y:s,width:r.getWidth(),height:r.getHeight()},s+=a.height+n}h=null==h?Oe.clone(a):Ze.unionRect(h,a)}return h?{width:Math.abs(h.width),height:Math.abs(h.height)}:null}}),Me.canvas.EditAttachment=function(t,e){Me.canvas.EditAttachment.superClass.constructor.call(this,t,e)},Oe.ext("twaver.canvas.EditAttachment",Me.canvas.Attachment,{paint:function(t){Me.canvas.EditAttachment.superClass.paint.apply(this,arguments),this._viewRect=null,this.paintResizingPoints(t),this.paintEditPoints(t),this.paintRotatePoints(t)},paintResizingPoints:function(t){var e=this.resizingPoints.size();if(!(0>=e)){var i=2*this.resizePointSize,n=2*this.resizePointSize,o=this._network.getResizePointFillColor(),s=this._network.getResizePointOutlineWidth(),a=this._network.getResizePointOutlineColor(),r=this._element.getAngle(),h=this._element.getOriginalRect();t.lineWidth=s;for(var l=0;e>l;l++){var c=this.resizingPoints.get(l),d={x:c.x-this.resizePointSize,y:c.y-this.resizePointSize,width:2*this.resizePointSize,height:2*this.resizePointSize},u=this._getRotateRect(d,r,{x:h.x+h.width/2,y:h.y+h.height/2});t.save(),Me.Util.rotateCanvas(t,u,r),Hn.rect(t,u.x,u.y,i,n),t.restore()}t.fillStyle=o,t.strokeStyle=a,t.fill(),t.stroke()}},paintEditPoints:function(t){var e=this.editPoints.size();if(!(0>=e)){var i=this._network.getEditPointOutlineColor(),n=this._network.getEditPointFillColor(),o=this._network.getEditPointOutlineWidth();t.beginPath(),t.lineWidth=o;for(var s=0;e>s;s++){var a=this.editPoints.get(s);t.beginPath(),Hn.circle(t,a.x,a.y,this.editPointSize,n,i),t.closePath()}}},paintRotatePoints:function(t){var e=this.rotatePoints.size();if(!(0>=e)){var i=this._network.getRotatePointOutlineColor(),n=this._network.getRotatePointFillColor(),o=this._network.getRotatePointOutlineWidth();t.beginPath(),t.lineWidth=o;for(var s=0;e>s;s++){var a=this.rotatePoints.get(s);t.beginPath(),Hn.circle(t,a.x,a.y,this.rotatePointSize,n,i),t.closePath()}}},validate:function(){Me.canvas.EditAttachment.superClass.validate.call(this),this.editPointSize=this._network.getEditPointSize(),this.resizePointSize=this._network.getResizePointSize(),this.rotatePointSize=this._network.getRotatePointSize(),this.resizingPoints=new Me.List,this.editPoints=new Me.List,this.rotatePoints=new Me.List,this._element instanceof Me.Node&&this._addResizingPoint(this._element),!(this._network.isRotatable(this._element)&&this._element instanceof Fn)||this._element instanceof Me.ShapeNode||this._element instanceof Me.Grid||this._element instanceof Me.Group||this._addRotatePoint(this._element),this._element instanceof Me.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof Me.canvas.ShapeLinkUI&&this._addShapeLinkPoints(this._element),this._ui instanceof Me.canvas.LinkUI&&this._addLinkControlPoint(this._ui)},_addResizingPoint:function(t){var e=t.getOriginalRect();if(e){var i=this._network.getResizePointSize();if(!(0>=i)){var n=new fn([{x:e.x,y:e.y},{x:e.x+e.width/2,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x,y:e.y+e.height/2},{x:e.x+e.width,y:e.y+e.height/2},{x:e.x,y:e.y+e.height},{x:e.x+e.width/2,y:e.y+e.height},{x:e.x+e.width,y:e.y+e.height}]),o=this._network.getResizePointOutlineWidth(),s=this._network.getResizePointOutlineColor(),a=this._network.getResizePointFillColor();this._addPoints(t.getRect(),n,o,s,a,!0)}}},_addRotatePoint:function(t){var e=t.getOriginalRect();if(e){var i=this._network.getRotatePointSize();if(!(0>=i)){var n=2*i,o=new Me.List([{x:e.x+e.width/2,y:e.y-this._network.getRotatePointOffset()-n/2}]),s=t.getAngle();0!=s&&(o=this._rotatePointList(o,s,t.getOriginalRect()));var a=o.get(0),r={x:a.x-n/2,y:a.y-n/2,width:n,height:n},h=this._network.getRotatePointOutlineWidth(),l=this.rotatePointSize+h;Ze.grow(e,l,l);var c=Ze.unionRect(t.getRect(),r);this._viewRect=Ze.unionRect(c,this._viewRect),this.rotatePoints=o}}},_addShapeNodePoint:function(t){this._addEditPoints(t.getPoints())},_addShapeLinkPoints:function(t){this._addEditPoints(t.getPoints())},_addLinkControlPoint:function(t){if(Ti.isOrthogonalLink(t._element)){var e=t.getControlPoint();if(e){var i=new Me.List;i.add(e),this._addEditPoints(i)}}},_addEditPoints:function(t){var e=Ze.getRect(t);if(e){var i=this._network.getEditPointSize();if(!(0>=i)){var n=this._network.getEditPointOutlineWidth();this._addPoints(e,t,n,!1)}}},_addPoints:function(t,e,i,n,o,s){var a=s?this._network.getResizePointSize():this._network.getEditPointSize();if(!(0>a)){var r=a+i;Ze.grow(t,r,r),this._viewRect=Ze.unionRect(t,this._viewRect),1==s?this.resizingPoints=e:this.editPoints=e}},_rotatePoint:function(t,e,i){var n=Ze.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2),o=n.transform(t);return o},_rotatePointList:function(t,e,i){var n=this,o=new Me.List;return t.forEach(function(t){o.add(n._rotatePoint(t,e,i))}),o},_getRotateRect:function(t,e,i){var n=Ze.createMatrix(e*Math.PI/180,i.x,i.y),o={x:t.x+t.width/2,y:t.y+t.height/2},s=n.transform(o),a=new Me.List([{x:s.x-t.width/2,y:s.y-t.height/2},{x:s.x+t.width/2,y:s.y-t.height/2},{x:s.x+t.width/2,y:s.y+t.height/2},{x:s.x-t.width/2,y:s.y+t.height/2}]);return Ze.getRect(a)}}),Me.canvas.HTMLLabelAttachment=function(t,e){Me.canvas.HTMLLabelAttachment.superClass.constructor.call(this,t,e),this._triangleDiv=Me.Util.createDiv(),this._roundDiv=Me.Util.createDiv(),this._contentDiv=Me.Util.createDiv();this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Oe.ext("twaver.canvas.HTMLLabelAttachment",Me.canvas.LabelAttachment,{validate:function(){var t=this._element.getStyle("attachment.htmllabel.hyperlink");t?(Me.Util.setCSSStyle(this._triangleDiv,"pointer-events","auto"),Me.Util.setCSSStyle(this._contentDiv,"pointer-events","auto")):(Me.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),Me.Util.setCSSStyle(this._contentDiv,"pointer-events","none")),Me.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Me.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var e=(this.getFont("label.font"),this.getLabel());this._contentDiv.innerHTML=e,this._contentDiv.style.visibility="hidden",Me.canvas.HTMLLabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(Me.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(Me.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(t){var e=this.isFill(),i=this.getOutlineWidth(),n=this._contentRect;if(this.getElementUI().setShadow(this,t),i>0||e){if(Ke.drawRoundRect(t,n.x,n.y,n.width,n.height,this.getCornerRadius()),this._pointers){var o=this._pointers;t.moveTo(o[0].x,o[0].y),t.lineTo(o[1].x,o[1].y),t.lineTo(o[2].x,o[2].y)}if(t.closePath(),i>0&&(t.lineWidth=i,t.strokeStyle=this.getOutlineColor(),t.lineCap=this.getCap(),t.lineJoin=this.getJoin(),t.stroke()),e){var s=this.getFillColor(),a=this.getGradient();a?Ke.fill(t,s,a,this.getGradientColor(),this._viewRect):t.fillStyle=s,t.fill()}}var r=(this.getFont("label.font"),this.getLabel(),this._network.getViewRect().x),h=this._network.getViewRect().y,l=this._network.getZoom(),c={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},d=c.x*l-r-this._contentDiv.offsetWidth/2*l+"px",u=c.y*l-h-this._contentDiv.offsetHeight/2*l+"px";this._contentDiv.style.left=d,this._contentDiv.style.top=u,this._contentDiv.style.setProperty("-webkit-transform","scale("+l+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&Ke.strokeRect(t,this._contentRect,"#AAAAAA")},setVisibility:function(t){this._contentDiv.style.visibility=t},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),Me.canvas.HTMLAlarmAttachment=function(t,e){Me.canvas.HTMLAlarmAttachment.superClass.constructor.call(this,t,e),this._triangleDiv=Me.Util.createDiv(),this._roundDiv=Me.Util.createDiv(),this._contentDiv=Me.Util.createDiv(),Me.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Me.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),Me.Util.setCSSStyle(this._contentDiv,"white-space","nowrap"),Me.Util.setCSSStyle(this._contentDiv,"pointer-events","none");this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Oe.ext("twaver.canvas.HTMLAlarmAttachment",Me.canvas.AlarmAttachment,{validate:function(){var t=(this.getFont("alarm.font"),this._network.getAlarmLabel(this._element));this._contentDiv.innerHTML=t,this._contentDiv.style.visibility="hidden",Me.canvas.HTMLAlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(Me.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(Me.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(t){var e=this.isFill(),i=this.getOutlineWidth(),n=this._contentRect;if(this.getElementUI().setShadow(this,t),i>0||e){if(Ke.drawRoundRect(t,n.x,n.y,n.width,n.height,this.getCornerRadius()),this._pointers){var o=this._pointers;t.moveTo(o[0].x,o[0].y),t.lineTo(o[1].x,o[1].y),t.lineTo(o[2].x,o[2].y)}if(t.closePath(),i>0&&(t.lineWidth=i,t.strokeStyle=this.getOutlineColor(),t.lineCap=this.getCap(),t.lineJoin=this.getJoin(),t.stroke()),e){var s=this.getFillColor(),a=this.getGradient();a?Ke.fill(t,s,a,this.getGradientColor(),this._viewRect):t.fillStyle=s,t.fill()}}var r=(this.getFont("alarm.font"),this._network.getAlarmLabel(this._element),this._network.getViewRect().x),h=this._network.getViewRect().y,l=this._network.getZoom(),c={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},d=c.x*l-r-this._contentDiv.offsetWidth/2*l+"px",u=c.y*l-h-this._contentDiv.offsetHeight/2*l+"px";this._contentDiv.style.left=d,this._contentDiv.style.top=u,this._contentDiv.style.setProperty("-webkit-transform","scale("+l+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&Ke.strokeRect(t,this._contentRect,"#AAAAAB"),Me.canvas.AlarmAttachment.superClass.paint.apply(this,arguments)},setVisibility:function(t){this._contentDiv.style.visibility=t},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),Me.canvas.interaction.BaseInteraction=function(t){this.network=t},Oe.ext("twaver.canvas.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},repaint:function(){this.network.repaintTopCanvas()},convertPointFromView:function(t){var e=t.x*this.network.getZoom()-this.network.getViewRect().x,i=t.y*this.network.getZoom()-this.network.getViewRect().y;return{x:e,y:i}},convertFromUIToMarkerRect:function(t,e,i){var n=this.network.getZoom();return{x:t.x*n-this.network.getViewRect().x+e*n,y:t.y*n-this.network.getViewRect().y+i*n,width:t.width*n,height:t.height*n}},getMarkerPoint:function(t){var e;if(He.isTouchable&&t.changedTouches&&t.changedTouches.length>0){var i=t.changedTouches[0];return e={x:i.clientX,y:i.clientY}}return e=He.isFirefox?{x:t.layerX,y:t.layerY}:{x:t.offsetX,y:t.offsetY}},paint:function(t){},addListener:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];je.addEventListener(e,"handle_"+e,this.network.getView(),this)}},removeListener:function(){for(var t=0;t<arguments.length;t++)je.removeEventListener(arguments[t],this.network.getView(),this)},_handle_mousedown:function(t){0===t.button&&(this._startLogical=this.network.getLogicalPoint(t),this._startClient=je.getClientPoint(t),this._startLogical&&je.handle_mousedown(this,t))},_handle_mousemove:function(t){this._endLogical={x:this._startLogical.x+(t.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(t.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(t){delete this._startClient,delete this._startLogical,delete this._endLogical}}),Me.canvas.interaction.SelectInteraction=function(t){Me.canvas.interaction.SelectInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.canvas.interaction.SelectInteraction",Me.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup"),this.end(),this.network.removeMarker(this)},paint:function(t){if(null!=this.startPoint&&null!=this.endPoint){var e=this.convertPointFromView(this.startPoint),i=this.convertPointFromView(this.endPoint),n=e.x,o=e.y,s=i.x,a=i.y,r=Ze.getRect([{x:n,y:o},{x:s,y:a}]);if(null!=r){t.beginPath();var h=this.network.getSelectOutlineWidth(),l=this.getIntersectMode()?this.network.getSelectFillColor():null;t.strokeStyle=this.network.getSelectOutlineColor(),t.lineWidth=h,Hn.rect(t,r.x,r.y,r.width,r.height,l,this.network.getSelectOutlineColor()),t.closePath()}}},handle_mousedown:function(t){if(this.network.isValidEvent(t)&&!this.network.isMovingElement()&&!this.network.isEditingElement()&&!t.shiftKey){var e=this.network.getElementAt(t),i=this.network.getSelectionModel();e?Oe.isCtrlDown(t)?i.contains(e)?i.removeSelection(e):i.appendSelection(e):i.contains(e)||i.setSelection(e):(Oe.isCtrlDown(t)||i.clearSelection(),this.end(t),this.startPoint=this.network.getLogicalPoint(t),this.startPoint&&this.network.isRectSelectEnabled()&&this.addListener("mousemove"))}},handle_mouseup:function(t){this.end(t)},handle_mousemove:function(t){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.end(t);var e=this.network.getLogicalPoint(t);e&&(this.network.setSelectingElement(!0),this.network.fireInteractionEvent(null==this.endPoint?{kind:"selectStart",event:t}:{kind:"selectBetween",event:t}),this.endPoint=e,this.repaint())},end:function(t){if(this.startPoint){if(this.endPoint&&this.startPoint.x!==this.endPoint.x&&this.startPoint.y!==this.endPoint.y){var e=Ze.getRect([this.startPoint,this.endPoint]),i=this.network.getElementsAtRect(e,this.getIntersectMode(),this.network.getRectSelectFilter());if(i&&i.size()>0){var n=this.network.getSelectionModel(),o=n.toSelection();i.forEach(function(t){n.contains(t)?o.remove(t):o.add(t)},this),n.setSelection(o)}this.network.fireInteractionEvent({kind:"selectEnd",event:t})}this.network.setSelectingElement(!1),this.removeListener("mousemove"),this.startPoint=null,this.endPoint=null,this.repaint()}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this.startPoint.x>this.endPoint.x&&this.startPoint.y>this.endPoint.y}}),Me.canvas.interaction.MoveInteraction=function(t,e){this.lazyMode=e,Me.canvas.interaction.MoveInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.canvas.interaction.MoveInteraction",Me.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","keydown","mouseout"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","keydown","mouseout"),this.end(),this.network.removeMarker(this)},handle_keydown:function(t){this.currentKeyEvent=t,this.addListener("keyup")},handle_keyup:function(t){this.currentKeyEvent=null,this.removeListener("keyup")},isParenting:function(){return this.pressPoint&&null!=this.currentKeyEvent&&80===this.currentKeyEvent.keyCode},parentProcess:function(t,e){var i=null;this.parent=null;var n=this;if(!e&&this.isParenting()){var o={},s=this.network.getLogicalPoint(t);o.x=s.x-1,o.y=s.y-1,o.width=2,o.height=2;var a=this.network.getElementsAtRect(o,!0);if(a&&a.size()>0)for(var r=a.size(),h=0;r>h;h++){var l=a.get(h);if(!n.network.getElementBox().getSelectionModel().contains(l)){n.parent=l;break}}}else this.parent=null;null!=this.parent&&(i=this.network.getElementUI(this.parent).getViewRect()),this.parentRect=null==i||e?null:i},paint:function(t){if(this.lazyMode){if(null==this.pressPoint||null==this.dragPoint)return;t.beginPath();var e=this.dragPoint.x-this.pressPoint.x,i=this.dragPoint.y-this.pressPoint.y,n=this.network.getMovableSelectedElements(),o=n.size(),s=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,a=this.network.getLazyMoveOutlineWidth(),r=this.network.getLazyMoveOutlineColor();t.strokeStyle=r,t.lineWidth=a,t.fillStyle=s;for(var h=0;o>h;h++){var l=n.get(h),c=this.network.getElementUI(l);if(c){var d=this.convertFromUIToMarkerRect(c.getViewRect(),e,i);Hn.rect(t,d.x,d.y,d.width,d.height)}}t.fill(),t.stroke()}if(this.parentRect){t.beginPath();var s=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,a=this.network.getLazyMoveOutlineWidth(),r=this.network.getLazyMoveOutlineColor();t.strokeStyle=r,t.lineWidth=a,t.fillStyle=s;var d=this.parentRect;Hn.rect(t,d.x,d.y,d.width,d.height),t.fill(),t.stroke()}},handle_mousedown:function(t){if(0===t.button&&this.network.isValidEvent(t)&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var e=this.network.getElementAt(t);this.network.isMovable(e)&&(this.end(t),this.lastPoint=this.network.getLogicalPoint(t),this.lazyMode&&(this.pressPoint=this.lastPoint),this.lastPoint&&this.addListener("mousemove"))}},handle_mouseup:function(t){this.end(t)},handle_mouseout:function(t){this.end(t)},handle_mousemove:function(t){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements())return void this.end(t);var e=this.network.getLogicalPoint(t);e&&this.lastPoint&&(this.xoffset=e.x-this.lastPoint.x,this.yoffset=e.y-this.lastPoint.y,Math.abs(this.xoffset)<1&&Math.abs(this.yoffset)<1||(this.lazyMode?null==this.dragPoint?(this.network.fireInteractionEvent({kind:"lazyMoveStart",event:t}),this.network.setMovingElement(!0)):this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:t}):(this.lastPoint=e,this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t})),this.network.moveSelectedElements(this.xoffset,this.yoffset)),this.parentProcess(t,!1),this.lazyMode&&(this.dragPoint=e),(this.lazyMode||this.isParenting())&&this.repaint()))},end:function(t){if(this.lazyMode){if(null!=this.dragPoint&&null!=this.pressPoint){var e=this,i=function(){e.network.fireInteractionEvent({kind:"lazyMoveEnd",event:t}),e.network.setMovingElement(!1)},n=this.dragPoint.x-this.pressPoint.x,o=this.dragPoint.y-this.pressPoint.y;this.network.moveSelectedElements(n,o,this.network.isLazyMoveAnimate(),i)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t}));if(this.isParenting()){null==this.parent&&(this.parent=this.network.getCurrentSubNetwork());var e=this;this.network.getMovableSelectedElements().forEach(function(t){t.setParent(e.parent)},this.network)}this.parentProcess(t,!0),this.isParenting()&&this.repaint(),this.network.invalidateCanvasSize(),this.removeListener("mousemove"),this.lastPoint=null,this.dragPoint=null,this.pressPoint=null}}),Me.canvas.interaction.ScrollInteraction=function(t){Me.canvas.interaction.ScrollInteraction.superClass.constructor.call(this,t),this.hThumbRect=null,this.vThumbRect=null,this.scrollBarVisible=!1},Oe.ext("twaver.canvas.interaction.ScrollInteraction",Me.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseover","mouseout"),He.isFirefox?je.addEventListener("DOMMouseScroll","handleMouseWheel",this.network.getView(),this):je.addEventListener("mousewheel","handleMouseWheel",this.network.getView(),this),je.addEventListener("mouseup","handleMouseUp",t,this),je.addEventListener("mousemove","handleMouseMove",t,this),this.network.addPropertyChangeListener(this.handleViewRectChange,this),this.validateScrollBar(),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseover","mouseout"),He.isFirefox?je.removeEventListener("DOMMouseScroll",this.network.getView(),this):je.removeEventListener("mousewheel",this.network.getView(),this),je.removeEventListener("mouseup",t,this),je.removeEventListener("mousemove",t,this),this.network.removePropertyChangeListener(this.handleViewRectChange,this),this.network.removeMarker(this)},handleViewRectChange:function(t){("viewRect"==t.property||"canvasSizeChange"==t.property)&&this.validateScrollBar()},getScrollBarWidth:function(){return this.network.getScrollBarWidth()},getScrollBarColor:function(){return"#cccccc"},validateScrollBar:function(){if(this.hThumbRect=null,this.vThumbRect=null,0==this.network.isScrollBarVisible())return void this.repaint();var t=this.network.getViewRect().height,e=this.network.getViewRect().width,i=this.network.getViewRect().x,n=this.network.getViewRect().y,o=this.network.getCanvasSize(),s=o.width,a=o.height;if(s>e&&(0>i||i+e>s))return void this.repaint();if(a>t&&(0>n||n+t>a))return void this.repaint();var r=0,h=a>t,l=s>e,c=this.getScrollBarWidth();if(a>t){r=l?t*(t-c)/a:t*t/a;var d=n/(a-t)*(t-r-c);this.vThumbRect={x:e-c,y:d,width:c,height:r}}var u=0;if(s>e){u=h?e*(e-c)/s:e*e/s;var _=i/(s-e)*(e-u-c);this.hThumbRect={x:_,y:t-c,width:u,height:c}}this.network.setHScrollBarVisible(null!=this.hThumbRect),this.network.setVScrollBarVisible(null!=this.vThumbRect),this.repaint()},scrollXOffset:function(t){var e=this.network.getViewRect().height,i=this.network.getViewRect().width,n=this.network.getViewRect().x,o=this.network.getViewRect().y,s=30;t&&(s=-30),this.network.setViewRect(n+s,o,i,e)},scrollYOffset:function(t){var e=this.network.getViewRect().height,i=this.network.getViewRect().width,n=this.network.getViewRect().x,o=this.network.getViewRect().y,s=30;t&&(s=-30),this.network.setViewRect(n,o+s,i,e)},handle_mousedown:function(t){if(1!=this.network.isValidEvent(t)){var e=this.getMarkerPoint(t);this.hBarDownPoint=null,this.vBarDownPoint=null,null!=this.vThumbRect&&Ze.containsPoint(this.vThumbRect,e.x,e.y)&&(this.vBarDownPoint={x:t.screenX,y:t.screenY},this.vBarDownOffset=this.vBarDownPoint.y-this.vThumbRect.y),null!=this.hThumbRect&&Ze.containsPoint(this.hThumbRect,e.x,e.y)&&(this.hBarDownPoint={x:t.screenX,y:t.screenY},this.hBarDownOffset=this.hBarDownPoint.x-this.hThumbRect.x)}},handle_mouseover:function(t){1!=this.scrollBarVisible&&(this.scrollBarVisible=!0,this.repaint())},handle_mouseout:function(t){0!=this.scrollBarVisible&&(this.scrollBarVisible=!1,this.repaint())},handleMouseUp:function(t){this.vBarDownPoint=null,this.hBarDownPoint=null,this.repaint()},handleMouseMove:function(t){var e={x:t.screenX,y:t.screenY},i=this.network.getCanvasSize(),n=this.network.getViewRect().height,o=this.network.getViewRect().width,s=this.getScrollBarWidth();if(null!=this.hBarDownPoint){var a=e.x-this.hBarDownPoint.x;return this.hBarDownPoint=e,void this.network.setViewOffSet(a*i.width/(o-s),0)}if(null!=this.vBarDownPoint){var r=e.y-this.vBarDownPoint.y;return this.vBarDownPoint=e,void this.network.setViewOffSet(0,r*i.height/(n-s))}},handleMouseWheel:function(t){var e=!1;t.wheelDelta!==t.wheelDeltaX?(t.wheelDelta?t.wheelDelta>0&&(e=!0):t.detail<0&&(e=!0),this.scrollYOffset(e)):(t.wheelDelta?t.wheelDelta>0&&(e=!0):t.detail<0&&(e=!0),this.scrollYOffset(e))},paintRoundRect:function(t,e,i,n,o,s,a,r){t.beginPath(),t.globalAlpha=i,t.fillStyle=e,Ke.drawRoundRect(t,n,o,s,a,r),t.fill()},paint:function(t){if(0!=this.network.isScrollBarVisible()&&(0!=this.scrollBarVisible||null!=this.hBarDownPoint||null!=this.vBarDownPoint)){var e=this.getScrollBarWidth(),i=this.network.getViewRect().height,n=this.network.getViewRect().width;t.save();var o,s=this.getScrollBarColor();null!=this.hThumbRect&&(o=t.createLinearGradient(this.hThumbRect.x,this.hThumbRect.y,this.hThumbRect.x,this.hThumbRect.y+this.hThumbRect.height),o.addColorStop(0,s),o.addColorStop(1,"#666666"),this.paintRoundRect(t,this.getScrollBarColor(),.5,0,i-e,n-e,e,e/2),this.paintRoundRect(t,o,.9,this.hThumbRect.x,this.hThumbRect.y+1,this.hThumbRect.width,this.hThumbRect.height-2,e/2)),null!=this.vThumbRect&&(o=t.createLinearGradient(this.vThumbRect.x,this.vThumbRect.y,this.vThumbRect.x+this.vThumbRect.width,this.vThumbRect.y),o.addColorStop(0,s),o.addColorStop(1,"#666666"),this.paintRoundRect(t,this.getScrollBarColor(),.5,n-e,0,e,i-e,e/2),this.paintRoundRect(t,o,.9,this.vThumbRect.x+1,this.vThumbRect.y,this.vThumbRect.width-2,this.vThumbRect.height,e/2)),t.restore()}}}),Me.canvas.interaction.DefaultInteraction=function(t){Me.canvas.interaction.DefaultInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.canvas.interaction.DefaultInteraction",Me.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove","keydown")},tearDown:function(){this.removeListener("mousedown","mousemove","keydown")},handle_mousedown:function(t){if(this.network.isValidEvent(t)){this.network.isFocusOnClick()&&Me.Util.setFocus(this.network.getView());var e=this.network.getElementAt(t);2===t.detail?this.handleDoubleClicked(t,e):this.handleClicked(t,e)}},handleClicked:function(t,e){Ii.handleClicked(this.network,t,e)},handleDoubleClicked:function(t,e){Ii.handleDoubleClicked(this.network,t,e)},handle_keydown:function(t){Ii.handleKeyDown(this.network,t)},handle_mousemove:function(t){var e=this.network.getElementAt(t),i=this._preElement,n=Li(i),o=Li(e);i!==e&&(i&&(n&&n.onMouseLeave&&n.onMouseLeave(i,this.network),this.network.onMouseLeave(i,t)),e&&(o&&o.onMouseEnter&&o.onMouseEnter(e,this.network),this.network.onMouseEnter(e,t))),e&&o&&o.onMouseMove&&o.onMouseMove(e,this.network),this.network.onMouseMove(e,t),this._preElement=e}}),Me.canvas.interaction.PanInteraction=function(t){Me.canvas.interaction.PanInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.canvas.interaction.PanInteraction",Me.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown","mouseup")},handle_mousedown:function(t){this.network.isValidEvent(t)&&(this.lastPoint=this.getMarkerPoint(t),this.lastPoint&&(this.addListener("mousemove"),this.network.getView().style.cursor="pointer"))},handle_mouseup:function(t){this._clear()},handle_mousemove:function(t){if(this.lastPoint){var e=this.getMarkerPoint(t);if(e){var i=e.x-this.lastPoint.x,n=e.y-this.lastPoint.y;this.network.panByOffset(-i,-n),this.lastPoint=e}}},_clear:function(t){this.lastPoint&&(this.lastPoint=null,this.network.getView().style.cursor=this._oldCursor,this.removeListener("mousemove"))}}),Me.canvas.interaction.CreateElementInteraction=function(t,e){e||(e=Me.Node),this.elementFunction=Me.Util.isTypeOf(e,Me.Node)?function(t){var i=new e;return i instanceof Me.Node&&i.setCenterLocation(t),i}:e,Me.canvas.interaction.CreateElementInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.canvas.interaction.CreateElementInteraction",Me.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(t){var e=this.network.getLogicalPoint(t);if(e){var i=this.elementFunction(e);i&&this.network.addElementByInteraction(i)}}}),Me.canvas.interaction.EditInteraction=function(t,e){this.lazyMode=e,this.pointIndex=-1,Me.canvas.interaction.EditInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.canvas.interaction.EditInteraction",Me.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear(),this.network.removeMarker(this)},paint:function(t){if(1==this.lazyMode&&null!=this.resizingRect){t.lineWidth=this.network.getResizeLineWidth();var e=this.convertFromUIToMarkerRect(this.resizingRect,0,0);t.save(),Me.Util.rotateCanvas(t,e,this.node.getAngle()),t.beginPath(),Hn.rect(t,e.x,e.y,e.width,e.height,null,this.network.getResizeLineColor()),t.restore()}this.isStartRotate&&this.showRotateScale(t)},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.network.repaintTopCanvas()},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(t){this.cursorID=t,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(t){if(0===t.button)if(!Oe.isAltDown(t)||this.network.isEditingElement())!this.network.isEditingElement()||this.isStart||this.isStartRotate||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:t,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?Oe.isAltDown(t)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:t,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?Oe.isAltDown(t)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:t,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(t)));else{var e=this.network.getElementAt(t),i=this.network.getLogicalPoint(t);if(e instanceof Me.ShapeNode){var n=this.getPointIndex(e.getPoints(),i,!0);n>0&&(this._handle_mousedown(t),this.pointIndex=n,this.shapeNode=e,e.addPoint(i,n),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:t,element:e,pointIndex:n}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:e,pointIndex:n}))}if(e instanceof Me.ShapeLink){var o=new Me.List(e.getPoints()),s=this.network.getElementUI(e);o.add(s.getFromPoint(),0),o.add(s.getToPoint());var n=this.getPointIndex(o,i)-1;n>0&&(this._handle_mousedown(t),this.pointIndex=n,this.shapeLink=e,e.addPoint(i,n),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:t,element:e,pointIndex:n}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:e,pointIndex:n}))}}},handle_mouseup:function(t){if(this.isStart){var e=this.network.getLogicalPoint(t);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var i=this,n=new Me.animate.AnimateBounds(this.node,this.resizingRect,function(){i.network.fireInteractionEvent({kind:"lazyResizeEnd",event:t,element:i.node,resizeDirection:i.resizeDirection}),i.clear()});Me.animate.AnimateManager.start(n)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:t,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:t,element:this.node,resizeDirection:this.resizeDirection});else this.shapeNode&&this.pointIndex>=0&&e?(this.shapeNode.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0&&e?(this.shapeLink.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&e&&(this.linkUI.setControlPoint(e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.linkUI._element}))}this._handle_mouseup(t),this.lazyMode||this.clear()},handle_mousemove:function(t){if(this.network.isValidEvent(t)){if(this.isStartRotate&&this.node)return this._handleRotateElement(t,this.node),void(this.network.isShowRotateScale()&&this.repaint());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0)return void this._handleMovingShapeNodePoint(t);if(this.shapeLink&&this.pointIndex>=0)return void this._handleMovingShapeLinkPoint(t);if(this.node&&this.resizeDirection)return void this._handleResizing(t);if(this.linkUI)return void this._handleMovingLinkControlPoint(t)}if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())return void this.clear();var e=this.network.getElementAt(t),i=this.network.getElementUI(e);if(!i||!i.getEditAttachment())return void this.clear();var n=this.network.getLogicalPoint(t);if(e instanceof Me.Node){if(this.node=e,this._isEditingShapeNode(n)||this._isResizingNode(n))return void this.network.setEditingElement(!0);if(this._isRotatingElement(n))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(e instanceof Me.ShapeLink){if(this.shapeLink=e,this._isEditingShapeLink(n))return void this.network.setEditingElement(!0)}else if(i instanceof Me.canvas.LinkUI){var o=this.network.getEditPointSize();if(Ti.isOrthogonalLink(i._element)){this.linkUI=i;var s=this.linkUI.getControlPoint();return void(s&&this._contains(n,s,o)&&(this._setCrossCursor(),this.network.setEditingElement(!0)))}}this.clear()}},_isRotatingElement:function(t){var e=this.network.getRotatePointSize();if(0>=e)return!1;var i=this.node.getOriginalRect(),n=this.node.getAngle();return this._isRotating(t,"crosshair",i,n)},_isRotating:function(t,e,i,n){var o=this.network.getRotatePointSize(),s={x:i.x+i.width/2,y:i.y-this.network.getRotatePointOffset()-o},a=this._rotatePoint(s,n,i),r={x:a.x-o,y:a.y-o,width:2*o,height:2*o};return Ze.containsPoint(r,t)?(this._removeCursor(),this._setCursor(e),!0):!1},_handleRotateElement:function(t,e){this._handle_mousemove(t);var i=this._calculateAngle(this.network.getLogicalPoint(t),e);e.setAngle(i)},_calculateAngle:function(t,e){var i=e.getCenterLocation();return Math.round(180*Math.atan2(i.x-t.x,t.y-i.y)/Math.PI+180)},_handleMovingShapeNodePoint:function(t){var e=this.network.getLogicalPoint(t);this.shapeNode.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(t){var e=this.network.getLogicalPoint(t);this.shapeLink.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(t){this.linkUI.setControlPoint(this.network.getLogicalPoint(t)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.linkUI._element})},_handleResizing:function(t){this._handle_mousemove(t);var e=this.node.getAngle(),i=this.node.getLocation(),n=this.node.getWidth()/2,o=this.node.getHeight()/2,s={x:i.x+n,y:i.y+o},a={x:-n,y:-o},r={x:-n,y:o},h={x:n,y:o},l={x:n,y:-o},c={x:0,y:-o},d={x:n,y:0},u={x:0,y:o},_={x:-n,y:0};if("northwest"===this.resizeDirection&&(this._transformPoint(h,s,e),a.x=this._endLogical.x,a.y=this._endLogical.y,s.x=(a.x+h.x)/2,s.y=(a.y+h.y)/2,this._reversPoint(a,s,e),this._reversPoint(h,s,e),this.resizingRect={x:a.x,y:a.y,width:h.x-a.x,height:h.y-a.y}),"north"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,s,e),c.y=g.y-s.y,this._transformPoint(c,s,e),this._transformPoint(u,s,e),s.x=(c.x+u.x)/2,s.y=(c.y+u.y)/2,this._reversPoint(c,s,e),this._reversPoint(u,s,e),this.resizingRect={x:s.x-this.node.getWidth()/2,y:s.y-(u.y-c.y)/2,width:this.node.getWidth(),height:u.y-c.y}}if("northeast"===this.resizeDirection&&(this._transformPoint(r,s,e),l.x=this._endLogical.x,l.y=this._endLogical.y,s.x=(r.x+l.x)/2,s.y=(r.y+l.y)/2,this._reversPoint(r,s,e),this._reversPoint(l,s,e),this.resizingRect={x:r.x,y:l.y,width:l.x-r.x,height:r.y-l.y}),"west"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,s,e),_.x=g.x-s.x,this._transformPoint(d,s,e),this._transformPoint(_,s,e),s.x=(d.x+_.x)/2,s.y=(d.y+_.y)/2,this._reversPoint(d,s,e),this._reversPoint(_,s,e),this.resizingRect={x:s.x-(d.x-_.x)/2,y:s.y-this.node.getHeight()/2,width:d.x-_.x,height:this.node.getHeight()}}if("east"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,s,e),d.x=g.x-s.x,this._transformPoint(d,s,e),this._transformPoint(_,s,e),s.x=(d.x+_.x)/2,s.y=(d.y+_.y)/2,this._reversPoint(d,s,e),this._reversPoint(_,s,e),this.resizingRect={x:s.x-(d.x-_.x)/2,y:s.y-this.node.getHeight()/2,width:d.x-_.x,height:this.node.getHeight()}}if("southwest"===this.resizeDirection&&(this._transformPoint(l,s,e),r.x=this._endLogical.x,r.y=this._endLogical.y,s.x=(r.x+l.x)/2,s.y=(r.y+l.y)/2,this._reversPoint(r,s,e),this._reversPoint(l,s,e),this.resizingRect={x:r.x,y:l.y,width:l.x-r.x,height:r.y-l.y}),"south"===this.resizeDirection){var g={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(g,s,e),u.y=g.y-s.y,this._transformPoint(c,s,e),this._transformPoint(u,s,e),s.x=(c.x+u.x)/2,s.y=(c.y+u.y)/2,this._reversPoint(c,s,e),this._reversPoint(u,s,e),this.resizingRect={x:s.x-this.node.getWidth()/2,y:s.y-(u.y-c.y)/2,width:this.node.getWidth(),height:u.y-c.y}}"southeast"===this.resizeDirection&&(this._transformPoint(a,s,e),h.x=this._endLogical.x,h.y=this._endLogical.y,s.x=(a.x+h.x)/2,s.y=(a.y+h.y)/2,this._reversPoint(a,s,e),this._reversPoint(h,s,e),this.resizingRect={x:a.x,y:a.y,width:h.x-a.x,height:h.y-a.y}),this.lazyMode?(this.repaint(),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:t,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:t,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(t){var e=this.network.getEditPointSize();if(this.node instanceof Me.ShapeNode){this.shapeNode=this.node;for(var i=this.shapeNode.getPoints(),n=0,o=i.size();o>n;n++){var s=i.get(n);if(this._contains(t,s,e))return this._setCrossCursor(),this.pointIndex=n,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(t){for(var e=this.network.getEditPointSize(),i=this.shapeLink.getPoints(),n=0,o=i.size();o>n;n++){var s=i.get(n);if(this._contains(t,s,e))return this._setCrossCursor(),this.pointIndex=n,!0}return this.pointIndex=-1,!1},_isResizingNode:function(t){var e=this.network.getResizePointSize();if(0>=e)return!1;var i=this.node.getOriginalRect(),n=this.node.getAngle(),o={x:i.x,y:i.y},s=this._rotatePoint(o,n,i);return this._isResizing(t,s.x,s.y,"northwest","nwse-resize")?!0:(o={x:i.x+i.width/2,y:i.y},s=this._rotatePoint(o,n,i),this._isResizing(t,s.x,s.y,"north","ns-resize")?!0:(o={x:i.x+i.width,y:i.y},s=this._rotatePoint(o,n,i),this._isResizing(t,s.x,s.y,"northeast","nesw-resize")?!0:(o={x:i.x,y:i.y+i.height/2},s=this._rotatePoint(o,n,i),this._isResizing(t,s.x,s.y,"west","ew-resize")?!0:(o={x:i.x+i.width,y:i.y+i.height/2},s=this._rotatePoint(o,n,i),this._isResizing(t,s.x,s.y,"east","ew-resize")?!0:(o={x:i.x,y:i.y+i.height},s=this._rotatePoint(o,n,i),this._isResizing(t,s.x,s.y,"southwest","nesw-resize")?!0:(o={x:i.x+i.width/2,y:i.y+i.height},s=this._rotatePoint(o,n,i),this._isResizing(t,s.x,s.y,"south","ns-resize")?!0:(o={x:i.x+i.width,y:i.y+i.height},s=this._rotatePoint(o,n,i),this._isResizing(t,s.x,s.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(t,e,i){var n=Ze.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2),o=n.transform(t);return o},_isResizing:function(t,e,i,n,o){var s=this.network.getResizePointSize();return this._contains(t,{x:e,y:i},s)?(this.resizeDirection!==n&&(this._removeCursor(),o=this._changeCursorWithAngle(n,this.node.getAngle()),this._setCursor(o),this.resizeDirection=n),!0):!1},_getRect:function(t,e,i,n){var o=i>t?t:i,s=n>e?e:n,a=Math.abs(t-i),r=Math.abs(e-n);return{x:o,y:s,width:a,height:r}},_contains:function(t,e,i){var n={x:e.x-i,y:e.y-i,width:2*i,height:2*i};return Ze.containsPoint(n,t)},getPointIndex:function(t,e,i){if(t.size()<2)return 0;for(var n,o=t.get(0),s=1;s<t.size();s++){if(n=t.get(s),this.isPointOnLine(e,o,n,6))return s;o=n}return o=t.get(0),i&&this.isPointOnLine(e,o,n,6)?t.size():0},showRotateScale:function(t){var e,i,n,o,s,a=(new Me.List,this.network.getRotateScaleWidth()),r=this.network.getRotateScaleHeight(),h=this.network.getRotatePointSize(),l=this.node.getAngle(),c=this.node.getOriginalRect(),d={x:c.x+c.width/2,y:c.y-this.network.getRotatePointOffset()-h},u=this._rotatePoint(d,l,c),_="13px Arial",g=l+"°";this.node.getAngle()>=0&&this.node.getAngle()<=180?(i={x:u.x+h,y:u.y},n={x:i.x+a,y:i.y},o={x:n.x,y:n.y-r},s={x:i.x,y:o.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(i={x:u.x-h,y:u.y},n={x:i.x-a,y:i.y},o={x:n.x,y:n.y-r},s={x:i.x,y:o.y});var f=new Me.List([i,n,o,s]),e=Oe.math.getRect(f);t.fillStyle=this.network.getRotateScaleFillColor(),t.fillRect(e.x,e.y,e.width,e.height),t.fillStyle=this.network.getRotateScaleFontColor(),t.textBaseline="middle",t.textAlign="center",t.font=_,t.fillText(g,e.x+e.width/2,e.y+e.height/2)},isPointOnLine:function(t,e,i,n){0>n&&(n=0);var o=this.getDistanceFromPointToLine(t,e,i);return n>=o&&t.x>=Math.min(e.x,i.x)-n&&t.x<=Math.max(e.x,i.x)+n&&t.y>=Math.min(e.y,i.y)-n&&t.y<=Math.max(e.y,i.y)+n},getDistanceFromPointToLine:function(t,e,i){if(e.x===i.x)return Math.abs(t.x-e.x);var n=(i.y-e.y)/(i.x-e.x),o=(i.x*e.y-e.x*i.y)/(i.x-e.x);return Math.abs(n*t.x-t.y+o)/Math.sqrt(n*n+1)},_transformPoint:function(t,e,i){var n=Math.cos(i*Math.PI/180),o=Math.sin(i*Math.PI/180),s=t.x,a=t.y,r=s*n-a*o,h=s*o+a*n;t.x=r+e.x,t.y=h+e.y},_reversPoint:function(t,e,i){i*=-1;var n=Math.cos(i*Math.PI/180),o=Math.sin(i*Math.PI/180),s=t.x-e.x,a=t.y-e.y,r=s*n-a*o,h=s*o+a*n;t.x=r+e.x,t.y=h+e.y},_changeCursorWithAngle:function(t,e){var i,n=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(t){case"northwest":i=1;break;case"north":i=2;break;case"northeast":i=3;break;case"east":i=4;break;case"southeast":i=5;break;case"south":i=6;break;case"southwest":i=7;break;case"west":i=8;break;default:i=0}return(e>=360||-360>=e)&&(e%=360),e>22.5&&67.5>=e&&(i+=1),-22.5>e&&e>=-67.5&&(i-=1),e>67.5&&112.5>=e&&(i+=2),-67.5>e&&e>=-112.5&&(i-=2),e>112.5&&157.5>=e&&(i+=3),-112.5>e&&e>=-157.5&&(i-=3),e>157.5&&202.5>=e&&(i+=4),-157.5>e&&e>=-202.5&&(i-=4),e>202.5&&247.5>=e&&(i+=5),-202.5>e&&e>=-247.5&&(i-=5),e>247.5&&292.5>=e&&(i+=6),-247.5>e&&e>=-292.5&&(i-=6),e>292.5&&337.5>=e&&(i+=7),-292.5>e&&e>=-337.5&&(i-=7),i>8&&(i-=8),0>=i&&(i+=8),n[i]}}),Me.canvas.interaction.CreateLinkInteraction=function(t,e){e||(e=Me.Link),this.linkFunction=Me.Util.isTypeOf(e,Me.Link)?function(t,i){var n=new e;return n instanceof Me.Link&&(n.setFromNode(t),n.setToNode(i)),n}:e,Me.canvas.interaction.CreateLinkInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.canvas.interaction.CreateLinkInteraction",Me.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this)},paint:function(t){t.beginPath();var e,i;t.lineWidth=this.network.getEditLineWidth();var n=this.network.getEditLineColor();this.currentNode&&this.currentNode!==this.fromNode&&(e=this.network.getElementUI(this.currentNode).getViewRect(),i=this.convertFromUIToMarkerRect(e,0,0),Hn.rect(t,i.x,i.y,i.width,i.height,null,n)),this.fromNode&&(e=this.network.getElementUI(this.fromNode).getViewRect(),i=this.convertFromUIToMarkerRect(e,0,0),Hn.rect(t,i.x,i.y,i.width,i.height,null,n)),this.currentPoint&&this.paintLine(t),t.closePath()},paintLine:function(t){var e=this.network.getEditLineColor(),i=this.convertPointFromView(this.fromNode.getCenterLocation()),n=i.x,o=i.y,s=this.currentPoint.x,a=this.currentPoint.y;t.strokeStyle=e,t.beginPath(),t.moveTo(n,o),t.lineTo(s,a),t.stroke()},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(t){if(this.network.isValidEvent(t))if(this.fromNode){if(this.toNode=this.currentNode,this.toNode){var e=this.createLink();e&&this.network.addElementByInteraction(e)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint()},handle_mousemove:function(t){var e=this.getMarkerPoint(t);if(e){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.clear();var i=null;this.fromNode?(this.currentNode=this.getToNode(t),this.currentPoint=e,this.repaint()):(i=this.getFromNode(t),this.currentNode!==i&&(this.currentNode=i,this.repaint()))}},getFromNode:function(t){return this.getNode(t)},getToNode:function(t){return this.getNode(t)},getNode:function(t){var e=this.network.getElementAt(t);return e instanceof Fn&&this.network.isLinkable(e)&&this.network.getElementBox().getSelectionModel().isSelectable(e)?e:null}}),Me.canvas.interaction.CreateShapeLinkInteraction=function(t,e){Me.canvas.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,t),e||(e=Me.ShapeLink),this.linkFunction=Me.Util.isTypeOf(e,Me.ShapeLink)?function(t,i,n){var o=new e;return o instanceof Me.ShapeLink&&(o.setFromNode(t),o.setToNode(i),n&&o.setPoints(n)),o}:e},Oe.ext("twaver.canvas.interaction.CreateShapeLinkInteraction",Me.canvas.interaction.CreateLinkInteraction,{clear:function(){this.points=null,Me.canvas.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(t){if(0===t.button){var e=this.network.getLogicalPoint(t);if(e){if(this.fromNode)if(this.toNode=this.currentNode,this.toNode){var i=this.createLink();i&&this.network.addElementByInteraction(i),this.clear()}else{if(this.points||(this.points=new Me.List),this.points.size()>0){var n=this.points.get(this.points.size()-1);if(n.x===e.x&&n.y===e.y)return}this.points.add(e)}else this.fromNode=this.currentNode,this.points=null,this.currentNode=null,this.currentPoint=null;this.repaint()}}},paintLine:function(t){if(this.currentPoint){var e,i=new Me.List;if(e=this.convertPointFromView(this.fromNode.getCenterLocation()),i.add(e,0),this.points&&this.points.size()>0)for(var n=this.points.size(),o=0;n>o;o++)e=this.convertPointFromView(this.points.get(o)),i.add(e);e=this.currentPoint,i.add(e),t.lineWidth=this.network.getEditLineWidth(),t.strokeStyle=this.network.getEditLineColor(),t.beginPath(),Ke.drawLinePoints(t,i),t.stroke()}}}),Me.canvas.interaction.CreateShapeNodeInteraction=function(t,e){e||(e=Me.ShapeNode),this.shapeNodeFunction=Me.Util.isTypeOf(e,Me.ShapeNode)?function(t){var i=new e;return i instanceof Me.ShapeNode&&t&&i.setPoints(t),i}:e,Me.canvas.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,t),this.timeStamp=-1},Oe.ext("twaver.canvas.interaction.CreateShapeNodeInteraction",Me.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this),this.network.setEditingElement(!1)},clear:function(){this.points=null,this.currentPoint=null},paint:function(t){if(this.points&&this.points.size()>0&&this.currentPoint){for(var e,i=new Me.List,n=this.points.size(),o=0;n>o;o++)e=this.convertPointFromView(this.points.get(o)),i.add(e);e=this.convertPointFromView(this.currentPoint),i.add(e),t.lineWidth=this.network.getEditLineWidth(),t.strokeStyle=this.network.getEditLineColor(),t.beginPath(),Ke.drawLinePoints(t,i),t.stroke()}},handle_mousedown:function(t){if(0===t.button){var e=this.network.getLogicalPoint(t);if(e){if(2===t.detail||t.timeStamp-this.timeStamp<300){if(this.points){var i=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(i),this.clear();var n=this;setTimeout(function(){n.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new Me.List),this.points.size()>0){var o=this.points.get(this.points.size()-1);if(o.x===e.x&&o.y===e.y)return}this.points.add(e)}this.timeStamp=t.timeStamp,this.repaint()}}},handle_mousemove:function(t){this.points&&(this.currentPoint=this.network.getLogicalPoint(t),this.repaint())}}),Me.canvas.interaction.MagnifyInteraction=function(t,e,i,n,o){Me.canvas.interaction.MagnifyInteraction.superClass.constructor.call(this,t),this.zoom=e||2,this.xRadius=i||100,this.yRadius=n||100,this.shape=o||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=je.createCanvas()},Oe.ext("twaver.canvas.interaction.MagnifyInteraction",Me.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousemove"),this.network.removeMarker(this)},paint:function(t){if(this.point){var e=this.network._zoom,i=this.zoom*e,n=this.point.x*e-this.network.viewRect.x-this.xRadius,o=this.point.y*e-this.network.viewRect.y-this.yRadius,s=2*this.xRadius,a=2*this.yRadius,r={x:this.point.x-this.xRadius/i,y:this.point.y-this.yRadius/i,width:s/i,height:a/i},h=this.borderWidth,l=je.createCanvas();l.width=s,l.height=a,this.network.toCanvasByRegion(r,i,l),t.save(),t.beginPath(),Ke.drawVector(t,this.shape,null,n,o,s,a),t.clip(),t.fillStyle=this.backgroundColor,t.beginPath(),t.rect(n,o,s,a),t.fill(),t.drawImage(l,n,o),t.restore(),t.beginPath(),t.lineWidth=h,Ke.drawVector(t,this.shape,null,n+h/2,o+h/2,s-h,a-h),t.strokeStyle=this.borderColor,t.stroke()}},handle_mousemove:function(t){this.point=this.network.getLogicalPoint(t),this.point&&this.repaint()},getZoom:function(){return this.zoom},setZoom:function(t){this.zoom=t,this.network.repaintTopCanvas()},getShape:function(){return this.shape},setShape:function(t){this.shape=t,this.network.repaintTopCanvas()},getXRadius:function(){return this.xRadius},setXRadius:function(t){this.xRadius=t,this.network.repaintTopCanvas()},getYRadius:function(){return this.yRadius},setYRadius:function(t){this.yRadius=t,this.network.repaintTopCanvas()},getBorderColor:function(){return this.borderColor},setBorderColor:function(t){this.borderColor=t,this.network.repaintTopCanvas()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(t){this.borderWidth=t,this.network.repaintTopCanvas()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(t){this.backgroundColor=t,this.network.repaintTopCanvas()}}),Me.canvas.interaction.TouchInteraction=function(t){Me.canvas.interaction.TouchInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.canvas.interaction.TouchInteraction",Me.canvas.interaction.BaseInteraction,{setUp:function(){var t=this.network.getView();je.addEventListener("touchstart","handleTouchstart",t,this),je.addEventListener("touchmove","handleTouchmove",t,this),je.addEventListener("touchend","handleTouchend",t,this),je.addEventListener("touchcancel","handleTouchend",t,this),this.network.addMarker(this)},tearDown:function(){var t=this.network.getView();je.removeEventListener("touchstart",this.network.getView(),this),je.removeEventListener("touchmove",t,this),je.removeEventListener("touchend",t,this),je.removeEventListener("touchcancel",t,this),this.network.removeMarker(this)},handleTouchstart:function(t){if(je.preventDefault(t),t.touches&&1==t.touches.length){var e=this.network.getLogicalPoint(t),i=this.network.getElementAt(e);this._startTouchTime=new Date,this._startTouchPoint=e,this._startTouchClient=this.getMarkerPoint(t),i?(this._haveElementUnderTouch=!0,this._startTouchElement=i):(this._haveElementUnderTouch=!1,this._startTouchElement=null),this.timer=setTimeout(function(){Ii.handleLongClicked(self.network,t,i)},1e3)}else t.touches&&2==t.touches.length&&(this._distance=bi.getDistance(t),this._zoom=this.network.getZoom());this._touchCount=t.touches.length},handleTouchmove:function(t){if(je.preventDefault(t),2==this._touchCount&&t.touches&&2==t.touches.length)if(this.timer&&clearTimeout(this.timer),Math.abs(this._distance-bi.getDistance(t))>=Rn.TOUCH_ZOOM_THRESHOLD||this._zoomFlag){this._zoomFlag=!0;var e=bi.getDistance(t)/this._distance;this.network.setTouchZoom(this._zoom*e,!1)}else{var i=this.getMarkerPoint(t),n=this._startTouchClient.x-i.x,o=this._startTouchClient.y-i.y;this.network.panByOffset(n,o),this._startTouchClient=i}else if(1==this._touchCount&&t.touches&&1==t.touches.length)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var s=this.network.getLogicalPoint(t),a=this.network.getElementAt(s);if(this.network.isMovingElement()||null!=this._startTouchElement&&this._startTouchElement==a&&this.network.getMovableSelectedElements().contains(a)){var n=s.x-this._startTouchPoint.x,o=s.y-this._startTouchPoint.y;(Math.abs(n)>=Rn.TOUCH_MOVE_THRESHOLD||Math.abs(o)>=Rn.TOUCH_MOVE_THRESHOLD)&&(this._startTouchPoint=s,this.network.moveSelectedElements(n,o),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t}),this.timer&&clearTimeout(this.timer)))}else{var n=s.x-this._startTouchPoint.x,o=s.y-this._startTouchPoint.y;(Math.abs(n)>=Rn.TOUCH_MOVE_THRESHOLD||Math.abs(o)>=Rn.TOUCH_MOVE_THRESHOLD)&&this.timer&&clearTimeout(this.timer);var i=this.getMarkerPoint(t),n=this._startTouchClient.x-i.x,o=this._startTouchClient.y-i.y;this.network.panByOffset(n,o),this._startTouchClient=i}}else{var r=this.network.getLogicalPoint(t);if(!r)return;var n=r.x-this._startTouchPoint.x,o=r.y-this._startTouchPoint.y;Math.abs(n)>=Rn.TOUCH_RECT_SELECT_THRESHOLD&&Math.abs(o)>=Rn.TOUCH_RECT_SELECT_THRESHOLD&&(this.network.setSelectingElement(!0),this._moveTouchPoint?this.network.fireInteractionEvent({kind:"selectBetween",event:t}):(this.network.fireInteractionEvent({kind:"selectStart",event:t}),this.timer&&clearTimeout(this.timer)),this._moveTouchPoint=r,this.repaint())}},handleTouchend:function(t){if(je.preventDefault(t),this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t});else if(this.network.isSelectingElement()){var e=Ze.getRect([this._startTouchPoint,this._moveTouchPoint]),i=this.network.getElementsAtRect(e,this.getIntersectMode(),this.network.getRectSelectFilter());if(i&&i.size()>0){var n=this.network.getSelectionModel(),o=n.toSelection();i.forEach(function(t){n.contains(t)?o.remove(t):o.add(t)},this),n.setSelection(o)}this.network.fireInteractionEvent({kind:"selectEnd",event:t}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}else if(this._startTouchPoint){this._zoomFlag=!1;var s=new Date,a=this.network.getLogicalPoint(t),r=this.network.getElementAt(this._startTouchPoint);a&&s.getTime()-this._startTouchTime.getTime()<=500&&Ze.getDistance(this._startTouchPoint,a)<=20&&(r?this.network.getSelectionModel().contains(r)||this.network.getSelectionModel().setSelection(r):this.network.getSelectionModel().clearSelection(),Ii.handleClicked(this.network,t,r),this.timer&&clearTimeout(this.timer),this._endTouchTime&&s.getTime()-this._endTouchTime.getTime()<=500&&Ze.getDistance(this._endTouchPoint,a)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Ii.handleDoubleClicked(this.network,t,r)):(this._endTouchTime=s,this._endTouchPoint=a))}},paint:function(t){if(this._startTouchPoint&&this._moveTouchPoint){var e=this.convertPointFromView(this._startTouchPoint),i=this.convertPointFromView(this._moveTouchPoint),n=e.x,o=e.y,s=i.x,a=i.y,r=Ze.getRect([{x:n,y:o},{x:s,y:a}]);if(null!=r){t.beginPath();var h=this.network.getSelectOutlineWidth(),l=this.getIntersectMode()?this.network.getSelectFillColor():null;t.strokeStyle=this.network.getSelectOutlineColor(),t.lineWidth=h,Hn.rect(t,r.x,r.y,r.width,r.height,l,this.network.getSelectOutlineColor()),t.closePath()}}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y}}),Me.canvas.interaction.MSTouchInteraction=function(t){Me.canvas.interaction.MSTouchInteraction.superClass.constructor.call(this,t),this._pointerMap={},this._pointerIdArray=[]},Oe.ext("twaver.canvas.interaction.MSTouchInteraction",Me.canvas.interaction.BaseInteraction,{setUp:function(){var t=this.network.getView();je.addEventListener("MSPointerDown","handleTouchstart",t,this),je.addEventListener("MSPointerMove","handleTouchmove",t,this),je.addEventListener("MSPointerUp","handleTouchend",t,this),je.addEventListener("MSPointerCancel","handleTouchend",t,this),this.network.addMarker(this)},tearDown:function(){var t=this.network.getView();je.removeEventListener("MSPointerDown",t,this),je.removeEventListener("MSPointerMove",t,this),je.removeEventListener("MSPointerUp",t,this),je.removeEventListener("MSPointerCancel",t,this),this.network.removeMarker(this)},handleTouchstart:function(t){if(this.network.isFocusOnClick()&&Me.Util.setFocus(this.network._view),!this.network.isSelectingElement()||t.pointerType!=t.MSPOINTER_TYPE_MOUSE){var e=this.network.getLogicalPoint(t),i=new Date;if(t.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(t),this._pointerMap[t.pointerId]||(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length){var n=this.network.getElementAt(e);this._startTouchElement=n,this._startClientPoint={x:t.clientX,y:t.clientY},Ii.handleClicked(this.network,t,n),this._startTouchTime&&this._startTouchPoint&&i.getTime()-this._startTouchTime.getTime()<=500&&Ze.getDistance(this._startTouchPoint,e)<=20?(Ii.handleDoubleClicked(this.network,t,n),this._doubleClick=!0):(je.handle_mousedown(this,t),this._startTouchPoint=e,this._startTouchTime=i);var o=this.network.getSelectionModel();n?Oe.isCtrlDown(t)?o.contains(n)?o.removeSelection(n):o.appendSelection(n):o.contains(n)||o.setSelection(n):Oe.isCtrlDown(t)||o.clearSelection()}else 2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())}},handleTouchmove:function(t){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ze.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10)&&(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length)){var e=this._getDistance()/this._distance;this.network.setZoom(this._zoom*e,!1)}},handleTouchend:function(t){if(this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t})),this.network.isSelectingElement()){var e=Ze.getRect([this._startTouchPoint,this._moveTouchPoint]),i=this.network.getElementsAtRect(e,this.getIntersectMode(),this.network.getRectSelectFilter());if(i&&i.size()>0){var n=this.network.getSelectionModel(),o=n.toSelection();i.forEach(function(t){n.contains(t)?o.remove(t):o.add(t)},this),n.setSelection(o)}this.network.fireInteractionEvent({kind:"selectEnd",event:t}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);for(var s=-1,a=0;a<this._pointerIdArray.length;a++)if(this._pointerIdArray[a]==t.pointerId){s=a;break}s>=0&&this._pointerIdArray.splice(s,1),delete this._pointerMap[t.pointerId],this._startTouchPoint=null,this._moveTouchPoint=null},_getDistance:function(){return Ze.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(t){var e={x:t.clientX,y:t.clientY};if(!(Ze.getDistance(this._startClientPoint,e)<3)&&this._startTouchPoint&&1==this._pointerIdArray.length)if(this._moveTouchPoint={x:this._startTouchPoint.x+(e.x-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(e.y-this._startClientPoint.y)/this.network.getZoom()},null==this._startTouchElement&&this.network.isRectSelectEnabled()){var i=this.network.getLogicalPoint(t);if(!i)return;this.network.setSelectingElement(!0),this.network.fireInteractionEvent(this._moveTouchPoint?{kind:"selectBetween",event:t}:{kind:"selectStart",event:t}),this.repaint()}else{var n=this.network.getElementAt(this._moveTouchPoint);if(null!=this._startTouchElement||this.network.isRectSelectEnabled()){if(this.network.isMovingElement()||null!=this._startTouchElement&&n==this._startTouchElement&&this.network.getMovableSelectedElements().contains(n)){var o=this._moveTouchPoint.x-this._startTouchPoint.x,s=this._moveTouchPoint.y-this._startTouchPoint.y;this.network.moveSelectedElements(o,s),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t}))}}else{var o=this._startClientPoint.x-e.x,s=this._startClientPoint.y-e.y;this.network.panByOffset(o,s)}this._startClientPoint=e}},handle_mouseup:function(t){this.handleTouchend(t),this._pointerIdArray=[],this._pointerMap={}},paint:function(t){if(this._startTouchPoint&&this._moveTouchPoint&&!this._startTouchElement&&this.network.isRectSelectEnabled()){var e=this.convertPointFromView(this._startTouchPoint),i=this.convertPointFromView(this._moveTouchPoint),n=e.x,o=e.y,s=i.x,a=i.y,r=Ze.getRect([{x:n,y:o},{x:s,y:a}]);if(null!=r){t.beginPath();var h=this.network.getSelectOutlineWidth(),l=this.getIntersectMode()?this.network.getSelectFillColor():null;t.strokeStyle=this.network.getSelectOutlineColor(),t.lineWidth=h,Hn.rect(t,r.x,r.y,r.width,r.height,l,this.network.getSelectOutlineColor()),t.closePath()}}}});var Wn=function(t,e){Oe.registerImage(t,e),Yn[t]=1},Yn={};Wn("node_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,23.5c0,0.276-0.224,0.5-0.5,0.5h-31C0.224,24,0,23.776,0,23.5v-2C0,21.224,0.224,21,0.5,21h31  c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_1_",type:"linear",x1:"15.9995",y1:"21",x2:"15.9995",y2:"24",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M15,22.3c0-0.165-0.134-0.3-0.3-0.3H3.3C3.134,22,3,22.135,3,22.3V24h12V22.3z",gradient:{id:"SVGID_2_",type:"linear",x1:"9",y1:"22",x2:"9",y2:"25",stop:[{offset:"0",color:"#69B4A5"},{offset:"0.1",color:"#61AD9C"}]}},{shape:"path",data:"M31,20H1V1c0-0.553,0.448-1,1-1h28c0.553,0,1,0.447,1,1V20z",gradient:{id:"SVGID_3_",type:"linear",x1:"15.9995",y1:"-0.1221",x2:"15.9995",y2:"19.9471",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:1,w:28,h:18,fill:"#FFFFFF"},{shape:"rect",x:3,y:2,w:26,h:16,gradient:{id:"SVGID_4_",type:"linear",x1:"15.9995",y1:"2.0654",x2:"15.9995",y2:"17.3835",stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}},{shape:"path",data:"9.649,17.034 6.815,17.034 9.935,2.966 12.768,2.966 z",fill:"#FFFFFF"},{shape:"path",data:"12.065,17.034 10.815,17.034 13.935,2.966 15.185,2.966 z",fill:"#FFFFFF"},{shape:"path",data:"14.065,17.034 13.315,17.034 16.435,2.966 17.185,2.966 z",fill:"#FFFFFF"}]}),Wn("group_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,16.5c0,0.276-0.224,0.5-0.5,0.5h-24C7.224,17,7,16.776,7,16.5v-1C7,15.224,7.224,15,7.5,15h24   c0.276,0,0.5,0.224,0.5,0.5V16.5z",gradient:{id:"SVGID_1_",type:"linear",x1:"19.5",y1:"15",x2:"19.5",y2:"17",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M19,16.5c0-0.277-0.224-0.5-0.5-0.5h-8c-0.276,0-0.5,0.223-0.5,0.5V17h9V16.5z",gradient:{id:"SVGID_2_",type:"linear",x1:"14.4995",y1:"15.9209",x2:"14.4995",y2:"17.0459",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M31,14H8V1c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V14z",gradient:{id:"SVGID_3_",type:"linear",x1:"19.5",y1:"0",x2:"19.5",y2:"14.0005",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:9,y:1,w:21,h:12,fill:"#FFFFFF"},{shape:"rect",x:10,y:2,w:19,h:10,gradient:{id:"SVGID_4_",type:"linear",x1:"19.5",y1:"1.9619",x2:"19.5",y2:"11.9744",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M25,23.5c0,0.276-0.224,0.5-0.5,0.5h-24C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h24   c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_5_",type:"linear",x1:"12.4995",y1:"22",x2:"12.4995",y2:"24",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M12,23.5c0-0.277-0.224-0.5-0.5-0.5h-8C3.224,23,3,23.223,3,23.5V24h9V23.5z",gradient:{id:"SVGID_6_",type:"linear",x1:"7.5",y1:"22.9209",x2:"7.5",y2:"24.0459",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M24,21H1V8c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V21z",gradient:{id:"SVGID_7_",type:"linear",x1:"12.4995",y1:"7",x2:"12.4995",y2:"21.0005",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:8,w:21,h:12,fill:"#FFFFFF"},{shape:"rect",x:3,y:9,w:19,h:10,gradient:{id:"SVGID_8_",type:"linear",x1:"12.4995",y1:"8.9619",x2:"12.4995",y2:"18.9749",stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}}]}),Wn("subnetwork_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,14.499c0,0.276-0.224,0.5-0.5,0.5h-20c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h20c0.276,0,0.5,0.224,0.5,0.5V14.499z",gradient:{id:"SVGID_1_",type:"linear",x1:21.5,y1:12.999,x2:21.5,y2:14.9995,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M22,14.499c0-0.277-0.224-0.5-0.5-0.5h-7c-0.276,0-0.5,0.223-0.5,0.5v0.5h8V14.499z",gradient:{id:"SVGID_2_",type:"linear",x1:18,y1:13.9199,x2:18,y2:15.0449,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M31,11.499c0,0.276-0.224,0.5-0.5,0.5h-18c-0.276,0-0.5-0.224-0.5-0.5v-11c0-0.276,0.224-0.5,0.5-0.5  h18c0.276,0,0.5,0.224,0.5,0.5V11.499z",gradient:{id:"SVGID_3_",type:"linear",x1:21.5,y1:-.9502,x2:21.5,y2:12.5498,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:13,y:.999,w:17,h:10,fill:"#FFFFFF"},{shape:"rect",x:14,y:1.999,w:15,h:8,gradient:{id:"SVGID_4_",type:"linear",x1:21.5,y1:1.9312,x2:21.5,y2:9.6537,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M21,23.5c0,0.276-0.224,0.5-0.5,0.5h-20C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h20  c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_5_",type:"linear",x1:10.4995,y1:22,x2:10.4995,y2:24,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:22,y:20.5,w:3,h:1.999,gradient:{id:"SVGID_6_",type:"linear",x1:-464.9424,y1:-722.2754,x2:-462.9424,y2:-722.2754,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"rect",x:28,y:16,w:2,h:3,gradient:{id:"SVGID_7_",type:"linear",x1:29,y1:16,x2:29,y2:19,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M11,23.5c0-0.277-0.224-0.5-0.5-0.5h-7C3.224,23,3,23.223,3,23.5V24h8V23.5z",gradient:{id:"SVGID_8_",type:"linear",x1:7,y1:22.9209,x2:7,y2:24.0459,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M20,20.5c0,0.276-0.224,0.5-0.5,0.5h-18C1.224,21,1,20.776,1,20.5v-11C1,9.224,1.224,9,1.5,9h18  C19.776,9,20,9.224,20,9.5V20.5z",gradient:{id:"SVGID_9_",type:"linear",x1:10.4995,y1:8.0508,x2:10.4995,y2:21.5513,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:10,w:17,h:10,fill:"#FFFFFF"},{shape:"rect",x:3,y:11,w:15,h:8,gradient:{id:"SVGID_10_",type:"linear",x1:10.4995,y1:10.9321,x2:10.4995,y2:18.6551,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}},{shape:"path",data:"M32,22.7c0,0.165-0.135,0.3-0.301,0.3h-5.4C26.134,23,26,22.865,26,22.7v-2.4  c0-0.165,0.134-0.3,0.299-0.3h5.4C31.865,20,32,20.135,32,20.3V22.7z",gradient:{id:"SVGID_11_",type:"linear",x1:29,y1:20,x2:29,y2:23,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]}),Wn("bus_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"rect",x:4,y:6,w:1,h:1,fill:"#232424"},{shape:"path",data:"M7,4c0,0.552-0.448,1-1,1H3C2.448,5,2,4.552,2,4V3c0-0.552,0.448-1,1-1h3c0.552,0,1,0.448,1,1V4z",gradient:{id:"SVGID_1_",type:"linear",x1:4.5,y1:2,x2:4.5,y2:5,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:3,w:3,h:1,fill:"#232424"},{shape:"rect",x:3,y:3,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M6,5.5C6,5.776,5.776,6,5.5,6h-2C3.224,6,3,5.776,3,5.5l0,0C3,5.224,3.224,5,3.5,5h2  C5.776,5,6,5.224,6,5.5L6,5.5z",gradient:{id:"SVGID_2_",type:"linear",x1:4.5,y1:6,x2:4.5,y2:5,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:12,y:6,w:1,h:1,fill:"#232424"},{shape:"path",data:"M15,4c0,0.552-0.447,1-1,1h-3c-0.553,0-1-0.448-1-1V3c0-0.552,0.447-1,1-1h3c0.553,0,1,0.448,1,1V4z",gradient:{id:"SVGID_3_",type:"linear",x1:12.5,y1:2,x2:12.5,y2:5,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:11,y:3,w:3,h:1,fill:"#232424"},{shape:"rect",x:11,y:3,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M14,5.5C14,5.776,13.777,6,13.5,6h-2C11.225,6,11,5.776,11,5.5l0,0C11,5.224,11.225,5,11.5,5h2  C13.777,5,14,5.224,14,5.5L14,5.5z",gradient:{id:"SVGID_4_",type:"linear",x1:12.5,y1:6,x2:12.5,y2:5,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:8,y:10,w:1,h:1,fill:"#232424"},{shape:"path",data:"M6,13c0-0.553,0.448-1,1-1h3c0.553,0,1,0.447,1,1v1c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V13z",gradient:{id:"SVGID_5_",type:"linear",x1:-1428.3853,y1:-571.5747,x2:-1428.3853,y2:-568.5747,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:7,y:13,w:3,h:1,fill:"#232424"},{shape:"rect",x:7,y:13,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M7,11.5C7,11.223,7.224,11,7.5,11h2c0.277,0,0.5,0.223,0.5,0.5l0,0c0,0.275-0.223,0.5-0.5,0.5h-2  C7.224,12,7,11.775,7,11.5L7,11.5z",gradient:{id:"SVGID_6_",type:"linear",x1:-1428.3862,y1:-567.5737,x2:-1428.3862,y2:-568.5737,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M15,7.5C15,7.776,14.777,8,14.5,8h-12C2.224,8,2,7.776,2,7.5l0,0C2,7.224,2.224,7,2.5,7h12  C14.777,7,15,7.224,15,7.5L15,7.5z",gradient:{id:"SVGID_7_",type:"linear",x1:8.4995,y1:6.1152,x2:8.4995,y2:7.5558,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M15,9.5c0,0.275-0.223,0.5-0.5,0.5h-12C2.224,10,2,9.775,2,9.5l0,0C2,9.223,2.224,9,2.5,9h12  C14.777,9,15,9.223,15,9.5L15,9.5z",gradient:{id:"SVGID_8_",type:"linear",x1:8.4995,y1:8.1147,x2:8.4995,y2:9.556,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]}),Wn("data_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,12c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12   z",gradient:{id:"SVGID_1_",type:"linear",x1:10.5,y1:6.959,x2:10.5,y2:12.2259,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:7,y:8,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:8,y:9,w:5,h:2,gradient:{id:"SVGID_2_",type:"linear",x1:10.5,y1:8.6997,x2:10.5,y2:11.0333,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M15,14.5c0,0.275-0.225,0.5-0.5,0.5h-8C6.224,15,6,14.775,6,14.5l0,0C6,14.223,6.224,14,6.5,14h8   C14.775,14,15,14.223,15,14.5L15,14.5z",gradient:{id:"SVGID_3_",type:"linear",x1:10.5,y1:13.125,x2:10.5,y2:14.5518,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:8,y:14,w:1,h:1,gradient:{id:"SVGID_4_",type:"linear",x1:8.4995,y1:14.0049,x2:8.4995,y2:14.9471,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M12,4H6c0,0-0.152-0.275-0.5-1C5.021,2,5.021,2,4,2C3.057,2,2,2,2,2C1.448,2,1,2.448,1,3v8  c0,0.553,0.448,1,1,1h3v-1H2V3h2.387l1.024,1.998L12,5v1h1V5C13,4.448,12.553,4,12,4z",gradient:{id:"SVGID_5_",type:"linear",x1:6.9995,y1:2.0527,x2:6.9995,y2:11.4757,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M12,5L5.411,4.998L4.387,3H2v8h3v-0.645V7.254V7c0-0.552,0.448-1,1-1h0.324h3.032H12V5z",gradient:{id:"SVGID_6_",type:"linear",x1:6.9995,y1:2.9902,x2:6.9995,y2:11.0032,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),Wn("grid_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,14c0,0.553-0.447,1-1,1H3c-0.552,0-1-0.447-1-1V3c0-0.552,0.448-1,1-1h11c0.553,0,1,0.448,1,1V14  z",gradient:{id:"SVGID_1_",type:"linear",x1:8.4995,y1:2.1255,x2:8.4995,y2:14.909,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:3,w:11,h:11,fill:"#FFFFFF"},{shape:"rect",x:3,y:5,w:11,h:1,gradient:{id:"SVGID_2_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8043,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:3,y:8,w:11,h:1,gradient:{id:"SVGID_3_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8043,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:3,y:11,w:11,h:1,gradient:{id:"SVGID_4_",type:"linear",x1:8.4995,y1:3.2095,x2:8.4995,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:11,y:3,w:1,h:11,gradient:{id:"SVGID_5_",type:"linear",x1:11.5,y1:3.209,x2:11.5,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:8,y:3,w:1,h:11,gradient:{id:"SVGID_6_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:5,y:3,w:1,h:11,gradient:{id:"SVGID_7_",type:"linear",x1:5.5,y1:3.209,x2:5.5,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),Wn("databox_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M14.5,6h-12H2v0.5v7C2,13.776,2.224,14,2.5,14h12c0.276,0,0.5-0.224,0.5-0.5v-7V6H14.5z",gradient:{id:"SVGID_1_",type:"linear",x1:8.4995,y1:6.0625,x2:8.4995,y2:14.063,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M14.776,5.553l-1.553-3.105C13.101,2.201,12.775,2,12.5,2h-8C4.225,2,3.899,2.201,3.776,2.447  L2.224,5.553L2,6h0.5h12H15L14.776,5.553z",gradient:{id:"SVGID_2_",type:"linear",x1:8.5005,y1:3.104,x2:8.5005,y2:-5.6467,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"12,2 9.5,2 7.5,2 5,2 3,6 7.5,6 9.5,6 14,6 z",gradient:{id:"SVGID_3_",type:"linear",x1:8.5005,y1:9.2295,x2:8.5005,y2:5.4586,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M11.5,9c0,0.276-0.224,0.5-0.5,0.5H6C5.724,9.5,5.5,9.276,5.5,9l0,0c0-0.276,0.224-0.5,0.5-0.5h5  C11.276,8.5,11.5,8.724,11.5,9L11.5,9z",fill:"#FFFFFF"}]}),Wn("group_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,8.5C15,8.776,14.776,9,14.5,9h-10C4.224,9,4,8.776,4,8.5v-7C4,1.224,4.224,1,4.5,1h10    C14.776,1,15,1.224,15,1.5V8.5z",gradient:{id:"SVGID_1_",type:"linear",x1:9.5,y1:.9512,x2:9.5,y2:8.9787,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:5,y:2,w:9,h:6,fill:"#FFFFFF"},{shape:"rect",x:6,y:3,w:7,h:4,gradient:{id:"SVGID_2_",type:"linear",x1:9.5,y1:3.02,x2:9.5,y2:6.9606,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,10.5c0,0.276-0.224,0.5-0.5,0.5h-12C3.224,11,3,10.776,3,10.5l0,0C3,10.224,3.224,10,3.5,10h12    C15.776,10,16,10.224,16,10.5L16,10.5z",gradient:{id:"SVGID_3_",type:"linear",x1:9.5,y1:9.9941,x2:9.5,y2:10.9976,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:6,y:10.001,w:2,h:.999,gradient:{id:"SVGID_4_",type:"linear",x1:7,y1:10.0059,x2:7,y2:10.9472,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M12,12.5c0,0.276-0.224,0.5-0.5,0.5h-10C1.224,13,1,12.776,1,12.5v-7C1,5.224,1.224,5,1.5,5h10    C11.776,5,12,5.224,12,5.5V12.5z",gradient:{id:"SVGID_5_",type:"linear",x1:6.4995,y1:4.9512,x2:6.4995,y2:12.9792,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:6,w:9,h:6,fill:"#FFFFFF"},{shape:"rect",x:3,y:7,w:7,h:4,gradient:{id:"SVGID_6_",type:"linear",x1:6.4995,y1:7.02,x2:6.4995,y2:10.9611,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M13,14.5c0,0.276-0.224,0.5-0.5,0.5h-12C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h12    C12.776,14,13,14.224,13,14.5L13,14.5z",gradient:{id:"SVGID_7_",type:"linear",x1:6.4995,y1:13.9941,x2:6.4995,y2:14.9976,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:14.001,w:2,h:.999,gradient:{id:"SVGID_8_",type:"linear",x1:4,y1:14.0059,x2:4,y2:14.9472,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),Wn("link_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"line",p1:{x:2.5,y:2.5},p2:{x:13.5,y:13.5},lineColor:"url(#SVGID_1_)",lineWidth:1},{shape:"ellipse",cx:13,cy:13,rx:2,ry:2,gradient:{id:"SVGID_2_",type:"linear",x1:11.5371,y1:11.5371,x2:14.2155,y2:14.2155,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:13,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:3,cy:3,rx:2,ry:2,gradient:{id:"SVGID_3_",type:"linear",x1:1.4956,y1:1.4956,x2:4.1473,y2:4.1473,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:3,cy:3,rx:1,ry:1,fill:"#FFFFFF"}]}),Wn("linksubnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,7.661c0-1.202-0.642-2.247-1.596-2.835C12.848,3.188,11.314,2,9.486,2  c-1.587,0-2.95,0.902-3.649,2.211C4.573,4.22,3.548,5.194,3.438,6.432C3.389,6.429,3.342,6.417,3.292,6.417  C2.026,6.417,1,7.443,1,8.708C1,9.975,2.026,11,3.292,11h8.371l0,0C13.506,11,15,9.506,15,7.661z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.959,x2:7.9995,y2:11.0921,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M3.292,10C2.58,10,2,9.42,2,8.708c0-0.712,0.58-1.292,1.292-1.292C3.286,7.422,3.332,7.427,3.379,7.43  l0.969,0.058L4.435,6.52C4.5,5.779,5.106,5.216,5.844,5.211l0.595-0.004l0.28-0.524C7.273,3.645,8.334,3,9.486,3  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,6.11,14,6.851,14,7.661C14,8.951,12.951,10,11.661,10H3.292z",fill:"#FFFFFF"},{shape:"path",data:"M3.292,10h8.37c1.11,0,2.04-0.781,2.276-1.821c-0.131-0.615-0.5-1.158-1.058-1.501l-0.307-0.189  l-0.116-0.341C12.021,4.863,10.828,4,9.486,4C8.334,4,7.273,4.645,6.719,5.682l-0.28,0.524L5.844,6.211  C5.106,6.216,4.5,6.779,4.435,7.52L4.349,8.487L3.379,8.43C3.332,8.427,3.286,8.422,3.292,8.417c-0.535,0-0.994,0.328-1.19,0.792  C2.297,9.672,2.757,10,3.292,10z",gradient:{id:"SVGID_2_",type:"linear",x1:8.019,y1:4.084,x2:8.019,y2:9.8062,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"line",p1:{x:8.01,y:8.01},p2:{x:13.186,y:13.186},lineColor:"url(#SVGID_3_)",lineWidth:1},{shape:"ellipse",cx:8,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:6.7881,y1:6.7881,x2:9.9924,y2:9.9924,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:8,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:13,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:11.5791,y1:11.5791,x2:14.3132,y2:14.3132,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:13,cy:13,rx:1,ry:1,fill:"#FFFFFF"}]}),Wn("node_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,11.5c0,0.276-0.224,0.5-0.5,0.5h-13C1.224,12,1,11.776,1,11.5v-9C1,2.224,1.224,2,1.5,2h13  C14.776,2,15,2.224,15,2.5V11.5z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.939,x2:7.9995,y2:11.9739,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:3,w:12,h:8,fill:"#FFFFFF"},{shape:"rect",x:3,y:4,w:10,h:6,gradient:{id:"SVGID_2_",type:"linear",x1:7.9995,y1:4.0513,x2:7.9995,y2:9.865,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M16,14.5c0,0.276-0.224,0.5-0.5,0.5h-15C0.224,15,0,14.776,0,14.5v-1C0,13.224,0.224,13,0.5,13h15  c0.276,0,0.5,0.224,0.5,0.5V14.5z",gradient:{id:"SVGID_3_",type:"linear",x1:7.9995,y1:13.0508,x2:7.9995,y2:14.9258,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M9,14.5C9,14.224,8.776,14,8.5,14h-5C3.224,14,3,14.224,3,14.5V15h6V14.5z",gradient:{id:"SVGID_4_",type:"linear",x1:5.9995,y1:14.0508,x2:5.9995,y2:15.9258,stop:[{offset:"0",color:"#69B4A5"},{offset:"0.1",color:"#61AD9C"},{offset:"0.4637",color:"#449981"},{offset:"0.7764",color:"#2C8E73"},{offset:"1",color:"#218A6E"}]}}]}),Wn("shapelink_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"line",p1:{x:7.5,y:2.5},p2:{x:2.5,y:7.5},lineColor:"url(#SVGID_1_)",lineWidth:1},{shape:"line",p1:{x:2.5,y:7.5},p2:{x:8.5,y:13.5},lineColor:"url(#SVGID_2_)",lineWidth:1},{shape:"line",p1:{x:9,y:13.186},p2:{x:13.5,y:6.5},lineColor:"url(#SVGID_3_)",lineWidth:1},{shape:"ellipse",cx:7,cy:3,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:5.5864,y1:1.5864,x2:8.4149,y2:4.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:7,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:2,cy:8,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:.5864,y1:6.5864,x2:3.4142,y2:9.4142,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:2,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:8,cy:13,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:6.5869,y1:11.5869,x2:9.4147,y2:14.4147,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:8,cy:13,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:7,rx:2,ry:2,gradient:{id:"SVGID_7_",type:"linear",x1:11.5859,y1:5.5859,x2:14.4144,y2:8.4144,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:7,rx:1,ry:1,fill:"#FFFFFF"}]}),Wn("shapenode_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M14.5,3h-9l-4,4v7h13L9,8.5L14.5,3z M12.086,13H2.5V7.414L5.914,4h6.172l-4.5,4.5L12.086,13z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:3.209,x2:7.9995,y2:13.6621,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:6,cy:3,rx:2,ry:2,gradient:{id:"SVGID_2_",type:"linear",x1:4.5859,y1:1.5859,x2:7.4151,y2:4.4151,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:6,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:3,rx:2,ry:2,gradient:{id:"SVGID_3_",type:"linear",x1:11.5869,y1:1.5864,x2:14.4153,y2:4.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:9,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:7.5864,y1:6.5864,x2:10.4149,y2:9.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:9,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:2,cy:7,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:.5859,y1:5.5859,x2:3.4144,y2:8.4144,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:2,cy:7,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:12.825,cy:13,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:11.4111,y1:11.5869,x2:14.2396,y2:14.4153,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:12.825,cy:13,rx:1,ry:1,fill:"#FFFFFF"}]}),Wn("shapesubnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,6.661c0-1.202-0.642-2.247-1.596-2.835C12.848,2.188,11.314,1,9.486,1  c-1.587,0-2.95,0.902-3.649,2.211C4.573,3.22,3.548,4.194,3.438,5.432C3.389,5.429,3.342,5.417,3.292,5.417  C2.026,5.417,1,6.443,1,7.708S2.026,10,3.292,10h8.371l0,0C13.506,10,15,8.505,15,6.661z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.3755,x2:7.9995,y2:9.733,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M3.292,9C2.58,9,2,8.42,2,7.708s0.58-1.292,1.292-1.292C3.286,6.422,3.332,6.427,3.379,6.43l0.969,0.058  L4.435,5.52C4.5,4.779,5.106,4.216,5.844,4.211l0.595-0.004l0.28-0.524C7.273,2.645,8.334,2,9.486,2  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,5.11,14,5.851,14,6.661C14,7.951,12.951,9,11.661,9H3.292z",fill:"#FFFFFF"},{shape:"path",data:"M3.272,9h8.37c1.11,0,2.039-0.689,2.275-1.729c-0.131-0.615-0.499-1.249-1.057-1.593l-0.307-0.189  l-0.116-0.341C12.002,3.863,10.809,3,9.468,3C8.314,3,7.254,3.645,6.7,4.682L6.42,5.207L5.825,5.211  C5.087,5.216,4.481,5.779,4.416,6.52L4.33,7.487L3.36,7.43C3.313,7.427,3.267,7.422,3.272,7.417c-0.535,0-0.994,0.327-1.19,0.792  C2.278,8.672,2.738,9,3.272,9z",gradient:{id:"SVGID_2_",type:"linear",x1:7.9995,y1:3.459,x2:7.9995,y2:8.4597,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M11.516,7.102h-8l2.469,6h8.5L11.516,7.102z M5.024,8.123h5.905l1.938,3.979H6.662L5.024,8.123z",gradient:{id:"SVGID_3_",type:"linear",x1:7.4443,y1:7.1724,x2:10.1111,y2:12.8383,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"5,8.112 10.904,8.112 12.842,12.092 6.638,12.092 z",fill:"#FFFFFF"},{shape:"ellipse",cx:5,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:3,y1:8,x2:7,y2:8,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:5,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:12,cy:8,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:10,y1:8,x2:14,y2:8,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:12,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:7,cy:12,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:5,y1:12,x2:9,y2:12,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:7,cy:12,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:14,cy:12,rx:2,ry:2,gradient:{id:"SVGID_7_",type:"linear",x1:12,y1:12,x2:16,y2:12,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:14,cy:12,rx:1,ry:1,fill:"#FFFFFF"}]}),Wn("subnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"rect",x:10,y:14.001,w:2,h:1,gradient:{id:"SVGID_1_",type:"linear",x1:11,y1:14.0059,x2:11,y2:14.9481,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"rect",x:14,y:10.001,w:1,h:2,gradient:{id:"SVGID_2_",type:"linear",x1:14.5,y1:10.0117,x2:14.5,y2:11.8962,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,6.001c0,0.552-0.447,1-1,1H8c-0.552,0-1-0.448-1-1v-4c0-0.552,0.448-1,1-1h7   c0.553,0,1,0.448,1,1V6.001z",gradient:{id:"SVGID_3_",type:"linear",x1:11.5,y1:.96,x2:11.5,y2:6.2265,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:8,y:2.001,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:9,y:3.001,w:5,h:2,gradient:{id:"SVGID_4_",type:"linear",x1:11.5,y1:2.7007,x2:11.5,y2:5.0337,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,8.501c0,0.276-0.225,0.5-0.5,0.5h-8c-0.276,0-0.5-0.224-0.5-0.5l0,0c0-0.276,0.224-0.5,0.5-0.5   h8C15.775,8.001,16,8.225,16,8.501L16,8.501z",gradient:{id:"SVGID_5_",type:"linear",x1:11.5,y1:7.126,x2:11.5,y2:8.5535,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:9,y:8.001,w:1,h:.999,gradient:{id:"SVGID_6_",type:"linear",x1:9.5,y1:8.0063,x2:9.5,y2:8.9477,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M9,12c0,0.553-0.447,1-1,1H1c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12z   ",gradient:{id:"SVGID_7_",type:"linear",x1:4.4995,y1:6.959,x2:4.4995,y2:12.2259,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:1,y:8,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:2,y:9,w:5,h:2,gradient:{id:"SVGID_8_",type:"linear",x1:4.5,y1:8.6997,x2:4.5,y2:11.0333,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M9,14.5C9,14.776,8.775,15,8.5,15h-8C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h8   C8.775,14,9,14.224,9,14.5L9,14.5z",gradient:{id:"SVGID_9_",type:"linear",x1:4.4995,y1:13.125,x2:4.4995,y2:14.5518,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:14,w:1,h:1,gradient:{id:"SVGID_10_",type:"linear",x1:2.5,y1:14.0049,x2:2.5,y2:14.9471,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M16,14.501c0,0.276-0.224,0.5-0.5,0.5h-2c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h2c0.276,0,0.5,0.224,0.5,0.5V14.501z",gradient:{id:"SVGID_11_",type:"linear",x1:14.5,y1:13.0117,x2:14.5,y2:14.8962,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]});var Hn={_hitCanvas:null,getHitCanvas:function(t,e){null==this._hitCanvas&&(this._hitCanvas=je.createCanvas()),0==arguments.length&&(t=2,e=2),this._hitCanvas.setAttribute("width",""+t-1),this._hitCanvas.setAttribute("height",""+e-1),this._hitCanvas.setAttribute("width",""+t),this._hitCanvas.setAttribute("height",""+e);var i=this.getCtx(this._hitCanvas);return i.clearRect(0,0,t,e),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(t){return t.getContext("2d")},render:function(t,i,n){i!=e&&(t.fillStyle=i,t.fill()),n!=e&&(t.strokeStyle=n,t.stroke())},text:function(t,e,i,n,o,s){t.textAlign="center",t.textBaseline="middle",null!=o&&(t.fillStyle=o,t.fillText(e,i,n)),s&&(t.strokeStyle=s,t.strokeText(e,i,n))},circle:function(t,e,i,n,o,s){t.arc(e,i,n,0,2*Math.PI,!0),t.closePath(),this.render(t,o,s)},rect:function(t,e,i,n,o,s,a){t.rect(e,i,n,o),t.closePath(),this.render(t,s,a)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(t,e,i,n,o,s){var a=0;return 0>=o?a|=this.OUT_LEFT|this.OUT_RIGHT:i>t?a|=this.OUT_LEFT:t>i+o&&(a|=this.OUT_RIGHT),0>=s?a|=this.OUT_TOP|this.OUT_BOTTOM:n>e?a|=this.OUT_TOP:e>n+s&&(a|=this.OUT_BOTTOM),a},intersectsLine:function(t,e,i,n,o,s,a,r){var h,l;if(0==(l=this.outcode(i,n,o,s,a,r)))return!0;for(;0!=(h=this.outcode(t,e,o,s,a,r));){if(0!=(h&l))return!1;if(0!=(h&(this.OUT_LEFT|this.OUT_RIGHT))){var c=o;0!=(h&this.OUT_RIGHT)&&(c+=a),e+=(c-t)*(n-e)/(i-t),t=c}else{var d=s;0!=(h&this.OUT_BOTTOM)&&(d+=r),t+=(d-e)*(i-t)/(n-e),e=d}}return!0}};Me.vector={},Me.vector.interaction={},Me.vector.Network=function(t){Me.vector.Network.superClass.constructor.apply(this,arguments),this.zoomManager=new Me.vector.PhysicalZoomManager(this),this._view=je.createView("hidden"),this._rootCanvas=je.createCanvas(),this._topCanvas=je.createCanvas(),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0},this._zoom=1,this._elementUIMap={},this._zoomMap={},this._viewRectMap={},this.viewRect={x:0,y:0,width:0,height:0},this.state={zooming:!1,panning:!1,autoLayout:!1},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new Me.List,this._topAttachmentList=new Me.List,this._hitTestTopAttachmentList=new Me.List,this.setElementBox(t?t:new Me.ElementBox),He.isTouchable?He.isMSTouchable?this.setDefaultInteractions(!1,!1):this.setTouchInteractions():this.setDefaultInteractions(!1,!1);var e=this;this._flowLink=function(){if(!(e.isMovingElement()||e.isSelectingElement()||e.isEditingElement()||e._box._layoutMovingElements)){e._flowLinkQuickFinder||(e._flowLinkQuickFinder=new Me.QuickFinder(e._box,"link.flow","style"));var t=e._flowLinkQuickFinder.find(!0);t.forEach(function(t){t._styleMap["link.flow.offset"]=e.getLinkFlowOffset(t),e.invalidateElementUI(t)})}},this.setToolTipEnabled(Me.Defaults.NETWORK_TOOLTIP_ENABLED),this._paintAll=!0,this._dirtyRects=new fn,this._invalidateMap={},this._invalidateAll=!0,e._count=0,e._invalidate=!0,function t(i){e._loopId=requestAnimationFrame(t),e._invalidate&&(e._count++,e._now=i,e.validate())}(0),Me.imageUtil.addEventListener(this.invalidateElementUIs,this),je.addEventListener("mousemove","handle_mousemove",this._view,this)},Oe.ext("twaver.vector.Network",Me.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","scrollBarWidth","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","selectionTolerance"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","scrollBarVisible","limitViewInCanvas","autoValidateCanvasSize","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable","edgeDetect","dragToPan","wheelToZoom","asyncZoomAndViewRect","debug","zoomDivVisible","showShadowInEdit","showAttachOnChg"],_currentSubNetwork:null,_subNetworkAnimate:Me.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!1,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:Me.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Me.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Me.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:Rn.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:Me.Defaults.VECTORUI_FUNCTION,_doubleClickToUpSubNetwork:Me.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:Me.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:Me.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:Me.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:Me.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:Me.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:Me.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:Me.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:Me.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:Me.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:Me.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:Me.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:Me.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:Me.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointSize:Me.Defaults.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:Me.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:Me.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:Me.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:Me.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:Me.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:Me.Defaults.NETWORK_RESIZE_ANIMATE,_rotatePointSize:Me.Defaults.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:Me.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:Me.Defaults.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:Me.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:Me.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:Rn.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:Rn.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:Rn.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:Rn.NETWORK_ROTATE_SCALE_FONT_COLOR,_editPointSize:Me.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:Me.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:Me.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:Me.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:Me.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:Me.Defaults.NETWORK_EDIT_LINE_WIDTH,_limitElementInPositiveLocation:!1,_linkFlowInterval:Rn.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:Rn.NETWORK_SELECTION_TOLERANCE,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_transparentSelectionEnable:Me.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,_edgeDetect:!1,_dragToPan:!0,_wheelToZoom:!0,_asyncZoomAndViewRect:!1,_debug:!1,_zoomDivVisible:!0,_showShadowInEdit:!1,_showAttachOnChg:!0,adjustBounds:function(t){var e=!1,i=this._view.style;if(i.left==t.x+"px"&&i.top==t.y+"px"&&i.width==t.width+"px"&&i.height==t.height+"px"&&(e=!0),Me.vector.Network.superClass.adjustBounds.apply(this,arguments),1!=e){var n=this._view.offsetWidth,o=this._view.offsetHeight;this._rootCanvas.setAttribute("width",n),this._rootCanvas.setAttribute("height",o),this._topCanvas.setAttribute("width",n),this._topCanvas.setAttribute("height",o),this.setViewRect(this.viewRect.x,this.viewRect.y,n,o),"undefined"==typeof Me.gis&&(Me.Util.makeHighRes(this._rootCanvas),Me.Util.makeHighRes(this._topCanvas)),this.invalidateElementVisibility()}},getLabel:function(t){return t.getStyle("network.label")||t.getName()},getLabel2:function(t){return t.getStyle("network.label")||t.getName2()},setZoomManager:function(t){var e=this.zoomManager;e!=t&&(this.zoomManager=t,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.invalidateElementUIs(),this.firePropertyChange("zoomManager",e,t))},getZoomManager:function(){return this.zoomManager},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){gi.twm(this);var t,e,i,n,o=this.getElementBox().getDatas()._as,s=o.length,a={},r=this._visibleFunction,h=1===this._box._layerBox.size()?this._box._layerBox._defaultLayer:null;for(t=0;s>t;t++)i=o[t],a[i._id]=this.isVisible(i,r,h);var l=this.getGraphicsZoom(),c=null,d={x:this.viewRect.x/l,y:this.viewRect.y/l,width:this.viewRect.width/l,height:this.viewRect.height/l};if(this._invalidateAll){if(this._visibleMap)for(t=0;s>t;t++)i=o[t],a[i._id]!==this._visibleMap[i._id]&&(n=this._elementUIMap[i._id],n&&n.invalidate());for(t=0;s>t;t++)i=o[t],n=this._elementUIMap[i._id],n&&n.validate();this._paintAll=!0}else if(this._paintAll){for(e in this._invalidateMap)n=this._elementUIMap[e],n&&n.invalidate();for(e in this._invalidateMap)n=this._elementUIMap[e],n&&n.validate()}else{for(e in this._invalidateMap)n=this._elementUIMap[e],n&&(this._dirtyRects.add(n.getZoomViewRect(!1)),n.invalidate());for(e in this._invalidateMap)n=this._elementUIMap[e],n&&(n.validate(),this._dirtyRects.add(n.getZoomViewRect(!0)))}this._paintAll?c=d:(this._dirtyRects.forEach(function(t){c=null==c?Oe.cloneRect(t):Ze.unionRect(c,t)}),c?(Ze.grow(c,2,2),c=Ze.intersection(c,d)):c=d),this._visibleMap=a,c&&this.paintRoot(c),this.validateCanvasSize(),1==this._repaintTopFlag&&(this._repaintTopFlag=!1,this.paintTopCanvas())},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(t){t?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(t){var e=this._linkFlowInterval;this._linkFlowInterval=t,this.firePropertyChange("linkFlowInterval",e,t),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getElementBox:function(){return this._box},setElementBox:function(t){if(!t)throw"ElementBox can not be null";if(this._box!==t){var e=this._box;e&&(e.removeDataBoxChangeListener(this.handleElementBoxChange,this),e.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),e.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),e.removeIndexChangeListener(this.handleIndexChange,this),e.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),e.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),e.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=t,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new Me.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(t):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange("elementBox",e,this._box)}},handleElementBoxChange:function(t){var e=t.data;if("add"===t.kind)this.createElementUI(e),this.invalidateBundleLink(e);else if("remove"===t.kind){var i=this.getElementUI(e);i&&(this._dirtyRects.add(i.getZoomViewRect()),i.dispose(),delete this._elementUIMap[e.getId()]),e===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null),delete this._invalidateMap[e._id]}else if("clear"===t.kind){for(var n in this._elementUIMap)this._elementUIMap[n]&&this._elementUIMap[n].dispose&&this._elementUIMap[n].dispose();this._elementUIMap={},null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null),this._paintAll=!0}else"layoutEnd"===t.kind?this.state.layouting=!1:"layouting"===t.kind&&(this.state.layouting=!0);this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(t){var e=t.source,i=this.getElementUI(e);i&&(this.invalidateElementUI(e),i.handlePropertyChange(t)),this.invalidateBundleLink(e),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(t){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(t){"editable"===t.property&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(t){var e=this.getSelectionModel().getLastData();e&&("append"===t.kind||"set"===t.kind)&&(this.isMakeVisibleOnSelected()&&this.makeVisible(e),this.isSendToTopOnSelected()&&this.sendToTop(e)),t.datas.forEach(function(e){var i=this.getElementUI(e);i&&i.handleSelectionChange(t),this.invalidateElementUI(e)},this),this.invalidateElementVisibility()},sendToTop:function(t){if(this._box.contains(t)){for(var e=t;e._parent&&this.isVisible(e._parent)&&(e=e._parent););e!==t&&this._box.adjustElementIndex(e),this._box.adjustElementIndex(t)}},getScopeRect:function(t){{var e=this.getGraphicsZoom();this.zoomManager}if("viewsize"===t)return{x:this._unionBounds.x-this.viewRect.x,y:this._unionBounds.y-this.viewRect.y,width:this._unionBounds.width,height:this._unionBounds.height};if("viewport"===t){if(this.viewRect)return Oe.cloneRect(this.viewRect)}else if("rootcanvas"===t)return{x:this.viewRect.x,y:this.viewRect.y,width:(Math.abs(this.viewRect.x-this._unionBounds.x)+this._unionBounds.width)*e,height:(Math.abs(this.viewRect.y-this._unionBounds.y)+this._unionBounds.height)*e};return{x:0,y:0,width:0,height:0}},getViewRect:function(){return this.viewRect?Oe.cloneRect(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},setViewOffSet:function(t,e){var i=this.viewRect.x,n=this.viewRect.y,o=this.viewRect.width,s=this.viewRect.height;this.setViewRect(i+t,n+e,o,s)},setViewRect:function(t,e,i,n){1==this.isLimitViewInCanvas()&&(0>t&&(t=0),i>this.realWidth?t=0:t+i>this.realWidth&&(t=this.realWidth-i),0>e&&(e=0),n>this.realHeight?e=0:e+n>this.realHeight&&(e=this.realHeight-n));var o=this.viewRect;(null==this.viewRect||t!=this.viewRect.x||e!=this.viewRect.y||i!=this.viewRect.width||n!=this.viewRect.height)&&(this.viewRect={x:t,y:e,width:i,height:n},this.firePropertyChange("viewRect",o,this.viewRect),this.invalidateElementVisibility(),this._paintAll=!0)},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(t){this.hScrollBarVisible=t},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(t){this.vScrollBarVisible=t},setZoomVisibilityThresholds:function(t){var e=this._visibilityThresholds;this._zoomVisibilityThresholds=t,this.firePropertyChange("zoomVisibilityThresholds",e,t),this.invalidateElementVisibility()},getZoomVisibilityThresholds:function(){return this._zoomVisibilityThresholds||{}},invalidateElementVisibility:function(){this.invalidate()},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(t){this._invalidateCanvasSizeFlag||(this._invalidateCanvasSizeFlag=!0,this.invalidate())},validateCanvasSize:function(){0!=this._invalidateCanvasSizeFlag&&(this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize())},_validateCanvasSize:function(){if(0==this.isAutoValidateCanvasSize())return this.realWidth=0,this.realHeight=0,void(this._unionBounds={x:0,y:0,width:0,height:0});var t,e=this.getElementBox().getDatas(),i=e.size();if(i>0){for(var n=0;i>n;n++){var o=e.get(n);if(this._visibleMap[o._id]){var s=this._elementUIMap[o._id];s&&(t=t?Ze.unionRect(t,s.getZoomViewRect(!0)):Oe.cloneRect(s.getZoomViewRect(!0)))}}null==t&&(t={x:0,y:0,width:0,height:0});var a=this.getGraphicsZoom();if(this._unionBounds={x:t.x*a,y:t.y*a,width:t.width*a,height:t.height*a},this.realWidth==(t.x+t.width)*a&&this.realHeight==(t.y+t.height)*a)return;this.realWidth=(t.x+t.width)*a,this.realHeight=(t.y+t.height)*a}else this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange("canvasSizeChange",null,this.viewRect)},getElementUI:function(t){return null==t?null:this._elementUIMap[t._id]},getUnionBounds:function(){return this._unionBounds},getZoomBodyRect:function(t){var e=this.getElementUI(t);return e?e.getZoomBodyRect():null},getShapeNodeZoomPoints:function(t,e){if(t._points){var i=this.getElementUI(t);if(i)return i._getZoomPoints()}return null},createElementUI:function(t){var e=this._elementUIMap[t.getId()];if(!e){if(e=this._elementUIFunction(this,t),!e){var i=t.getClassName(),n=i.substr(i.indexOf(".")+1)+"UI",o=Me.vector[n];o&&(e=new o(this,t))}e&&(this._elementUIMap[t.getId()]=e)}return this._invalidateMap&&(this._invalidateMap[t._id]=t),e},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(t){if(!t)throw"ElementUIFunction can not be null";if(this._elementUIFunction!==t){var e=this._elementUIFunction;this._elementUIFunction=t,this.firePropertyChange("elementUIFunction",e,t),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())}},invalidateElementUI:function(t,e){if(!this._invalidateAll){this._invalidateMap[t._id]=t;{this.getElementUI(t)}if(t instanceof Fn){var i=t.getAgentLinks();null!=i&&i.forEach(this.invalidateElementUI,this);var n=t.getParent();n instanceof Me.Group&&this.invalidateElementUI(n)}this.invalidateElementVisibility()}},invalidateElementUIs:function(t){this._invalidateAll=!0,this._invalidateMap={},this._visibleMap={},this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.invalidate()},invalidateSelectedElementUIs:function(t){this.getSelectionModel().getSelection().forEach(function(e){this.invalidateElementUI(e,t)},this)},invalidateBundleLink:function(t){if(t instanceof Me.Link&&t._bundleLinks){var e=this._elementUIMap;t._bundleLinks.forEachSiblingLink(function(i){if(i!==t){var n=e[i._id];n&&n.invalidate(!1)}},this)}},paintRoot:function(t){var i=this._rootCanvas.getContext("2d");i.save();var n=this.getGraphicsZoom();i.beginPath(),i.rect(Math.round(t.x*n-this.viewRect.x),Math.round(t.y*n-this.viewRect.y),Math.round(t.width*n),Math.round(t.height*n)),i.clip(),i.clearRect(Math.round(t.x*n-this.viewRect.x),Math.round(t.y*n-this.viewRect.y),Math.round(t.width*n),Math.round(t.height*n)),this.visibleList=new Me.List,this._topAttachmentList=new Me.List,_n.draw(i,this);var o=this.getElementBox().getDatas()._as,s=o.length,a=this.zoomManager;a._zoomGraphicsBegin(i),this.paintBottom(i,t);var r,h,l,c,d=this._box._layerBox,n=this.getGraphicsZoom(),u={x:this.viewRect.x/n,y:this.viewRect.y/n,width:this.viewRect.width/n,height:this.viewRect.height/n};if(this.adjustLinkIndex(),1===d.size())for(r=0;s>r;r++)h=o[r],this._visibleMap[h._id]?(l=this._elementUIMap[h._id],this._debug&&Ke.strokeRect(i,t,"red"),null!=l&&this._isInView(l,t)&&(l.paint(i),l.setAttachmentVisible&&l.setAttachmentVisible(!0)),null!=l&&Ze.intersects(u,l.getZoomViewRect())?l.setAttachmentVisible&&l.setAttachmentVisible(!0):l.setAttachmentVisible&&l.setAttachmentVisible(!1),this.visibleList.add(h)):(l=this._elementUIMap[h._id],l&&l.setAttachmentVisible&&l.setAttachmentVisible(!1));else d.forEachByDepthFirst(function(e){for(r=0;s>r;r++)h=o[r],d.getLayerByElement(h)===e&&this._visibleMap[h._id]?(l=this._elementUIMap[h._id],null!=l&&this._isInView(l,t)&&(l.paint(i),l.setAttachmentVisible&&l.setAttachmentVisible(!0)),null!=l&&Ze.intersects(u,l.getZoomViewRect())?l.setAttachmentVisible&&l.setAttachmentVisible(!0):l.setAttachmentVisible&&l.setAttachmentVisible(!1),l&&l.validateZIndex&&l.validateZIndex(d.getDatas().indexOf(e)),this.visibleList.add(h)):l=this._elementUIMap[h._id]},null,this);for(s=this._topAttachmentList.size(),r=0;s>r;r++)c=this._topAttachmentList.get(r),c.getElementUI().paintAttachment(i,c);if(this.paintTop(i,t),this._xyz!==e){var s,_=this._xyz,g=_.markText,f=_.type,v=(_.expired,_.innerHTML),m=0,p=0,y=this.viewRect;i.translate(this.viewRect.x/this.getZoom(),this.viewRect.y/this.getZoom()),i.scale(1/this.getZoom(),1/this.getZoom());var n=this.getZoom();g!=e&&null!=g&&""!=g||"2"==f?(i.font="15px Arial sans-serif",s=Oe.g.getTextSize(i.font,v),i.fillStyle="red",m=y.width-s.width,p=y.height-20):(i.font="10px Arial sans-serif",s=Oe.g.getTextSize(i.font,v),m=y.width/2-s.width/2,p=y.height/2),i.fillText(v,m,p)}i.restore(),this._invalidateMap={},this._invalidateAll=!1,this._paintAll=!1,this._dirtyRects=new fn},adjustLinkIndex:function(){var t,e,n=this._box.getDatas()._as,o=this.hasEditInteraction();if(o){for(this._hasAdjustedLinks=!1,i=n.length-1;i>-1;i--)if(t=n[i],t instanceof Me.Link)if(this.isEditable(t)&&this.getElementUI(t).isEditable()&&this.isSelected(t))e=this._box.getDatas().indexOf(t),this._box.getDatas().removeAt(e),this._box.getDatas().add(t),this._hasAdjustedLinks=!0;else{var s=t.getToNode();e=this._box.getDatas().indexOf(s),this._box.getDatas().removeAt(e),this._box.getDatas().add(s);var a=t.getFromNode();e=this._box.getDatas().indexOf(a),this._box.getDatas().removeAt(e),this._box.getDatas().add(a)}}else if(this._hasAdjustedLinks){for(i=n.length-1;i>-1;i--)if(t=n[i],t instanceof Me.Link){var s=t.getToNode();e=this._box.getDatas().indexOf(s),this._box.getDatas().removeAt(e),this._box.getDatas().add(s);var a=t.getFromNode();e=this._box.getDatas().indexOf(a),this._box.getDatas().removeAt(e),this._box.getDatas().add(a)}this._hasAdjustedLinks=!1}},paintBottom:function(t,e){},paintTop:function(t,e){},_isInView:function(t,e){return Ze.intersects(e,t.getZoomViewRect())},paintTopCanvas:function(){var t=this._topCanvas.getContext("2d");t.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(t)},paintMarker:function(t){for(var e=this.markerList.size(),i=0;e>i;i++){var n=this.markerList.get(i);n.paint(t)}},getLayerByElement:function(t){return this._box.getLayerBox().getLayerByElement(t)},getLogicalPoint2:function(t){return this.zoomManager._getLogicalPoint(t)},getLogicalPoint:function(t){return this.zoomManager._getLogicalPoint(t,!0)},getElementAt:function(t){if(null==this.visibleList)return null;var e;if(t.target?e=this.getLogicalPoint2(t):t.event?t.event.target&&(e=this.getLogicalPoint2(t.event)):e=t,null!=this._hitTestTopAttachmentList)for(var i=this._hitTestTopAttachmentList.size(),n=i-1;n>=0;n--){var o=this._hitTestTopAttachmentList.get(n);if(o.hit(e.x,e.y))return o.getElement()}if(null!=this.visibleList)for(var s=this.visibleList.size(),a=s-1;a>=0;a--){var r=this.visibleList.get(a),h=this.getElementUI(r);if(h&&h.hit(e.x,e.y))return r}return null},getElementsAt:function(t){var e=new Me.List;if(null==this.visibleList)return null;var i;if(t.target?i=this.getLogicalPoint2(t):t.event?t.event.target&&(i=this.getLogicalPoint2(t.event)):i=t,null!=this._hitTestTopAttachmentList)for(var n=this._hitTestTopAttachmentList.size(),o=n-1;o>=0;o--){var s=this._hitTestTopAttachmentList.get(o);s.hit(i.x,i.y)&&e.add(s.getElement())}if(null!=this.visibleList)for(var a=this.visibleList.size(),r=a-1;r>=0;r--){var h=this.visibleList.get(r),l=this.getElementUI(h);l&&l.hit(i.x,i.y)&&e.add(h)}return e},hitTest:function(t){var e=this.getElementAt(t);if(!e)return null;var i=this.getElementUI(e);if(!i)return null;var n;return n=t.target?this.getLogicalPoint2(t):t.event?this.getLogicalPoint2(t.event):t,i.hitTest(n.x,n.y)},getElementsAtRect:function(t,i,n,o){var s=new Me.List;if(null==this.visibleList)return s;o=o===e?!0:o;for(var a=this.visibleList.size(),r=a-1;r>=0;r--){var h=this.visibleList.get(r),l=this.getElementUI(h);l&&(!n||n(l._element))&&(o&&this.isSelectable(l._element)||!o)&&(i?l.intersects(t)&&s.add(h):Ze.contains(t,l.getZoomViewRect(di))&&s.add(h))}return s},getPosition:function(t,e,i,n,o,s){var a,r=e instanceof Me.vector.ElementUI?e:this.getElementUI(e);if(r)if("from"===t||"to"===t){if(r.getFromPosition&&(a="from"===t?r.getFromPosition(n,o):r.getToPosition(n,o)))return i?{x:a.x-i.width/2,y:a.y-i.height/2}:a}else a="hotspot"===t?s?r.getZoomHotSpot(this.zoomManager):r.getHotSpot():Xe.get(t,s?r.getZoomBodyRect():r.getBodyRect(),i);if(!a&&e.getRect&&(a=Xe.get(t,e.getRect(),i)),a)return{x:a.x+n,y:a.y+o};throw"position '"+t+"' object '"+e+"'"},isValidEvent:function(t){if(!t)return!1;var e,i;if(t.currentTarget===this._view){if(He.isFirefox?(e=t.layerX,i=t.layerY):(e=t.offsetX,i=t.offsetY),1==this.isHScrollBarVisible()&&i>=this.viewRect.height-this.getScrollBarWidth())return!1;if(1==this.isVScrollBarVisible()&&e>=this.viewRect.width-this.getScrollBarWidth())return!1}return!0},addMarker:function(t){this.markerList.add(t),this.repaintTopCanvas()},removeMarker:function(t){this.markerList.remove(t),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(t){return this._box.contains(t)&&t.isMovable()?this._movableFunction&&!this._movableFunction(t)?!1:this.getLayerByElement(t).isMovable():!1},hasMovableSelectedElements:function(){for(var t=this.getSelectionModel().getSelection(),e=0;e<t.size();e++){var i=t.get(e);if(this.isMovable(i))return!0}return!1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(t){return this.isMovable(t)},this)},moveSelectedElements:function(t,e,i,n){if(0!==t||0!==e){var o=this.getMovableSelectedElementsRect();null!=o&&(this._limitElementInPositiveLocation&&(o.x+t<0&&(t=-o.x),o.y+e<0&&(e=-o.y)),Me.Util.moveElements(this.getMovableSelectedElements(),t,e,i,n,this))}},getMovableSelectedElementsRect:function(){var t=this.getMovableSelectedElements();if(0===t.size())return null;for(var e=null,i=0,n=t.size();n>i;i++){var o=t.get(i);if(o instanceof Fn){var s=this.getElementUI(o);s&&(e=Ze.unionRect(e,s.getViewRect()))}}return e},isVisibleAttachment:function(t){return!this.state.zooming&&!this.state.panning&&!this.state.layouting},isVisible:function(t,e,i){if(!this._box.contains(t))return!1;if(!t.isVisible())return!1;if(3!==arguments.length&&(e=this._visibleFunction),e&&!e(t))return!1;if(!(i||this._box._layerBox.getLayerByElement(t))._visible)return!1;if(xi.getSubNetwork(t)!==this._currentSubNetwork)return!1;if(!this.zoomManager.isElementVisible(t))return!1;if(t instanceof Me.Link){if(!this._noAgentLinkVisible){if(!t._fromAgent||!t._toAgent)return!1;if(!this.isVisible(t._fromAgent,e,i)||!this.isVisible(t._toAgent,e,i))return!1}if(t.getBundleIndex()>0&&t.getBundleCount()>1&&!t.getStyle("link.bundle.expanded"))return!1}else for(var n=t._parent;n&&!n.ISubNetwork;){if(n instanceof Me.Group&&(!n.isExpanded()||!this.isVisible(n,e,i)))return!1;n=n._parent}return t.IDummy?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(t){var e=this._visibleFunction;this._visibleFunction=t,this.firePropertyChange("visibleFunction",e,t),this.invalidateElementVisibility()},isEditable:function(t){return this._box.contains(t)?this._editableFunction&&!this._editableFunction(t)?!1:this.getLayerByElement(t).isEditable():!1},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(t){var e=this._editableFunction;this._editableFunction=t,this.firePropertyChange("editableFunction",e,t),this.invalidateSelectedElementUIs(!0)},isRotatable:function(t){return this._rotatableFunction&&!this._rotatableFunction(t)?!1:!0},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(t){var e=this._rotatableFunction;this._rotatableFunction=t,this.firePropertyChange("rotatableFunction",e,t),this.invalidateSelectedElementUIs(!0)},isLinkable:function(t,e){return null==this._linkableFunction||this._linkableFunction(t,e)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(t){var e=this._linkableFunction;this._linkableFunction=t,this.firePropertyChange("linkableFunction",e,t),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(t){var e=t.getStyle("shadow.color");return!e&&this.isSelected(t)&&"shadow"===t.getStyle("select.style")?t.getStyle("select.color"):e},getSelectColor:function(t){return t.getStyle("select.color")},getAlarmLabel:function(t){var e=t.getAlarmState().getHighestNewAlarmSeverity();if(e){var i=t.getAlarmState().getNewAlarmCount(e)+e.nickName;return t.getAlarmState().hasLessSevereNewAlarms()&&(i+="+"),i}return null},getLinkHandlerLabel:function(t){return t.isBundleAgent()?"+("+t.getBundleCount()+")":null},setInteractions:function(t){var e=this._interactions;e&&e.forEach(function(t){t.tearDown()}),this._interactions=t,t&&t.forEach(function(t){t.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",e,t)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(t,e){var i=[new Me.vector.interaction.DefaultInteraction(this,t)];e&&i.push(new Me.vector.interaction.MoveLinkInteraction(this,t)),this.setInteractions(i)},setTouchInteractions:function(){this.setInteractions([new Me.vector.interaction.DefaultInteraction(this,!1),new Me.vector.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new Me.vector.interaction.MSTouchInteraction(this)])},setEditInteractions:function(t,e){var i=[new Me.vector.interaction.EditInteraction(this,t),new Me.vector.interaction.DefaultInteraction(this)];e&&i.push(new Me.vector.interaction.MoveLinkInteraction(this,t)),this.setInteractions(i)},setCreateElementInteractions:function(t){this.setInteractions([new Me.vector.interaction.CreateElementInteraction(this,t),new Me.vector.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(t){this.setInteractions([new Me.vector.interaction.CreateLinkInteraction(this,t),new Me.vector.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(t){this.setInteractions([new Me.vector.interaction.CreateShapeLinkInteraction(this,t),new Me.vector.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(t){this.setInteractions([new Me.vector.interaction.CreateShapeNodeInteraction(this,t),new Me.vector.interaction.DefaultInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new Me.vector.interaction.DefaultInteraction(this),new Me.vector.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(t){var e=this._hasEditInteraction;this._hasEditInteraction=t,this.firePropertyChange("hasEditInteraction",e,t)},addElementByInteraction:function(t){t.getParent()||t.setParent(this._currentSubNetwork),this._box.add(t),this.getSelectionModel().setSelection(t),this.fireInteractionEvent({kind:"createElement",element:t})},getToolTip:function(t){if(t){var e=t.getToolTip();return e?e:t.getName()}return null},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(t){if(this._toolTipEnabled=t,t){if(!this._toolTipListener){var e=this;this._toolTipListener=function(t){if(e.isMovingElement())return void Si.hideToolTip();var i=e.getElementAt(t);if(e._preElement!==i){if(e._preElement=i,i){var n=e.getToolTip(i);return void Si.showToolTip({x:t.pageX,y:t.pageY},n,function(t){var i=e._view.getBoundingClientRect(),n=t.getBoundingClientRect();n.width+n.left>i.width+i.left&&(t.style.left=i.width+i.left-n.width+(Ve.documentElement.scrollLeft||Ve.body.scrollLeft)+"px"),n.height+n.top>i.height+i.top&&(t.style.top=i.height+i.top-n.height+(Ve.documentElement.scrollTop||Ve.body.scrollTop)+"px")})}Si.hideToolTip()}},this._view.addEventListener("mousemove",this._toolTipListener,!1),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Si.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!1),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},setZoom:function(t,e){if(t=this.checkZoom(t),this.isAsyncZoomAndViewRect())var i=this._zoomMap[this._currentSubNetwork].zoom;else var i=this._zoom;if(t!=i){var n=this.getViewRect();e||(e={x:n.width/2,y:n.height/2});var o=this.viewRect,s=e.x-(e.x+o.x)*t/i,a=e.y-(e.y+o.y)*t/i;this.isAsyncZoomAndViewRect()?this._zoomMap[this._currentSubNetwork].zoom=t:this._zoom=t,this._paintAll=!0,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.zoomManager._invalidateZoom(),this.setViewRect(-s,-a,this.viewRect.width,this.viewRect.height),this._asyncZoomAndViewRect?this.firePropertyChange("zoom",i,this._zoomMap[this._currentSubNetwork].zoom):this.firePropertyChange("zoom",i,this._zoom),this.state.zooming=!0;var r=null,h=this;r?clearTimeout(r):r=setTimeout(function(){r=null,h.state.zooming=!1,h.invalidateElementUIs(!0)},100)}},getZoom:function(){if(this.isAsyncZoomAndViewRect()){var t=this._zoomMap[this._currentSubNetwork];return t||(this._zoomMap[this._currentSubNetwork]={zoom:1}),this._zoomMap[this._currentSubNetwork].zoom}return this._zoom},getSizeZoom:function(t){return this.zoomManager.getSizeZoom(t)},getLocationZoom:function(){return this.zoomManager.getLocationZoom()},getGraphicsZoom:function(){return this.zoomManager.getGraphicsZoom()},zoomOverview:function(t){if(!(this._unionBounds.width<=0||this._unionBounds.width<=0)){var e=this.getZoom(),i=this._unionBounds,n=i.width/e,o=i.height/e,s=this.viewRect.width/n,a=this.viewRect.height/o,r=Math.min(s,a);this.setZoom(r);var h=this.getZoom(),l=this.viewRect.width/2-this._unionBounds.width/2*h/e,c=this.viewRect.height/2-this._unionBounds.height/2*h/e;if(this.setViewRect(this._unionBounds.x*h/e-l,this._unionBounds.y*h/e-c,this.viewRect.width,this.viewRect.height),1!=this.getLocationZoom()){var d=null==arguments[1]?5:arguments[1];if(d>0){d--;var u=this;setTimeout(function(){u.zoomOverview(t,d)},25)}}}},zoomReset:function(t){this.setZoom(1,t)},zoomIn:function(t){this.setZoom(1.2*this.getZoom(),t)},zoomOut:function(t){this.setZoom(this.getZoom()/1.2,t)},upSubNetwork:function(t,e){this._currentSubNetwork&&this.setCurrentSubNetwork(xi.getSubNetwork(this._currentSubNetwork),t,e)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(t,e,i){if(Me.animate.AnimateManager.endAnimate(),e){if(this._currentSubNetwork===t)return;if(t&&!this._box.contains(t))throw t+" is not contained in this network's elementBox";var n=new Me.animate.AnimateSubNetwork(this,t,i);Me.animate.AnimateManager.start(n)}else this._setCurrentSubNetwork(t),i&&i()},_setCurrentSubNetwork:function(t){if(this._currentSubNetwork!==t){if(t&&!this._box.contains(t))throw t+" is not contained in this network's elementBox";if(this.isAsyncZoomAndViewRect()){var e=this._viewRectMap[this._currentSubNetwork];this._viewRectMap[this._currentSubNetwork]=e?this.viewRect:this.viewRect?this.viewRect:{x:0,y:0,width:this.viewRect.width,height:this.viewRect.height}}var i=this._currentSubNetwork;if(this._currentSubNetwork=t,this.firePropertyChange("currentSubNetwork",i,t),this.isAsyncZoomAndViewRect()){this._viewRectMap[this._currentSubNetwork]||(this._viewRectMap[this._currentSubNetwork]={x:0,y:0,width:this.viewRect.width,height:this.viewRect.height});var e=this._viewRectMap[this._currentSubNetwork];this.setViewRect(e.x,e.y,e.width,e.height),this.invalidateElementUIs()}this.invalidateElementVisibility(),this.invalidateCanvasSize(),this._paintAll=!0}},makeVisible:function(t){var e=this.getElementUI(t);if(e){var i=xi.getSubNetwork(t);if(i!==this._currentSubNetwork){var n=this;return void this.setCurrentSubNetwork(i,this.isSubNetworkAnimate(),function(){Oe.callLater(n.makeVisible,n,[t])})}for(var o=t;(o=o.getParent())&&o!==i;)o instanceof Me.Group&&o.setExpanded(!0);var s=e.getViewRect();if(s){var a,r=e.getZoomViewRect(this.zoomManager);a=s.x==r.x&&s.y==r.y&&s.width==r.width&&s.height==r.height?{x:s.x*this.getGraphicsZoom(),y:s.y*this.getGraphicsZoom(),width:s.width*this.getGraphicsZoom(),height:s.height*this.getGraphicsZoom()}:r,Ze.intersects(this.viewRect,a)||this.isVisible(t)&&Oe.callLater(this.centerByLogicalPoint,this,[a.x+a.width/2,a.y+a.height/2])}}},centerByLogicalPoint:function(t,e,i){var n=t-this.viewRect.width/2,o=e-this.viewRect.height/2;this.setViewRect(n,o,this.viewRect.width,this.viewRect.height)},panByOffset:function(t,e){this.setViewOffSet(t,e)},getIconsNames:function(t){return t.getStyle("icons.names")},getIconsColors:function(t){return t.getStyle("icons.colors")},getLinkFlowStepping:function(t){var e=parseInt(t.getStyle("link.flow.stepping"));return e||(e=Rn.NETWORK_LINK_FLOW_STEPPING),e},getLinkFlowOffset:function(t){var e=t.getStyle("link.flow.offset");return isNaN(e)&&(e=0),e+this.getLinkFlowStepping(t)},toCanvas:function(t,e,i,n,o,s){i||(i=je.createCanvas()),i.setAttribute("width",t),i.setAttribute("height",e),i._viewRect?(i._viewRect.width=t,i._viewRect.height=e):i._viewRect={x:0,y:0,width:t,height:e};var a=i.getContext("2d");if(a.translate(-o,-s),a.clearRect(0,0,t,e),_n.draw(a,this),0===this._view.clientWidth||0===this._view.clientHeight)return i;t/this.realWidth*this.getGraphicsZoom(),e/this.realHeight*this.getGraphicsZoom();a.scale(n,n);var r=this.getElementBox().getDatas()._as,h=r.length;this._topAttachmentList=new Me.List;var l,c,d,u,_,g,f=this.getElementBox().getLayerBox(),v=f.getRoots(),m=v.size();if(this.adjustLinkIndex(),1===m)for(d=0;h>d;d++)u=r[d],this._visibleMap[u._id]&&(_=this._elementUIMap[u._id],null!=_&&_.paint(a));else for(l=0;m>l;l++)for(c=v.get(l),d=0;h>d;d++)u=r[d],f.getLayerByElement(u)===c&&this._visibleMap[u._id]&&(_=this._elementUIMap[u._id],null!=_&&_.paint(a));for(h=this._topAttachmentList.size(),d=0;h>d;d++)g=this._topAttachmentList.get(d),g.getElementUI().paintAttachment(a,g);return i},toCanvasByRegion:function(t,e,i){i||(i=je.createCanvas());var n=t.width*e,o=t.height*e;i.setAttribute("width",n),i.setAttribute("height",o),i._viewRect?(i._viewRect.width=n,i._viewRect.height=o):i._viewRect={x:0,y:0,width:n,height:o};var s=i.getContext("2d");if(s.clearRect(0,0,n,o),_n.draw(s,this),0===this._view.clientWidth||0===this._view.clientHeight)return i;s.save(),s.scale(e,e),s.beginPath(),s.translate(-t.x,-t.y);var a=this.getElementBox().getDatas()._as,r=a.length;this._topAttachmentList=new Me.List;var h,l,c,d,u,_,g=this.getElementBox().getLayerBox(),f=g.getRoots(),v=f.size();if(this.adjustLinkIndex(),1===v)for(c=0;r>c;c++)d=a[c],this._visibleMap[d._id]&&(u=this._elementUIMap[d._id],null!=u&&Ze.intersects(t,u.getZoomViewRect())&&u.paint(s));else for(h=0;v>h;h++)for(l=f.get(h),c=0;r>c;c++)d=a[c],g.getLayerByElement(d)===l&&this._visibleMap[d._id]&&(u=this._elementUIMap[d._id],null!=u&&Ze.intersects(t,u.getZoomViewRect())&&u.paint(s));for(r=this._topAttachmentList.size(),c=0;r>c;c++)_=this._topAttachmentList.get(c),_.getElementUI().paintAttachment(s,_);return s.restore(),i},getGroupChildrenRects:function(t){return this.zoomManager._getGroupChildrenRects(t)},convertPointFromView:function(t){return this.zoomManager._convertPointFromView(t)},getOffset:function(t,e){return this.zoomManager._getOffset(t,e)},panToCenter:function(){this.setViewRect((this.realWidth-this.viewRect.width)/2,(this.realHeight-this.viewRect.height)/2,this.viewRect.width,this.viewRect.height)},moveElementsToCenter:function(){if(this._limitViewInCanvas){var t=this.viewRect,e=this._unionBounds,i=t.x+t.width/2-e.x-e.width/2,n=t.y+t.height/2-e.y-e.height/2;Me.Util.moveElements(this._box.toDatas(),i,n)}else{var i=this.viewRect.width/2-this._unionBounds.width/2,n=this.viewRect.height/2-this._unionBounds.height/2;this.setViewRect(this._unionBounds.x-i,this._unionBounds.y-n,this.viewRect.width,this.viewRect.height)}},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(t){var e=this._linkPathFunction;this._linkPathFunction=t,this.firePropertyChange("linkPathFunction",e,t),this.invalidateElementUIs()},invalidate:function(){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:"invalidate"}))},validate:function(){this._invalidate&&(ze||0!==this._view.offsetWidth||0!==this._view.offsetHeight)&&(this._invalidate=!1,this._isValidating=!0,this.fireViewEvent({kind:"validateStart"}),this.validateImpl(),this.fireViewEvent({kind:"validateEnd"}),this._isValidating=!1)},onClickElement:function(t,e){},onClickBackground:function(t){},onDoubleClickElement:function(t,e){},onDoubleClickBackground:function(t){},onLongClickElement:function(t,e){},onLongClickBackground:function(t){},onMouseMove:function(t,e){},onMouseEnter:function(t,e){},onMouseLeave:function(t,e){},setMovingElement:function(t){if(t!=this._movingElement){var e=this._movingElement;this._movingElement=t,this.firePropertyChange("movingElement",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},setEditingElement:function(t){if(t!=this._editingElement){var e=this._editingElement;this._editingElement=t,this.firePropertyChange("editingElement",e,t),this._box._undoManager._enabled&&(t?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},dispose:function(){Me.imageUtil.removeEventListener(this.invalidateElementUIs,this),this.setInteractions(null),cancelAnimationFrame(this._loopId)},handle_mousemove:function(t){var e=this.getElementAt(t),i=this.__preElement,n=Li(i),o=Li(e);i!==e&&(i&&(n&&n.onMouseLeave&&n.onMouseLeave(i,this),this.onMouseLeave(i,t)),e&&(o&&o.onMouseEnter&&o.onMouseEnter(e,this),this.onMouseEnter(e,t))),e&&o&&o.onMouseMove&&o.onMouseMove(e,this),this.onMouseMove(e,t),this.__preElement=e}}),Me.vector.Overview=function(t){Me.vector.Overview.superClass.constructor.apply(this,t),this._view=je.createView(),this._rootDiv=je.createDiv(),this._imageCanvas=je.createCanvas(),this._imageDiv=je.createDiv(),this._maskCanvas=je.createCanvas(),this._selectDiv=je.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,je.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this._exportImageCanvas=je.createCanvas(),this._imageCtx=this._imageCanvas.getContext("2d"),this.setNetwork(t),He.isTouchable?He.isMSTouchable?new Me.vector.OverviewMSTouchInteraction(this):(new Me.vector.OverviewTouchInteraction(this),new Me.vector.OverviewInteraction(this)):new Me.vector.OverviewInteraction(this)},Oe.ext("twaver.vector.Overview",Me.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:Rn.OVERVIEW_FILL_COLOR,_outlineColor:Rn.OVERVIEW_OUTLINE_COLOR,_outlineWidth:Rn.OVERVIEW_OUTLINE_WIDTH,_selectColor:Rn.OVERVIEW_SELECT_COLOR,_selectWidth:Rn.OVERVIEW_SELECT_WIDTH,_padding:Rn.OVERVIEW_PADDING,_animate:Rn.OVERVIEW_ANIMATE,_maxPackingWidth:Rn.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:Rn.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(t){this._invalidateMask()},setNetwork:function(t){t!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),je.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=t,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),je.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate())},_handleNetworkPropertyChange:function(t){("zoom"===t.property||"currentSubNetwork"===t.property||"elementBox"===t.property||"dataBox"===t.property||"canvasSizeChange"===t.property)&&this.invalidate()},_handleNetworkViewChange:function(t){"validateEnd"===t.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(t){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),Oe.callLater(this.validate,this,null,t))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,Oe.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network.getViewRect().width&&0!==this._network.getViewRect().height&&!this._network._invalidate){var t,e=this._maxPackingWidth>0&&this._maxPackingHeight>0;t=e?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},Ze.grow(t,-this._padding,-this._padding),e&&(je.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),t.width=this._imageDiv._viewRect.width,t.height=this._imageDiv._viewRect.height);var i=this._network.getGraphicsZoom(),n=this._network._unionBounds;n=Ze.unionRect(n,{x:0,y:0,width:n.x,height:n.y}),n={x:n.x/i,y:n.y/i,width:n.width/i,height:n.height/i};var o={x:this._network.viewRect.x/i,y:this._network.viewRect.y/i,width:this._network.viewRect.width/i,height:this._network.viewRect.height/i},s=Ze.unionRect(n,o),a=Math.min(t.width/s.width,t.height/s.height),r=s.width*a,h=s.height*a,l=s.width*a,c=s.height*a,d=t.x+(t.width-l)/2,u=t.y+(t.height-c)/2;if(this._isNetworkDirty){var _={x:d,y:u,width:l,height:c};this._network.toCanvas(r,h,this._exportImageCanvas,a,s.x*a,s.y*a),this._imageCanvas.setAttribute("width",l),this._imageCanvas.setAttribute("height",c),this._imageCtx.drawImage(this._exportImageCanvas,0,0,r,h),je.setDiv(this._imageDiv,_,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var g={x:(o.x-s.x)*a,y:(o.y-s.y)*a,width:o.width*a,height:o.height*a},f=je.setCanvas(this._maskCanvas,d,u,l,c);f.lineWidth=0,f.fillStyle=this._fillColor,Ke.drawVector(f,"rectangle",null,d,u,l,c),f.closePath(),f.fill(),f.stroke(),f.clearRect(d+g.x,u+g.y,g.width,g.height),f.lineWidth=this._outlineWidth,f.strokeStyle=this._outlineColor;var v=g.width-2*this._outlineWidth,m=g.height-2*this._outlineWidth;v=Math.min(v,l-2-g.x-this._outlineWidth),m=Math.min(m,c-2-g.y-this._outlineWidth),Ke.drawVector(f,"rectangle",null,d+g.x+this._outlineWidth,u+g.y+this._outlineWidth,v,m),f.closePath(),f.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(t){return je.getLogicalPoint(this._view,t,1,this._rootDiv)},centerNetwork:function(t,e){var i=this._imageDiv._viewRect;if(Ze.containsPoint(i,t)){var n=this._network.getGraphicsZoom(),o=this._network._unionBounds;o=Ze.unionRect(o,{x:0,y:0,width:o.x,height:o.y}),o={x:o.x/n,y:o.y/n,width:o.width/n,height:o.height/n};var s={x:this._network.viewRect.x/n,y:this._network.viewRect.y/n,width:this._network.viewRect.width/n,height:this._network.viewRect.height/n},a=Ze.unionRect(o,s);this._network.centerByLogicalPoint((a.x+(t.x-i.x)/i.width*a.width)*n,(a.y+(t.y-i.y)/i.height*a.height)*n,e),this._invalidateMask()}}}),Me.vector.OverviewTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,je.addEventListener("touchstart","handleTouchstart",this.view,this)},Oe.ext("twaver.vector.OverviewTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t),this.clear(),this.endPoint=this.overview.getLogicalPoint(t),bi.isMultiTouch(t)&&(this.distance=bi.getDistance(t),this.zoom=this.network.getZoom()),je.addEventListener("touchmove","handleTouchmove",this.view,this),je.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(t){if(this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(t),bi.isSingleTouch(t))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var e=bi.getDistance(t)/this.distance;this.network.setZoom(this.zoom*e,!1)}},handleTouchend:function(t){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(t);var e=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;e?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),e?Oe.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,je.removeEventListener("touchmove",this.view,this),je.removeEventListener("touchend",this.view,this)),this.moved=!1}}),Me.vector.OverviewMSTouchInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,this._pointerMap={},this._pointerIdArray=[],je.addEventListener("MSPointerDown","handleTouchstart",this.view,this),je.addEventListener("MSPointerMove","handleTouchmove",this.view,this),je.addEventListener("MSPointerUp","handleTouchend",this.view,this),je.addEventListener("MSPointerCancel","handleTouchend",this.view,this)},Oe.ext("twaver.vector.OverviewMSTouchInteraction",Object,{handleTouchstart:function(t){je.preventDefault(t),t.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[t.pointerId]&&this.overview.getLogicalPoint(t)&&(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(t),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(t){if(0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ze.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10))if(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length){var e=this._getDistance()/this._distance;this.network.setZoom(this._zoom*e,!1)}else if(1==this._pointerIdArray.length&&this._startTouchPoint){var i=this.overview.getLogicalPoint(t);if(null==i)return;this._startTouchPoint=i,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(t){var e=this.overview.getLogicalPoint(t);if(1==this._pointerIdArray.length&&e){var i=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&Ze.getDistance(this._endTouchPoint,e)<=10;i?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=e,this._endTouchTime=new Date),i?Oe.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Ze.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Me.vector.OverviewInteraction=function(t){this.overview=t,this.network=t.getNetwork(),this.view=t._view,je.addEventListener("mousedown","handleMousedown",this.view,this)},Oe.ext("twaver.vector.OverviewInteraction",Object,{handleMousedown:function(t){this.clear(),this.endPoint=this.overview.getLogicalPoint(t),Oe.isCtrlDown(t)&&(this.startPoint=this.endPoint,je.setVisible(this.overview._selectDiv,!0)),je.addEventListener("mousemove","handleMousemove",this.view,this),je.addEventListener("mouseup","handleMouseup",this.view,this)},handleMouseup:function(t){if(this.endPoint=this.overview.getLogicalPoint(t),"detail"in t&&2===t.detail)Oe.callLater(this.network.zoomReset,this.network,[this.endPoint,this.overview._animate]);else if(je.isVisible(this.overview._selectDiv)&&this.startPoint){var e=this.overview._imageDiv._viewRect,i=this.overview._selectDiv._viewRect.x,n=this.overview._selectDiv._viewRect.y,o=e.width/this.overview._selectDiv._viewRect.width,s=e.height/this.overview._selectDiv._viewRect.height,a=Math.min(o,s);this.network.setZoom(a*Math.min(this.network.getViewRect().width/this.network.getCanvasSize().width,this.network.getViewRect().height/this.network.getCanvasSize().height)*this.network.getZoom(),!1);var r=this.network.getCanvasSize().width*((i-e.x+this.overview._selectDiv._viewRect.width/2)/e.width),h=this.network.getCanvasSize().height*((n-e.y+this.overview._selectDiv._viewRect.height/2)/e.height);Oe.callLater(this.network.centerByLogicalPoint,this.network,[r,h,this.overview._animate]),je.setVisible(this.overview._selectDiv,!1),je.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(t){var e=this.overview.getLogicalPoint(t);if(this.endPoint=e,je.isVisible(this.overview._selectDiv)&&this.startPoint){var i=e.x>this.startPoint.x?this.startPoint.x:e.x,n=e.x>this.startPoint.x?this.startPoint.y:e.y;e.x>this.startPoint.x&&e.y<this.startPoint.y&&(n=e.y),e.x<this.startPoint.x&&e.y>this.startPoint.y&&(n=this.startPoint.y);var o=this.overview._imageDiv._viewRect;i<o.x&&(i=o.x),i>o.x+o.width&&(i=o.x+o.width),n<o.y&&(n=o.y),n>o.y+o.height&&(n=o.y+o.height);var s=Math.abs(e.x-this.startPoint.x),a=Math.abs(e.y-this.startPoint.y);i+s>o.x+o.width&&(s=o.x+o.width-i),n+a>o.y+o.height&&(a=o.y+o.height-n),je.setDiv(this.overview._selectDiv,{x:i,y:n,width:s,height:a},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(e,!1)},clear:function(){this.endPoint&&(this.endPoint=null,je.removeEventListener("mousemove",this.view,this),je.removeEventListener("mouseup",this.view,this))}}),Me.vector.ElementUI=function(t,e){this._network=t,this._element=e,this._attachments=new Me.List,this._bodyBounds=new Me.List,this._hitTest=!1,this._hitTest=!1,this._intersectTest=!1,this.invalidate(!0)},Oe.ext("twaver.vector.ElementUI",Object,{getElement:function(){return this._element},getNetwork:function(){return this._network},handlePropertyChange:function(t){},handleSelectionChange:function(t){},invalidate:function(t){t===e&&(t=!0),t&&(this._invalidateAttachmentsFlag=!0),this._invalidateFlag||(this._hotSpot=null,this._bodyRect=null,this._invalidateFlag=!0,this.invalidateZoom(),this.setAttachmentVisible&&this.setAttachmentVisible(!1))},invalidateZoom:function(){this._zoomBodyRect=null,this._zoomViewRect=null,this._zoomHotSpot=null},updateStyle:function(){this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._glowBlur=this._element.getStyle("glow.blur"),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this._wholeAlpha=this._element.getStyle("whole.alpha")},validate:function(){var t=this;if(0!=this._invalidateFlag){this._bodyBounds.clear(),this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this.updateStyle(),this.validateImpl(),this._attachments.forEach(function(t){t.validate()});var e;this._bodyBounds.forEach(function(t){e=Ze.unionRect(e,t)}),null==e&&(e=Oe.cloneRect(this._element.getLocation()),e.width=0,e.height=0),this._unionBodyBounds={x:e.x,y:e.y,width:e.width,height:e.height},this._attachments.forEach(function(i){e=i instanceof Me.vector.EditAttachment?i.getElementUI()instanceof Me.vector.LinkUI?Ze.unionRect(e,i._viewRect):Ze.unionRect(e,t._network.zoomManager._reverseElementZoomRect(t,i._viewRect)):i.getElementUI()instanceof Me.vector.LinkUI?Ze.unionRect(e,t._network.zoomManager._getAttachmentZoomOutLineRect(i,i._viewRect)):i.getElementUI()instanceof Me.vector.GroupUI&&i.getElementUI()._shapeRect?i instanceof Me.vector.IconsAttachment?Ze.unionRect(e,i._viewRect):Ze.unionRect(e,t._network.zoomManager._getAttachmentZoomOutLineRect(i,i._viewRect)):Ze.unionRect(e,i._viewRect)}),this._viewRect=e}},validateImpl:function(){},setGlow:function(t,e){"glow"===this._element.getStyle("outer.style")&&(e.shadowColor=this._outerColor,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=this._glowBlur)},clearGlow:function(t){(0!=t.shadowOffsetX||0!=t.shadowOffsetY||0!=t.shadowBlur)&&(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0)},setShadow:function(t,e){var i=this._network.zoomManager,n=t.isShadowable()&&this._shadowColor&&!this._editAttachment;if(e.shadowOffsetX===this._shadowXOffset&&e.shadowOffsetY===this._shadowYOffset&&e.shadowBlur===this._shadowBlur)return e;if(n||this._network._showShadowInEdit){var o=i.getGraphicsZoom(),s=i.getSizeZoom();o*=s,o>1&&(o=1),e.shadowOffsetX=this._shadowXOffset*o,e.shadowOffsetY=this._shadowYOffset*o,e.shadowBlur=this._shadowBlur*o,e.shadowColor=this._shadowColor}return e},clearShadow:function(t){(0!=t.shadowOffsetX||0!=t.shadowOffsetY||0!=t.shadowBlur)&&(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0)},appendShadowBound:function(t,e){var i=t.isShadowable()&&this._shadowColor&&!this._editAttachment;if(i){var n=this._network.zoomManager,o=n.getGraphicsZoom(),s=n.getSizeZoom();o*=s,o>1&&(o=1),this._shadowXOffset>0?e.width+=this._shadowXOffset:(e.x+=this._shadowXOffset,e.width+=-this._shadowXOffset),this._shadowYOffset>0?e.height+=this._shadowYOffset:(e.y+=this._shadowYOffset,e.height+=-this._shadowYOffset);var a=this._shadowBlur;a=Math.ceil(a/o),Ze.grow(e,a+1,a+1)}return e},appendGlowBound:function(t,e){if("glow"===this._element.getStyle("outer.style")){var i=this._network.zoomManager,n=i.getGraphicsZoom(),o=i.getSizeZoom();n*=o,n>1&&(n=1);var s=this._glowBlur;s=Math.ceil(s/n),Ze.grow(e,s+1,s+1)}},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&"shadow"===this._element.getStyle("select.style")?!0:!1},addAttachment:function(t){this._attachments.add(t),this.invalidate(!1)},removeAttachment:function(t){this._attachments.remove(t),this.invalidate(!1)},getAttachments:function(){return this._attachments},checkAttachments:function(){this.checkLabelAttachment(),this.checkLabel2Attachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var t=this._network.getLabel(this._element);null!=t&&""!==t?this._labelAttachment||(this._labelAttachment=new Me.vector.LabelAttachment(this,Rn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkLabel2Attachment:function(){var t=this._network.getLabel2(this._element);null!=t&&""!==t?this._label2Attachment||(this._label2Attachment=new Me.vector.Label2Attachment(this,Rn.SHOW_LABEL2_IN_ATTACHMENT_DIV),this.addAttachment(this._label2Attachment)):this._label2Attachment&&(this.removeAttachment(this._label2Attachment),this._label2Attachment=null)},checkAlarmAttachment:function(){var t=this._network.getAlarmLabel(this._element);null!=t&&""!==t?this._alarmAttachment||(this._alarmAttachment=new Me.vector.AlarmAttachment(this,Rn.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var t=this._network.getIconsNames(this._element);t&&t.length>0?this._iconsAttachment||(this._iconsAttachment=new Me.vector.IconsAttachment(this,Rn.SHOW_ICON_IN_ATTACHMENT_DIV),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)&&this.isEditable()?this._editAttachment||(this._editAttachment=new Me.vector.EditAttachment(this,Rn.SHOW_EDIT_IN_ATTACHMENT_DIV),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},isEditable:function(){return!0},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getDyeColor:function(t){return this._innerColor?this._innerColor:this.getStyle(t)},getStyle:function(t){return this._element.getStyle(t)},getFont:function(t){var e=this._element.getStyle(t);return e?e:Me.Defaults.FONT},paint:function(t){t.save(),t.globalAlpha=this._wholeAlpha,t.beginPath(),this.paintBody(t),this.clearShadow(t),this.clearGlow(t),t.closePath(),t.beginPath(),this.paintAttachments(t),t.closePath(),t.restore(),this._network._debug&&Ke.strokeRect(t,this.getZoomBodyRect(),"orange")},paintBody:function(t){},getZoomBodyRect:function(t){return this._network.zoomManager._getElementZoomRect(this,this.getBodyRect())},getZoomHotSpot:function(){return this._zoomHotSpot||(this._zoomHotSpot=this._network.zoomManager._getZoomHotSpot(this,this._hotSpot)),Oe.clone(this._zoomHotSpot)},getZoomPointers:function(t,e){return this._network.zoomManager._getZoomPointers(t,this,e)},_getZoomViewRect:function(t,e,i){var n=this._network.zoomManager;if(e){var o=Oe.cloneRect(n._getAttachmentZoomRect(e,t));return o}var s=n.getLocationZoom(),a=n.getSizeZoom(this),r=this._bodyRect?this._bodyRect:this.getBodyRect();t=t||{x:r.x,y:r.y,width:0,height:0};var h=r.x+r.width/2,l=r.y+r.height/2;return{x:h*s+(t.x-h)*a,y:l*s+(t.y-l)*a,width:t.width*a,height:t.height*a}},getZoomViewRect:function(t){{var e=this._network.zoomManager,i=e.getLocationZoom();e.getGraphicsZoom()}if(1==i)return Oe.cloneRect(this._viewRect);if(!this._zoomViewRect||t){var n,o=this._getZoomViewRect(Oe.cloneRect(this._unionBodyBounds),!1);n=Ze.unionRect(n,o);this._attachments.forEach(function(t){n=t instanceof Me.vector.EditAttachment?Ze.unionRect(n,t._viewRect):Ze.unionRect(n,t.getZoomViewRect())}),this._zoomViewRect=n}return Oe.cloneRect(this._zoomViewRect)},paintAttachments:function(t){t.beginPath();for(var e=this._attachments.size(),i=0;e>i;i++){var n=this._attachments.get(i);(this._network.isShowAttachOnChg()||this._network.isVisibleAttachment(n))&&(1==this._hitTest&&0==n.isShowOnTop()&&this.paintAttachment(t,n),1==this._intersectTest&&this.paintAttachment(t,n),0==this._hitTest&&0==this._intersectTest&&(n.isShowOnTop()?this._network._topAttachmentList.add(n):this.paintAttachment(t,n)))}},paintAttachment:function(t,e){var i=this._network.zoomManager;i.isAttachmentVisible(this._element)&&(e!=this._labelAttachment&&e!=this._label2Attachment||i.isLabelVisible(this._element))&&(e!=this._alarmAttachment||i.isAlarmBalloonVisible(this._element))&&(t.beginPath(),e.paint(t),this.clearShadow(t))},getViewRect:function(){return Oe.cloneRect(this._viewRect)},getUnionBodyBounds:function(){return Oe.cloneRect(this._unionBodyBounds)},addBodyBounds:function(t){t&&this._bodyBounds.add(t)},getBodyRect:function(t){return t==e&&(t=!0),this._bodyRect||(this._bodyRect=this.createBodyRect()),t?Oe.cloneRect(this._bodyRect):this._bodyRect},getHotSpot:function(){return this._hotSpot?Oe.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(t){this._hotSpot=t},hit:function(t,e){return!1},intersects:function(t){return Ze.contains(t,this.getZoomViewRect())?!0:!1},hitCanvasRectAtBody:function(t){var e=Hn.getHitCanvas(t.width,t.height),i=Hn.getCtx(e);if(i.save(),i.translate(-t.x,-t.y),this._element.getImage){var n=Oe.getImageAsset(this._element.getImage());if(n&&n.getImage()instanceof On)return 1}this.paintBody(i);try{for(var o=i.getImageData(0,0,t.width,t.height),s=o.data,a=0;a<o.width;a++)for(var r=0;r<o.height;r++){var h=4*(r*o.width+a),l=s[h+3];if(0!==l)return i.restore(),1}}catch(e){if(Hn.disposeHitCanvas(),Ze.contains(this.getUnionBodyBounds(),t))return 0}return i.restore(),-1},hitCanvasRectAtAttachments:function(t){var e=Hn.getHitCanvas(t.width,t.height),i=Hn.getCtx(e);i.save(),i.translate(-t.x,-t.y),this.paintAttachments(i);try{for(var n=i.getImageData(0,0,t.width,t.height),o=n.data,s=0;s<n.width;s++)for(var a=0;a<n.height;a++){var r=4*(a*n.width+s),h=o[r+3];if(0!==h)return i.restore(),1}}catch(t){Hn.disposeHitCanvas()}return i.restore(),-1},hitCanvasRect:function(t){this._intersectTest=!0,1==this._hitTest&&(this._intersectTest=!1);var e=Ze.intersection(t,this.getZoomViewRect()),i=this.hitCanvasRectAtBody(e);if(1==i)return this._intersectTest=!1,!0;var n=this.hitCanvasRectAtAttachments(e);return 1==n?(this._intersectTest=!1,!0):(this._intersectTest=!1,0==i)},hitCanvasPoint:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();if(n&&n>0&&Ze.grow(i,n,n),!Ze.intersects(this.getZoomViewRect(),i))return!1;this._hitTest=!0;var o=this.hitCanvasRect(i);return this._hitTest=!1,o},hitTest:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();if(n&&n>0&&Ze.grow(i,n,n),!Ze.intersects(this.getZoomViewRect(),i))return null;for(var o=Ze.intersection(i,this.getZoomViewRect()),s=this._attachments.size(),a=0;s>a;a++){var r=this._attachments.get(a);if(r.hit(t,e))return r}var h=this.hitCanvasRectAtBody(o);return 1==h?this:0==h?this:null},dispose:function(){this._attachments.forEach(function(t){t.dispose()}),this._attachments.clear()}}),Me.vector.NodeUI=function(t,e){Me.vector.NodeUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.vector.NodeUI",Me.vector.ElementUI,{invalidate:function(t){this.curInterval&&clearInterval(this.curInterval),Me.vector.NodeUI.superClass.invalidate.call(this,t)},createBodyRect:function(){return this._element.getRect()},validateImpl:function(){Me.vector.NodeUI.superClass.validateImpl.call(this);var t=this.getStyle("vector.shape"),e=this.getBodyRect();this._hotSpot=Ze.getHotSpot(e.x,e.y,e.width,e.height,t),this.validateBodyBounds()},validate:function(){0!=this._invalidateFlag&&Me.vector.NodeUI.superClass.validate.call(this)},validateBodyBounds:function(){var t=this.getStyle("body.type");"default"===t?this.addBodyBounds(this.getDefaultBodyRect()):"vector"===t?this.addBodyBounds(this.getVectorBody()):"default.vector"===t?(this.addBodyBounds(this.getVectorBody()),this.addBodyBounds(this.getDefaultBodyRect())):"vector.default"===t&&(this.addBodyBounds(this.getDefaultBodyRect()),this.addBodyBounds(this.getVectorBody())),this._outerColor&&"border"===this.getStyle("outer.style")&&this.addBodyBounds(this.getOuterBorderRect()),!this._editAttachment&&"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.addBodyBounds(this.getSelectBorderRect())},getDefaultBodyRect:function(){var t=this._element,e=this.getBodyRect();if(!t.getImage()||"string"==typeof t.getImage()&&!Oe.getImageAsset(t.getImage()))return e;Ze.addPadding(e,this._element,"image.padding",1);var i=Oe.cloneRect(e);return this.appendGlowBound(this,i),this.appendShadowBound(this,i),e=i},getVectorBody:function(){var t=this.getPathRect("vector");return t},getOuterBorderRect:function(){return this._getBorderRect("outer")},getSelectBorderRect:function(){return this._getBorderRect("select")},_getBorderRect:function(t){var e=this._element,i=e.getStyle(t+".width"),n=e.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();if(i>0){i="select"===t?i/n:i;var o=this.getBodyRect();Ze.addPadding(o,e,t+".padding","select"===t?1/n:1);var s=Oe.cloneRect(o);return Ze.grow(s,2*i,2*i),s}return null},getPathRect:function(t,e){{var i=this._element,n=this.getBodyRect();this._network.zoomManager.getSizeZoom()}e&&Ze.addPadding(n,i,t+".padding",1);var o=Oe.cloneRect(n),s=i.getStyle(t+".outline.width");if(s>0)if(this._getZoomPoints){for(var a=this._element._points,r=a.size(),h=0,l=0;r>l;l++){if(0==l)var c=a.get(l),d=a.get(r-1),u=a.get(l+1);else if(l==r-1)var c=a.get(l),d=a.get(l-1),u=a.get(0);else var c=a.get(l),d=a.get(l-1),u=a.get(l+1);var _=Ze.getCenterPoint(d,u),g=Ze.getAngle(_,c),f=Math.abs(5*(s+1)*Math.sin(g));h=f>h?f:h,f=Math.abs(5*(s+1)*Math.cos(g)),h=f>h?f:h}Ze.grow(o,h,h)}else Ze.grow(o,s/2,s/2);return this.appendGlowBound(this,o),this.appendShadowBound(this,o),o},getZoomPathRect:function(t,e){{var i=this._element,n=this.getZoomBodyRect();this._network.zoomManager.getSizeZoom()}e&&Ze.addPadding(n,i,t+".padding",1);var o=Oe.cloneRect(n),s=i.getStyle(t+".outline.width");if(s>0)if(this._getZoomPoints){for(var a=this._getZoomPoints(),r=a.size(),h=0,l=0;r>l;l++){if(0==l)var c=a.get(l),d=a.get(r-1),u=a.get(l+1);else if(l==r-1)var c=a.get(l),d=a.get(l-1),u=a.get(0);else var c=a.get(l),d=a.get(l-1),u=a.get(l+1);var _=Ze.getCenterPoint(d,u),g=Ze.getAngle(_,c),f=Math.abs(5*(s+1)*Math.sin(g));h=f>h?f:h,f=Math.abs(5*(s+1)*Math.cos(g)),h=f>h?f:h}Ze.grow(o,h,h)}else Ze.grow(o,s/2,s/2);return this.appendGlowBound(this,o),this.appendShadowBound(this,o),o},paintBody:function(t){this.curInterval&&clearInterval(this.curInterval);var e=this.getStyle("body.type");"default"===e?this.drawDefaultBody(t):"vector"===e?this.drawVectorBody(t):"default.vector"===e?(this.drawVectorBody(t),this.drawDefaultBody(t)):"vector.default"===e&&(this.drawDefaultBody(t),this.drawVectorBody(t)),this._outerColor&&"border"===this.getStyle("outer.style")&&this.drawOuterBorder(t),"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.drawSelectBorder(t)},drawOuterBorder:function(t){var e=this._element,i=e.getStyle("outer.width");if(i>0){var n=this.getZoomBodyRect();Ze.addPadding(n,e,"outer.padding",1),t.lineWidth=i,t.lineCap=e.getStyle("outer.cap"),t.lineJoin=e.getStyle("outer.join"),t.strokeStyle=this._outerColor,Ke.drawVector(t,e.getStyle("outer.shape"),null,n),t.stroke()}},drawDefaultBody:function(t){var e,i=this._element;if(i.getImage()&&("string"!=typeof i.getImage()||(e=Oe.getImageAsset(i.getImage())))&&(!this._shapeRect||i.getStyle("group.expend.image")&&("string"!=typeof i.getStyle("group.expend.image")||(e=Oe.getImageAsset(i.getStyle("group.expend.image")))))){var n=this.getZoomBodyRect();Ze.addPadding(n,this._element,"image.padding",1),0!=i.getAngle()&&(t.save(),n=i.getOriginalRect(),n=this._network.zoomManager._getElementZoomRect(this,n),Me.Util.rotateCanvas(t,n,i.getAngle())),this.setGlow(this,t),this.setShadow(this,t);if(e&&e.getImage()instanceof On){var o,s=e.getImage().frames,a=e.getImage().size,r=0;o=Nn(s,a,0),t.drawImage(o,n.x,n.y,n.width,n.height),this.curInterval=setInterval(function(){r=(r+s.length)%s.length,o=Nn(s,a,r),t.drawImage(o,n.x,n.y,n.width,n.height),r++},100)}else this._shapeRect?Vi(t,i.getStyle("group.expend.image"),this.getInnerColor(),n,i,this._network):Vi(t,i.getImage(),this.getInnerColor(),n,i,this._network);0!=i.getAngle()&&t.restore()}},drawSelectBorder:function(t){this.clearGlow(t);var e=this._element,i=e.getStyle("select.width");if(i>0){var n=this.getZoomBodyRect();n=Oe.cloneRect(n);var o=e.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();Ze.addPadding(n,e,"select.padding",1/o),Ze.grow(n,i/2/o,i/2/o),t.lineWidth=i/o,t.lineCap=e.getStyle("select.cap"),t.lineJoin=e.getStyle("select.join"),t.strokeStyle=e.getStyle("select.color"),Ke.drawVector(t,e.getStyle("select.shape"),null,n),t.stroke()}},drawVectorBody:function(t){this.drawPath(t,"vector",!0,this._element.getStyle("vector.outline.pattern"));var e=this.getStyle("vector.deep"),i=this.getStyle("vector.fill.color");if(0!==e&&i&&"rectangle"===this.getStyle("vector.shape")){var n=this.getZoomBodyRect(),o=this._element.getAngle();if(0!=o){t.save();var s=this._element.getOriginalRect();s=this._network.zoomManager._getElementZoomRect(this,s),Me.Util.rotateCanvas(t,s,o)}Ke.draw3DRect(t,i,e,n),0!=o&&t.restore()}},drawPath:function(t,e,i,n,o,s,a){var r=this._network.zoomManager,h=this._element,l=null;l="group"==e?this._shapeRect:this.getZoomBodyRect(),i&&Ze.addPadding(l,h,e+".padding",1);var c=h.getStyle(e+".outline.width");this.setGlow(this,t),this.setShadow(this,t),0!=h.getAngle()&&(h instanceof Un||(l=h.getOriginalRect(),l=r._getElementZoomRect(this,l)),t.save(),Me.Util.rotateCanvas(t,l,h.getAngle()));var d,u=h.getStyle(e+".fill");if(u){d=this._innerColor&&!xi.hasDefault(this._element)?this._innerColor:h.getStyle(e+".fill.color");var _=h.getStyle(e+".gradient");_?Ke.fill(t,d,_,h.getStyle(e+".gradient.color"),l):t.fillStyle=d}var g=h.getStyle(e+".shape"),f=h.getStyle("group.shape.roundrect.radius");u&&(t.beginPath(),o?Ke.drawLinePoints(t,o,null,s,a):"roundrect"===g&&"group"===e?Ke.drawVector(t,g,null,l,f):Ke.drawVector(t,g,null,l),t.fill()),c>0&&(t.lineWidth=c,t.lineCap=h.getStyle(e+".cap"),t.lineJoin=h.getStyle(e+".join"),t.strokeStyle=h.getStyle(e+".outline.color"),t.beginPath(),o?Ke.drawLinePoints(t,o,n,s,a):"roundrect"===g&&"group"===e?Ke.drawVector(t,g,n,l,f):Ke.drawVector(t,g,n,l),t.stroke()),0!=h.getAngle()&&t.restore()},hit:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();if(n&&n>0&&Ze.grow(i,n,n),this._network._transparentSelectionEnable){var o=this.getBodyRect();if(Oe.math.intersects(o,i))return!0}return Ze.intersects(this.getZoomViewRect(),i)?this.hitCanvasPoint(t,e):!1},intersects:function(t){var e=Me.vector.NodeUI.superClass.intersects.apply(this,arguments);if(1==e)return!0;if(this._network._transparentSelectionEnable){var i=this.getBodyRect();if(Oe.math.intersects(i,t))return!0}return Ze.intersects(t,this.getZoomViewRect())?this.hitCanvasRect(t):!1}}),Me.vector.LinkUI=function(t,e){Me.vector.LinkUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.vector.LinkUI",Me.vector.ElementUI,{isEditable:function(){return!0},invalidate:function(t){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,this._angle=null,Me.vector.LinkUI.superClass.invalidate.call(this,t)},invalidateZoom:function(){this._fromPoint=null,this._toPoint=null,this._linkPoints=null,Me.vector.LinkUI.superClass.invalidateZoom.call(this)},validateImpl:function(){this.validateBodyBounds(),Me.vector.LinkUI.superClass.validateImpl.call(this)},validateBodyBounds:function(){var t=this.getLinkPoints();if(t&&!(t.size()<2)){var e=this._element,i=Ze.getLineRect(t),n=e.getStyle("link.width"),o=n;if(this._outerColor){var s=e.getStyle("outer.width");o+=2*s}var a=!this._editAttachment&&"border"===e.getStyle("select.style")&&this._network.isSelected(this._element);if(a){var r=e.getStyle("select.width");o+=2*r}Ze.grow(i,o/2,o/2),e.getStyle("arrow.from")&&(this._network._edgeDetect?(this._network._debug&&(this._arrowFromRect=vn.getArrowRect(this,t,!0,e.getStyle("arrow.from.shape"),e.getStyle("arrow.from.width"),e.getStyle("arrow.from.height"),0,0,this._network.zoomManager)),i=Ze.unionRect(i,vn.getArrowRect(this,t,!0,e.getStyle("arrow.from.shape"),e.getStyle("arrow.from.width"),e.getStyle("arrow.from.height"),0,0,this._network.zoomManager))):(this._network._debug&&(this._arrowFromRect=vn.getArrowRect(this,t,!0,e.getStyle("arrow.from.shape"),e.getStyle("arrow.from.width"),e.getStyle("arrow.from.height"),e.getStyle("arrow.from.xoffset"),e.getStyle("arrow.from.yoffset"),this._network.zoomManager)),i=Ze.unionRect(i,vn.getArrowRect(this,t,!0,e.getStyle("arrow.from.shape"),e.getStyle("arrow.from.width"),e.getStyle("arrow.from.height"),e.getStyle("arrow.from.xoffset"),e.getStyle("arrow.from.yoffset"),this._network.zoomManager)))),e.getStyle("arrow.to")&&(this._network._edgeDetect?(this._network._debug&&(this._arrowToRect=vn.getArrowRect(this,t,!1,e.getStyle("arrow.to.shape"),e.getStyle("arrow.to.width"),e.getStyle("arrow.to.height"),0,0,this._network.zoomManager)),i=Ze.unionRect(i,vn.getArrowRect(this,t,!1,e.getStyle("arrow.to.shape"),e.getStyle("arrow.to.width"),e.getStyle("arrow.to.height"),0,0,this._network.zoomManager))):(this._network._debug&&(this._arrowToRect=vn.getArrowRect(this,t,!1,e.getStyle("arrow.to.shape"),e.getStyle("arrow.to.width"),e.getStyle("arrow.to.height"),e.getStyle("arrow.to.xoffset"),e.getStyle("arrow.to.yoffset"),this._network.zoomManager)),i=Ze.unionRect(i,vn.getArrowRect(this,t,!1,e.getStyle("arrow.to.shape"),e.getStyle("arrow.to.width"),e.getStyle("arrow.to.height"),e.getStyle("arrow.to.xoffset"),e.getStyle("arrow.to.yoffset"),this._network.zoomManager)))),this.appendShadowBound(this,i),this.addBodyBounds(i),this._growLinkJoinBounds(i,o)}},_growLinkJoinBounds:function(t,e){},createBodyRect:function(){var t=this.getHotSpot();return t?{x:t.x-1,y:t.y-1,width:2,height:2}:null},paintBody:function(t){var e=this.getLinkPoints();if(e&&!(e.size()<2)){var i=this._element,n=i.isBundleAgent()&&i.getStyle("link.agent"),o=i.getStyle(n?"link.agent.width":"link.width"),s=o;if(this._outerColor&&"border"===this.getStyle("outer.style")){var a=i.getStyle("outer.width");s+=2*a}var r=!this._editAttachment&&"border"===i.getStyle("select.style")&&this._network.isSelected(this._element);if(r){var h=i.getStyle("select.width");s+=2*h}this.setGlow(this,t),this.setShadow(this,t),t.lineCap=i.getStyle(n?"link.agent.cap":"link.cap"),t.lineJoin=i.getStyle(n?"link.agent.join":"link.join");var l=i.getStyle(n?"link.agent.pattern":"link.pattern");r&&this.drawLinePoints(t,e,s,i.getStyle("select.color"),l),this._outerColor&&"border"===this.getStyle("outer.style")&&this.drawLinePoints(t,e,o+2*a,this._outerColor,l),this.drawLinePoints(t,e,o,this._innerColor||i.getStyle(n?"link.agent.color":"link.color"),l),vn.drawLinkArrow(this,t,e,this._network.zoomManager),this._network._debug&&(Ke.strokeRect(t,this._arrowToRect,Me.Util.randomColor()),Ke.strokeRect(t,this._arrowFromRect,Me.Util.randomColor()))}},drawLinePoints:function(t,e,i,n,o){t.lineWidth=i,t.strokeStyle=n;var s=this._element.isBundleAgent()&&this._element.getStyle("link.agent");if(this._element.getStyle(s?"link.agent.flow":"link.flow")===!0&&o&&o.length>1){var a=new Ai(t,o[0],o[1]),r=this._element.getStyle(s?"link.agent.flow.offset":"link.flow.offset"),h=Math.floor(r/(o[0]+o[1]));h>2&&(r-=(o[0]+o[1])*h),this._element.getStyle(s?"link.agent.flow.converse":"link.flow.converse")?r<o[0]?a.overflow=o[0]-r:r>=o[0]&&r<=o[0]+o[1]?(a.overflow=o[1]-(r-o[0]),a.overflow&&(a.isLine=!1)):(r-=o[0]+o[1],a.overflow=o[0]-r):r<=o[1]?(a.overflow=r,r&&(a.isLine=!1)):r>o[1]&&r<=o[0]+o[1]?a.overflow=r-o[1]:(r-=o[0]+o[1],r&&(a.isLine=!1),a.overflow=r),this._element._styleMap[s?"link.agent.flow.offset":"link.flow.offset"]=r,t.beginPath(),Ke._drawLine(e,t),t.stroke(),t.shadowColor="transparent",t.beginPath();var l=this._element.getStyle(s?"link.agent.flow.color":"link.flow.color");l=l?l:Rn.NETWORK_LINK_FLOW_COLOR,t.strokeStyle=l,Ke._drawLine(e,a),t.stroke(),t.shadowColor=this._shadowColor}else t.beginPath(),Ke.drawLinePoints(t,e,o),t.stroke()},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=Ze.calculateLineLength(this._linkPoints)),this._linkPoints},getFromPosition:function(t,e){var i=this.getFromPoint();return i?{x:i.x+t,y:i.y+e}:null},getToPosition:function(t,e){var i=this.getToPoint();return i?{x:i.x+t,y:i.y+e}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=Ti.createFromPoint(this,this._network.zoomManager)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=Ti.createToPoint(this,this._network.zoomManager)),this._toPoint},getZoomBodyRect:function(){return this.getBodyRect()},getZoomViewRect:function(){return this._viewRect},createLinkPoints:function(){var t=this._network.zoomManager,e=this.getStyle("link.type"),i=new Me.List;if(Ti.isOrthogonalOrFlexionalLink(this._element))i=Ti.orthogonalAndFlexional(this,e,t);else if(this._element.isLooped()){var n=this._network.getElementUI(this._element.getFromAgent());null!=n&&(this._hotSpot=Ti.fillLoopedPoints(this,n.getZoomBodyRect(),i))}else{if("arc"!==e&&"triangle"!==e&&"parallel"!==e)throw"Can not resolve link type '"+e+"'";var o=this.getFromPoint(),s=this.getToPoint();this._hotSpot=Ti.fillBundlePoints(this,e,o,s,i,t)}if(this._network._linkPathFunction){var a=this._network._linkPathFunction(this,i);a&&(i=a)}return i},checkAttachments:function(){Me.vector.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var t=this._network.getLinkHandlerLabel(this._element);null!=t&&""!==t?this._linkHandlerAttachment||(this._linkHandlerAttachment=new Me.vector.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getControlPoint:function(){return Ti.getControlPoint(this._element,this,this._network.zoomManager)},setControlPoint:function(t){if(t){var e=this.getStyle("link.type");if(Ti.hasControlPoint(e)){var i=Ti.getLinkSourceBounds(this,this._network.zoomManager),n=Ti.getLinkTargetBounds(this,this._network.zoomManager);Ti.setParamsByControlPoint(t,i,n,e,this._element)}}},getLineLength:function(){return this._lineLength},hit:function(t,e){var i={x:t,y:e,width:0,height:0},n=this._network.getSelectionTolerance();return n&&n>0&&Ze.grow(i,n,n),Ze.intersects(this._viewRect,i)?this.hitCanvasPoint(t,e):!1},intersects:function(t){var e=Me.vector.NodeUI.superClass.intersects.apply(this,arguments);if(1==e)return!0;if(0==Ze.intersects(t,this._viewRect))return!1;var i=this.getLinkPoints(),n=i.size();if(2==n)for(var o=0;n>o;o+=2){var s=i.get(o);if(n>o+1){var a=i.get(o+1);if(Hn.intersectsLine(s.x,s.y,a.x,a.y,t.x,t.y,t.width,t.height))return!0}}return this.hitCanvasRect(t)},getAngle:function(){return!this._angle&&this._fromPoint&&this._toPoint&&(this._angle=Ze.getAngle(this._fromPoint,this._toPoint)),this._angle||0},getAbsoluteAngle:function(){var t={x:10,y:0},e=this._fromPoint,i=this._toPoint,n={x:i.x-e.x,y:i.y-e.y},o=180*Math.acos((n.x*t.x+n.y*t.y)/(Math.sqrt(t.x*t.x+t.y*t.y)*Math.sqrt(n.x*n.x+n.y*n.y)))/Math.PI;return o=e.y<=i.y?o:360-o,o=o%360*Math.PI/180},appendShadowBound:function(t,e){var i=t.isShadowable()&&this._shadowColor&&!this._editAttachment;if(i){this._shadowXOffset>0?e.width+=this._shadowXOffset:(e.x+=this._shadowXOffset,e.width+=-this._shadowXOffset),this._shadowYOffset>0?e.height+=this._shadowYOffset:(e.y+=this._shadowYOffset,e.height+=-this._shadowYOffset);var n=this._shadowBlur;Ze.grow(e,n+1,n+1)}return e}}),Me.vector.GroupUI=function(t,e){Me.vector.GroupUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.vector.GroupUI",Me.vector.NodeUI,{isEditable:function(){return!this._element.isExpanded()},paintBody:function(t){this._shapeRect?this._element.getStyle("group.expend.image")?(Me.vector.GroupUI.superClass.paintBody.apply(this,arguments),this._element.getStyle("group.expend.image.vector")&&this.drawExpandedGroup(t)):this.drawExpandedGroup(t):Me.vector.GroupUI.superClass.paintBody.apply(this,arguments)},validateBodyBounds:function(){if(this.getBodyRect(),this._shapeRect){var t=this.getPathRect("group",!1),e=this.getStyle("group.deep");Ze.grow(t,e+1,e+1),this.addBodyBounds(t)}else Me.vector.GroupUI.superClass.validateBodyBounds.call(this)},getZoomBodyRect:function(){return this._element.isExpanded()?this.getBodyRect():Me.vector.GroupUI.superClass.getZoomBodyRect.call(this)},getZoomViewRect:function(){return this._element.isExpanded()?this.getViewRect():Me.vector.GroupUI.superClass.getZoomViewRect.call(this)},drawExpandedGroup:function(t){this.drawPath(t,"group",!1,this._element.getStyle("vector.outline.pattern"));var e=this.getStyle("group.deep"),i=this.getStyle("group.fill.color");0!==e&&i&&"rectangle"===this.getStyle("group.shape")&&Ke.draw3DRect(t,i,e,this._shapeRect)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var t=this._element,e=this._network;if(t.isExpanded()){t.getChildren().forEach(function(t){var i=e.getElementUI(t);i&&i.validate()});var i=this.getChildrenRects();if(!i.isEmpty()){var n=t.getStyle("group.shape"),o=Ge[n];if(!o)throw"Can not resolve group shape '"+n+"'";this._shapeRect=o(i)}}return this._shapeRect?(Ze.addPadding(this._shapeRect,t,"group.padding",1),this._shapeRect):Me.vector.GroupUI.superClass.createBodyRect.call(this)},appendShadowBound:function(t,e){var i=t.isShadowable()&&this._shadowColor&&!this._editAttachment;if(i){this._shadowXOffset>0?e.width+=this._shadowXOffset:(e.x+=this._shadowXOffset,e.width+=-this._shadowXOffset),this._shadowYOffset>0?e.height+=this._shadowYOffset:(e.y+=this._shadowYOffset,e.height+=-this._shadowYOffset);var n=this._shadowBlur;Ze.grow(e,n+1,n+1)}return e}}),Me.vector.ShapeNodeUI=function(t,e){Me.vector.ShapeNodeUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.vector.ShapeNodeUI",Me.vector.NodeUI,{getDefaultBodyRect:function(){return this._element._points.size()<2?null:this._reverseZoomPathRect()},drawDefaultBody:function(t){this._element._points.size()<2||(this.drawPath(t,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._getZoomPoints(),this._element._segments,this._element.getStyle("shapenode.closed")),vn.drawLinkArrow(this,t,Ze.getPointObject(this._element._points,this._element._segments)))},invalidateZoom:function(){this._zoomPoints=null,Me.vector.LinkUI.superClass.invalidateZoom.call(this)},_getZoomPoints:function(){return this._zoomPoints=this._network.zoomManager._getShapeNodeZoomPoints(this,this._element._points),this._zoomPoints},_reverseZoomPathRect:function(){return this._network.zoomManager._reverseElementZoomRect(this,this.getZoomPathRect("vector",!0))}}),Me.vector.ShapeLinkUI=function(t,e){Me.vector.ShapeLinkUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.vector.ShapeLinkUI",Me.vector.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var t=this.getFromPoint(),e=this.getToPoint(),i=new Me.List,n=this.getStyle("shapelink.type");i.add(t),null!=this._element._points&&i.addAll(this._network.zoomManager._getShapeLinkZoomPoints(this._element._points)),i.add(e);var o,s,a;if("lineto"===n);else if("quadto"===n){for(o=new Me.List(i.get(0)),s=1,pointCount=i.size();s<pointCount;s++)o.add(s<pointCount-1?new Me.List([i.get(s++),i.get(s)]):i.get(s));i=o}else if("cubicto"===n){for(o=new Me.List(i.get(0)),s=1,pointCount=i.size();s<pointCount;s++)o.add(s<pointCount-2?new Me.List([i.get(s++),i.get(s++),i.get(s)]):s<pointCount-1?new Me.List([i.get(s++),i.get(s)]):i.get(s));i=o}else{if("orthogonalto"!==n)throw"Can not resolve shapelink type '"+n+"'";for(a=i.get(0),o=new Me.List(a),s=1,pointCount=i.size();s<pointCount;s++)if(s<pointCount-1){var r=Oe.clone(i.get(s)),h=r.x,l=r.y,c=h-a.x,d=l-a.y;Math.abs(c)>Math.abs(d)?(r.x=h,r.y=a.y):(r.x=a.x,r.y=l),a=r,o.add(a)}else o.add(i.get(s));i=o}var u,_,g,r,f,c,d,v=Ze.calculateLineLength(i)/2,m=i.size(),p=0,y=0;for(u=0;m>u;u++)if(r=i.get(u),0!=u){if(g=r,g instanceof fn&&(g=g._as),g instanceof Array?(f=Ze.calculateCurveLength(_,g,1),_=g[g.length-1]):(d=r.y-_.y,c=r.x-_.x,f=Math.sqrt(c*c+d*d),_=g),y+=f,v>=p&&y>=v){var w=v-p,A=i.get(u-1);A instanceof fn&&(A=A._as,A instanceof Array&&(A=A[A.length-1]));var x=i.get(u),E=Ze.getPathInfo(x,A,w,0,-1).point;this._hotSpot=Oe.clone(E)}p=y}else _=r;return i},_growLinkJoinBounds:function(t,e){Ze.grow(t,3*e,3*e)}}),Me.vector.GridUI=function(t,e){Me.vector.GridUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.vector.GridUI",Me.vector.NodeUI,{drawDefaultBody:function(t){this._element.getImage()?Me.vector.GridUI.superClass.drawDefaultBody.apply(this,arguments):this.drawGridBody(t)},validateBodyBounds:function(){if(this._element.getImage())Me.vector.GridUI.superClass.validateBodyBounds.call(this);else{var t=this.getBodyRect(),e=Oe.clone(t),i=this._element.getStyle("outer.width");Ze.grow(e,i,i),this.appendShadowBound(this,e),this.addBodyBounds(e)}},_getZoomCellRect:function(t,e){var i=this._element.getCellRect(t,e),n=this._element.getRect(),o=n.x+n.width/2,s=n.y+n.height/2,a=this.getZoomBodyRect(),r=a.width/n.width,h=a.x+a.width/2,l=0==o?1:h/o;return{x:o*l+(i.x-o)*r,y:s*l+(i.y-s)*r,width:i.width*r,height:i.height*r}},drawGridBody:function(t){var e=this.getStyle("grid.fill"),i=this.getStyle("grid.deep"),n=this.getStyle("grid.cell.deep");if(e||0!==i||0!==n){t.beginPath();var o=this.getZoomBodyRect(),s=this.getDyeColor("grid.fill.color");if(this.setGlow(this,t),this.setShadow(this,t),e&&(t.fillStyle=s,t.rect(o.x,o.y,o.width,o.height),t.fill()),t.closePath(),this.clearShadow(t),t.beginPath(),0!=i&&Ke.draw3DRect(t,s,i,o.x,o.y,o.width,o.height),t.closePath(),0!=n)for(var a=this.getStyle("grid.row.count"),r=this.getStyle("grid.column.count"),h=0;a>h;h++)for(var l=0;r>l;l++){var c=this._getZoomCellRect(h,l);null!=c&&(t.beginPath(),Ke.draw3DRect(t,s,n,c.x,c.y,c.width,c.height),t.closePath())}}}}),Me.vector.RotatableNodeUI=function(t,e){Me.vector.RotatableNodeUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.vector.RotatableNodeUI",Me.vector.NodeUI,{isEditable:function(){return!1},getDefaultBodyRect:function(){var t=this._element,e=Oe.getImageAsset(t.getImage()),i=this.getBodyRect();return e?(Ze.addPadding(i,this._element,"image.padding",1),i):i},drawDefaultBody:function(t){var e=this._element,i=Oe.getImageAsset(e.getImage());if(i){var n=this.getBodyRect();if(Ze.addPadding(n,this._element,"image.padding",1),i.getImage()){var o=this._element._getOrignalWidth(),s=this._element._getOrignalHeight(),a=this._element._getRotateRect();t.save(),t.translate(n.x-a.x+o/2,n.y-a.y+s/2),t.rotate(this._element._angle*Math.PI/180),t.drawImage(i.getImage(this._innerColor),-o/2,-s/2,o,s),t.restore()}else if(i.getSrc());else if(!i.getFunction())throw"ImageAsset '"+e.getImage()+" ' is empty"}}}),Me.vector.HTMLNodeUI=function(t,e){Me.vector.HTMLNodeUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.vector.HTMLNodeUI",Me.vector.NodeUI,{checkAttachments:function(){Me.vector.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var t=this._element.getStyle("attachment.label.style");if(t&&"none"===t)return void Me.vector.HTMLNodeUI.superClass.checkLabelAttachment.call(this);var e=this._network.getLabel(this._element);null!=e&&""!==e?this._labelAttachment||(this._labelAttachment=new Me.vector.HTMLLabelAttachment(this,Rn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkLabel2Attachment:function(){var t=this._element.getStyle("attachment.label2.style");if(t&&"none"===t)return void Me.vector.HTMLNodeUI.superClass.checkLabel2Attachment.call(this);var e=this._network.getLabel2(this._element);null!=e&&""!==e?this._label2Attachment||(this._label2Attachment=new Me.vector.HTMLLabel2Attachment(this,Rn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._label2Attachment)):this._label2Attachment&&(this.removeAttachment(this._label2Attachment),this._label2Attachment=null)},checkAlarmAttachment:function(){var t=this._element.getStyle("attachment.alarm.style");if(t&&"none"===t)return void Me.vector.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);var e=this._network.getAlarmLabel(this._element);null!=e&&""!==e?this._alarmAttachment||(this._alarmAttachment=new Me.vector.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},setAttachmentVisible:function(t){t?(this._labelAttachment&&this._labelAttachment.setVisibility("visible"),this._label2Attachment&&this._label2Attachment.setVisibility("visible"),this._alarmAttachment&&this._alarmAttachment.setVisibility("visible")):(this._labelAttachment&&this._labelAttachment.setVisibility("hidden"),this._label2Attachment&&this._label2Attachment.setVisibility("hidden"),this._alarmAttachment&&this._alarmAttachment.setVisibility("hidden"))},validateZIndex:function(t){this._labelAttachment&&this._labelAttachment.validateZIndex(t)}}),Me.vector.HTMLLinkUI=function(t,e){Me.vector.HTMLLinkUI.superClass.constructor.call(this,t,e)},Oe.ext("twaver.vector.HTMLLinkUI",Me.vector.LinkUI,{checkAttachments:function(){Me.vector.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var t=this._element.getStyle("attachment.label.style");if(t&&"none"===t)return void Me.vector.HTMLLinkUI.superClass.checkLabelAttachment.call(this);var e=this._network.getLabel(this._element);null!=e&&""!==e?this._labelAttachment||(this._labelAttachment=new Me.vector.HTMLLabelAttachment(this,Rn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkLabel2Attachment:function(){var t=this._element.getStyle("attachment.label2.style");if(t&&"none"===t)return void Me.vector.HTMLNodeUI.superClass.checkLabelAttachment.call(this);var e=this._network.getLabel2(this._element);null!=e&&""!==e?this._label2Attachment||(this._label2Attachment=new Me.vector.HTMLLabel2Attachment(this,Rn.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._label2Attachment)):this._label2Attachment&&(this.removeAttachment(this._label2Attachment),this._label2Attachment=null)},checkAlarmAttachment:function(){var t=this._element.getStyle("attachment.alarm.style");if(t&&"none"===t)return void Me.vector.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);var e=this._network.getAlarmLabel(this._element);null!=e&&""!==e?this._alarmAttachment||(this._alarmAttachment=new Me.vector.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},setAttachmentVisible:function(t){t?(this._labelAttachment&&this._labelAttachment.setVisibility("visible"),this._label2Attachment&&this._label2Attachment.setVisibility("visible"),this._alarmAttachment&&this._alarmAttachment.setVisibility("visible")):(this._labelAttachment&&this._labelAttachment.setVisibility("hidden"),this._label2Attachment&&this._label2Attachment.setVisibility("hidden"),this._alarmAttachment&&this._alarmAttachment.setVisibility("hidden"))}}),Me.vector.Attachment=function(t,e){this._ui=t,this._element=this._ui.getElement(),this._network=t.getNetwork(),this._showOnTop=e,e&&this._network._hitTestTopAttachmentList.add(this)},Oe.ext("twaver.vector.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},isShowOnTop:function(){return this._showOnTop===!0},setShowOnTop:function(t){this._showOnTop=t},getStyle:function(t){return this._ui.getStyle(t)},getFont:function(t){return this._ui.getFont(t)},getViewRect:function(){return Oe.clone(this._viewRect)},getAlpha:function(){return 1},validate:function(){},paint:function(t){},getZoomViewRect:function(){var t=this._network.zoomManager._getAttachmentZoomOutLineRect(this,this._viewRect);return t},hit:function(t,e){return Ze.containsPoint(this.getZoomViewRect(),t,e)?this.hitCanvasRect({x:t-1,y:e-1,width:2,height:2}):!1},hitCanvasRect:function(t){var e=Hn.getHitCanvas(t.width,t.height),i=Hn.getCtx(e);i.save(),i.translate(-t.x,-t.y),this.paint(i);try{for(var n=i.getImageData(0,0,t.width,t.height),o=n.data,s=0;s<n.width;s++)for(var a=0;a<n.height;a++){var r=4*(a*n.width+s),h=o[r+3];if(0!==h)return i.restore(),!0}}catch(t){Hn.disposeHitCanvas()}return i.restore(),!1},dispose:function(){this._network._hitTestTopAttachmentList.remove(this)},_rotatePoint:function(t,e,i){var n=Ze.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2),o=n.transform(t);return o},_rotatePointList:function(t,e,i){var n=this,o=new Me.List;return t.forEach(function(t){o.add(n._rotatePoint(t,e,i))}),o}}),Me.vector.BasicAttachment=function(t,e){Me.vector.BasicAttachment.superClass.constructor.call(this,t,e),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0}},Oe.ext("twaver.vector.BasicAttachment",Me.vector.Attachment,{paint:function(t){Me.vector.BasicAttachment.superClass.paint.apply(this,arguments);var e=this.isFill(),i=this.getOutlineWidth(),n=this._network.zoomManager._getAttachmentZoomOutLineRect(this,this._roundRect);if(this.getElementUI().setGlow(this,t),this.getElementUI().setShadow(this,t),i>0||e){if(Ke.drawRoundRect(t,n.x,n.y,n.width,n.height,this.getCornerRadius()),this._network._debug&&Ke.strokeRect(t,n,"#C71585"),this._pointers){var o=this._ui.getZoomPointers(this,this._pointers);t.moveTo(o[0].x,o[0].y),t.lineTo(o[1].x,o[1].y),t.lineTo(o[2].x,o[2].y)}if(t.closePath(),i>0&&(t.lineWidth=i,t.strokeStyle=this.getOutlineColor(),t.lineCap=this.getCap(),t.lineJoin=this.getJoin(),t.stroke()),e){var s=this.getFillColor(),a=this.getGradient();a?Ke.fill(t,s,a,this.getGradientColor(),this._viewRect):t.fillStyle=s,t.fill()}}},validate:function(){Me.vector.BasicAttachment.superClass.validate.call(this),this.calculateMeasure();var t=this.getOutlineWidth();(null==t||0>=t)&&(t=1),this._viewRect=Ze.getRect(this._pointers),this._viewRect=Ze.unionRect(this._viewRect,this._roundRect),t>0&&Ze.grow(this._viewRect,2*t,2*t),this._viewRect=this._ui.appendShadowBound(this,this._viewRect);var e=this._element instanceof Me.Link&&this._element.getStyle("link.label.rotatable");if(e){var i=this._viewRect.x+this._viewRect.width/2,n=this._viewRect.y+this._viewRect.height/2,o=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:i-o,y:n-o,width:2*o,height:2*o}}},calculateMeasure:function(){var t=this.getContentWidth(),e=this.getContentHeight(),i=this.getCornerRadius(),n=this.getPointerLength(),o=this.getPointerWidth(),s=this.getPosition(),a=this.getXOffset(),r=this.getYOffset(),h=this._roundRect;h.width=t+i,h.height=e;var l;if(this._ui._element instanceof Me.Link){var c,d=this._ui.getLinkPoints();c=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(a)>0&&Math.abs(a)<1?"from"===s?a*=c:"to"===s?a=c*(1-a):(a/=2,a+=.5,a*=c):"from"===s?a=a:"to"===s?a=c-a:a+=c/2;{var u,_=Ze.calculatePointInfoAlongLine(d,!0,a,r),g=_.point;_.angle}u="from"===s?this._ui.getFromPoint():"to"===s?this._ui.getToPoint():this._ui._hotSpot,a=g.x-u.x,r=g.y-u.y}if(n>0){var f=this.getDirection();l=this._network.getPosition(s,this._ui,null,a,r,!1);var v;if("aboveleft"===f)h.y=l.y-n-h.height,h.x=l.x-(h.width-i),v=Math.max(l.x-o,l.x-(h.width-i)+i/2),this._pointers=[l,{x:l.x,y:l.y-n},{x:v,y:l.y-n}];else if("aboveright"===f)h.y=l.y-n-h.height,h.x=l.x-i,v=Math.min(l.x+o,l.x-i+h.width-i/2),this._pointers=[l,{x:l.x,y:l.y-n},{x:v,y:l.y-n}];else if("belowleft"===f)h.y=l.y+n,h.x=l.x-(h.width-i),v=Math.max(l.x-o,l.x-(h.width-i)+i/2),this._pointers=[l,{x:l.x,y:l.y+n},{x:v,y:l.y+n}];else if("belowright"===f)h.y=l.y+n,h.x=l.x-i,v=Math.min(l.x+o,l.x-i+h.width-i/2),this._pointers=[l,{x:l.x,y:l.y+n},{x:v,y:l.y+n}];else if("leftabove"===f)h.y=l.y+i-h.height,h.x=l.x-n-h.width,v=Math.max(l.y-o,l.y+i-h.height+i/2),this._pointers=[l,{x:l.x-n,y:l.y},{x:l.x-n,y:v}];else if("leftbelow"===f)h.y=l.y-i,h.x=l.x-n-h.width,v=Math.min(l.y+o,l.y-i+h.height-i/2),this._pointers=[l,{x:l.x-n,y:l.y},{x:l.x-n,y:v}];else if("rightabove"===f)h.y=l.y+i-h.height,h.x=l.x+n,v=Math.max(l.y-o,l.y+i-h.height+i/2),this._pointers=[l,{x:l.x+n,y:l.y},{x:l.x+n,y:v}];else if("rightbelow"===f)h.y=l.y-i,h.x=l.x+n,v=Math.min(l.y+o,l.y-i+h.height-i/2),this._pointers=[l,{x:l.x+n,y:l.y},{x:l.x+n,y:v}];else if("above"===f)h.y=l.y-n-h.height,h.x=l.x-h.width/2,v=Math.min(t/2,o/2),this._pointers=[l,{x:l.x-v,y:l.y-n},{x:l.x+v,y:l.y-n}];else if("below"===f)h.y=l.y+n,h.x=l.x-h.width/2,v=Math.min(t/2,o/2),this._pointers=[l,{x:l.x-v,y:l.y+n},{x:l.x+v,y:l.y+n}];else if("left"===f)h.y=l.y-h.height/2,h.x=l.x-n-h.width,v=Math.min(e/2,o/2),this._pointers=[l,{x:l.x-n,y:l.y+v},{x:l.x-n,y:l.y-v}];else{if("right"!==f)throw"Can not resolve '"+f+"' attachment direction";h.y=l.y-h.height/2,h.x=l.x+n,v=Math.min(e/2,o/2),this._pointers=[l,{x:l.x+n,y:l.y+v},{x:l.x+n,y:l.y-v}]}}else l=this._network.getPosition(s,this._ui,{width:h.width,height:h.height},a,r,!1),h.x=l.x,h.y=l.y,this._pointers=null;this._contentRect.x=h.x+(h.width-t)/2,this._contentRect.y=h.y+(h.height-e)/2,this._contentRect.width=t,this._contentRect.height=e;var m=this.getPadding();0!=m&&Ze.grow(h,m,m),m=this.getPaddingLeft(),0!=m&&(h.x-=m,h.width+=m),m=this.getPaddingRight(),0!=m&&(h.width+=m),m=this.getPaddingTop(),0!=m&&(h.y-=m,h.height+=m),m=this.getPaddingBottom(),0!=m&&(h.height+=m),h.width<0&&(h.width=h.width,h.x-=h.width),h.height<0&&(h.height=-h.height,h.y-=h.height)},getContentWidth:function(){return Me.Defaults.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return Me.Defaults.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return Me.Defaults.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return Me.Defaults.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return Me.Defaults.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return Me.Defaults.ATTACHMENT_POSITION},getXOffset:function(){return Me.Defaults.ATTACHMENT_XOFFSET},getYOffset:function(){return Me.Defaults.ATTACHMENT_YOFFSET},getPadding:function(){return Me.Defaults.ATTACHMENT_PADDING},getPaddingLeft:function(){return Me.Defaults.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return Me.Defaults.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return Me.Defaults.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return Me.Defaults.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return Me.Defaults.ATTACHMENT_DIRECTION},isFill:function(){return Me.Defaults.ATTACHMENT_FILL},getFillColor:function(){return Me.Defaults.ATTACHMENT_FILL_COLOR},getGradient:function(){return Me.Defaults.ATTACHMENT_GRADIENT},getGradientColor:function(){return Me.Defaults.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return Me.Defaults.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return Me.Defaults.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return Me.Defaults.ATTACHMENT_CAP},getJoin:function(){return Me.Defaults.ATTACHMENT_JOIN},isShadowable:function(){return Me.Defaults.ATTACHMENT_SHADOWABLE},getRoundRect:function(){return Oe.clone(this._roundRect)},getContentRect:function(){return Oe.clone(this._contentRect)}}),Me.vector.LabelAttachment=function(t,e){Me.vector.LabelAttachment.superClass.constructor.call(this,t,e)},Oe.ext("twaver.vector.LabelAttachment",Me.vector.BasicAttachment,{paint:function(t){var e=this._element instanceof Me.Link&&this._element.getStyle("link.label.rotatable");if(e){t.save();var i=this.getZoomViewRect(),n=i.x+i.width/2,o=i.y+i.height/2;t.translate(n,o),t.rotate(this._network.getElementUI(this._element).getAngle()),t.translate(-n,-o)}Me.vector.LabelAttachment.superClass.paint.apply(this,arguments);var s=this._network.zoomManager,a=s._getAttachmentZoomRect(this,this._contentRect),r=this._element.getStyle("label.align"),h=this._element&&this._element.getStyle("label.rotate.angle");if(0!==h&&(t.save(),Me.Util.rotateCanvas(t,this._contentRect,h)),s._drawText(this,t,this.text,a,this.font,this.getStyle("label.color"),r),(e||0!==h)&&t.restore(),this._network._debug){var l=this._viewRect;Ke.strokeRect(t,l,"#AAABBB")}},validate:function(){this.font=this.getFont("label.font");var t=this.getLabel(),e=Oe.g.getTextSize(this.font,t),i=this.getMaxLength();0!==i&&e.width>i?(this.text=Oe.g.getCollapseTextInLength(this.font,t,i),this._textSize=Oe.g.getTextSize(this.font,this.text)):(this.text=t,this._textSize=e),Me.vector.LabelAttachment.superClass.validate.call(this);var n=this._viewRect,o=this._element&&this._element.getStyle("label.rotate.angle");if(0!==o){var s=new Me.List;s.add({x:n.x,y:n.y}),s.add({x:n.x+n.width,y:n.y}),s.add({x:n.x+n.width,y:n.y+n.height}),s.add({x:n.x,y:n.y+n.height}),s=this._rotatePointList(s,o,n);var a=Me.Util.getRect(s);this._viewRect=a}},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},getMaxLength:function(){return this.getStyle("label.maxlength")},isShadowable:function(){return this.getStyle("label.shadowable")}}),Me.vector.Label2Attachment=function(t,e){Me.vector.Label2Attachment.superClass.constructor.call(this,t,e)},Oe.ext("twaver.vector.Label2Attachment",Me.vector.BasicAttachment,{paint:function(t){var e=this._element instanceof Me.Link&&this._element.getStyle("link.label.rotatable");if(e){t.save();var i=this.getZoomViewRect(),n=i.x+i.width/2,o=i.y+i.height/2;t.translate(n,o),t.rotate(this._network.getElementUI(this._element).getAngle()),t.translate(-n,-o)}Me.vector.Label2Attachment.superClass.paint.apply(this,arguments);var s=this._network.zoomManager,a=s._getAttachmentZoomRect(this,this._contentRect),r=this._element.getStyle("label.align"),h=this._element&&this._element.getStyle("label2.rotate.angle");if(0!==h&&(t.save(),Me.Util.rotateCanvas(t,this._contentRect,h)),s._drawText(this,t,this.text,a,this.font,this.getStyle("label2.color"),r),(e||0!==h)&&t.restore(),this._network._debug){var l=s.getAttachmentSizeZoom(this),c=a;c.width*=l,c.height*=l,Ke.strokeRect(t,c,"#AAABBB")}},validate:function(){this.font=this.getFont("label2.font");var t=this.getLabel(),e=Oe.g.getTextSize(this.font,t),i=this.getMaxLength();0!==i&&e.width>i?(this.text=Oe.g.getCollapseTextInLength(this.font,t,i),this._textSize=Oe.g.getTextSize(this.font,this.text)):(this.text=t,this._textSize=e),Me.vector.LabelAttachment.superClass.validate.call(this);var n=this._viewRect,o=this._element&&this._element.getStyle("label2.rotate.angle");if(0!==o){var s=new Me.List;s.add({x:n.x,y:n.y}),s.add({x:n.x+n.width,y:n.y}),s.add({x:n.x+n.width,y:n.y+n.height}),s.add({x:n.x,y:n.y+n.height}),s=this._rotatePointList(s,o,n);var a=Me.Util.getRect(s);this._viewRect=a}},getLabel:function(){return this._network.getLabel2(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label2.corner.radius")},getPointerLength:function(){return this.getStyle("label2.pointer.length")},getPointerWidth:function(){return this.getStyle("label2.pointer.width")},getPosition:function(){return this.getStyle("label2.position")},getXOffset:function(){return this.getStyle("label2.xoffset")},getYOffset:function(){return this.getStyle("label2.yoffset")},getPadding:function(){return this.getStyle("label2.padding")},getPaddingLeft:function(){return this.getStyle("label2.padding.left")},getPaddingRight:function(){return this.getStyle("label2.padding.right")},getPaddingTop:function(){return this.getStyle("label2.padding.top")},getPaddingBottom:function(){return this.getStyle("label2.padding.bottom")},getDirection:function(){return this.getStyle("label2.direction")},isFill:function(){return this.getStyle("label2.fill")},getFillColor:function(){return this.getStyle("label2.fill.color")},getGradient:function(){return this.getStyle("label2.gradient")},getGradientColor:function(){return this.getStyle("label2.gradient.color")},getOutlineWidth:function(){return this.getStyle("label2.outline.width")},getOutlineColor:function(){return this.getStyle("label2.outline.color")},getCap:function(){return this.getStyle("label2.cap")},getJoin:function(){return this.getStyle("label2.join")},getAlpha:function(){return this.getStyle("label2.alpha")},getMaxLength:function(){return this.getStyle("label2.maxlength")},isShadowable:function(){return this.getStyle("label2.shadowable")}}),Me.vector.AlarmAttachment=function(t,e){Me.vector.AlarmAttachment.superClass.constructor.call(this,t,e)},Oe.ext("twaver.vector.AlarmAttachment",Me.vector.BasicAttachment,{paint:function(t){Me.vector.AlarmAttachment.superClass.paint.apply(this,arguments);var e=this._network.zoomManager,i=e._getAttachmentZoomRect(this,this._contentRect);e._drawText(this,t,this.text,i,this.font,this.getStyle("alarm.color"))},validate:function(){this.font=this.getFont("alarm.font"),this.text=this._network.getAlarmLabel(this._element),this._textSize=Ke.getTextSize(this.font,this.text),this._fillColor=this._network.getAlarmFillColor(this._element),Me.vector.AlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),Me.vector.LinkHandlerAttachment=function(t,e){Me.vector.LinkHandlerAttachment.superClass.constructor.call(this,t,e)},Oe.ext("twaver.vector.LinkHandlerAttachment",Me.vector.BasicAttachment,{paint:function(t){var e=this._network.zoomManager;Me.vector.LinkHandlerAttachment.superClass.paint.apply(this,arguments);var i=e._getAttachmentZoomRect(this,this._contentRect);e._drawText(this,t,this.linkHandlerLabel,i,this.linkHandlerFont,this.getStyle("link.handler.color"))},validate:function(){this.linkHandlerFont=this.getFont("link.handler.font"),this.linkHandlerLabel=this._network.getLinkHandlerLabel(this._element),this._textSize=Ke.getTextSize(this.linkHandlerFont,this.linkHandlerLabel),Me.vector.LinkHandlerAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),Me.vector.IconsAttachment=function(t,e){Me.vector.IconsAttachment.superClass.constructor.call(this,t,e)},Oe.ext("twaver.vector.IconsAttachment",Me.vector.Attachment,{isShadowable:function(){return Me.Defaults.ATTACHMENT_SHADOWABLE},validate:function(){if(Me.vector.IconsAttachment.superClass.validate.call(this),this.iconsNames=this._network.getIconsNames(this._element),this.iconsNames&&0!=this.iconsNames.length){var t=this._makeGroup(this.iconsNames),e=this._makeGroup(this._network.getIconsColors(this._element)),n=this._network.zoomManager;len=t.length,this.iconsOrientation=this._makeArray(this._element.getStyle("icons.orientation"),len,"right"),this.iconsPosition=this._makeArray(this._element.getStyle("icons.position"),len,"topleft.bottomright"),this.iconsXoffset=this._makeArray(this._element.getStyle("icons.xoffset"),len,0),this.iconsYoffset=this._makeArray(this._element.getStyle("icons.yoffset"),len,0),this.iconsXgap=this._makeArray(this._element.getStyle("icons.xgap"),len,1),this.iconsYgap=this._makeArray(this._element.getStyle("icons.ygap"),len,1),this.locations=[],this.iconsSizes=[],this.iconsOrientations=[];var o,s,a;for(i=0;i<len;i++){var r=t[i],a=this.iconsOrientation[i]||"right",h=this.iconsPosition[i]||"topleft.bottomright",l=this.iconsXgap[i]||1,c=this.iconsYgap[i]||1,d=this.iconsXoffset[i]||0,u=this.iconsYoffset[i]||0;if(this._ui._element instanceof Me.Link){var _,g=this._ui.getLinkPoints();_=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(d)>0&&Math.abs(d)<1?"from"===h?d*=_:"to"===h?d=_*(1-d):(d/=2,d+=.5,d*=_):"from"===h?d=d:"to"===h?d=_-d:d+=_/2;{var f,v=Ze.calculatePointInfoAlongLine(g,!0,d,u),m=v.point;v.angle}f="from"===h?this._ui.getFromPoint():"to"===h?this._ui.getToPoint():this._ui._hotSpot,d=m.x-f.x,u=m.y-f.y}s=null,o=this._getIconsSize(r,a,l,c,n),o&&(s=this._network.getPosition(h,this._ui,o,d,u),this._iconLocation=s,"top"===a?s.y+=o.height:"left"===a&&(s.x+=o.width)),this.locations.push(s),this.iconsSizes.push(o),this.iconsOrientations.push(a)}var p=null;for(i=0;i<this.locations.length;i++)s=this.locations[i],o=this.iconsSizes[i],a=this.iconsOrientations[i],null!=s&&(p=null==p?"top"===a?{x:s.x,y:s.y-o.height,width:o.width,height:o.height}:"left"===a?{x:s.x-o.width,y:s.y,width:o.width,height:o.height}:{x:s.x,y:s.y,width:o.width,height:o.height}:"top"===a?Ze.unionRect(p,{x:s.x,y:s.y-o.height,width:o.width,height:o.height}):"left"===a?Ze.unionRect(p,{x:s.x-o.width,y:s.y,width:o.width,height:o.height}):Ze.unionRect(p,{x:s.x,y:s.y,width:o.width,height:o.height}));this._viewRect=n?p||this.getElementUI().getViewRect():p||{x:this._element.getLocation().x,y:this._element.getLocation().y,width:0,height:0},this.iconsGroups=t,this.colorGroups=e;var y=this._element instanceof Me.Link&&this._element.getStyle("link.icons.rotatable");for(i=0;i<len;i++)if(y instanceof Array&&y[i]&&this._viewRect){var w=this._viewRect.x+this._viewRect.width/2,A=this._viewRect.y+this._viewRect.height/2,x=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:w-x/2,y:A-x/2,width:x,height:x}}}},_makeGroup:function(t){if(!Array.isArray(t))return[[t]];var e,i,n,o=[],s=!1,a=t.length;for(e=0;a>e;e++)i=t[e],Array.isArray(i)?(s=!0,o.push(i)):(n=[i],o.push(n));return s||(o.length=0,o.push(t)),o},_makeArray:function(t,e,i){if(Array.isArray(t))return t;for(var n=[],o=0;e>o;o++)n.push(t||i);return n},paint:function(t){if(Me.vector.IconsAttachment.superClass.paint.apply(this,arguments),this.iconsNames&&0!=this.iconsNames.length&&this.locations){var e,i,n,o,s,a,r,h,l,c,d=this._network.zoomManager;for(e=0;e<this.iconsGroups.length;e++)if(i=this.locations[e]){s=i.x,a=i.y,o=this.iconsGroups[e],r=this.colorGroups[e],h=this.iconsOrientation[e],l=this.iconsXgap[e]||1,c=this.iconsYgap[e]||1,n=0;for(var u in o){var _=null,g=null;r&&r.length>n&&(g=r[n++]);var f=Oe.getImageAsset(o[u]);if(null!=f){if(d&&this._ui instanceof Me.vector.GroupUI&&this._ui._shapeRect){var v=d.getAttachmentSizeZoom(this),m=f.getWidth()*v,p=f.getHeight()*v;if("right"===h)_={x:s,y:a,width:m,height:p},s+=_.width+l;else if("left"===h)_={x:s-m,y:a,width:m,height:p},s-=_.width+l;else if("top"===h)_={x:s,y:a-p,width:m,height:p},a-=_.height+c;else{if("bottom"!==h)throw"Can not resolve '"+h+"' orientation";_={x:s,y:a,width:m,height:p},a+=_.height+c}}else{if("right"===h)_={x:s,y:a,width:f.getWidth(),height:f.getHeight()},s+=_.width+l;else if("left"===h)_={x:s-f.getWidth(),y:a,width:f.getWidth(),height:f.getHeight()},s-=_.width+l;else if("top"===h)_={x:s,y:a-f.getHeight(),width:f.getWidth(),height:f.getHeight()},a-=_.height+c;else{if("bottom"!==h)throw"Can not resolve '"+h+"' orientation";_={x:s,y:a,width:f.getWidth(),height:f.getHeight()},a+=_.height+c}_=d._getAttachmentZoomOutLineRect(this,_)}var y=this._element instanceof Me.Link&&this._element.getStyle("link.icons.rotatable");if(y instanceof Array&&y[e]){t.save();var w=_,s=w.x+w.width/2,a=w.y+w.height/2;t.translate(s,a),t.rotate(this._network.getElementUI(this._element).getAbsoluteAngle()),t.translate(-s,-a),Vi(t,f.getImage(g,_.width,_.height),g,_,this._element,this._network),t.restore()}else Vi(t,f.getImage(g,_.width,_.height),g,_,this._element,this._network);if(this._network._debug){var _=this._viewRect;Ke.strokeRect(t,_,"#FCFC00",1),Ke.strokeRect(t,_,"#FCFC00",1)}}}}}},_getIconsSize:function(t,e,i,n,o){var s=0,a=0,r=null,h=null,l=null;for(var c in t)if(h=Oe.getImageAsset(t[c])){if("right"===e)r={x:s,y:a,width:h.getWidth(),height:h.getHeight()},s+=r.width+i;else if("left"===e)r={x:s-h.getWidth(),y:a,width:h.getWidth(),height:h.getHeight()},s-=r.width+i;else if("top"===e)r={x:s,y:a-h.getHeight(),width:h.getWidth(),height:h.getHeight()},a-=r.height+n;else{if("bottom"!==e)throw"Can not resolve '"+e+"' orientation";r={x:s,y:a,width:h.getWidth(),height:h.getHeight()},a+=r.height+n}l=null==l?Oe.clone(r):Ze.unionRect(l,r)}return l?o&&this._ui instanceof Me.vector.GroupUI&&this._ui._shapeRect?{width:Math.abs(l.width)*o.getAttachmentSizeZoom(this),height:Math.abs(l.height)*o.getAttachmentSizeZoom(this)}:{width:Math.abs(l.width),height:Math.abs(l.height)}:null}}),Me.vector.EditAttachment=function(t,e){Me.vector.EditAttachment.superClass.constructor.call(this,t,e)},Oe.ext("twaver.vector.EditAttachment",Me.vector.Attachment,{paint:function(t){Me.vector.EditAttachment.superClass.paint.apply(this,arguments),this.paintResizingPoints(t),this.paintEditPoints(t),this.paintRotatePoints(t)},paintResizingPoints:function(t){var e=this.resizingPoints.size();if(!(0>=e)){var i=this._element.getStyle("edit.physicalZoom")?1:this._network.getGraphicsZoom(),n=this.resizePointSize/i,o=2*n,s=2*n,a=this._network.getResizePointFillColor(),r=this._network.getResizePointOutlineWidth()/i,h=this._network.getResizePointOutlineColor(),l=this._element.getAngle(),c=this._network.zoomManager,d=c._getElementZoomRect(this.getElementUI(),this._element.getOriginalRect());t.lineWidth=r;for(var u=this.resizingPoints,_=0;e>_;_++){var g=u.get(_),f={x:g.x-n,y:g.y-n,width:2*n,height:2*n},v=this._getRotateRect(f,l,{x:d.x+d.width/2,y:d.y+d.height/2});t.save(),Me.Util.rotateCanvas(t,v,l),Hn.rect(t,v.x,v.y,o,s),t.restore()}if(t.fillStyle=a,t.strokeStyle=h,t.fill(),t.stroke(),this._network._debug){var m=this.getViewRect("resize");Ke.strokeRect(t,m,"#CCDDCC");var m=c._getElementZoomRect(this.getElementUI(),this.getElementUI()._viewRect);Ke.strokeRect(t,m,"#FD7766")}}},paintEditPoints:function(t){var e=this.editPoints.size();if(!(0>=e)){var i=this._element.getStyle("edit.physicalZoom")?1:this._network.getGraphicsZoom(),n=this._network.getEditPointOutlineColor(),o=this._network.getEditPointFillColor(),s=this._network.getEditPointOutlineWidth()/i;t.beginPath(),t.lineWidth=s;for(var a=this.editPoints,r=0;e>r;r++){var h=a.get(r);t.beginPath(),Hn.circle(t,h.x,h.y,this.editPointSize,o,n),t.closePath()}if(this._network._debug){var l=this.getViewRect("edit");Ke.strokeRect(t,l,"#AAABBC")}}},paintRotatePoints:function(t){var e=this.rotatePoints.size();if(!(0>=e)){var i=this._element.getStyle("edit.physicalZoom")?1:this._network.getGraphicsZoom(),n=this._network.getRotatePointOutlineColor(),o=this._network.getRotatePointFillColor(),s=this._network.getRotatePointOutlineWidth()/i;t.beginPath(),t.lineWidth=s;for(var a=this.rotatePoints,r=0;e>r;r++){var h=a.get(r);t.beginPath(),Hn.circle(t,h.x,h.y,this.rotatePointSize/i,o,n),t.closePath(),t.beginPath()}if(this._network._debug){var l=this.getViewRect("rotate");Ke.strokeRect(t,l,"green")}}},getViewRect:function(t){if(t){if("resize"===t)return this._resizeRect;if("rotate"===t)return this._rotateRect;if("edit"===t)return this._editRect}return this._viewRect||{x:0,y:0,width:0,height:0}},validate:function(){Me.vector.EditAttachment.superClass.validate.call(this);var t=this._network.getGraphicsZoom();this.editPointSize=this._network.getEditPointSize(),this.resizePointSize=this._network.getResizePointSize(),this.rotatePointSize=this._network.getRotatePointSize(),this.resizingPoints=new Me.List,this.editPoints=new Me.List,this.rotatePoints=new Me.List,this._element instanceof Me.Node&&this._addResizingPoint(this._element),!(this._network.isRotatable(this._element)&&this._element instanceof Fn)||this._element instanceof Me.ShapeNode||this._element instanceof Me.Grid||this._element instanceof Me.Group||this._addRotatePoint(this._element),this._element instanceof Me.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof Me.vector.ShapeLinkUI&&this._addShapeLinkPoints(this._element),this._ui instanceof Me.vector.LinkUI&&this._addLinkControlPoint(this._ui);var e=this._network.getResizePointOutlineWidth()/t,i=this.getElementUI().getZoomBodyRect(),n=2*Math.sqrt(2);if(this._resizeOffset=(this.resizePointSize+e+1)*n,Ze.grow(i,this._resizeOffset,this._resizeOffset),this._resizeRect=i,e=this._network.getEditPointOutlineWidth()/t,this.editPoints.size()>0){var o=Ze.getRect(this.editPoints);Ze.grow(o,2*this.editPointSize+2*e),i=Ze.unionRect(i,o)}this._editRect=o,e=this._network.getRotatePointOutlineWidth()/t;var s=this.rotatePointSize;if(this.rotatePoints.size()>0){var a=this.rotatePoints.get(0),r={x:a.x-s-e-1,y:a.y-s-e-1,width:2*s+2*e+2,height:2*s+2*e+2};i=Ze.unionRect(i,r),this._rotateRect=r}this._viewRect=i},_addResizingPoint:function(t){var e=this._network.zoomManager._getElementZoomRect(this.getElementUI(),t.getOriginalRect());if(e){var i=this._network.getResizePointSize();if(!(0>=i)){var n=new fn([{x:e.x,y:e.y},{x:e.x+e.width/2,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x,y:e.y+e.height/2},{x:e.x+e.width,y:e.y+e.height/2},{x:e.x,y:e.y+e.height},{x:e.x+e.width/2,y:e.y+e.height},{x:e.x+e.width,y:e.y+e.height}]),o=this._network.getResizePointOutlineWidth(),s=this._network.getResizePointOutlineColor(),a=this._network.getResizePointFillColor();this._addPoints(t.getRect(),n,o,s,a,!0)}}},_addRotatePoint:function(t){var e=this._network.zoomManager._getElementZoomRect(this.getElementUI(),t.getOriginalRect());if(e){var i=this._network.getRotatePointSize()/this._network.getGraphicsZoom();if(!(0>=i)){var n=2*i,o=new Me.List([{x:e.x+e.width/2,y:e.y-this._network.getRotatePointOffset()/this._network.getGraphicsZoom()-i}]),s=t.getAngle();0!=s&&(o=this._rotatePointList(o,s,e));var a=o.get(0),r={x:a.x-n/2,y:a.y-n/2,width:n,height:n},h=this._network.getRotatePointOutlineWidth(),l=this.rotatePointSize+h;Ze.grow(e,l,l);{Ze.unionRect(t.getRect(),r)}this.rotatePoints=o}}},_addShapeNodePoint:function(t){var e=this._network.zoomManager._getShapeNodeZoomPoints(this.getElementUI(),t.getPoints());this._addEditPoints(e)},_addShapeLinkPoints:function(t){var e=this._network.zoomManager._getShapeLinkZoomPoints(t.getPoints());this._addEditPoints(e)},_addLinkControlPoint:function(t){var e,i=new Me.List,n=t._element.getFromAgent();e=n?t._element.getFromAgent():t._element.getFromNode();var o=t._element.getStyle("link.from.xoffset"),s=t._element.getStyle("link.from.yoffset"),a=this._network.getElementUI(e),r=a.getZoomBodyRect(),h={x:r.x+r.width/2,y:r.y+r.height/2},l={x:h.x+o,y:h.y+s};i.add(l);var c,d=t._element.getToAgent();c=d?t._element.getToAgent():t._element.getToNode();var u=t._element.getStyle("link.to.xoffset"),_=t._element.getStyle("link.to.yoffset"),g=this._network.getElementUI(c),f=g.getZoomBodyRect(),v={x:f.x+f.width/2,y:f.y+f.height/2},m={x:v.x+u,y:v.y+_};if(i.add(m),Ti.isOrthogonalLink(t._element)&&t.getControlPoint()){var p=t.getControlPoint();p&&i.add(p)}var y=this.editPoints.size();if(y>0)for(var w=0;y>w;w++)i.add(this.editPoints.get(w));this._addEditPoints(i)},_addEditPoints:function(t){var e=Ze.getRect(t);if(e){var i=this._network.getEditPointSize();if(!(0>=i)){var n=this._network.getEditPointOutlineWidth();this._addPoints(e,t,n,!1)}}},_addPoints:function(t,e,i,n,o,s){var a=s?this._network.getResizePointSize():this._network.getEditPointSize();if(!(0>a)){var r=a+i;Ze.grow(t,r,r),1==s?this.resizingPoints=e:this.editPoints=e}},_rotatePoint:function(t,e,i){var n=Ze.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2),o=n.transform(t);return o},_rotatePointList:function(t,e,i){var n=this,o=new Me.List;return t.forEach(function(t){o.add(n._rotatePoint(t,e,i))}),o},_getRotateRect:function(t,e,i){var n=Ze.createMatrix(e*Math.PI/180,i.x,i.y),o={x:t.x+t.width/2,y:t.y+t.height/2},s=n.transform(o),a=new Me.List([{x:s.x-t.width/2,y:s.y-t.height/2},{x:s.x+t.width/2,y:s.y-t.height/2},{x:s.x+t.width/2,y:s.y+t.height/2},{x:s.x-t.width/2,y:s.y+t.height/2}]);return Ze.getRect(a)}}),Me.vector.HTMLLabelAttachment=function(t,e){Me.vector.HTMLLabelAttachment.superClass.constructor.call(this,t,e),this._triangleDiv=Me.Util.createDiv(),this._roundDiv=Me.Util.createDiv(),this._contentDiv=Me.Util.createDiv();this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Oe.ext("twaver.vector.HTMLLabelAttachment",Me.vector.LabelAttachment,{validate:function(){this.validateZIndex(0);var e=this._element.getStyle("attachment.htmllabel.hyperlink");e?(Me.Util.setCSSStyle(this._triangleDiv,"pointer-events","auto"),Me.Util.setCSSStyle(this._contentDiv,"pointer-events","auto")):(Me.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),Me.Util.setCSSStyle(this._contentDiv,"pointer-events","none")),Me.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Me.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var i=(this.getFont("label.font"),this.getLabel());i!==this.text&&(this.text&&("object"==typeof this.text?t.jquery?t.jquery(this.text).remove():this._contentDiv.removeChild(this.text):this._contentDiv.innerHTML=""),i&&("object"==typeof i?t.jquery?t.jquery(this._contentDiv).append(i):this._contentDiv.appendChild(i):this._contentDiv.innerHTML=i),this.text=i),this._contentDiv.style.visibility="hidden",Me.vector.HTMLLabelAttachment.superClass.validate.call(this)},validateZIndex:function(t){this._roundDiv.style.zIndex=1e5*t+this._network.getElementBox().getDatas().indexOf(this._element)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(Me.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(Me.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(t){var e=this.isFill(),i=this.getOutlineWidth(),n=this._contentRect;if(this.getElementUI().setGlow(this,t),this.getElementUI().setShadow(this,t),i>0||e){if(Ke.drawRoundRect(t,n.x,n.y,n.width,n.height,this.getCornerRadius()),this._pointers){var o=this._ui.getZoomPointers(this,this._pointers);t.moveTo(o[0].x,o[0].y),t.lineTo(o[1].x,o[1].y),t.lineTo(o[2].x,o[2].y)}if(t.closePath(),i>0&&(t.lineWidth=i,t.strokeStyle=this.getOutlineColor(),t.lineCap=this.getCap(),t.lineJoin=this.getJoin(),t.stroke()),e){var s=this.getFillColor(),a=this.getGradient();a?Ke.fill(t,s,a,this.getGradientColor(),this._viewRect):t.fillStyle=s,t.fill()}}var r=(this.getFont("label.font"),this.getLabel(),this._network.getViewRect().x),h=this._network.getViewRect().y,l=this._network.getZoom(),c={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},d=c.x*l-r-this._contentDiv.offsetWidth/2*l+"px",u=c.y*l-h-this._contentDiv.offsetHeight/2*l+"px";this._contentDiv.style.left=d,this._contentDiv.style.top=u,He.isFirefox?(Me.Util.setCSSStyle(this._contentDiv,"-moz-transform","scale("+l+")"),Me.Util.setCSSStyle(this._contentDiv,"-moz-transform-origin","0 0")):He.isOpera?(Me.Util.setCSSStyle(this._contentDiv,"-o-transform","scale("+l+")"),Me.Util.setCSSStyle(this._contentDiv,"-o-transform-origin","0 0")):He.isChrome||He.isSafari?(Me.Util.setCSSStyle(this._contentDiv,"-webkit-transform","scale("+l+")"),Me.Util.setCSSStyle(this._contentDiv,"-webkit-transform-origin","0 0")):He.isIE?(Me.Util.setCSSStyle(this._contentDiv,"-ms-transform","scale("+l+")"),Me.Util.setCSSStyle(this._contentDiv,"-ms-transform-origin","0 0")):(Me.Util.setCSSStyle(this._contentDiv,"transform","scale("+l+")"),Me.Util.setCSSStyle(this._contentDiv,"transform-origin","0 0")),this._network._debug&&(Ke.strokeRect(t,this._contentRect,"blue"),Ke.strokeRect(t,this._roundRect,"red"),Ke.strokeRect(t,this._viewRect,"green"));var _=this._element instanceof Me.Link&&this._element.getStyle("link.label.rotatable");if(_){{var g=this.getZoomViewRect(),f=(g.x+g.width/2,g.y+g.height/2,180*this._network.getElementUI(this._element).getAbsoluteAngle()/Math.PI);this._contentDiv.offsetWidth/2*l,this._contentDiv.offsetHeight/2*l}He.isFirefox?Me.Util.setCSSStyle(this._contentDiv,"-moz-transform","translate(0px,0px) rotate("+f+"deg) scale("+l+")"):He.isOpera?Me.Util.setCSSStyle(this._contentDiv,"-o-transform","translate(0px,0px) rotate("+f+"deg) scale("+l+")"):He.isChrome||He.isSafari?Me.Util.setCSSStyle(this._contentDiv,"-webkit-transform","translate(0px, 0px) rotate("+f+"deg) scale("+l+")"):He.isIE?Me.Util.setCSSStyle(this._contentDiv,"-ms-transform","translate(0px,0px) rotate("+f+"deg) scale("+l+")"):Me.Util.setCSSStyle(this._contentDiv,"transform","translate(0px,0px) rotate("+f+"deg) scale("+l+")")}},setVisibility:function(t){this._contentDiv.style.visibility=t},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),Me.vector.HTMLLabel2Attachment=function(t,e){Me.vector.HTMLLabel2Attachment.superClass.constructor.call(this,t,e),this._triangleDiv=Me.Util.createDiv(),this._roundDiv=Me.Util.createDiv(),this._contentDiv=Me.Util.createDiv();this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Oe.ext("twaver.vector.HTMLLabel2Attachment",Me.vector.LabelAttachment,{validate:function(){this.validateZIndex(0);var e=this._element.getStyle("attachment.htmllabel2.hyperlink");e?(Me.Util.setCSSStyle(this._triangleDiv,"pointer-events","auto"),Me.Util.setCSSStyle(this._contentDiv,"pointer-events","auto")):(Me.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),Me.Util.setCSSStyle(this._contentDiv,"pointer-events","none")),Me.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Me.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var i=(this.getFont("label2.font"),this.getLabel());i!==this.text&&(this.text&&("object"==typeof this.text?t.jquery?t.jquery(this.text).remove():this._contentDiv.removeChild(this.text):this._contentDiv.innerHTML=""),i&&("object"==typeof i?t.jquery?t.jquery(this._contentDiv).append(i):this._contentDiv.appendChild(i):this._contentDiv.innerHTML=i),this.text=i),this._contentDiv.style.visibility="hidden",Me.vector.HTMLLabelAttachment.superClass.validate.call(this)},validateZIndex:function(t){this._roundDiv.style.zIndex=1e5*t+this._network.getElementBox().getDatas().indexOf(this._element)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(Me.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(Me.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(t){var e=this.isFill(),i=this.getOutlineWidth(),n=this._contentRect;if(this.getElementUI().setGlow(this,t),this.getElementUI().setShadow(this,t),i>0||e){if(Ke.drawRoundRect(t,n.x,n.y,n.width,n.height,this.getCornerRadius()),this._pointers){var o=this._ui.getZoomPointers(this,this._pointers);t.moveTo(o[0].x,o[0].y),t.lineTo(o[1].x,o[1].y),t.lineTo(o[2].x,o[2].y)}if(t.closePath(),i>0&&(t.lineWidth=i,t.strokeStyle=this.getOutlineColor(),t.lineCap=this.getCap(),t.lineJoin=this.getJoin(),t.stroke()),e){var s=this.getFillColor(),a=this.getGradient();a?Ke.fill(t,s,a,this.getGradientColor(),this._viewRect):t.fillStyle=s,t.fill()}}var r=(this.getFont("label2.font"),this.getLabel(),this._network.getViewRect().x),h=this._network.getViewRect().y,l=this._network.getZoom(),c={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},d=c.x*l-r-this._contentDiv.offsetWidth/2*l+"px",u=c.y*l-h-this._contentDiv.offsetHeight/2*l+"px";this._contentDiv.style.left=d,this._contentDiv.style.top=u,this._contentDiv.style.setProperty("-webkit-transform","scale("+l+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&(Ke.strokeRect(t,this._contentRect,"blue"),Ke.strokeRect(t,this._roundRect,"red"),Ke.strokeRect(t,this._viewRect,"green"));var _=this._element instanceof Me.Link&&this._element.getStyle("link.label2.rotatable");if(_){{var g=this.getZoomViewRect(),f=(g.x+g.width/2,g.y+g.height/2,180*this._network.getElementUI(this._element).getAbsoluteAngle()/Math.PI);this._contentDiv.offsetWidth/2*l,this._contentDiv.offsetHeight/2*l}He.isFirefox?Me.Util.setCSSStyle(this._contentDiv,"-moz-transform","translate(0px,0px) rotate("+f+"deg) scale("+l+")"):He.isOpera?Me.Util.setCSSStyle(this._contentDiv,"-o-transform","translate(0px,0px) rotate("+f+"deg) scale("+l+")"):He.isChrome||He.isSafari?Me.Util.setCSSStyle(this._contentDiv,"-webkit-transform","translate(0px, 0px) rotate("+f+"deg) scale("+l+")"):He.isIE?Me.Util.setCSSStyle(this._contentDiv,"-ms-transform","translate(0px,0px) rotate("+f+"deg) scale("+l+")"):Me.Util.setCSSStyle(this._contentDiv,"transform","translate(0px,0px) rotate("+f+"deg) scale("+l+")")}},setVisibility:function(t){this._contentDiv.style.visibility=t},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv},getLabel:function(){return this._network.getLabel2(this._element)},getCornerRadius:function(){return this.getStyle("label2.corner.radius")},getPointerLength:function(){return this.getStyle("label2.pointer.length")},getPointerWidth:function(){return this.getStyle("label2.pointer.width")},getPosition:function(){return this.getStyle("label2.position")},getXOffset:function(){return this.getStyle("label2.xoffset")},getYOffset:function(){return this.getStyle("label2.yoffset")},getPadding:function(){return this.getStyle("label2.padding")},getPaddingLeft:function(){return this.getStyle("label2.padding.left")},getPaddingRight:function(){return this.getStyle("label2.padding.right")},getPaddingTop:function(){return this.getStyle("label2.padding.top")},getPaddingBottom:function(){return this.getStyle("label2.padding.bottom")},getDirection:function(){return this.getStyle("label2.direction")},isFill:function(){return this.getStyle("label2.fill")},getFillColor:function(){return this.getStyle("label2.fill.color")},getGradient:function(){return this.getStyle("label2.gradient")},getGradientColor:function(){return this.getStyle("label2.gradient.color")},getOutlineWidth:function(){return this.getStyle("label2.outline.width")},getOutlineColor:function(){return this.getStyle("label2.outline.color")},getCap:function(){return this.getStyle("label2.cap")},getJoin:function(){return this.getStyle("label2.join")},getAlpha:function(){return this.getStyle("label2.alpha")},isShadowable:function(){return this.getStyle("label2.shadowable")}}),Me.vector.HTMLAlarmAttachment=function(t,e){Me.vector.HTMLAlarmAttachment.superClass.constructor.call(this,t,e),this._triangleDiv=Me.Util.createDiv(),this._roundDiv=Me.Util.createDiv(),this._contentDiv=Me.Util.createDiv(),Me.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Me.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),Me.Util.setCSSStyle(this._contentDiv,"white-space","nowrap"),Me.Util.setCSSStyle(this._contentDiv,"pointer-events","none");this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Oe.ext("twaver.vector.HTMLAlarmAttachment",Me.vector.AlarmAttachment,{validate:function(){var t=(this.getFont("alarm.font"),this._network.getAlarmLabel(this._element));this._contentDiv.innerHTML=t,this._contentDiv.style.visibility="hidden",Me.vector.HTMLAlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(Me.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(Me.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(t){var e=this.isFill(),i=this.getOutlineWidth(),n=this._contentRect;if(this.getElementUI().setShadow(this,t),i>0||e){if(Ke.drawRoundRect(t,n.x,n.y,n.width,n.height,this.getCornerRadius()),this._pointers){var o=this._ui.getZoomPointers(this,this._pointers);t.moveTo(o[0].x,o[0].y),t.lineTo(o[1].x,o[1].y),t.lineTo(o[2].x,o[2].y)}if(t.closePath(),i>0&&(t.lineWidth=i,t.strokeStyle=this.getOutlineColor(),t.lineCap=this.getCap(),t.lineJoin=this.getJoin(),t.stroke()),e){var s=this.getFillColor(),a=this.getGradient();a?Ke.fill(t,s,a,this.getGradientColor(),this._viewRect):t.fillStyle=s,t.fill()}}var r=(this.getFont("alarm.font"),this._network.getAlarmLabel(this._element),this._network.getViewRect().x),h=this._network.getViewRect().y,l=this._network.getZoom(),c={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},d=c.x*l-r-this._contentDiv.offsetWidth/2*l+"px",u=c.y*l-h-this._contentDiv.offsetHeight/2*l+"px";this._contentDiv.style.left=d,this._contentDiv.style.top=u,this._contentDiv.style.setProperty("-webkit-transform","scale("+l+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&Ke.strokeRect(t,this._contentRect,"#DDDDDD"),Me.vector.AlarmAttachment.superClass.paint.apply(this,arguments)},setVisibility:function(t){this._contentDiv.style.visibility=t},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),Me.vector.BaseZoomManager=function(t){this.network=t,this.visibilityThresholds=t.visibilityThresholds},Oe.ext("twaver.vector.BaseZoomManager",Object,{getZoom:function(){return this.network.getZoom()},getGraphicsZoom:function(){return 1},getSizeZoom:function(t){return 1},getAttachmentSizeZoom:function(t){var e=t.getElementUI();return this.getSizeZoom(e)},getLocationZoom:function(t){return 1},_getZoomVisibilityThresholds:function(){return this.network.getZoomVisibilityThresholds()},_convertPointFromView:function(t){var e=t.x*this.getGraphicsZoom()-this.network.getViewRect().x,i=t.y*this.getGraphicsZoom()-this.network.getViewRect().y;return{x:e,y:i}},_getElementViewRect:function(t,e){var i=this.getLocationZoom(t),n=this.getSizeZoom(t);if(1==i&&1==n)return e;var o=this._getZoomPoint(t),s=o.x,a=o.y;return null==e&&console.log("View rect is null"),{x:s*i+(e.x-s)*n,y:a*i+(e.y-a)*n,width:e.width*n,height:e.height*n}},_invalidateZoom:function(){this.network.invalidateElementUIs()},_getGroupChildrenRects:function(t){var e=new fn;return t.getChildren().forEach(function(t){if(t instanceof Fn){var i=this.network.getElementUI(t);if(i){var n=i.getZoomViewRect(this);n&&e.add(n)}}},this),e},_zoomGraphicsBegin:function(t){var e=this.network,i=this.getGraphicsZoom();t.scale(i,i),t.translate(-e.viewRect.x/i,-e.viewRect.y/i)},_getEditZoomPoints:function(t,e){var i=this.getLocationZoom(t),n=this.getSizeZoom(t);if(1==i&&1==n||t instanceof Me.vector.LinkUI&&!(t instanceof Me.vector.ShapeLinkUI))return e;var o;o=t instanceof Me.vector.ShapeLinkUI?Ze.getCenterPoint(Ze.getRect(e)):this._getZoomPoint(t);var s=o.x,a=o.y;if(e.forEach){var r,h=new fn;return e.forEach(function(t){t instanceof fn?(r=new fn,t.forEach(function(t){r.add({x:s*i+(t.x-s)*n,y:a*i+(t.y-a)*n})}),h.add(r)):h.add({x:s*i+(t.x-s)*n,y:a*i+(t.y-a)*n})}),h}return e.x?{x:s*i+(e.x-s)*n,y:a*i+(e.y-a)*n}:void 0},_getShapeNodeZoomPoints:function(t,e,i){var n=this.getLocationZoom(t),o=this.getSizeZoom(t);if(1==n&&1==o)return e;i&&(n=1/n,o=1/o);var s,a=Ze.getRect(e),r=a.x+a.width/2,h=a.y+a.height/2,l=new fn;return e.forEach(function(t){t instanceof fn?(s=new fn,t.forEach(function(t){s.add({x:r*n+(t.x-r)*o,y:h*n+(t.y-h)*o})}),l.add(s)):l.add({x:r*n+(t.x-r)*o,y:h*n+(t.y-h)*o})}),l},_getShapeLinkZoomPoints:function(t,e){var i=this.getLocationZoom(),n=i;if(1==i&&1==n)return t;e&&(i=1/i,n=1/n);var o,s=Ze.getRect(t),a=s.x+s.width/2,r=s.y+s.height/2,h=new fn;return t.forEach(function(t){t instanceof fn?(o=new fn,t.forEach(function(t){o.add({x:a*i+(t.x-a)*n,y:r*i+(t.y-r)*n})}),h.add(o)):h.add({x:a*i+(t.x-a)*n,y:r*i+(t.y-r)*n})}),h},_getLogicalPoint:function(t,e){var i,n=e?this.getZoom():this.getGraphicsZoom(),o=this.network;if(He.isTouchable&&t.changedTouches&&t.changedTouches.length>0){var s=o._view.getBoundingClientRect(),a=t.changedTouches[0],r=He.isAndroid?0:bi.scrollLeft(),h=He.isAndroid?0:bi.scrollTop();return i={x:(a.clientX+o.viewRect.x-s.left-r)/n,y:(a.clientY+o.viewRect.y-s.top-h)/n}}return i=He.isFirefox?{x:(t.layerX+o.viewRect.x)/n,y:(t.layerY+o.viewRect.y)/n}:{x:(t.offsetX+o.viewRect.x)/n,y:(t.offsetY+o.viewRect.y)/n}},_getVisibleRect:function(t){return t},_getElementZoomRect:function(t,e){var i=this.getLocationZoom(t),n=this.getSizeZoom(t);if(1==i&&1==n)return Oe.cloneRect(e);var o=null!=t?this._getZoomPoint(t):{x:e.x+e.width/2,y:e.y+e.height/2},s=o.x,a=o.y;return{x:s*i+(e.x-s)*n,y:a*i+(e.y-a)*n,width:e.width*n,height:e.height*n}},_reverseElementZoomRect:function(t,e){var i=this.getLocationZoom(t),n=this.getSizeZoom(t);if(1==i&&1==n)return Oe.cloneRect(e);var o=null!=t?this._getZoomPoint(t):{x:e.x+e.width/2,y:e.y+e.height/2},s=o.x,a=o.y;return{x:s+(e.x-s*i)/n,y:a+(e.y-a*i)/n,width:e.width/n,height:e.height/n}},_getZoomContentRect:function(t,i,n,o,s,a){var r=this.getSizeZoom(t.getElementUI()),h=this.getAttachmentSizeZoom(t),l=t.getElementUI();return a==e?l instanceof Me.vector.GroupUI&&l._shapeRect?{x:o.x*s+1*(i.x-o.x)+(n.x-i.x)*h,y:o.y*s+1*(i.y-o.y)+(n.y-i.y)*h,width:n.width,height:n.height}:{x:o.x*s+(i.x-o.x)*r+(n.x-i.x)*h,y:o.y*s+(i.y-o.y)*r+(n.y-i.y)*h,width:n.width,height:n.height}:{x:o.x*s+(i.x-o.x)*r+(n.x-i.x)*h,y:o.y*s+(i.y-o.y)*r+(n.y-i.y)*h+a*(t.textHeight-4)*h,width:n.width,height:t.textHeight}},_getAttachmentZoomRect:function(t,i,n){var o=this.getLocationZoom(t.getElementUI()),s=t.getElementUI(),a=this.getSizeZoom(t.getElementUI()),r=this.getAttachmentSizeZoom(t),h=t._pointers;if(1==o&&1==r&&1==a)return n==e?i:{x:i.x,y:i.y+n*(t.textHeight-4),width:i.width,height:t.textHeight};var s=t.getElementUI(),l=this._getZoomPoint(s,t),c=(l.x,l.y,t.getPosition?t.getPosition():"center"),d=h?h[0]:Zn.get(c,i);return n==e?s instanceof Me.vector.LinkUI||s instanceof Me.vector.GroupUI&&s._shapeRect?this._getZoomContentRect(t,d,i,l,1):this._getZoomContentRect(t,d,i,l,o):this._getZoomContentRect(t,d,i,l,o,n)},_getZoomPoint:function(t,e){var i,n,o=t._element;if(o instanceof Me.Follower&&o.getHost()&&o.getHost()instanceof Me.Grid)return i=o.getHost(),n=i.getRect(),{x:n.x+n.width/2,y:n.y+n.height/2};if(n=t.getBodyRect(),t instanceof Me.vector.LinkUI&&e&&e.getPosition){{e.getXOffset(),e.getYOffset()}if("from"===e.getPosition())return t._fromPoint;if("to"===e.getPosition())return t._toPoint}return{x:n.x+n.width/2,y:n.y+n.height/2}},_getZoomPointers:function(t,e,i){if(i){var n=this._getZoomPoint(e),o=this.getLocationZoom(e),s=this.getSizeZoom(e),a=this.getAttachmentSizeZoom(t),r=i[0];return e instanceof Me.vector.LinkUI?[{x:n.x+(r.x-n.x)*s,y:n.y+(r.y-n.y)*s},{x:n.x+(r.x-n.x)*s+(i[1].x-r.x)*a,y:n.y+(r.y-n.y)*s+(i[1].y-r.y)*a},{x:n.x+(r.x-n.x)*s+(i[2].x-r.x)*a,y:n.y+(r.y-n.y)*s+(i[2].y-r.y)*a}]:e instanceof Me.vector.GroupUI&&e._shapeRect?[{x:n.x+1*(r.x-n.x),y:n.y+1*(r.y-n.y)},{x:n.x+1*(r.x-n.x)+(i[1].x-r.x)*a,y:n.y+1*(r.y-n.y)+(i[1].y-r.y)*a},{x:n.x+1*(r.x-n.x)+(i[2].x-r.x)*a,y:n.y+1*(r.y-n.y)+(i[2].y-r.y)*a}]:[{x:n.x*o+(r.x-n.x)*s,y:n.y*o+(r.y-n.y)*s},{x:n.x*o+(r.x-n.x)*s+(i[1].x-r.x)*a,y:n.y*o+(r.y-n.y)*s+(i[1].y-r.y)*a},{x:n.x*o+(r.x-n.x)*s+(i[2].x-r.x)*a,y:n.y*o+(r.y-n.y)*s+(i[2].y-r.y)*a}]}},_getZoomHotSpot:function(t,e){if(e){var i=this._getZoomPoint(t),n=this.getLocationZoom(t),o=this.getSizeZoom(t);return{x:i.x*n+(e.x-i.x)*o,y:i.y*n+(e.y-i.y)*o}}return null},limitZoom:function(t){return t},_isVisible:function(t){var e,i=this._getZoomVisibilityThresholds(),n=i[t];if(null!=n){var o=i.zoomName;if(e="sizeZoom"==o?this.getSizeZoom():"locationZoom"==o?this.getLocationZoom():"graphicsZoom"==o?this.getGraphicsZoom():this.getZoom(),n>e)return!1}return!0},isElementVisible:function(t){var e=this.getZoom(),i=this._isVisible("element",e);return i&&t instanceof Me.Link?this.isLinkVisible(t):i},isLinkVisible:function(t){var e=this.getZoom();return this._isVisible("link",e)},isLabelVisible:function(t){var e=this.getZoom();return this._isVisible("label",e)},isAttachmentVisible:function(t){var e=this.getZoom();return this._isVisible("attachment",e)},isAlarmBalloonVisible:function(t){var e=this.getZoom();return this._isVisible("alarmBallon",e)},_getAttachmentOutLineWidth:function(t){return t.getOutlineWidth()},_getAttachmentZoomOutLineRect:function(t,e){var i=this.getLocationZoom(t.getElementUI()),n=this.getAttachmentSizeZoom(t);if(1==i&&1==n)return e;var o=this._getAttachmentZoomRect(t,e,null),s=t.getElement();return this.isAttachmentVisible(s)?(t instanceof Me.vector.LabelAttachment||t instanceof Me.vector.Label2Attachment)&&!this.isLabelVisible(s)?{x:o.x,y:o.x,width:0,height:0}:t instanceof Me.vector.AlarmAttachment&&!this.isAlarmBalloonVisible(s)?{x:o.x,y:o.x,width:0,height:0}:{x:o.x,y:o.y,width:o.width*n,height:o.height*n}:{x:o.x,y:o.x,width:0,height:0}},_drawText:function(t,e,i,n,o,s,a){var r=this.getLocationZoom(t.getElementUI()),h=this.getAttachmentSizeZoom(t);1!=r&&1!=h?(e.translate(n.x,n.y),e.scale(h,h),Ke.drawText(e,i,{x:0,y:0,width:n.width,height:n.height},o,s,a),e.scale(1/h,1/h),e.translate(-n.x,-n.y)):Ke.drawText(e,i,n,o,s,a)},_getOffset:function(t,e){var i=this.getLocationZoom();return{x:(t.x-e.x)/i,y:(t.y-e.y)/i}}});var Zn={"topleft.topleft":function(t){return{x:t.x+t.width,y:t.y+t.height}},"topleft.topright":function(t){return{x:t.x,y:t.y+t.height}},"top.top":function(t){return{x:t.x+t.width/2,y:t.y+t.height}},"topright.topleft":function(t){return{x:t.x+t.width,y:t.y+t.height}},"topright.topright":function(t){return{x:t.x,y:t.y+t.height}},topleft:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},top:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},topright:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},"topleft.bottomleft":function(t){return{x:t.x+t.width,y:t.y}},"topleft.bottomright":function(t){return{x:t.x,y:t.y}},"top.bottom":function(t){return{x:t.x+t.width/2,y:t.y}},"topright.bottomleft":function(t){return{x:t.x+t.width,y:t.y}},"topright.bottomright":function(t){return{x:t.x,y:t.y}},"left.left":function(t){return{x:t.x+t.width,y:t.y+t.height/2}},left:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},"left.right":function(t){return{x:t.x,y:t.y+t.height/2}},center:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},"right.left":function(t){return{x:t.x+t.width,y:t.y+t.height/2}},right:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},"right.right":function(t){return{x:t.x,y:t.y+t.height/2}},"bottomleft.topleft":function(t){return{x:t.x+t.width,y:t.y+t.height}},"bottomleft.topright":function(t){return{x:t.x,y:t.y+t.height}},"bottom.top":function(t){return{x:t.x+t.width/2,y:t.y+t.height}},"bottomright.topleft":function(t){return{x:t.x+t.width,y:t.y+t.height}},"bottomright.topright":function(t){return{x:t.x,y:t.y+t.height}},bottomleft:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},bottom:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},bottomright:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},"bottomleft.bottomleft":function(t){return{x:t.x+t.width,y:t.y}},"bottomleft.bottomright":function(t){return{x:t.x,y:t.y}},"bottom.bottom":function(t){return{x:t.x+t.width/2,y:t.y}},"bottomright.bottomleft":function(t){return{x:t.x+t.width,y:t.y}},"bottomright.bottomright":function(t){return{x:t.x,y:t.y}},from:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},to:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},get:function(t,e){if(!e)throw"rect can not be null";var i=Zn[t];if(i)return i(e);throw"Can not resolve '"+t+"' position"}};Me.vector.PhysicalZoomManager=function(t){Me.vector.PhysicalZoomManager.superClass.constructor.apply(this,arguments)},Oe.ext("twaver.vector.PhysicalZoomManager",Me.vector.BaseZoomManager,{getGraphicsZoom:function(){return this.getZoom()},_invalidateZoom:function(){}}),Me.vector.LogicalZoomManager=function(t,e){Me.vector.LogicalZoomManager.superClass.constructor.apply(this,arguments),this.sizeChange=e},Oe.ext("twaver.vector.LogicalZoomManager",Me.vector.BaseZoomManager,{getLocationZoom:function(t){return this.getZoom()},getSizeZoom:function(t){return this.sizeChange?this.getZoom():1}}),Me.vector.MixedZoomManager=function(t,e){Me.vector.MixedZoomManager.superClass.constructor.call(this,t,e)},Oe.ext("twaver.vector.MixedZoomManager",Me.vector.LogicalZoomManager,{}),function(){function t(t){n[t]=function(){return this.getZoom()>1?e[t].apply(this,arguments):i[t].apply(this,arguments)}}var e=Me.vector.LogicalZoomManager.prototype,i=Me.vector.PhysicalZoomManager.prototype,n=Me.vector.MixedZoomManager.prototype;for(var o in i)"function"==typeof i[o]&&"constructor"!=o&&(e.hasOwnProperty(o)||i.hasOwnProperty(o))&&t(o);n._invalidateZoom=function(){this.network.invalidateElementUIs()}}(),Me.vector.interaction.BaseInteraction=function(t){this.network=t},Oe.ext("twaver.vector.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},repaint:function(){this.network.repaintTopCanvas()},getOffset:function(t,e){return this.network.getOffset(t,e)},convertPointFromView:function(t){return this.network.convertPointFromView(t)},convertFromUIToMarkerRect:function(t,e,i,n){var o=this.network.zoomManager,s=o.getLocationZoom(),a=o.getGraphicsZoom(),r=o.getSizeZoom(this.network.getElementUI(n));return{x:t.x*s*a-this.network.getViewRect().x+e*s*a,y:t.y*s*a-this.network.getViewRect().y+i*s*a,width:t.width*r*a,height:t.height*r*a}},getMarkerPoint:function(t){var e;if(He.isTouchable&&t.changedTouches&&t.changedTouches.length>0){var i=t.changedTouches[0];return e={x:i.clientX,y:i.clientY}}return e=He.isFirefox?{x:t.layerX,y:t.layerY}:{x:t.offsetX,y:t.offsetY}},paint:function(t){},addListener:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];je.addEventListener(e,"handle_"+e,this.network.getView(),this)}},removeListener:function(){for(var t=0;t<arguments.length;t++)je.removeEventListener(arguments[t],this.network.getView(),this)},_handle_mousedown:function(t){0===t.button&&(this._startLogical=this.network.getLogicalPoint2(t),this._startClient=je.getClientPoint(t),this._startLogical&&je.handle_mousedown(this,t))},_handle_mousemove:function(t){this._endLogical={x:this._startLogical.x+(t.clientX-this._startClient.x)/this.network.getGraphicsZoom(),y:this._startLogical.y+(t.clientY-this._startClient.y)/this.network.getGraphicsZoom()}},_handle_mouseup:function(t){delete this._startClient,delete this._startLogical,delete this._endLogical}}),Me.vector.interaction.DefaultInteraction=function(t,e){Me.vector.interaction.DefaultInteraction.superClass.constructor.call(this,t),this.lazyMode=e},Oe.ext("twaver.vector.interaction.DefaultInteraction",Me.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseover","mouseout","keydown"),He.isFirefox?je.addEventListener("DOMMouseScroll","handleMouseWheel",this.network.getView(),this):je.addEventListener("mousewheel","handleMouseWheel",this.network.getView(),this),je.addEventListener("mouseup","handle_mouseup",t,this),je.addEventListener("dblclick","handleDoubleClicked",this.network.getView(),this),this._oldCursor=this.network.getView().style.cursor,this.network.addPropertyChangeListener(this.handleViewRectChange,this),this.validateScrollBar(),this.network.addMarker(this),this.network.getView().oncontextmenu=function(t){t.preventDefault()},this._createZoomDiv()},tearDown:function(){this.removeListener("mousedown","mouseover","mouseout","keydown"),He.isFirefox?je.removeEventListener("DOMMouseScroll",this.network.getView(),this):je.removeEventListener("mousewheel",this.network.getView(),this),je.removeEventListener("mouseup",t,this),je.removeEventListener("dblclick",this.network.getView(),this),this.network.removePropertyChangeListener(this.handleViewRectChange,this),this.end(),this.network.removeMarker(this),this._zoomDiv=null},_createZoomDiv:function(){if(null==this._zoomDiv){this._zoomDiv=Ve.createElement("div"),this._zoomLabel=Ve.createElement("span"),this._zoomLabel.style.display="block",this._zoomLabel.style.textAlign="center";var e=Ve.createElement("button");e.innerHTML="Reset to default",this._zoomDiv.appendChild(this._zoomLabel),this._zoomDiv.appendChild(e);var i=Rn,n=this._zoomDiv.style;n.position="absolute",n.color=i.TOOLTIP_COLOR,n.background=i.TOOLTIP_BACKGROUND,n.fontSize=i.TOOLTIP_FONT_SIZE,n.padding=i.TOOLTIP_PADDING,n.border=i.TOOLTIP_BORDER,n.borderRadius=i.TOOLTIP_BORDER_RADIUS,n.boxShadow=i.TOOLTIP_BOX_SHADOW,n.zIndex=i.TOOLTIP_ZINDEX,n.setProperty&&n.setProperty("-webkit-box-shadow",i.TOOLTIP_BOX_SHADOW,null);var o=this;e.onclick=function(t){o.network.setZoom(1),o._setZoomDivVisible(!1)};var s=this._zoomDiv,a=function(){return s.style.opacity=parseFloat(s.style.opacity)-.05,parseFloat(s.style.opacity)<=.05?(o._setZoomDivVisible(!1),void(s._clearTimeout=null)):void(s._clearTimeout=setTimeout(s._clearFunc,100))};s._clearFunc=a,s.onmouseover=function(e){e||(e=t.event);for(var i=e.relatedTarget?e.relatedTarget:e.fromElement;i&&i!=s;)i=i.parentNode;i!=s&&(s._clearTimeout&&(clearTimeout(s._clearTimeout),s._clearTimeout=null),s.style.opacity=1)},s.onmouseout=function(e){e||(e=t.event);for(var i=e.relatedTarget?e.relatedTarget:e.toElement;i&&i!=s;)i=i.parentNode;i!=s&&(s._clearTimeout=setTimeout(s._clearFunc,10))}}},_isZoomDivVisible:function(){return null!=this._zoomDiv&&null!=this._zoomDiv.parentNode},_getZoomDiv:function(){return this._zoomDiv||this._createZoomDiv(),this._zoomDiv},_setZoomDivVisible:function(t,e,i){var n=this._getZoomDiv();if(t){this._zoomLabel.innerHTML=i,n.style.opacity=1,this._isZoomDivVisible()||this.network.getView().appendChild(n),n.style.left=Rn.TOOLTIP_XOFFSET+"px",n.style.top=Rn.TOOLTIP_YOFFSET+"px";n._clearTimeout&&(clearTimeout(n._clearTimeout),n._clearTimeout=null),n._clearTimeout=setTimeout(n._clearFunc,250)}else n.parentNode&&n.parentNode.removeChild(n)},handleViewRectChange:function(t){("viewRect"==t.property||"canvasSizeChange"==t.property)&&this.validateScrollBar()},getScrollBarWidth:function(){return this.network.getScrollBarWidth()},getScrollBarColor:function(){return"#cccccc"},validateScrollBar:function(){if(this.hThumbRect=null,this.vThumbRect=null,0==this.network.isScrollBarVisible())return void this.repaint();var t=this.network.getViewRect().height,e=this.network.getViewRect().width,i=this.network.getViewRect().x,n=this.network.getViewRect().y,o=this.network.getCanvasSize(),s=this.network._unionBounds,a=s.x,r=s.y,h=s.width,l=s.height,c=o.width,d=o.height,u=e,_=t,g=!1,f=!1;(i>a||c>e+i)&&(f=!0),(n>r||d>n+t)&&(g=!0);var v,m,p,y=0,w=0,A=0,x=0,E=u,T=_,C=this.getScrollBarWidth();f&&(g&&(E-=C),x=C,w=_-C,i>a&&i+e>c?(v=i-a,v=v*E/(v+u),y=v,A=E-v):a>i&&c>i+e?(v=c-(i+e),v=E*v/(v+u),y=0,A=E-v):(m=i-a,p=c-(i+e),m=E*m/h,p=E*p/h,y=m,A=u-m-p),this.hThumbRect={x:y,y:w,width:A,height:x}),y=0,w=0,A=0,x=0,E=u,T=_,g&&(f&&(T-=C),A=C,y=u-C,n>r&&n+t>d?(v=n-r,v=T*v/(v+_),w=v,x=T-v):r>n&&d>n+t?(v=d-(n+t),v=T*v/(v+_),w=0,x=T-v):(m=n-r,p=d-(n+t),m=T*m/l,p=T*p/l,w=m,x=T-m-p),this.vThumbRect={x:y,y:w,width:A,height:x}),this.network.setHScrollBarVisible(null!=this.hThumbRect),this.network.setVScrollBarVisible(null!=this.vThumbRect),this.repaint()},scrollXOffset:function(t){var e=this.network.getViewRect().height,i=this.network.getViewRect().width,n=this.network.getViewRect().x,o=this.network.getViewRect().y,s=30;t&&(s=-30),this.network.setViewRect(n+s,o,i,e)},scrollYOffset:function(t){var e=this.network.getViewRect().height,i=this.network.getViewRect().width,n=this.network.getViewRect().x,o=this.network.getViewRect().y,s=30;t&&(s=-30),this.network.setViewRect(n,o+s,i,e)},handle_mouseover:function(t){1!=this.scrollBarVisible&&(this.scrollBarVisible=!0,this.repaint())},handle_mouseout:function(t){0!=this.scrollBarVisible&&(this.scrollBarVisible=!1,this.repaint(),this.end(t))},handle_keydown:function(t){this.currentKeyEvent=t,this.addListener("keyup"),Ii.handleKeyDown(this.network,t)},handle_keyup:function(t){this.currentKeyEvent=null,this.removeListener("keyup")},start:function(e){this.end(e,!0),this.lastPoint=this.network.getLogicalPoint2(e),this.startPoint=this.network.getLogicalPoint2(e),this.lastPanPoint=this.getMarkerPoint(e),this.lazyMode&&(this.pressPoint=this.lastPoint),je.addEventListener("mousemove","handle_mousemove",t,this)},end:function(e,i){if(this.vBarDownPoint=null,this.hBarDownPoint=null,this.network.state.panning&&(this.network.state.panning=!1,this.network.invalidateElementUIs(!0)),i||(this.network.getView().style.cursor=this._oldCursor),this.isMoving){if(this.lazyMode){if(null!=this.dragPoint&&null!=this.pressPoint){var n=this,o=function(){n.network.fireInteractionEvent({kind:"lazyMoveEnd",event:e}),n.network.setMovingElement(!1)},s=this.getOffset(this.dragPoint,this.pressPoint),a=s.x,r=s.y;this.network.moveSelectedElements(a,r,this.network.isLazyMoveAnimate(),o)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:e}));if(this.isParenting()){null==this.parent&&(this.parent=this.network.getCurrentSubNetwork());var n=this;this.network.getMovableSelectedElements().forEach(function(t){t.setParent(n.parent)},this.network)}this.parentProcess(e,!0),this.isParenting()&&this.repaint(),this.network.invalidateCanvasSize(),this.lastPoint=null,this.dragPoint=null,this.pressPoint=null,this.repaint()}if(this.isSelecting&&this.startPoint){if(this.endPoint&&this.startPoint.x!==this.endPoint.x&&this.startPoint.y!==this.endPoint.y){var h=Ze.getRect([this.startPoint,this.endPoint]),l=this.network.getElementsAtRect(h,this.getIntersectMode(),this.network.getRectSelectFilter());if(l&&l.size()>0){var c=this.network.getSelectionModel(),d=c.toSelection();l.forEach(function(t){c.contains(t)?d.remove(t):d.add(t)},this),c.setSelection(d)}this.network.fireInteractionEvent({kind:"selectEnd",event:e})}this.network.setSelectingElement(!1),this.startPoint=null,this.endPoint=null,this.repaint()}this.isMouseDown=!1,je.removeEventListener("mousemove",t,this)},_isDragToSelect:function(t){return!this.network._dragToPan},handle_mousedown:function(t){var e=this.network;if(t.target==e.getView()||t.target==e._topCanvas||t.target==e._rootCanvas){if(this.isMoving=!1,this.isSelecting=!1,this.hBarDownPoint=null,this.vBarDownPoint=null,this._setZoomDivVisible(!1),!this.network.isValidEvent(t)){var i=this.getMarkerPoint(t);return this.start(t),null!=this.vThumbRect&&Ze.containsPoint(this.vThumbRect,i.x,i.y)&&(this.vBarDownPoint={x:t.screenX,y:t.screenY},this.vBarDownOffset=this.vBarDownPoint.y-this.vThumbRect.y),void(null!=this.hThumbRect&&Ze.containsPoint(this.hThumbRect,i.x,i.y)&&(this.hBarDownPoint={x:t.screenX,y:t.screenY},this.hBarDownOffset=this.hBarDownPoint.x-this.hThumbRect.x))}this.network.isFocusOnClick()&&Me.Util.setFocus(this.network.getView());var n=this.network.getElementAt(t),o=this.network.getElementsAt(t);if(o&&o instanceof fn)for(var s=0;s<o.size();s++){var a=o.get(s),r=this.network.getElementBox().getSelectionModel().isSelectable(a);if(r){n=a;break}}if(this.network.isSelectingElement()||this.network.isEditingElement()||null==n||(this.network.isMovable(n)&&this.network.getElementBox().getSelectionModel().isSelectable(n)?this.isMoving=!0:this.network.getView().style.cursor="pointer",this.start(t)),!this.network.isSelectingElement()&&!this.network.isEditingElement()){var h=this.network.getSelectionModel();null==n||n&&!this.network.getElementBox().getSelectionModel().isSelectable(n)?(Oe.isCtrlDown(t)?this.isSelecting=!0:this._isDragToSelect(t)?(this.isSelecting=!0,h.clearSelection()):this.network.isRectSelectEnabled()&&(h.clearSelection(),this.network.getView().style.cursor="pointer"),this.start(t)):Oe.isCtrlDown(t)?h.contains(n)?h.removeSelection(n):h.appendSelection(n):h.contains(n)||h.setSelection(n)}this.handleClicked(t,n),this.isMouseDown=!0}},handle_mousemove:function(t){this._setZoomDivVisible(!1);var e=this.network.getLogicalPoint2(t);if(e){var i={x:t.screenX,y:t.screenY},n=this.network.getCanvasSize(),o=this.network.getViewRect().height,s=this.network.getViewRect().width,a=this.getScrollBarWidth();if(null!=this.hBarDownPoint){var r=i.x-this.hBarDownPoint.x;return this.hBarDownPoint=i,void this.network.setViewOffSet(r*n.width/(s-a),0)}if(null!=this.vBarDownPoint){var h=i.y-this.vBarDownPoint.y;return this.vBarDownPoint=i,void this.network.setViewOffSet(0,h*n.height/(o-a))}if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.isMoving||!this.isMouseDown||Oe.isCtrlDown(t))if(this.isSelecting&&(Oe.isCtrlDown(t)||this._isDragToSelect()))this.network.setSelectingElement(!0),this.network.fireInteractionEvent(null==this.endPoint?{kind:"selectStart",event:t}:{kind:"selectBetween",event:t}),this.endPoint=e,this.repaint();else if(this.isMoving||this.isSelecting||!this.isMouseDown)this.end(t);else{if(!this.lastPanPoint||!this.network._dragToPan)return;var e=this.getMarkerPoint(t);if(!e)return;var l=e.x-this.lastPanPoint.x,c=e.y-this.lastPanPoint.y;this.network.panByOffset(-l,-c),this.network.fireInteractionEvent({kind:"panning",event:t}),this.network.state.panning=!0,this.lastPanPoint=e}else{var d=this.getOffset(e,this.lastPoint);if(this.xoffset=d.x,this.yoffset=d.y,Math.abs(this.xoffset)<1&&Math.abs(this.yoffset)<1)return;this.lazyMode?null==this.dragPoint?(this.network.fireInteractionEvent({kind:"lazyMoveStart",event:t}),this.network.setMovingElement(!0)):this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:t}):(this.lastPoint=e,this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t})),this.network.moveSelectedElements(this.xoffset,this.yoffset)),this.parentProcess(t,!1),this.lazyMode&&(this.dragPoint=e),(this.lazyMode||this.isParenting())&&this.repaint()}}},handleMouseWheel:function(t){if(Ve.activeElement===this.network.getView()){if(!this.network._wheelToZoom)return void this._handleMouseWheelScroll(t);je.preventDefault(t);var e={x:t.offsetX||t.layerX,y:t.offsetY||t.layerY},i=this.network.getZoom();t.wheelDelta&&t.wheelDelta>0||t.detail&&t.detail<0?this.network.setZoom(1.1*i,e):this.network.setZoom(i/1.1,e),this._setZoomDivVisible(this.network.isZoomDivVisible(),t,"Zoom : "+parseFloat(this.network.getZoom().toFixed(4)))}},_handleMouseWheelScroll:function(t){je.preventDefault(t);var e=!1,i=this._getVisibleScrollBar();null!=i&&(e=t.wheelDelta?t.wheelDelta>0:t.detail<0,"v"==i?this.scrollYOffset(e):this.scrollXOffset(e))},handle_mouseup:function(t){this.end(t)},isParenting:function(){return this.pressPoint&&null!=this.currentKeyEvent&&80===this.currentKeyEvent.keyCode},parentProcess:function(t,e){var i=null;this.parent=null;var n=this;if(!e&&this.isParenting()){var o={},s=this.network.getLogicalPoint2(t);o.x=s.x-1,o.y=s.y-1,o.width=2,o.height=2;var a=this.network.getElementsAtRect(o,!0);if(a&&a.size()>0)for(var r=a.size(),h=0;r>h;h++){var l=a.get(h);if(!n.network.getElementBox().getSelectionModel().contains(l)){n.parent=l;break}}}else this.parent=null;null!=this.parent&&(i=this.network.getElementUI(this.parent).getViewRect()),this.parentRect=null==i||e?null:i},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this.startPoint.x>this.endPoint.x&&this.startPoint.y>this.endPoint.y},_getVisibleScrollBar:function(){return 0==this.network.isScrollBarVisible()?null:null!=this.vThumbRect?"v":null!=this.hThumbRect?"h":null},paintScroll:function(t){if(0!=this.network.isScrollBarVisible()&&(0!=this.scrollBarVisible||null!=this.hBarDownPoint||null!=this.vBarDownPoint)){var e=this.getScrollBarWidth(),i=this.network.getViewRect().height,n=this.network.getViewRect().width;t.save();var o,s=this.getScrollBarColor();null!=this.hThumbRect&&(o=t.createLinearGradient(this.hThumbRect.x,this.hThumbRect.y,this.hThumbRect.x,this.hThumbRect.y+this.hThumbRect.height),o.addColorStop(0,s),o.addColorStop(1,"#666666"),this.paintRoundRect(t,this.getScrollBarColor(),.5,0,i-e,n-e,e,e/2),this.paintRoundRect(t,o,.9,this.hThumbRect.x,this.hThumbRect.y+1,this.hThumbRect.width,this.hThumbRect.height-2,e/2)),null!=this.vThumbRect&&(o=t.createLinearGradient(this.vThumbRect.x,this.vThumbRect.y,this.vThumbRect.x+this.vThumbRect.width,this.vThumbRect.y),o.addColorStop(0,s),o.addColorStop(1,"#666666"),this.paintRoundRect(t,this.getScrollBarColor(),.5,n-e,0,e,i-e,e/2),this.paintRoundRect(t,o,.9,this.vThumbRect.x+1,this.vThumbRect.y,this.vThumbRect.width-2,this.vThumbRect.height,e/2)),t.restore()}},paintRoundRect:function(t,e,i,n,o,s,a,r){t.beginPath(),t.globalAlpha=i,t.fillStyle=e,Ke.drawRoundRect(t,n,o,s,a,r),t.fill()},paint:function(t){if(this.paintScroll(t),this.network.isSelectingElement()){if(null==this.startPoint||null==this.endPoint)return;var e=this.convertPointFromView(this.startPoint),i=this.convertPointFromView(this.endPoint),n=e.x,o=e.y,s=i.x,a=i.y,r=Ze.getRect([{x:n,y:o},{x:s,y:a}]);if(null!=r){t.beginPath();var h=this.network.getSelectOutlineWidth(),l=this.getIntersectMode()?this.network.getSelectFillColor():null;t.strokeStyle=this.network.getSelectOutlineColor(),t.lineWidth=h,Hn.rect(t,r.x,r.y,r.width,r.height,l,this.network.getSelectOutlineColor()),t.closePath()}}else{if(this.lazyMode){if(null==this.pressPoint||null==this.dragPoint)return;t.beginPath();var c=this.getOffset(this.dragPoint,this.pressPoint),d=c.x,u=c.y,_=this.network.getMovableSelectedElements(),g=_.size(),f=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,h=this.network.getLazyMoveOutlineWidth(),v=this.network.getLazyMoveOutlineColor();t.strokeStyle=v,t.lineWidth=h,t.fillStyle=f;for(var m=0;g>m;m++){var p=_.get(m),y=this.network.getElementUI(p);if(y){var w=this.convertFromUIToMarkerRect(y.getViewRect(),d,u);Hn.rect(t,w.x,w.y,w.width,w.height)}}t.fill(),t.stroke()}if(this.parentRect){t.beginPath();var f=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,h=this.network.getLazyMoveOutlineWidth(),v=this.network.getLazyMoveOutlineColor();t.strokeStyle=v,t.lineWidth=h,t.fillStyle=f;var w=this.parentRect;Hn.rect(t,w.x,w.y,w.width,w.height),t.fill(),t.stroke()}}},handleClicked:function(t,e){Ii.handleClicked(this.network,t,e)},handleDoubleClicked:function(t){var e=this.network.getElementAt(t);Ii.handleDoubleClicked(this.network,t,e)}}),Me.vector.interaction.CreateElementInteraction=function(t,e){e||(e=Me.Node),this.elementFunction=Me.Util.isTypeOf(e,Me.Node)?function(t){var i=new e;return i instanceof Me.Node&&i.setCenterLocation(t),i}:e,Me.vector.interaction.CreateElementInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.vector.interaction.CreateElementInteraction",Me.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(t){var e=this.network.getLogicalPoint2(t);if(e){var i=this.elementFunction(e);i&&this.network.addElementByInteraction(i)}}}),Me.vector.interaction.EditInteraction=function(t,e){this.lazyMode=e,this.pointIndex=-1,this.linkPointsType=null,Me.vector.interaction.EditInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.vector.interaction.EditInteraction",Me.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear(),this.network.removeMarker(this)},paint:function(t){if(1==this.lazyMode&&null!=this.resizingRect){t.lineWidth=this.network.getResizeLineWidth();var e=this.convertFromUIToMarkerRect(this.resizingRect,0,0,this.node);t.save(),Me.Util.rotateCanvas(t,e,this.node.getAngle()),t.beginPath(),Hn.rect(t,e.x,e.y,e.width,e.height,null,this.network.getResizeLineColor()),t.restore()}this.isStartRotate&&this.showRotateScale(t)},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.network.repaintTopCanvas()},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(t){this.cursorID=t,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(t){if(0===t.button)if(!Oe.isAltDown(t)||this.network.isEditingElement())!this.network.isEditingElement()||this.isStart||this.isStartRotate||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:t,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?Oe.isAltDown(t)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:t,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink?Oe.isAltDown(t)?this.pointIndex>=0&&(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:t,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(t),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(t)));else{var e=this.network.getElementAt(t),i=this.network.getLogicalPoint2(t);if(e instanceof Me.ShapeNode){var n=this.getPointIndex(this.network.getShapeNodeZoomPoints(e),i,!0);n>0&&(this._handle_mousedown(t),this.pointIndex=n,this.shapeNode=e,e.addPoint(i,n),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:t,element:e,pointIndex:n}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:e,pointIndex:n}))}if(e instanceof Me.ShapeLink){var o=new Me.List(e.getPoints()),s=this.network.getElementUI(e);o.add(s.getFromPoint(),0),o.add(s.getToPoint());var n=this.getPointIndex(o,i)-1;n>0&&(this._handle_mousedown(t),this.pointIndex=n,this.shapeLink=e,e.addPoint(i,n),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:t,element:e,pointIndex:n}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:t,element:e,pointIndex:n}))}}},handle_mouseup:function(t){if(this.isStart){var e=this.network.getLogicalPoint2(t);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var i=this,n=new Me.animate.AnimateBounds(this.node,this.resizingRect,function(){i.network.fireInteractionEvent({kind:"lazyResizeEnd",event:t,element:i.node,resizeDirection:i.resizeDirection}),i.clear()});Me.animate.AnimateManager.start(n)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:t,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:t,element:this.node,resizeDirection:this.resizeDirection});else this.shapeNode&&this.pointIndex>=0&&e?(this._resetShapeNodePoints(e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.shapeNode,pointIndex:this.pointIndex})):e&&(this.shapeLink||this.linkUI)&&("from"===this.linkPointsType?this._setFromPoint(e):"to"===this.linkPointsType?this._setToPoint(e):"shapeControl"===this.linkPointsType?(this._resetShapeLinkPoints(e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.shapeLink,pointIndex:this.pointIndex})):"control"===this.linkPointsType&&Ti.isOrthogonalLink(this.linkUI._element)&&this.linkUI.getControlPoint()&&(this._setLinkControlPoint(e),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:t,element:this.linkUI._element})))}this._handle_mouseup(t),this.lazyMode||this.clear()},handle_mousemove:function(t){var e=this.network.getEditPointSize();if(this.network.isValidEvent(t)){if(this.isStartRotate&&this.node)return this._handleRotateElement(t,this.node),void(this.network.isShowRotateScale()&&this.repaint());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0)return void this._handleMovingShapeNodePoint(t);if(this.node&&this.resizeDirection)return void this._handleResizing(t);if((this.shapeLink||this.linkUI)&&this.linkPointsType){if("from"===this.linkPointsType)return void this._handleMovingFromPoint(t);if("to"===this.linkPointsType)return void this._handleMovingToPoint(t);if("shapeControl"===this.linkPointsType)return void this._handleMovingShapeLinkPoint(t);if("control"===this.linkPointsType&&Ti.isOrthogonalLink(this.linkUI._element)&&this.linkUI.getControlPoint())return void this._handleMovingLinkControlPoint(t)}}if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())return void this.clear();var i=this.network.getElementAt(t),n=this.network.getElementUI(i);if(!n||!n.getEditAttachment())return void this.clear();var o=this.network.getLogicalPoint2(t);if(i instanceof Me.Node){if(this.node=i,this._isEditingShapeNode(o)||this._isResizingNode(o))return void this.network.setEditingElement(!0);if(this._isRotatingElement(o))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(i instanceof Me.Link){i instanceof Me.ShapeLink?this.shapeLink=i:n instanceof Me.vector.LinkUI&&(this.linkUI=n);var s,a=i.getFromAgent();s=a?i.getFromAgent():i.getFromNode();var r,h=i.getStyle("link.from.xoffset"),l=i.getStyle("link.from.yoffset"),c=this.network.getElementUI(s),d=c.getZoomBodyRect(),u={x:d.x+d.width/2,y:d.y+d.height/2},_={x:u.x+h,y:u.y+l},g=i.getToAgent();r=g?i.getToAgent():i.getToNode();var f=i.getStyle("link.to.xoffset"),v=i.getStyle("link.to.yoffset"),m=this.network.getElementUI(r),p=m.getZoomBodyRect(),y={x:p.x+p.width/2,y:p.y+p.height/2},w={x:y.x+f,y:y.y+v};if(_&&this._contains(o,_,e))return this.linkPointsType="from",this._setCrossCursor(),void this.network.setEditingElement(!0);if(w&&this._contains(o,w,e))return this.linkPointsType="to",this._setCrossCursor(),void this.network.setEditingElement(!0);if(i instanceof Me.ShapeLink){if(this._isEditingShapeLink(o))return this.linkPointsType="shapeControl",void this.network.setEditingElement(!0)}else if(n instanceof Me.vector.LinkUI){if(Ti.isOrthogonalLink(n._element)){var A=this.linkUI.getControlPoint();if(A&&this._contains(o,A,e))return this.linkPointsType="control",this._setCrossCursor(),void this.network.setEditingElement(!0)}return void(this.linkPointsType=null)}this.linkPointsType=null}this.clear()}},_isRotatingElement:function(t){var e=this.network.getRotatePointSize();if(0>=e)return!1;var i=this.network.zoomManager,n=this.network.getElementUI(this.node),o=i.getSizeZoom(n),s=i._getElementZoomRect(n,this.node.getOriginalRect()),a=this.node.getAngle();return this._isRotating(t,"crosshair",s,a,o)},_isRotating:function(t,e,i,n,o){var s=this.network.getRotatePointSize()/this.network.getGraphicsZoom(),a={x:i.x+i.width/2,y:i.y-this.network.getRotatePointOffset()/this.network.getGraphicsZoom()-s},r=this._rotatePoint(a,n,i),h={x:r.x-s,y:r.y-s,width:2*s,height:2*s};return Ze.containsPoint(h,t)?(this._removeCursor(),this._setCursor(e),!0):!1},_handleRotateElement:function(t,e){this._handle_mousemove(t);var i=this._calculateAngle(this.network.getLogicalPoint2(t),e);e.setAngle(i)},_calculateAngle:function(t,e){var i=this.network.getZoomBodyRect(e),n=Ze.getCenterPoint(i);return Math.round(180*Math.atan2(n.x-t.x,t.y-n.y)/Math.PI+180)},_resetShapeNodePoints:function(t){var e=this.network.getShapeNodeZoomPoints(this.shapeNode);e.set(this.pointIndex,t);var i=this.network.getElementUI(this.shapeNode),n=this.network.zoomManager._getShapeNodeZoomPoints(i,e,!0);this.shapeNode.setPoints(n)},_handleMovingShapeNodePoint:function(t){var e=this.network.getLogicalPoint2(t);this._resetShapeNodePoints(e),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.shapeNode,pointIndex:this.pointIndex})},_resetShapeLinkPoints:function(t){var e=this.network.zoomManager._getShapeLinkZoomPoints(this.shapeLink._points);e.set(this.pointIndex,t);var i=this.network.zoomManager._getShapeLinkZoomPoints(e,!0);this.shapeLink.setPoints(i)},_handleMovingShapeLinkPoint:function(t){var e=this.network.getLogicalPoint2(t);this._resetShapeLinkPoints(e),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.shapeLink,pointIndex:this.pointIndex})},_setLinkControlPoint:function(t){var e=this.linkUI.getControlPoint(),i=this.linkUI.getControlPoint(),n=(this.network.zoomManager,{x:t.x-i.x,y:t.y-i.y});e.x+=n.x,e.y+=n.y,this.linkUI.setControlPoint(e)},_handleMovingLinkControlPoint:function(t){var e=this.network.getLogicalPoint2(t);this._setLinkControlPoint(e),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:t,element:this.linkUI._element})},_setFromPoint:function(t){var e;if(this.linkUI)e=this.linkUI._element;else{if(!this.shapeLink)return;e=this.shapeLink}var i,n=e.getFromAgent();i=n?e.getFromAgent():e.getFromNode();var o=this.network.getElementUI(i),s=o.getZoomBodyRect(),a={x:s.x+s.width/2,y:s.y+s.height/2},r={x:t.x-a.x,y:t.y-a.y};e.setStyle("link.from.xoffset",r.x),e.setStyle("link.from.yoffset",r.y)},_handleMovingFromPoint:function(t){var e=this.network.getLogicalPoint2(t);this._setFromPoint(e)},_setToPoint:function(t){var e;if(this.linkUI)e=this.linkUI._element;else{if(!this.shapeLink)return;e=this.shapeLink}var i,n=e.getToAgent();i=n?e.getToAgent():e.getToNode();var o=this.network.getElementUI(i),s=o.getZoomBodyRect(),a={x:s.x+s.width/2,y:s.y+s.height/2},r={x:t.x-a.x,y:t.y-a.y};e.setStyle("link.to.xoffset",r.x),e.setStyle("link.to.yoffset",r.y)},_handleMovingToPoint:function(t){var e=this.network.getLogicalPoint2(t);this._setToPoint(e)},convertFromUIToMarkerRect:function(t,e,i,n){var o=this.network.zoomManager,s=o.getLocationZoom(),a=o.getGraphicsZoom(),r=this.network.getElementUI(n),h=o.getSizeZoom(r),l=t.x+t.width/2,c=t.y+t.height/2,d=l-t.x,u=c-t.y;return{x:l*s*a-this.network.getViewRect().x+e*s*a-d*h*a,y:c*s*a-this.network.getViewRect().y+i*s*a-u*h*a,width:t.width*h*a,height:t.height*h*a}},_getReverseZoomPoint:function(t,e,i){var n=this.network.zoomManager,o=n.getLocationZoom(),s=n.getSizeZoom(this.network.getElementUI(t));return e.x*=o,e.y*=o,{x:e.x/o+(i.x-e.x)/s,y:e.y/o+(i.y-e.y)/s}},_getReverseZoomRect:function(t,e){var i=this.network.zoomManager,n=i.getLocationZoom(),o=i.getSizeZoom(s);if(n==o)return t;var s=this.network.getElementUI(e),a=s.getBodyRect(),r=a.x+a.width/2,h=a.y+a.height/2,l={x:r*n+(t.x-r)*o,y:h*n+(t.y-h)*o,width:t.width*o,height:t.height*o};return r=l.x+l.width/2,h=l.y+l.height/2,{x:r/n+(l.x-r)*o,y:h/n+(l.y-h)*o,width:t.width,height:t.height}},_handleResizing:function(t){this._handle_mousemove(t);var e=this.node.getAngle(),i=this.node.getLocation(),n=this.node.getWidth()/2,o=this.node.getHeight()/2,s={x:i.x+n,y:i.y+o},a={x:-n,y:-o},r={x:-n,y:o},h={x:n,y:o},l={x:n,y:-o},c={x:0,y:-o},d={x:n,y:0},u={x:0,y:o},_={x:-n,y:0},g=this._getReverseZoomPoint(this.node,Oe.clone(s),this._endLogical);if("northwest"===this.resizeDirection&&(this._transformPoint(h,s,e),a.x=g.x,a.y=g.y,s.x=(a.x+h.x)/2,s.y=(a.y+h.y)/2,this._reversPoint(a,s,e),this._reversPoint(h,s,e),this.resizingRect={x:a.x,y:a.y,width:h.x-a.x,height:h.y-a.y},Oe.isShiftDown(t)&&this._revertResizeRect(this.node,this.resizingRect,1)),"north"===this.resizeDirection){var f={x:g.x,y:g.y};this._reversPoint(f,s,e),c.y=f.y-s.y,this._transformPoint(c,s,e),this._transformPoint(u,s,e),s.x=(c.x+u.x)/2,s.y=(c.y+u.y)/2,this._reversPoint(c,s,e),this._reversPoint(u,s,e),this.resizingRect={x:s.x-this.node.getWidth()/2,y:s.y-(u.y-c.y)/2,width:this.node.getWidth(),height:u.y-c.y}}if("northeast"===this.resizeDirection&&(this._transformPoint(r,s,e),l.x=g.x,l.y=g.y,s.x=(r.x+l.x)/2,s.y=(r.y+l.y)/2,this._reversPoint(r,s,e),this._reversPoint(l,s,e),this.resizingRect={x:r.x,y:l.y,width:l.x-r.x,height:r.y-l.y},Oe.isShiftDown(t)&&this._revertResizeRect(this.node,this.resizingRect,2)),"west"===this.resizeDirection){var f={x:g.x,y:g.y};this._reversPoint(f,s,e),_.x=f.x-s.x,this._transformPoint(d,s,e),this._transformPoint(_,s,e),s.x=(d.x+_.x)/2,s.y=(d.y+_.y)/2,this._reversPoint(d,s,e),this._reversPoint(_,s,e),this.resizingRect={x:s.x-(d.x-_.x)/2,y:s.y-this.node.getHeight()/2,width:d.x-_.x,height:this.node.getHeight()}}if("east"===this.resizeDirection){var f={x:g.x,y:g.y};this._reversPoint(f,s,e),d.x=f.x-s.x,this._transformPoint(d,s,e),this._transformPoint(_,s,e),s.x=(d.x+_.x)/2,s.y=(d.y+_.y)/2,this._reversPoint(d,s,e),this._reversPoint(_,s,e),this.resizingRect={x:s.x-(d.x-_.x)/2,y:s.y-this.node.getHeight()/2,width:d.x-_.x,height:this.node.getHeight()}}if("southwest"===this.resizeDirection&&(this._transformPoint(l,s,e),r.x=g.x,r.y=g.y,s.x=(r.x+l.x)/2,s.y=(r.y+l.y)/2,this._reversPoint(r,s,e),this._reversPoint(l,s,e),this.resizingRect={x:r.x,y:l.y,width:l.x-r.x,height:r.y-l.y},Oe.isShiftDown(t)&&this._revertResizeRect(this.node,this.resizingRect,4)),"south"===this.resizeDirection){var f={x:g.x,y:g.y};this._reversPoint(f,s,e),u.y=f.y-s.y,this._transformPoint(c,s,e),this._transformPoint(u,s,e),s.x=(c.x+u.x)/2,s.y=(c.y+u.y)/2,this._reversPoint(c,s,e),this._reversPoint(u,s,e),this.resizingRect={x:s.x-this.node.getWidth()/2,y:s.y-(u.y-c.y)/2,width:this.node.getWidth(),height:u.y-c.y}}"southeast"===this.resizeDirection&&(this._transformPoint(a,s,e),h.x=g.x,h.y=g.y,s.x=(a.x+h.x)/2,s.y=(a.y+h.y)/2,this._reversPoint(a,s,e),this._reversPoint(h,s,e),this.resizingRect={x:a.x,y:a.y,width:h.x-a.x,height:h.y-a.y},Oe.isShiftDown(t)&&this._revertResizeRect(this.node,this.resizingRect,3)),this.resizingRect=this._getReverseZoomRect(this.resizingRect,this.node),this.lazyMode?(this.repaint(),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:t,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:t,element:this.node,resizeDirection:this.resizeDirection}))},_revertResizeRect:function(t,e,i){var n=t.getOriginalRect(),o=Math.max(e.width/n.width,e.height/n.height),s=n.width*o,a=n.height*o,r=e.x,h=e.y;1==i?(r+=e.width-s,h+=e.height-a):2==i?h+=e.height-a:3==i||4==i&&(r+=e.width-s),e.x=r,e.y=h,e.width=s,e.height=a},_isEditingShapeNode:function(t){var e=this.network.getEditPointSize();if(this.node instanceof Me.ShapeNode){this.shapeNode=this.node;for(var i=this.network.getShapeNodeZoomPoints(this.node),n=0,o=i.size();o>n;n++){var s=i.get(n);if(this._contains(t,s,e))return this._setCrossCursor(),this.pointIndex=n,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(t){for(var e=this.network.getEditPointSize(),i=this.network.zoomManager._getShapeLinkZoomPoints(this.shapeLink.getPoints()),n=0,o=i.size();o>n;n++){var s=i.get(n);if(this._contains(t,s,e))return this._setCrossCursor(),this.pointIndex=n,!0}return this.pointIndex=-1,!1},_isResizingNode:function(t){var e=this.network.getResizePointSize();if(0>=e)return!1;var i=this.network.zoomManager,n=this.network.getElementUI(this.node),o=i._getElementZoomRect(n,this.node.getOriginalRect()),s=this.node.getAngle(),a={x:o.x,y:o.y},r=this._rotatePoint(a,s,o);return this._isResizing(t,r.x,r.y,"northwest","nwse-resize")?!0:(a={x:o.x+o.width/2,y:o.y},r=this._rotatePoint(a,s,o),this._isResizing(t,r.x,r.y,"north","ns-resize")?!0:(a={x:o.x+o.width,y:o.y},r=this._rotatePoint(a,s,o),this._isResizing(t,r.x,r.y,"northeast","nesw-resize")?!0:(a={x:o.x,y:o.y+o.height/2},r=this._rotatePoint(a,s,o),this._isResizing(t,r.x,r.y,"west","ew-resize")?!0:(a={x:o.x+o.width,y:o.y+o.height/2},r=this._rotatePoint(a,s,o),this._isResizing(t,r.x,r.y,"east","ew-resize")?!0:(a={x:o.x,y:o.y+o.height},r=this._rotatePoint(a,s,o),this._isResizing(t,r.x,r.y,"southwest","nesw-resize")?!0:(a={x:o.x+o.width/2,y:o.y+o.height},r=this._rotatePoint(a,s,o),this._isResizing(t,r.x,r.y,"south","ns-resize")?!0:(a={x:o.x+o.width,y:o.y+o.height},r=this._rotatePoint(a,s,o),this._isResizing(t,r.x,r.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(t,e,i){var n=Ze.createMatrix(e*Math.PI/180,i.x+i.width/2,i.y+i.height/2),o=n.transform(t);return o},_isResizing:function(t,e,i,n,o){var s=this.network.getGraphicsZoom(),a=this.network.getResizePointSize()/s;return this._contains(t,{x:e,y:i},a)?(this.resizeDirection!==n&&(this._removeCursor(),o=this._changeCursorWithAngle(n,this.node.getAngle()),this._setCursor(o),this.resizeDirection=n),!0):!1},_getRect:function(t,e,i,n){var o=i>t?t:i,s=n>e?e:n,a=Math.abs(t-i),r=Math.abs(e-n);return{x:o,y:s,width:a,height:r}},_contains:function(t,e,i){var n={x:e.x-i,y:e.y-i,width:2*i,height:2*i};return Ze.containsPoint(n,t)},getPointIndex:function(t,e,i){if(t.size()<2)return 0;for(var n,o=t.get(0),s=1;s<t.size();s++){if(n=t.get(s),this.isPointOnLine(e,o,n,6))return s;o=n}return o=t.get(0),i&&this.isPointOnLine(e,o,n,6)?t.size():0},showRotateScale:function(t){var e,i,n,o,s,a=(new Me.List,this.network.getRotateScaleWidth()),r=this.network.getRotateScaleHeight(),h=this.network.getRotatePointSize(),l=this.node.getAngle(),c=this.network.zoomManager,d=this.network.getElementUI(this.node),u=c._getElementZoomRect(d,this.node.getOriginalRect()),_={x:u.x+u.width/2,y:u.y-this.network.getRotatePointOffset()-h},g=this._rotatePoint(_,l,u),f="13px Arial",v=l+"°",m=this.network.getViewRect();1===c.getLocationZoom()&&(t.translate(-m.x,-m.y),t.scale(this.network.getZoom(),this.network.getZoom())),this.node.getAngle()>=0&&this.node.getAngle()<=180?(i={x:g.x+h,y:g.y},n={x:i.x+a,y:i.y},o={x:n.x,y:n.y-r},s={x:i.x,y:o.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(i={x:g.x-h,y:g.y},n={x:i.x-a,y:i.y},o={x:n.x,y:n.y-r},s={x:i.x,y:o.y});var p=new Me.List([i,n,o,s]),e=Oe.math.getRect(p);1!==c.getLocationZoom()&&(e.x-=m.x,e.y-=m.y),t.fillStyle=this.network.getRotateScaleFillColor(),t.fillRect(e.x,e.y,e.width,e.height),t.fillStyle=this.network.getRotateScaleFontColor(),t.textBaseline="middle",t.textAlign="center",t.font=f,t.fillText(v,e.x+e.width/2,e.y+e.height/2),1===c.getLocationZoom()&&(t.scale(1/this.network.getZoom(),1/this.network.getZoom()),t.translate(m.x,m.y))},isPointOnLine:function(t,e,i,n){0>n&&(n=0);var o=this.getDistanceFromPointToLine(t,e,i);return n>=o&&t.x>=Math.min(e.x,i.x)-n&&t.x<=Math.max(e.x,i.x)+n&&t.y>=Math.min(e.y,i.y)-n&&t.y<=Math.max(e.y,i.y)+n},getDistanceFromPointToLine:function(t,e,i){if(e.x===i.x)return Math.abs(t.x-e.x);var n=(i.y-e.y)/(i.x-e.x),o=(i.x*e.y-e.x*i.y)/(i.x-e.x);return Math.abs(n*t.x-t.y+o)/Math.sqrt(n*n+1)},_transformPoint:function(t,e,i){var n=Math.cos(i*Math.PI/180),o=Math.sin(i*Math.PI/180),s=t.x,a=t.y,r=s*n-a*o,h=s*o+a*n;t.x=r+e.x,t.y=h+e.y},_reversPoint:function(t,e,i){i*=-1;var n=Math.cos(i*Math.PI/180),o=Math.sin(i*Math.PI/180),s=t.x-e.x,a=t.y-e.y,r=s*n-a*o,h=s*o+a*n;t.x=r+e.x,t.y=h+e.y},_changeCursorWithAngle:function(t,e){var i,n=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(t){case"northwest":i=1;break;case"north":i=2;break;case"northeast":i=3;break;case"east":i=4;break;case"southeast":i=5;break;case"south":i=6;break;case"southwest":i=7;break;case"west":i=8;break;default:i=0}return(e>=360||-360>=e)&&(e%=360),e>22.5&&67.5>=e&&(i+=1),-22.5>e&&e>=-67.5&&(i-=1),e>67.5&&112.5>=e&&(i+=2),-67.5>e&&e>=-112.5&&(i-=2),e>112.5&&157.5>=e&&(i+=3),-112.5>e&&e>=-157.5&&(i-=3),e>157.5&&202.5>=e&&(i+=4),-157.5>e&&e>=-202.5&&(i-=4),e>202.5&&247.5>=e&&(i+=5),-202.5>e&&e>=-247.5&&(i-=5),e>247.5&&292.5>=e&&(i+=6),-247.5>e&&e>=-292.5&&(i-=6),e>292.5&&337.5>=e&&(i+=7),-292.5>e&&e>=-337.5&&(i-=7),i>8&&(i-=8),0>=i&&(i+=8),n[i]}}),Me.vector.interaction.MoveLinkInteraction=function(t,e){Me.vector.interaction.MoveLinkInteraction.superClass.constructor.call(this,t),this.xoffset=0,this.yoffset=0},Oe.ext("twaver.vector.interaction.MoveLinkInteraction",Me.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown"),this.oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown"),this.network.getView().style.cursor=this.oldCursor,this.end()},handle_mousedown:function(t){if(0===t.button&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var e=this.network.getElementAt(t);e instanceof Me.Link&&(this.element=e,this.end(t),this._handle_mousedown(t))}},handle_mouseup:function(t){this.end(t)},handle_mousemove:function(t){if(!this._startLogical||this.network.isSelectingElement()||this.network.isEditingElement())return void this.end(t);if(this._handle_mousemove(t),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y,this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:t,element:this.element});else{this.mark=je.createCanvas();var e;this.network.getMovableSelectedElements().forEach(function(t){var i=this.getElementUI(t);i&&(e=Ze.unionRect(e,i.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),je.setDiv(this.mark,e,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:t,element:this.element})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else{var i=new Me.List([this.element.getFromNode(),this.element.getToNode()]);Me.Util.moveElements(i,this.xoffset,this.yoffset),this._startLogical=this._endLogical,this._startClient=je.getClientPoint(t),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t,element:this.element}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t,element:this.element}))}},end:function(t){if(this._startLogical){if(this.lazyMode){if(this.mark){var e=this,i=function(){e.network.fireInteractionEvent({kind:"lazyMoveEnd",event:t,element:this.element}),e.mark&&(e.network.getTopDiv().removeChild(e.mark),e.mark=null,e.network.setMovingElement(!1))},n=new Me.List([this.element.getFromNode(),this.element.getToNode()]);Me.Util.moveElements(n,this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),i)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t,element:this.element}));this._handle_mouseup(t),delete this.element}}}),Me.vector.interaction.CreateLinkInteraction=function(t,e){e||(e=Me.Link),this.linkFunction=Me.Util.isTypeOf(e,Me.Link)?function(t,i){var n=new e;return n instanceof Me.Link&&(n.setFromNode(t),n.setToNode(i)),n}:e,Me.vector.interaction.CreateLinkInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.vector.interaction.CreateLinkInteraction",Me.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this)},paint:function(t){t.beginPath();var e,i;t.lineWidth=this.network.getEditLineWidth();var n=this.network.getEditLineColor();this.currentNode&&this.currentNode!==this.fromNode&&(e=this.network.getElementUI(this.currentNode).getZoomViewRect(!0),i=this.convertFromUIToMarkerRect(e,0,0),Hn.rect(t,i.x,i.y,i.width,i.height,null,n)),this.fromNode&&(e=this.network.getElementUI(this.fromNode).getZoomViewRect(!0),i=this.convertFromUIToMarkerRect(e,0,0),Hn.rect(t,i.x,i.y,i.width,i.height,null,n)),this.currentPoint&&this.paintLine(t),t.closePath()},convertFromUIToMarkerRect:function(t,e,i){var n=this.network.zoomManager,o=n.getGraphicsZoom();return{x:t.x*o-this.network.getViewRect().x+e*o,y:t.y*o-this.network.getViewRect().y+i*o,width:t.width*o,height:t.height*o}},getZoomNodeRectOrPoint:function(t,e){var i=this.network.getElementUI(t).getZoomBodyRect();return e?{x:i.x+i.width/2,y:i.y+i.height/2}:i},paintLine:function(t){var e=this.network.getEditLineColor(),i=this.network.getElementUI(this.fromNode).getZoomBodyRect(),n=this.convertPointFromView({x:i.x+i.width/2,y:i.y+i.height/2}),o=n.x,s=n.y,a=this.currentPoint.x,r=this.currentPoint.y;t.strokeStyle=e,t.beginPath(),t.moveTo(o,s),t.lineTo(a,r),t.stroke()},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(t){if(this.network.isValidEvent(t))if(this.fromNode){if(this.toNode=this.currentNode,this.toNode){var e=this.createLink();e&&this.network.addElementByInteraction(e)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint()},handle_mousemove:function(t){var e=this.getMarkerPoint(t);if(e){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.clear();var i=null;this.fromNode?(this.currentNode=this.getToNode(t,this.fromNode),this.currentPoint=e,this.repaint()):(i=this.getFromNode(t),this.currentNode!==i&&(this.currentNode=i,this.repaint()))}},getFromNode:function(t){return this.getNode(t)},getToNode:function(t,e){return this.getNode(t,e)},getNode:function(t,e){var i=this.network.getElementAt(t);return i instanceof Fn&&this.network.isLinkable(i,e)&&this.network.getElementBox().getSelectionModel().isSelectable(i)?i:null}}),Me.vector.interaction.CreateShapeLinkInteraction=function(t,e){Me.vector.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,t),e||(e=Me.ShapeLink),this.linkFunction=Me.Util.isTypeOf(e,Me.ShapeLink)?function(t,i,n){var o=new e;if(o instanceof Me.ShapeLink&&(o.setFromNode(t),o.setToNode(i),n)){var s=this.network.zoomManager;o.setPoints(s._getShapeLinkZoomPoints(n,!0))}return o}:e},Oe.ext("twaver.vector.interaction.CreateShapeLinkInteraction",Me.vector.interaction.CreateLinkInteraction,{clear:function(){this.points=null,Me.vector.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(t){if(0===t.button){var e=this.network.getLogicalPoint2(t);if(e){if(this.fromNode)if(this.toNode=this.currentNode,this.toNode){var i=this.createLink();i&&this.network.addElementByInteraction(i),this.clear()}else{if(this.points||(this.points=new Me.List),this.points.size()>0){var n=this.points.get(this.points.size()-1);if(n.x===e.x&&n.y===e.y)return}this.points.add(e)}else this.fromNode=this.currentNode,this.points=null,this.currentNode=null,this.currentPoint=null;this.repaint()}}},paintLine:function(t){if(this.currentPoint){var e,i=new Me.List;if(e=this.convertPointFromView(this.getZoomNodeRectOrPoint(this.fromNode,!0)),i.add(e,0),this.points&&this.points.size()>0)for(var n=this.points.size(),o=0;n>o;o++)e=this.convertPointFromView(this.points.get(o)),i.add(e);e=this.currentPoint,i.add(e),t.lineWidth=this.network.getEditLineWidth(),t.strokeStyle=this.network.getEditLineColor(),t.beginPath(),Ke.drawLinePoints(t,i),t.stroke()}}}),Me.vector.interaction.CreateShapeNodeInteraction=function(t,e){e||(e=Me.ShapeNode),this.shapeNodeFunction=Me.Util.isTypeOf(e,Me.ShapeNode)?function(t){var i=new e;if(i instanceof Me.ShapeNode){var n=this.network.zoomManager,o=this.network.createElementUI(i);if(t){var s=n._getShapeNodeZoomPoints(o,t,!0);o.invalidateZoom(),i.setPoints(s)}}return i}:e,Me.vector.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,t),this.timeStamp=-1},Oe.ext("twaver.vector.interaction.CreateShapeNodeInteraction",Me.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this),this.network.setEditingElement(!1)},clear:function(){this.points=null,this.currentPoint=null},paint:function(t){if(this.points&&this.points.size()>0&&this.currentPoint){for(var e,i=new Me.List,n=this.points.size(),o=0;n>o;o++)e=this.convertPointFromView(this.points.get(o)),i.add(e);e=this.convertPointFromView(this.currentPoint),i.add(e),t.lineWidth=this.network.getEditLineWidth(),t.strokeStyle=this.network.getEditLineColor(),t.beginPath(),Ke.drawLinePoints(t,i),t.stroke()}},handle_mousedown:function(t){if(0===t.button){var e=this.network.getLogicalPoint2(t);if(e){if(2===t.detail||t.timeStamp-this.timeStamp<300){if(this.points){var i=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(i),this.clear();var n=this;setTimeout(function(){n.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new Me.List),this.points.size()>0){var o=this.points.get(this.points.size()-1);if(o.x===e.x&&o.y===e.y)return}this.points.add(e)}this.timeStamp=t.timeStamp,this.repaint()}}},handle_mousemove:function(t){this.points&&(this.currentPoint=this.network.getLogicalPoint2(t),this.repaint())}}),Me.vector.interaction.MagnifyInteraction=function(t,e,i,n,o){Me.vector.interaction.MagnifyInteraction.superClass.constructor.call(this,t),this.scale=e||2,this.xRadius=i||100,this.yRadius=n||100,this.shape=o||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=je.createCanvas()},Oe.ext("twaver.vector.interaction.MagnifyInteraction",Me.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove"),this.addListener("mousewheel"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousemove"),this.removeListener("mousewheel"),this.network.removeMarker(this)},paint:function(t){if(this.point){var e=this.network.zoomManager,i=e.getLocationZoom(),n=e.getGraphicsZoom(),o=(e.getSizeZoom(),this.network.getZoom(),this.xRadius/this.scale/n),s=this.yRadius/this.scale/n;if("mousewheel"===this.mouseFlag){var a={x:this.zoomPoint.x-o,y:this.zoomPoint.y-s,width:2*o,height:2*s};this.network.toCanvasByRegion(a,this.scale*n,this.markCanvas,"white");var r={x:this.zoomPoint.x-this.xRadius-this.network.viewRect.x,y:this.zoomPoint.y-this.yRadius-this.network.viewRect.y,width:this.markCanvas.width,height:this.markCanvas.height}}else{var a={x:this.point.x*i-o,y:this.point.y*i-s,width:2*o,height:2*s};this.network.toCanvasByRegion(a,this.scale*n,this.markCanvas,"white");var r={x:this.point.x*i*n-this.xRadius-this.network.viewRect.x,y:this.point.y*i*n-this.yRadius-this.network.viewRect.y,width:this.markCanvas.width,height:this.markCanvas.height}}t.save(),t.beginPath(),Ke.drawVector(t,this.shape,null,r.x,r.y,2*a.width*n,2*a.height*n),t.clip(),t.fillStyle=this.backgroundColor,t.beginPath(),t.rect(r.x,r.y,r.width,r.height),t.fill(),t.drawImage(this.markCanvas,r.x,r.y),t.restore(),t.beginPath(),t.lineWidth=this.borderWidth,Ke.drawVector(t,this.shape,null,r.x+this.borderWidth/2,r.y+this.borderWidth/2,2*a.width*n-this.borderWidth,2*a.height*n-this.borderWidth),t.strokeStyle=this.borderColor,t.stroke(),this.mouseFlag=null}},handle_mousemove:function(t){this.point=this.network.getLogicalPoint(t),this.point&&(this.mouseFlag="mousemove",this.repaint())},handle_mousewheel:function(t){var e=this.network.zoomManager,i=e.getLocationZoom();1!==i&&(this.zoomPoint=this.network.getLogicalPoint2(t)),this.zoomPoint&&(this.mouseFlag="mousewheel",this.repaint())},getScale:function(){return this.scale},setScale:function(t){this.scale=t,this.network.repaintTopCanvas()},getShape:function(){return this.shape},setShape:function(t){this.shape=t,this.network.repaintTopCanvas()},getXRadius:function(){return this.xRadius},setXRadius:function(t){this.xRadius=t,this.network.repaintTopCanvas()},getYRadius:function(){return this.yRadius},setYRadius:function(t){this.yRadius=t,this.network.repaintTopCanvas()},getBorderColor:function(){return this.borderColor},setBorderColor:function(t){this.borderColor=t,this.network.repaintTopCanvas()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(t){this.borderWidth=t,this.network.repaintTopCanvas()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(t){this.backgroundColor=t,this.network.repaintTopCanvas()}}),Me.vector.interaction.TouchInteraction=function(t){Me.vector.interaction.TouchInteraction.superClass.constructor.call(this,t)},Oe.ext("twaver.vector.interaction.TouchInteraction",Me.vector.interaction.BaseInteraction,{setUp:function(){var t=this.network.getView();je.addEventListener("touchstart","handleTouchstart",t,this),je.addEventListener("touchmove","handleTouchmove",t,this),je.addEventListener("touchend","handleTouchend",t,this),je.addEventListener("touchcancel","handleTouchend",t,this)},tearDown:function(){var t=this.network.getView();je.removeEventListener("touchstart",t,this),je.removeEventListener("touchmove",t,this),je.removeEventListener("touchend",t,this),je.removeEventListener("touchcancel",t,this)},_isDragToSelect:function(t){return!this.network._dragToPan},handleTouchstart:function(t){if(je.preventDefault(t),this.isMoving=!1,this.isSelecting=!1,1==t.touches.length){var e=this.network.getLogicalPoint2(t),i=this._element=this.network.getElementAt(e);if(this._startTouchTime=new Date,this._currentTouchPoint=e,this._startTouchClient=this._currentTouchClient=this.getMarkerPoint(t),i)if(this.network.getSelectionModel().contains(i))this.isSelecting=!0;else{this.network.getSelectionModel().setSelection(i);var n=this.network.getSelectionModel();n.contains(i)&&(this.isSelecting=!0,console.log("isSelecting",!0))}else this.isSelecting=!1,this.network.getSelectionModel().clearSelection();Ii.handleClicked(this.network,t,i),this._endTouchTime&&this._startTouchTime.getTime()-this._endTouchTime.getTime()<=500&&Ze.getDistance(this._endTouchClient,this._startTouchClient)<=20?(delete this._endTouchTime,delete this._endTouchClient,Ii.handleDoubleClicked(this.network,t,i)):(this._endTouchTime=this._startTouchTime,this._endTouchClient=this._startTouchClient)}else this._distance=bi.getDistance(t),this._zoom=this.network.getZoom()},handleTouchmove:function(t){if(je.preventDefault(t),t.touches.length>1){var e=bi.getDistance(t);if(Math.abs(e-this._distance)<20)return;var i=e/this._distance;this.network.setZoom(this._zoom*i,!1)}else if(null==this._zoom){var n=this.getMarkerPoint(t);if(Ze.getDistance(this._startTouchClient,n)<20)return;if(this._element)if(this.isSelecting||this._isDragToSelect(t)){var o=this.network.getLogicalPoint2(t),s=this.getOffset(o,this._currentTouchPoint),a=s.x,r=s.y;this._currentTouchPoint=o,this.network.moveSelectedElements(a,r),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t}))}else{var a=this._currentTouchClient.x-n.x,r=this._currentTouchClient.y-n.y;this.network.panByOffset(a,r),this._currentTouchClient=n}else{var a=this._currentTouchClient.x-n.x,r=this._currentTouchClient.y-n.y;this.network.panByOffset(a,r),this._currentTouchClient=n}}},handleTouchend:function(t){je.preventDefault(t),this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t})),0===t.touches.length&&(this._distance=null,this._zoom=null,this._element=null,this._startTouchTime=null,this._currentTouchPoint=null,this._startTouchClient=this._currentTouchClient=null)}}),Me.vector.interaction.MSTouchInteraction=function(t){Me.vector.interaction.MSTouchInteraction.superClass.constructor.call(this,t),this._pointerMap={},this._pointerIdArray=[]},Oe.ext("twaver.vector.interaction.MSTouchInteraction",Me.vector.interaction.BaseInteraction,{setUp:function(){var t=this.network.getView();je.addEventListener("MSPointerDown","handleTouchstart",t,this),je.addEventListener("MSPointerMove","handleTouchmove",t,this),je.addEventListener("MSPointerUp","handleTouchend",t,this),je.addEventListener("MSPointerCancel","handleTouchend",t,this),this.network.addMarker(this)},tearDown:function(){var t=this.network.getView();je.removeEventListener("MSPointerDown",t,this),je.removeEventListener("MSPointerMove",t,this),je.removeEventListener("MSPointerUp",t,this),je.removeEventListener("MSPointerCancel",t,this),this.network.removeMarker(this)},handleTouchstart:function(t){if(this.network.isFocusOnClick()&&Me.Util.setFocus(this.network._view),!this.network.isSelectingElement()||t.pointerType!=t.MSPOINTER_TYPE_MOUSE){var e=this.network.getLogicalPoint2(t),i=new Date;if(t.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(t),this._pointerMap[t.pointerId]||(this._pointerIdArray.push(t.pointerId),this._pointerMap[t.pointerId]=t),1==this._pointerIdArray.length){var n=this.network.getElementAt(e);this._startTouchElement=n,this._startClientPoint={x:t.clientX,y:t.clientY};var o=this.network.getSelectionModel();n?Oe.isCtrlDown(t)?o.contains(n)?o.removeSelection(n):o.appendSelection(n):o.contains(n)||o.setSelection(n):Oe.isCtrlDown(t)||o.clearSelection(),Ii.handleClicked(this.network,t,n),this._startTouchTime&&this._startTouchPoint&&i.getTime()-this._startTouchTime.getTime()<=500&&Ze.getDistance(this._startTouchPoint,e)<=20?(Ii.handleDoubleClicked(this.network,t,n),this._doubleClick=!0):(je.handle_mousedown(this,t),this._startTouchPoint=e,this._startTouchTime=i)}else 2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())}},handleTouchmove:function(t){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[t.pointerId]&&!(Ze.getDistance({x:this._pointerMap[t.pointerId].pageX,y:this._pointerMap[t.pointerId].pageY},{x:t.pageX,y:t.pageY})<=10)&&(this._pointerMap[t.pointerId]=t,2==this._pointerIdArray.length)){var e=this._getDistance()/this._distance;this.network.setZoom(this._zoom*e,!1)}},handleTouchend:function(t){if(this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:t})),this.network.isSelectingElement()){var e=Ze.getRect([this._startTouchPoint,this._moveTouchPoint]),i=this.network.getElementsAtRect(e,this.getIntersectMode(),this.network.getRectSelectFilter());if(i&&i.size()>0){var n=this.network.getSelectionModel(),o=n.toSelection();i.forEach(function(t){n.contains(t)?o.remove(t):o.add(t)},this),n.setSelection(o)}this.network.fireInteractionEvent({kind:"selectEnd",event:t}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);for(var s=-1,a=0;a<this._pointerIdArray.length;a++)if(this._pointerIdArray[a]==t.pointerId){s=a;break}s>=0&&this._pointerIdArray.splice(s,1),delete this._pointerMap[t.pointerId],this._moveTouchPoint=null},_getDistance:function(){return Ze.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(t){var e={x:t.clientX,y:t.clientY};if(!(Ze.getDistance(this._startClientPoint,e)<3)&&this._startTouchPoint&&1==this._pointerIdArray.length)if(this._moveTouchPoint={x:this._startTouchPoint.x+(e.x-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(e.y-this._startClientPoint.y)/this.network.getZoom()},null==this._startTouchElement&&this.network.isRectSelectEnabled()){var i=this.network.getLogicalPoint2(t);if(!i)return;this.network.setSelectingElement(!0),this.network.fireInteractionEvent(this._moveTouchPoint?{kind:"selectBetween",event:t}:{kind:"selectStart",event:t}),this.repaint()}else{var n=this.network.getElementAt(this._moveTouchPoint);if(null!=this._startTouchElement||this.network.isRectSelectEnabled()){if(this.network.isMovingElement()||null!=this._startTouchElement&&n==this._startTouchElement&&this.network.getMovableSelectedElements().contains(n)){var o=this._moveTouchPoint.x-this._startTouchPoint.x,s=this._moveTouchPoint.y-this._startTouchPoint.y;this.network.moveSelectedElements(o,s),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:t}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:t}))}}else{var o=this._startClientPoint.x-e.x,s=this._startClientPoint.y-e.y;this.network.panByOffset(o,s)}this._startClientPoint=e}},handle_mouseup:function(t){this.handleTouchend(t),this._pointerIdArray=[],this._pointerMap={}},paint:function(t){if(this._startTouchPoint&&this._moveTouchPoint&&!this._startTouchElement&&this.network.isRectSelectEnabled()){var e=this.convertPointFromView(this._startTouchPoint),i=this.convertPointFromView(this._moveTouchPoint),n=e.x,o=e.y,s=i.x,a=i.y,r=Ze.getRect([{x:n,y:o},{x:s,y:a}]);if(null!=r){t.beginPath();var h=this.network.getSelectOutlineWidth(),l=this.getIntersectMode()?this.network.getSelectFillColor():null;t.strokeStyle=this.network.getSelectOutlineColor(),t.lineWidth=h,Hn.rect(t,r.x,r.y,r.width,r.height,l,this.network.getSelectOutlineColor()),t.closePath()}}}}),Me.XmlSerializer=function(t,e,i){this.dataBox=t,this.settings=e?e:new Me.SerializationSettings,this.filterFunction=i,this.ref=0,this.refMap={},this.idMap={},this.xmlString=""},Oe.ext("twaver.XmlSerializer",Object,{serialize:function(){return this.xmlString="<twaver version='"+Me.Util.getVersion()+"' platform='html5'>\n",this.serializeBody(),this.xmlString+="</twaver>\n",this.xmlString},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable&&(this.xmlString+="<dataBox class='"+this.dataBox.getClassName()+"'>\n",this.dataBox.serializeXml(this,this.dataBox.newInstance()),this.xmlString+="</dataBox>\n"),this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(t){this.refMap[t.getId()]=this.ref++,t.getChildren().forEach(this.initRefs,this)},isSerializable:function(t){return this.dataBox.contains(t)?this.filterFunction&&!this.filterFunction(t)?!1:!0:!1},serializeData:function(t){if(this.isSerializable(t)){var e=t.newInstance(),i=this.refMap[t.getId()];this.xmlString+="<data class='"+t.getClassName()+"' ref='"+i+"'",null!=this.settings.getPropertyType("id")&&(this.xmlString+=" id='"+t.getId()+"'"),this.xmlString+=">\n",t.serializeXml(this,e),this.xmlString+="</data>\n"}t.getChildren().forEach(this.serializeData,this)},serializePropertyXml:function(t,e,i){var n=this.settings.getPropertyType(e);if(n){var o=Oe.getValue(t,e,n),s=Oe.getValue(i,e,n);o!==s&&this.serializeValue("p",e,o,s,n)}},serializeStyleXml:function(t,e,i){var n=this.settings.getStyleType(e);if(n){var o=t.getStyle(e),s=i.getStyle(e);o!=s&&this.serializeValue("s",e,o,s,n)}},serializeClientXml:function(t,e,i){var n=this.settings.getClientType(e);if(null!=n){var o=t.getClient(e),s=i.getClient(e);o!=s&&this.serializeValue("c",e,o,s,n)}},serializeValue:function(t,e,i,n,o){if(null==i)this.xmlString+="\t<"+t+" n='"+e+"' none=''/>\n";else if("cdata"===o)this.xmlString+="\t<"+t+" n='"+e+"'><![CDATA["+i+"]]></"+t+">\n";else if("data"===o){var s=this.refMap[i.getId()];null!=s&&(this.xmlString+="\t<"+t+" n='"+e+"' ref='"+s+"'/>\n")}else"point"===o?n&&i.x===n.x&&i.y===n.y||(this.xmlString+="\t<"+t+" n='"+e+"' x='"+i.x+"' y='"+i.y+"'/>\n"):"list.point"===o?(this.xmlString+="\t<"+t+" n='"+e+"'>\n",i.forEach(function(t){this.xmlString+="\t\t<p x='"+t.x+"' y='"+t.y+"'/>\n"},this),this.xmlString+="\t</"+t+">\n"):"list.string"===o||"list.number"===o?(this.xmlString+="\t<"+t+" n='"+e+"'>\n",i.forEach(function(t){this.xmlString+="\t\t<s>"+t+"</s>\n"},this),this.xmlString+="\t</"+t+">\n"):this.xmlString+="rectangle"===o?"\t<"+t+" n='"+e+"' x='"+i.x+"' y='"+i.y+"' w='"+i.width+"' h='"+i.height+"'/>\n":"\t<"+t+" n='"+e+"'>"+i+"</"+t+">\n"},deserialize:function(t,e){Oe.isDeserializing=!0,this.xmlString=t;var i=Oe.xml(t).documentElement;this.refMap={},this.idMap={};var n,o,s,a=new fn,r=new fn,h=i.getElementsByTagName("data"),l=h.length;for(s=0;l>s;s++){o=h[s];var c=o.getAttribute("class"),d=this.settings.getPropertyType("id");if(d&&o.hasAttribute("id")){var u=null;if("string"===d)u=o.getAttribute("id");else if("int"===d)u=parseInt(o.getAttribute("id"));else{if("number"!==d)throw"Unsupported id type '"+d+"'";u=parseFloat(o.getAttribute("id"))}if("remove"===o.getAttribute("action")){this.dataBox.removeById(u);continue}n=this.dataBox.getDataById(u),n||(n=Oe.newInstance(c,u))}else n=Oe.newInstance(c);if(o.hasAttribute("ref")){var _=o.getAttribute("ref");this.refMap[_]=n}a.add(n),r.add(o),this.idMap[n.getId()]=n}for(this.dataBox.forEach(function(t){this.idMap[t.getId()]=t},this),l=a.size(),s=0;l>s;s++)n=a.get(s),o=r.get(s),n.deserializeXml(this,o);for(s=0;l>s;s++)n=a.get(s),this.dataBox.containsById(n.getId())||(e&&!n.getParent()&&n.setParent(e),this.dataBox.add(n));this.settings.isDataBoxSerializable&&1===i.getElementsByTagName("dataBox").length&&this.dataBox.deserializeXml(this,i.getElementsByTagName("dataBox")[0]),Oe.isDeserializing=!1},deserializePropertyXml:function(t,e,i){var n=this.settings.getPropertyType(i);n&&Oe.setValue(t,i,this.deserializeValue(e,n))},deserializeStyleXml:function(t,e,i){var n=this.settings.getStyleType(i);n&&t.setStyle(i,this.deserializeValue(e,n))},deserializeClientXml:function(t,e,i){var n=this.settings.getClientType(i);n&&t.setClient(i,this.deserializeValue(e,n))},deserializeValue:function(t,e){if(t.hasAttribute("@none"))return null;if("string"===e)return t.textContent;if("number"===e)return parseFloat(t.textContent);if("boolean"===e)return"true"===t.textContent;if("int"===e)return parseInt(t.textContent);if("point"===e)return{x:parseFloat(t.getAttribute("x")),y:parseFloat(t.getAttribute("y"))};if("data"===e){var i=t.getAttribute("ref"),n=this.refMap[i];return n?n:this.idMap[i]}var o,s,a,r;if("list.point"===e){var h=new fn,l=t.getElementsByTagName("p");for(o=l.length,r=0;o>r;r++){var c=l[r];h.add({x:parseFloat(c.getAttribute("x")),y:parseFloat(c.getAttribute("y"))})}return h}if("list.string"===e){var d=new fn;for(a=t.getElementsByTagName("s"),o=a.length,r=0;o>r;r++)d.add(a[r].textContent);return d}if("list.number"===e){for(s=new fn,a=t.getElementsByTagName("s"),o=a.length,r=0;o>r;r++)s.add(parseFloat(a[r].textContent));return s}if("array.string"===e)return t.textContent.split(",");if("array.number"===e){for(s=t.textContent.split(","),o=s.length,r=0;o>r;r++)s[r]=parseFloat(s[r]);return s}return"rectangle"===e?{x:parseFloat(t.getAttribute("x")),y:parseFloat(t.getAttribute("y")),width:parseFloat(t.getAttribute("w")),height:parseFloat(t.getAttribute("h"))}:t.textContent}}),Oe.addMethod(Me.Data,{serializeXml:function(t,e){if(t.settings.isClientSerializable&&this._clientMap)for(var i in this._clientMap)this.serializeClientXml(t,i,e);this.serializePropertyXml(t,"name",e),this.serializePropertyXml(t,"icon",e),this.serializePropertyXml(t,"toolTip",e),this.serializePropertyXml(t,"parent",e)},serializePropertyXml:function(t,e,i){t.serializePropertyXml(this,e,i)},serializeClientXml:function(t,e,i){t.serializeClientXml(this,e,i)},deserializeXml:function(t,e){var i,n,o,s,a=e.getElementsByTagName("p"),r=a.length;for(i=0;r>i;i++)n=a[i],n.hasAttribute("n")&&this.deserializePropertyXml(t,n,n.getAttribute("n"));if(t.settings.isClientSerializable)for(o=e.getElementsByTagName("c"),r=o.length,i=0;r>i;i++)s=o[i],s.hasAttribute("n")&&this.deserializeClientXml(t,s,s.getAttribute("n"))},deserializePropertyXml:function(t,e,i){t.deserializePropertyXml(this,e,i)},deserializeClientXml:function(t,e,i){t.deserializeClientXml(this,e,i)}}),Oe.addMethod(Me.Element,{serializeXml:function(t,e){if(t.settings.isStyleSerializable&&this._styleMap)for(var i in this._styleMap)this.serializeStyleXml(t,i,e);Me.Element.superClass.serializeXml.call(this,t,e),this.serializePropertyXml(t,"layerId",e),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===t.settings.getPropertyType("alarmState")&&(t.xmlString+="\t<p n='alarmState'>\n",Me.AlarmSeverity.forEach(function(e){var i=this.getNewAlarmCount(e);i>0&&(t.xmlString+="\t\t<n n='"+e.name+"' c='"+i+"'/>\n")},this._alarmState),Me.AlarmSeverity.forEach(function(e){var i=this.getAcknowledgedAlarmCount(e);i>0&&(t.xmlString+="\t\t<a n='"+e.name+"' c='"+i+"'/>\n")},this._alarmState),t.xmlString+="\t</p>\n")},serializeStyleXml:function(t,e,i){t.serializeStyleXml(this,e,i)},deserializeXml:function(t,e){if(Me.Element.superClass.deserializeXml.call(this,t,e),t.settings.isStyleSerializable){var i,n,o=e.getElementsByTagName("s"),s=o.length;for(i=0;s>i;i++)n=o[i],n.hasAttribute("n")&&this.deserializeStyleXml(t,n,n.getAttribute("n"))}},deserializeStyleXml:function(t,e,i){t.deserializeStyleXml(this,e,i)},deserializePropertyXml:function(t,e,i){if("alarmState"===i){if("alarmstate"===t.settings.getPropertyType("alarmState")){var n,o,s,a=e.getElementsByTagName("n");for(o=0;o<a.length;o++)s=a[o],n=Me.AlarmSeverity.getByName(s.getAttribute("n")),this._alarmState.setNewAlarmCount(n,parseInt(s.getAttribute("c")));for(a=e.getElementsByTagName("a"),o=0;o<a.length;o++)s=a[o],n=Me.AlarmSeverity.getByName(s.getAttribute("n")),this._alarmState.setAcknowledgedAlarmCount(n,parseInt(s.getAttribute("c")))}}else Me.Element.superClass.deserializePropertyXml.call(this,t,e,i)}}),Oe.addMethod(Fn,{serializeXml:function(t,e){Fn.superClass.serializeXml.call(this,t,e),this.serializePropertyXml(t,"image",e),this.serializePropertyXml(t,"location",e),Oe.num(this._width)&&this._width>=0&&this.serializePropertyXml(t,"width",e),Oe.num(this._height)&&this._height>=0&&this.serializePropertyXml(t,"height",e)}}),Oe.addMethod(Me.Link,{serializeXml:function(t,e){Me.Link.superClass.serializeXml.call(this,t,e),this.serializePropertyXml(t,"fromNode",e),this.serializePropertyXml(t,"toNode",e)}}),Oe.addMethod(Me.Follower,{serializeXml:function(t,e){Me.Follower.superClass.serializeXml.call(this,t,e),this.serializePropertyXml(t,"host",e)}}),Oe.addMethod(Un,{serializeXml:function(t,e){Un.superClass.serializeXml.call(this,t,e),this.serializePropertyXml(t,"expanded",e)}}),Oe.addMethod(Me.ShapeNode,{serializeXml:function(t,e){Me.ShapeNode.superClass.serializeXml.call(this,t,e),this.serializePropertyXml(t,"points",e),this.serializePropertyXml(t,"segments",e)}}),Oe.addMethod(Me.ShapeLink,{serializeXml:function(t,e){Me.ShapeLink.superClass.serializeXml.call(this,t,e),this.serializePropertyXml(t,"points",e)}}),Oe.addMethod(Me.RotatableNode,{serializeXml:function(t,e){Me.RotatableNode.superClass.serializeXml.call(this,t,e),this.serializePropertyXml(t,"angle",e)}}),Oe.addMethod(Me.DataBox,{serializeXml:function(t,e){if(t.settings.isClientSerializable&&this._clientMap)for(var i in this._clientMap)this.serializeClientXml(t,i,e);this.serializePropertyXml(t,"name",e),this.serializePropertyXml(t,"icon",e),this.serializePropertyXml(t,"toolTip",e)},serializePropertyXml:function(t,e,i){t.serializePropertyXml(this,e,i)},serializeClientXml:function(t,e,i){t.serializeClientXml(this,e,i)},deserializeXml:function(t,e){var i,n,o,s,a=e.getElementsByTagName("p"),r=a.length;for(i=0;r>i;i++)n=a[i],n.hasAttribute("n")&&this.deserializePropertyXml(t,n,n.getAttribute("n"));if(t.settings.isClientSerializable)for(o=e.getElementsByTagName("c"),r=o.length,i=0;r>i;i++)s=o[i],s.hasAttribute("n")&&this.deserializeClientXml(t,s,s.getAttribute("n"))},deserializePropertyXml:function(t,e,i){t.deserializePropertyXml(this,e,i)},deserializeClientXml:function(t,e,i){t.deserializeClientXml(this,e,i)}}),Oe.addMethod(Me.ElementBox,{serializeXml:function(t,e){if(t.settings.isLayerBoxSerializable&&(t.xmlString+="\t<layerBox>\n",this._layerBox.forEachByDepthFirst(function(e){t.xmlString+=this._layerBox.getDefaultLayer()===e?"\t\t<layer ":"\t\t<layer id='"+e.getId()+"' ",e.getName()&&(t.xmlString+="name='"+e.getName()+"' "),t.xmlString+="visible='"+e.isVisible()+"' editable='"+e.isEditable()+"' movable='"+e.isMovable()+"'/>\n"},null,this),t.xmlString+="\t</layerBox>\n"),t.settings.isStyleSerializable&&this._styleMap)for(var i in this._styleMap)this.serializeStyleXml(t,i,e);Me.ElementBox.superClass.serializeXml.call(this,t,e)},serializeStyleXml:function(t,e,i){t.serializeStyleXml(this,e,i)},deserializeStyleXml:function(t,e,i){t.deserializeStyleXml(this,e,i)},deserializeXml:function(t,e){if(Me.ElementBox.superClass.deserializeXml.call(this,t,e),t.settings.isLayerBoxSerializable&&1==e.getElementsByTagName("layerBox").length)for(var i=e.getElementsByTagName("layerBox")[0].getElementsByTagName("layer"),n=0;n<i.length;n++){var o,s=i[n];if(s.hasAttribute("id")){var a=t.settings.getPropertyType("layerId");if("string"===a)o=new Me.Layer(s.getAttribute("id"));else if("int"===a)o=new Me.Layer(parseInt(s.getAttribute("id")));else{if("number"!==a)throw"Unsupported layer id type '"+a+"'";o=new Me.Layer(parseFloat(s.getAttribute("id")))}this._layerBox.getDataById(o.getId())?o=this._layerBox.getDataById(o.getId()):this._layerBox.add(o)}else o=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(o);s.hasAttribute("name")&&o.setName(s.getAttribute("name")),s.hasAttribute("visible")&&o.setVisible("true"===s.getAttribute("visible")),s.hasAttribute("editable")&&o.setEditable("true"===s.getAttribute("editable")),s.hasAttribute("movable")&&o.setMovable("true"===s.getAttribute("movable"))}if(t.settings.isStyleSerializable)for(var r=e.getElementsByTagName("s"),h=r.length,n=0;h>n;n++){var l=r[n];l.hasAttribute("n")&&this.deserializeStyleXml(t,l,l.getAttribute("n"))}}}),Me.JsonSerializer=function(t,e,i){this.dataBox=t,this.settings=e?e:new Me.SerializationSettings,this.filterFunction=i,this.ref=0,this.refMap={},this.idMap={},this.jsonObject={}},Oe.ext("twaver.JsonSerializer",Object,{serialize:function(){return this.jsonObject={version:Me.Util.getVersion(),platform:"html5"},this.settings.isImageSerializable&&(this.jsonObject.images={}),this.serializeBody(),JSON.stringify(this.jsonObject)},serializeBody:function(){if(this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable){var t={class:this.dataBox.getClassName(),p:{},s:{},c:{}};this.jsonObject.dataBox=t,this.dataBox.serializeJson(this,this.dataBox.newInstance(),t),Oe.isEmptyObject(t.p)&&delete t.p,Oe.isEmptyObject(t.s)&&delete t.s,Oe.isEmptyObject(t.c)&&delete t.c}this.jsonObject.datas=[],this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(t){this.refMap[t.getId()]=this.ref++,t.getChildren().forEach(this.initRefs,this)},isSerializable:function(t){return this.dataBox.contains(t)?this.filterFunction&&!this.filterFunction(t)?!1:!0:!1},serializeData:function(t){if(this.isSerializable(t)){var e=t.newInstance(),i=this.refMap[t.getId()],n={class:t.getClassName(),ref:i,p:{},s:{},c:{}};if(this.settings.getPropertyType("id")&&(this.jsonObject.id=t.getId()),this.jsonObject.datas.push(n),t.serializeJson(this,e,n),Oe.isEmptyObject(n.p)&&delete n.p,Oe.isEmptyObject(n.s)&&delete n.s,Oe.isEmptyObject(n.c)&&delete n.c,this.settings.isImageSerializable&&t.getImage){var o=t.getImage();if("string"==typeof o&&!Yn[o]&&!this.jsonObject.images[o]){var s=Oe.getImageAsset(o),a=s&&s.getImage();a&&!on(a)&&(this.jsonObject.images[o]=a)}}}t.getChildren().forEach(this.serializeData,this)},serializePropertyJson:function(t,e,i,n){var o=this.settings.getPropertyType(e);if(o){var s=Oe.getValue(t,e,o),a=Oe.getValue(i,e,o);s!==a&&this.serializeValue(e,s,a,o,n.p)}},serializeStyleJson:function(t,e,i,n){var o=this.settings.getStyleType(e);if(o){var s=t.getStyle(e),a=i.getStyle(e);s!=a&&this.serializeValue(e,s,a,o,n.s)}},serializeClientJson:function(t,e,i,n){var o=this.settings.getClientType(e);if(null!=o){var s=t.getClient(e),a=i.getClient(e);s!=a&&this.serializeValue(e,s,a,o,n.c)}},serializeValue:function(t,e,i,n,o){if(null==e)o[t]=null;else if(e instanceof fn)o[t]=e._as;else if("data"===n){var s=this.refMap[e.getId()];null!=s&&(o[t]=s)}else o[t]=e},deserialize:function(t,e){Oe.isDeserializing=!0,this.jsonObject=JSON.parse(t);var i=this.jsonObject.images;this.settings.isImageSerializable&&i&&Object.keys(i).forEach(function(t){Oe.registerImage(t,i[t])}),this.refMap={},this.idMap={};for(var n,o=new fn,s=new fn,a=this.jsonObject.datas.length,r=0;a>r;r++){var h=this.jsonObject.datas[r],l=h["class"],c=this.settings.getPropertyType("id");if(c&&null!=h.id){if("remove"===h.action){this.dataBox.removeById(h.id);continue}n=this.dataBox.getDataById(h.id),n||(n=Oe.newInstance(l,h.id))}else n=Oe.newInstance(l);null!=h.ref&&(this.refMap[h.ref]=n),o.add(n),s.add(h),this.idMap[n.getId()]=n}for(this.dataBox.forEach(function(t){this.idMap[t.getId()]=t},this),a=o.size(),r=0;a>r;r++)n=o.get(r),n.deserializeJson(this,s.get(r));for(r=0;a>r;r++)n=o.get(r),this.dataBox.containsById(n.getId())||(e&&!n.getParent()&&n.setParent(e),this.dataBox.add(n));this.settings.isDataBoxSerializable&&this.jsonObject.dataBox&&this.dataBox.deserializeJson(this,this.jsonObject.dataBox),Oe.isDeserializing=!1},deserializePropertyJson:function(t,e,i){var n=this.settings.getPropertyType(i);n&&Oe.setValue(t,i,this.deserializeValue(e,n))},deserializeStyleJson:function(t,e,i){var n=this.settings.getStyleType(i);n&&t.setStyle(i,this.deserializeValue(e,n))},deserializeClientJson:function(t,e,i){var n=this.settings.getClientType(i);n&&t.setClient(i,this.deserializeValue(e,n))},deserializeValue:function(t,e){if("data"===e){var i=this.refMap[t];return i?i:this.idMap[t]}return"array.number"===e?t:t instanceof Array?new fn(t):t}}),Oe.addMethod(Me.Data,{serializeJson:function(t,e,i){if(t.settings.isClientSerializable&&this._clientMap)for(var n in this._clientMap)this.serializeClientJson(t,n,e,i);this.serializePropertyJson(t,"name",e,i),this.serializePropertyJson(t,"icon",e,i),this.serializePropertyJson(t,"toolTip",e,i),this.serializePropertyJson(t,"parent",e,i)},serializePropertyJson:function(t,e,i,n){t.serializePropertyJson(this,e,i,n)},serializeClientJson:function(t,e,i,n){t.serializeClientJson(this,e,i,n)},deserializeJson:function(t,e){var i;for(i in e.p)this.deserializePropertyJson(t,e.p[i],i);if(t.settings.isClientSerializable)for(i in e.c)this.deserializeClientJson(t,e.c[i],i)},deserializePropertyJson:function(t,e,i){t.deserializePropertyJson(this,e,i)},deserializeClientJson:function(t,e,i){t.deserializeClientJson(this,e,i)}}),Oe.addMethod(Me.Element,{serializeJson:function(t,e,i){if(t.settings.isStyleSerializable&&this._styleMap)for(var n in this._styleMap)this.serializeStyleJson(t,n,e,i);if(Me.Element.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"layerId",e,i),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===t.settings.getPropertyType("alarmState")){var o={n:{},a:{}};i.p.alarmState=o,Me.AlarmSeverity.forEach(function(t){var e=this.getNewAlarmCount(t);e>0&&(o.n[t.name]=e)},this._alarmState),Me.AlarmSeverity.forEach(function(t){var e=this.getAcknowledgedAlarmCount(t);e>0&&(o.a[t.name]=e)},this._alarmState),Oe.isEmptyObject(o.n)&&delete o.n,Oe.isEmptyObject(o.a)&&delete o.a,Oe.isEmptyObject(o)&&delete i.p.alarmState}},serializeStyleJson:function(t,e,i,n){t.serializeStyleJson(this,e,i,n)},deserializeJson:function(t,e){if(Me.Element.superClass.deserializeJson.call(this,t,e),t.settings.isStyleSerializable)for(var i in e.s)this.deserializeStyleJson(t,e.s[i],i)},deserializeStyleJson:function(t,e,i){t.deserializeStyleJson(this,e,i)},deserializePropertyJson:function(t,e,i){if("alarmState"===i){if("alarmstate"===t.settings.getPropertyType("alarmState")){var n;for(n in e.n)this._alarmState.setNewAlarmCount(Me.AlarmSeverity.getByName(n),e.n[n]);for(n in e.a)this._alarmState.setAcknowledgedAlarmCount(Me.AlarmSeverity.getByName(n),e.a[n])}}else Me.Element.superClass.deserializePropertyJson.call(this,t,e,i)}}),Oe.addMethod(Fn,{serializeJson:function(t,e,i){Fn.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"image",e,i),this.serializePropertyJson(t,"location",e,i),Oe.num(this._width)&&this._width>=0&&this.serializePropertyJson(t,"width",e,i),Oe.num(this._height)&&this._height>=0&&this.serializePropertyJson(t,"height",e,i)}}),Oe.addMethod(Me.Link,{serializeJson:function(t,e,i){Me.Link.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"fromNode",e,i),this.serializePropertyJson(t,"toNode",e,i)}}),Oe.addMethod(Me.Follower,{serializeJson:function(t,e,i){Me.Follower.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"host",e,i)}}),Oe.addMethod(Un,{serializeJson:function(t,e,i){Un.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"expanded",e,i)}}),Oe.addMethod(Me.ShapeNode,{serializeJson:function(t,e,i){Me.ShapeNode.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"points",e,i),this.serializePropertyJson(t,"segments",e,i)}}),Oe.addMethod(Me.ShapeLink,{serializeJson:function(t,e,i){Me.ShapeLink.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"points",e,i)}}),Oe.addMethod(Me.RotatableNode,{serializeJson:function(t,e,i){Me.RotatableNode.superClass.serializeJson.call(this,t,e,i),this.serializePropertyJson(t,"angle",e,i)}}),Oe.addMethod(Me.DataBox,{serializeJson:function(t,e,i){if(t.settings.isClientSerializable&&this._clientMap)for(var n in this._clientMap)this.serializeClientJson(t,n,e,i);this.serializePropertyJson(t,"name",e,i),this.serializePropertyJson(t,"icon",e,i),this.serializePropertyJson(t,"toolTip",e,i)},serializePropertyJson:function(t,e,i,n){t.serializePropertyJson(this,e,i,n)},serializeClientJson:function(t,e,i,n){t.serializeClientJson(this,e,i,n)},deserializeJson:function(t,e){var i;for(i in e.p)this.deserializePropertyJson(t,e.p[i],i);if(t.settings.isClientSerializable)for(i in e.c)this.deserializeClientJson(t,e.c[i],i)},deserializePropertyJson:function(t,e,i){t.deserializePropertyJson(this,e,i)},deserializeClientJson:function(t,e,i){t.deserializeClientJson(this,e,i)}}),Oe.addMethod(Me.ElementBox,{serializeJson:function(t,e,i){if(t.settings.isLayerBoxSerializable&&(i.layers=[],this._layerBox.forEachByDepthFirst(function(t){var e={};i.layers.push(e),this._layerBox.getDefaultLayer()!==t&&(e.id=t.getId()),t.getName()&&(e.name=t.getName()),e.visible=t.isVisible(),e.editable=t.isEditable(),e.movable=t.isMovable()},null,this)),t.settings.isStyleSerializable&&this._styleMap)for(var n in this._styleMap)this.serializeStyleJson(t,n,e,i);Me.ElementBox.superClass.serializeJson.call(this,t,e,i)},serializeStyleJson:function(t,e,i,n){t.serializeStyleJson(this,e,i,n)},deserializeStyleJson:function(t,e,i){t.deserializeStyleJson(this,e,i)},deserializeJson:function(t,e){if(Me.ElementBox.superClass.deserializeJson.call(this,t,e),t.settings.isLayerBoxSerializable&&e.layers&&e.layers)for(var i=e.layers.length,n=0;i>n;n++){var o,s=e.layers[n];null!=s.id?(o=new Me.Layer(s.id),this._layerBox.getDataById(o.getId())?o=this._layerBox.getDataById(o.getId()):this._layerBox.add(o)):(o=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(o)),s.name&&o.setName(s.name),null!=s.visible&&o.setVisible(s.visible),null!=s.editable&&o.setEditable(s.editable),null!=s.movable&&o.setMovable(s.movable)}if(t.settings.isStyleSerializable)for(var a in e.s)this.deserializeStyleJson(t,e.s[a],a)}}),Me.layout.SpringLayouter=function(t){this._network=t,this._damper=1,this._maxMotion=0,this._motionRatio=0,this._isAdjusting=!1,this._timer=null,this._snodeMap={},this._snodes=new fn,this._slinks=new fn,this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this),this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this)},Oe.ext("twaver.layout.SpringLayouter",Object,{_nodeRepulsionFactor:.6,_linkRepulsionFactor:.6,_limitBounds:null,_interval:50,_stepCount:10,_motionLimit:.01,start:function(){if(!this._timer){var e=this,i=function(){e.relax.call(e)};this._timer=t.setInterval(i,this._interval),this._damper=1}},stop:function(){this._timer&&(t.clearInterval(this._timer),this._timer=null)},relax:function(){if(!(this._damper<.1&&this._maxMotion<this._motionLimit)){this._rebuild();for(var t=this._snodes.size(),e=0;e<this._stepCount;e++){this._slinks.forEach(this._relaxLink,this);for(var i=0;t>i;i++)for(var n=0;t>n;n++){var o=this._snodes.get(i),s=this._snodes.get(n);o!=s&&this._relaxNodePair(o,s)}this._moveNodes()}this._isAdjusting=!0;for(var e=0;t>e;e++){var a=this._snodes.get(e);a.fix||a.element.setLocation(a.x,a.y)}this._isAdjusting=!1}},isRunning:function(){return!!this._timer},getNetwork:function(){return this._network},isVisible:function(t){return this._network.isVisible(t)},isMovable:function(t){return this._network.isMovable(t)?this._network.getSelectionModel().contains(t)?!1:t instanceof Un?!1:!0:!1},getNodeRepulsionFactor:function(){return this._nodeRepulsionFactor},setNodeRepulsionFactor:function(t){.02>t&&(t=.02),this._nodeRepulsionFactor=t,this._damper=1},getLinkRepulsionFactor:function(){return this._linkRepulsionFactor},setLinkRepulsionFactor:function(t){.02>t&&(t=.02),this._linkRepulsionFactor=t,this._damper=1},getStepCount:function(){return this._stepCount},setStepCount:function(t){this._stepCount=t,this._damper=1},getInterval:function(){return this._interval},setInterval:function(e){if(this._interval!==e&&(this._interval=e,this._timer)){t.clearInterval(this._timer);var i=this,n=function(){i.relax.call(i)};this._timer=t.setInterval(n,this._interval)}},getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(t){this._limitBounds=t,this._damper=1},_handleDataPropertyChange:function(t){this._isAdjusting||(this._damper=1)},_handleDataBoxChange:function(t){this._damper=0===this._network.getElementBox().size()?0:1},_handleNetworkPropertyChange:function(t){if("elementBox"===t.property){var e=t.oldValue;null!=e&&(e.removeDataBoxChangeListener(this._handleDataBoxChange,this),e.removeDataPropertyChangeListener(this._handleDataPropertyChange,this)),this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this)}},_relaxLink:function(t){var e=t.toNode.x-t.fromNode.x,i=t.toNode.y-t.fromNode.y,n=Math.sqrt(e*e+i*i),o=.25*e,s=.25*i;o/=100*t.length;var a=t.length,r=100*a,h=s;s/=r,h/=100*t.length,t.toNode.dx=t.toNode.dx-o*n,t.toNode.dy=t.toNode.dy-s*n,t.fromNode.dx=t.fromNode.dx+o*n,t.fromNode.dy=t.fromNode.dy+s*n},_relaxNodePair:function(t,e){var i=0,n=0,o=t.x-e.x,s=t.y-e.y,a=o*o+s*s;0===a?(i=Me.Util.random(),n=Me.Util.random()):36e4>a&&(i=o/a,n=s/a);var r=t.repulsion*e.repulsion/100,h=.25*r;t.dx+=i*h,t.dy+=n*h,e.dx-=i*h,e.dy-=n*h},_moveNodes:function(){for(var t=this._maxMotion,e=0,i=0,n=this._snodes.size();n>i;i++){var o=this._snodes.get(i),s=o.dx,a=o.dy;s*=this._damper,a*=this._damper,o.dx=s/2,o.dy=a/2;var r=Math.sqrt(s*s+a*a);if(!o.fix)if(o.x=o.x+Math.max(-30,Math.min(30,s)),o.y=o.y+Math.max(-30,Math.min(30,a)),this._limitBounds){o.x<this._limitBounds.x&&(o.x=this._limitBounds.x,this._adjustLocation(1,0)),o.y<this._limitBounds.y&&(o.y=this._limitBounds.y,this._adjustLocation(0,1));var h,l=this._network.getElementUI(o.element);h=l?l._viewRect:o.element.getRect(),h&&(o.x+h.width>this._limitBounds.x+this._limitBounds.width&&(o.x=this._limitBounds.x+this._limitBounds.width-h.width,this._adjustLocation(-1,0)),o.y+h.height>this._limitBounds.y+this._limitBounds.height&&(o.y=this._limitBounds.y+this._limitBounds.height-h.height,this._adjustLocation(0,-1)))}else o.x<1&&this._adjustLocation(1,0),o.y<1&&this._adjustLocation(0,1);e=Math.max(r,e)}this._maxMotion=e,this._motionRatio=this._maxMotion>0?t/this._maxMotion-1:0,this._damp()},_damp:function(){this._motionRatio<=.001&&((this._maxMotion<.2||this._maxMotion>1&&this._damper<.9)&&this._damper>.01?this._damper-=.01:this._maxMotion<.4&&this._damper>.003?this._damper-=.003:this._damper>1e-4&&(this._damper-=1e-4)),this._maxMotion<this._motionLimit&&(this._damper=0)},_rebuild:function(){this._snodeMap={},this._snodes.clear(),this._slinks.clear(),this._network.getElementBox().forEach(function(t){this.isVisible(t)&&(t instanceof Me.Link?this._addLink(t):t instanceof Fn&&this._addNode(t))},this)},_addNode:function(t){var e=this._snodeMap[t.getId()];return e?e:(e={},e.element=t,e.repulsion=this._getRepulsion(t),e.x=t.getX(),e.y=t.getY(),e.dx=0,e.dy=0,e.fix=!this.isMovable(t),this._snodeMap[t.getId()]=e,this._snodes.add(e),e)},_addLink:function(t){var e={};e.fromNode=this._addNode(t.getFromNode()),e.toNode=this._addNode(t.getToNode()),e.element=t;var i,n,o=this._network.getElementUI(t.getToNode()),s=this._network.getElementUI(t.getFromNode());o&&o._viewRect&&s&&s._viewRect?(i=o._viewRect.width+s._viewRect.width,n=o._viewRect.height+s._viewRect.height):(i=t.getToNode().getWidth()+t.getFromNode().getWidth(),n=t.getToNode().getHeight()+t.getFromNode().getHeight()),e.length=Math.floor(Math.sqrt(i*i+n*n)*this._linkRepulsionFactor),e.length<=0&&(e.length=100),this._slinks.add(e)},_getRepulsion:function(t){var e,i=this._network.getElementUI(t);if(i&&i._viewRect){var n=i._viewRect;e=Math.floor(Math.sqrt(n.width*n.width+n.height*n.height)*this._nodeRepulsionFactor)}else e=100;return 0>=e&&(e=100),e},_adjustLocation:function(t,e){for(var i=0,n=this._snodes.size();n>i;i++){var o,s=this._snodes.get(i),a=this._network.getElementUI(s.element);if(o=a?a._viewRect:s.element.getRect(),!o)return;t>0?(!this._limitBounds||s.x+o.width+t<this._limitBounds.x+this._limitBounds.width)&&(s.x+=t):(!this._limitBounds||s.x+t>this._limitBounds.x)&&(s.x+=t),e>0?(!this._limitBounds||s.y+o.height+e<this._limitBounds.y+this._limitBounds.height)&&(s.y+=e):(!this._limitBounds||s.y+e>this._limitBounds.y)&&(s.y+=e)}}}),Me.layout.CloudLayouter=function(t){Me.layout.CloudLayouter.superClass.constructor.apply(this,arguments),this._network=t,this._centerX=0,this._centerY=0,this._radius=1,this._rect=null,this._localPoint=null,this._lastWidth=-1e3,this._lastHeight=-1e3,this._nodes=new fn,this._sa=0,this._ca=0,this._sb=0,this._cb=0,this._sc=0,this._cc=0,this._lasta=0,this._lastb=0,this._active=!1,this._horizontalElliptical=1,this._verticalElliptical=1,this._timer=null,this._centering=!1,this._centeringNode=null,this._freeze=!1,this._network.setInteractions("twaver.network.Network"===this._network.getClassName()?[new Me.network.interaction.SelectInteraction(this._network)]:[new Me.canvas.interaction.SelectInteraction(this._network)])},Oe.ext("twaver.layout.CloudLayouter",Me.PropertyChangeDispatcher,{__accessor:["updateNodeFunction","mouseMoveFunction","mouseOverFunction","percentPadding","ceaseRate","ceaseLimit"],__bool:["elliptical","active","updateLayoutRectOnResized","reloadOnDataBoxChanged"],_moveSpeed:2,_ceaseRate:.9,_ceaseLimit:.01,_percentPadding:.2,_elliptical:!0,_interval:50,_reloadOnDataBoxChanged:!0,_updateLayoutRectOnResized:!0,getNetwork:function(){return this._network},isLayoutable:function(t){return this._network.isVisible(t)&&this._network.isMovable(t)},start:function(e){if(0===arguments.length&&(e=!0),!this._timer){this._installListeners(),e&&this.updateLayoutRect(!0);var i=this,n=function(){i._update.call(i)};this._timer=t.setInterval(n,this._interval),this._update()}},stop:function(){this._timer&&(t.clearInterval(this._timer),this._timer=null)},isRunning:function(){return!!this._timer},getInterval:function(){return this._interval},setInterval:function(e){if(this._interval!==e){var i=this._interval;if(this._interval=e,this._timer){t.clearInterval(this._timer);var n=this,o=function(){n._update.call(n)};this._timer=t.setInterval(o,this._interval)}this.firePropertyChange("interval",i,e)}},getMoveSpeed:function(){return this._moveSpeed},setMoveSpeed:function(t){var e=this._moveSpeed;this._moveSpeed=t,this.firePropertyChange("moveSpeed",e,t)},getLayoutRect:function(){var t=this._network.getView().offsetWidth/this._network.getZoom(),e=this._network.getView().offsetHeight/this._network.getZoom(),i=t*this._percentPadding,n=e*this._percentPadding;return{x:i,y:n,width:t-2*i,height:e-2*n}},getCount:function(){return this._nodes.size()},updateLayoutRect:function(t){var e=this._radius;if(this._rect=this.getLayoutRect(),this._rect.width<=2&&(this._rect.width=2),this._rect.height<=2&&(this._rect.height=2),this._radius=Math.min(this._rect.width/2,this._rect.height/2),this.isElliptical()?(this._horizontalElliptical=this._rect.width/2/this._radius,this._verticalElliptical=this._rect.height/2/this._radius):(this._horizontalElliptical=1,this._verticalElliptical=1),this._centerX=this._rect.x+this._rect.width/2,this._centerY=this._rect.y+this._rect.height/2,t)this.reload();else{this._lasta=1,this._lastb=1;for(var i=this._nodes.size(),n=0;i>n;n++){var o=this._nodes.get(n);o.cx*=this._radius/e,o.cy*=this._radius/e,o.cz*=this._radius/e}this._freeze?this._updateNodes(0,0,0):this._update()}this._lastWidth=this._network.getView().offsetWidth,this._lastHeight=this._network.getView().offsetHeight},reload:function(){this._freeze=!1,this._centeringNode=null,this._localPoint=null,this._centering=!1,this._nodes=new fn,this._box.forEach(function(t){if(t&&this.isLayoutable(t)){var e={};e.node=t,this._nodes.add(e)}},this),this._sineCosine(0,0,0),this._active=!1,this._lasta=1,this._lastb=1;for(var t=0,e=0,i=this._nodes.size(),n=0;i>n;n++){t=Math.acos(-1+(2*(n+1)-1)/i),e=Math.sqrt(i*Math.PI)*t;var o=this._nodes.get(n);o.cx=this._radius*Math.cos(e)*Math.sin(t),o.cy=this._radius*Math.sin(e)*Math.sin(t),o.cz=this._radius*Math.cos(t)}},_sineCosine:function(t,e,i){var n=Math.PI/180;this._sa=Math.sin(t*n),this._ca=Math.cos(t*n),this._sb=Math.sin(e*n),this._cb=Math.cos(e*n),this._sc=Math.sin(i*n),this._cc=Math.cos(i*n)},handleSelectionChange:function(t){this.centerNode(this._network.getSelectionModel().getLastData())},handleDataBoxChange:function(t){(this._reloadOnDataBoxChanged||"clear"===t.kind)&&this.reload()},handleMouseMove:function(t){this._centering||this._updateLogicalPoint(t),this._active=this._mouseMoveFunction?this._mouseMoveFunction(t):!0},handleMouseOver:function(t){this._centering||this._updateLogicalPoint(t),this._active=this._mouseOverFunction?this._mouseOverFunction(t):!0},_updateLogicalPoint:function(t){this._localPoint=this._network.getLogicalPoint(t)},handleRollOut:function(t){this._active=!1},handleResize:function(t){if("validateEnd"===t.kind){if(!this._updateLayoutRectOnResized)return;if(Math.abs(this._network.getView().offsetWidth-this._lastWidth)<=2&&Math.abs(this._network.getView().offsetHeight-this._lastHeight)<=2)return;this.updateLayoutRect()}},handleNetworkPropertyChange:function(t){"elementBox"===t.property&&(this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this.reload()),"zoom"===t.property&&(this._localPoint=null,this.updateLayoutRect())},_adjustIndex:function(){this._nodes.sort(this._sortFunction);for(var t=this._nodes.size(),e=0;t>e;e++){var i=this._nodes.get(e).node,n=this._box.getDatas().indexOf(i);this._box.getDatas().removeAt(n),this._box.getDatas().add(i,e),this._box.fireIndexChange(i,n,e),this.updateNode(i,e,t,this._nodes.get(e).alpha)}},_sortFunction:function(t,e){return e.cz>t.cz?1:e.cz<t.cz?-1:0},updateNode:function(t,e,i,n){this._updateNodeFunction&&this._updateNodeFunction(t,e,i,n)},_update:function(){if(!this._freeze){var t,e;if(this._centering&&this._centeringNode){var i=this.isAtCenter(this._centeringNode.node,this._centeringNode.perspective,this._centeringNode.cx,this._centeringNode.cy,this._centeringNode.cz);if(i)return this._freeze=!0,this._centering=!1,void(this._centeringNode=null)}if(!this._freeze&&(this._active||this._centering)&&this._localPoint?this.isElliptical()?(t=(this._centerY-this._localPoint.y)/(this._rect.height/2)*this._moveSpeed,e=(this._localPoint.x-this._centerX)/(this._rect.width/2)*this._moveSpeed):(t=(this._centerY-this._localPoint.y)/this._radius*this._moveSpeed,e=(this._localPoint.x-this._centerX)/this._radius*this._moveSpeed):(t=this._lasta*this._ceaseRate,e=this._lastb*this._ceaseRate),this._lasta=t,this._lastb=e,Math.abs(t)>this._ceaseLimit||Math.abs(e)>this._ceaseLimit){var n=0;this._sineCosine(t,e,n);for(var o=0,s=this._nodes.size();s>o;o++){var a=this._nodes.get(o),r=a.cx,h=a.cy*this._ca+a.cz*-this._sa,l=a.cy*this._sa+a.cz*this._ca,c=r*this._cb+l*this._sb,d=h,u=r*-this._sb+l*this._cb,_=c*this._cc+d*-this._sc,g=c*this._sc+d*this._cc,f=u;a.cx=_,a.cy=g,a.cz=f;var v=2*this._radius;v/=v+f,a.perspective=v,a.alpha=(this._radius-f)/(2*this._radius);var m=this._horizontalElliptical*_*v-2*this._horizontalElliptical+this._centerX,p=g*v*this._verticalElliptical+this._centerY;a.node.setCenterLocation(m,p)}this._adjustIndex()}}},centerNode:function(t){if(t&&this.isLayoutable(t)){if(this._centeringNode&&t===this._centeringNode.node&&this._freeze)return;for(var e=0,i=this._nodes.size();i>e;e++){var n=this._nodes.get(e);if(n&&t===n.node){this._centering=!0,this._freeze=!1,this._active=!0,this._centeringNode=n,this._localPoint=this.createControlPoint(this._centeringNode.node);break}}}else this._centering=!1,this._freeze=!1,this._active=!1,this._localPoint=null},createControlPoint:function(t){var e=t.getCenterLocation(),i=this.getLayoutRect(),n=i.x+i.width/2,o=i.y+i.height/2,s=Math.atan2(e.y-o,e.x-n),a=i.width+i.height;return{x:n+a*Math.cos(s),y:o+a*Math.sin(s)}},isAtCenter:function(t,e,i,n,o){if(this._moveSpeed<=0)return!0;var s=16/this._moveSpeed;return s>20?s=20:2>s&&(s=2),-o/Math.sqrt(i*i+n*n)>s},_updateNodes:function(t,e,i){this._sineCosine(t,e,i);for(var n=0,o=this._nodes.size();o>n;n++){var s=this._nodes.get(n),a=s.cx,r=s.cy*this._ca+s.cz*-this._sa,h=s.cy*this._sa+s.cz*this._ca,l=a*this._cb+h*this._sb,c=r,d=a*-this._sb+h*this._cb,u=l*this._cc+c*-this._sc,_=l*this._sc+c*this._cc,g=d;s.cx=u,s.cy=_,s.cz=g;var f=2*this._radius;f/=f+g,s.perspective=f;var v=this._horizontalElliptical*u*f-2*this._horizontalElliptical+this._centerX,m=_*f*this._verticalElliptical+this._centerY;s.node.setCenterLocation(v,m)}this._adjustIndex()},_installListeners:function(){this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._network.addViewListener(this.handleResize,this),je.addEventListener("mouseout","handleRollOut",this._network.getView(),this),je.addEventListener("mousemove","handleMouseMove",this._network.getView(),this),je.addEventListener("mouseover","handleMouseOver",this._network.getView(),this),this._network.addPropertyChangeListener(this.handleNetworkPropertyChange,this)},_uninstallListeners:function(){this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._network.removeViewListener(this.handleResize,this),je.removeEventListener("mouseout",this._network.getView(),this),je.removeEventListener("mousemove",this._network.getView(),this),je.removeEventListener("mouseover",this._network.getView(),this),this._network.removePropertyChangeListener(this.handleNetworkPropertyChange,this)}}),Me.layout.AutoLayouter=function(t){this._box=t},Oe.ext("twaver.layout.AutoLayouter",Object,{_expandGroup:!1,_repulsion:1,_type:null,_animate:!0,_explicitXOffset:Number.NaN,_explicitYOffset:Number.NaN,_xOffset:0,_yOffset:0,isExpandGroup:function(){return this._expandGroup},setExpandGroup:function(t){this._expandGroup=t},getRepulsion:function(){return this._repulsion},setRepulsion:function(t){this._repulsion=t},getType:function(){return this._type},isAnimate:function(){return this._animate},setAnimate:function(t){this._animate=t},getElementBox:function(){return this._box},getExplicitXOffset:function(){return this._explicitXOffset},setExplicitXOffset:function(t){this._explicitXOffset=t},getExplicitYOffset:function(){return this._explicitYOffset},setExplicitYOffset:function(t){this._explicitYOffset=t},getDimension:function(t){if(t instanceof Un&&t.getChildrenSize()>0){for(var e=null,i=0,n=t.getChildrenSize();n>i;i++){var o=t.getChildAt(i);o instanceof Fn&&(e=e?Ze.unionRect(e,o.getRect()):o.getRect())}return e?{width:e.width,height:e.height}:null}return{width:t.getWidth(),height:t.getHeight()}},isVisible:function(t){return!0},isMovable:function(t){return!0},getGroupLayoutType:function(t){return this._type},getElements:function(){var t,e=this._box,i=e.getSelectionModel().size()>1;i?t=e.getSelectionModel().getSelection():(t=new fn,e.forEachByBreadthFirst(t.add,null,t)),this._xOffset=-1,this._yOffset=-1;for(var n=new fn,o=0,s=t.size();s>o;o++){var a=t.get(o);this.isVisible(a)&&(a instanceof Me.Link?n.add(a):this.isMovable(a)&&a instanceof Fn&&(n.add(a),i&&((this._xOffset<0||a.getX()<this._xOffset)&&(this._xOffset=a.getX()),(this._yOffset<0||a.getY()<this._yOffset)&&(this._yOffset=a.getY()))))}return i||(this._xOffset=isNaN(this._explicitXOffset)?50/this._repulsion:this._explicitXOffset,this._yOffset=isNaN(this._explicitYOffset)?50/this._repulsion:this._explicitYOffset),n},getLayoutResult:function(t){var e={};return this.doLayoutImpl(t,null,e),e},doLayout:function(t,e){return this.doLayoutImpl(t,e)},doLayoutImpl:function(t,e,i){var n=this,o=e;e=function(){n._box._layoutMovingElements=!1,o&&o()},this._type=t;var s=null;if("round"===t?s=new as:"symmetry"===t?s=new ws:"hierarchic"===t?s=new Ls:("topbottom"===t||"bottomtop"===t||"rightleft"===t||"leftright"===t)&&(s=new Go),null==s)return!1;n._box._layoutMovingElements=!0;var a={},r=this.getElements(),h=new As(this,r,!0,null);r=h.process();var l=new fs(this,r,t,!0,null);try{s.i2(l)}catch(t){return h.resetGroup(),null!=e&&e(),!1}var c,d;for(c in l._a){d=l._a[c];var u=l.g4(d);a[c]={x:u.x+this._xOffset,y:u.y+this._yOffset}}var _;if("rightleft"===t||"leftright"===t||"bottomtop"===t){var g=As.createMatrix(t),f=Number.MAX_VALUE,v=Number.MAX_VALUE;for(c in a){d=l._a[c],_=a[c];var m=g.transform(_);_.x=m.x,_.y=m.y;var p;"rightleft"===t||"leftright"===t?(p=m.x-l.g9(d)/2/this._repulsion,f>p&&(f=p),p=m.y-l.gj(d)/2/this._repulsion,v>p&&(v=p)):(p=m.x-l.gj(d)/2/this._repulsion,f>p&&(f=p),p=m.y-l.g9(d)/2/this._repulsion,v>p&&(v=p))}for(c in a)d=l._a[c],_=a[c],_.x=_.x-f+this._xOffset,_.y=_.y-v+this._yOffset}if(null==i&&this._animate){var y=new fn,w=new fn;for(c in a)y.add(l._a[c].node),w.add(a[c]);Me.animate.AnimateManager.endAnimate(),n._box._dataBoxChangeDispatcher.fire({kind:"layouting"}),Me.animate.AnimateManager.start(new Me.animate.AnimateCenterLocation(y,w,function(){h.resetGroup(),n._box._dataBoxChangeDispatcher.fire({kind:"layoutEnd"}),null!=e&&Oe.callLater(e)}))}else{n._box._dataBoxChangeDispatcher.fire({kind:"layouting"});for(c in a)d=l._a[c],_=a[c],null==i?d.node.setCenterLocation(_.x,_.y):i[d.node.getId()]=_;h.resetGroup(),n._box._dataBoxChangeDispatcher.fire({kind:"layoutEnd"}),null!=e&&Oe.callLater(e)}return!0}});var Gn=function(t,e){this.x=t,this.y=e};Oe.ext(Gn,Object,{equals:function(t){return this===t?!0:t instanceof Gn?t.x==this.x&&t.y==this.y:!1}});var Xn=function(t,e){this.width=t,this.height=e};Oe.ext(Xn,Object,{});var jn=function(t,e){this.x=t,this.y=e};Oe.ext(jn,Object,{});var Kn=function(){2===arguments.length?(Kn.superClass.constructor.call(this,arguments[1].width,arguments[1].height),this.x=arguments[0].x,this.y=arguments[0].y):(Kn.superClass.constructor.call(this,arguments[2],arguments[3]),this.x=arguments[0],this.y=arguments[1])};Oe.ext(Kn,Xn,{});var Jn=function(t,e){if(Jn.a2(t.x,e.x))this._a=1,this._b=0,this._c=-t.x;else{this._b=-1;var i=(e.y-t.y)/(e.x-t.x),n=t.y-t.x*i;this._a=i,this._c=n}};Oe.ext(Jn,Object,{a3:function(){return this._a},a4:function(){return this._b},a5:function(){return this._c}}),Jn.a6=function(t,e){if(Jn.a1(t.a3())&&Jn.a1(e.a3()))return null;if(Jn.a1(t.a4())&&Jn.a1(e.a4()))return null;if(Jn.a1(e.a4())){var i=t;t=e,e=i}var n,o,s=t.a3(),a=t.a4(),r=-t.a5();Jn.a1(t.a3())?(n=e.a4(),o=-e.a5()):(n=e.a4()-e.a3()/t.a3()*t.a4(),o=-e.a5()-e.a3()/t.a3()*-t.a5());var h=o/n,l=(r-h*a)/s;return new Gn(l,h)},Jn.a1=function(t){return Jn.a2(t,0)},Jn.a2=function(t,e){return Math.abs(t-e)<1e-5};var qn=function(t){if(this._a=new yo,t)for(var e=0;e<t.size();e++)this._a.aa(t.get(e))};Oe.ext(qn,Object,{c:function(){return this._a.ah()},d:function(){return this._a.ah()},a:function(){for(var t=new fn,e=this.c();e.i1();e.i2())t.add(e.i6(),0);return new qn(t)},b:function(){return this._a.ay()}});var Qn=function(t,e){this.x=t,this.y=e};Oe.ext(Qn,Object,{a:function(t,e){this.x=t,this.y=e}});var $n=function(t,e){this.x=t||0,this.y=e||0};Oe.ext($n,Object,{b:function(){return new $n(this.x,this.y)},a:function(t){this.z=t},c:function(){return this.x},d:function(){return this.y},f:function(t,e){this.x=t,this.y=e}});var to=function(t){this._c=new yo,t?(this.ac(t.a8().b()),this.ad(t.a9().b())):(this.ac(new $n),this.ad(new $n))};Oe.ext(to,Object,{a6:function(){return this.a5(this)},ac:function(t){t.a(this),this._a=t},ad:function(t){t.a(this),this._b=t},a8:function(){return this._a},a9:function(){return this._b},a1:function(t,e){return this.a4(t,e,this.aa())},a2:function(){return this._c.ay()},a7:function(t){return this._c.ak(t)},aa:function(){return 0===this._c.ay()?null:this._c.as()},a3:function(){this._c.af()},i2:function(t){var e=this.a7(t);return null!=e?new Gn(e.x,e.y):null},i1:function(){return this.a2()},i6:function(){var t=this.a8();return new Gn(t.c(),t.d())},i7:function(){var t=this.a9();return new Gn(t.c(),t.d())},i8:function(t){this.a8().f(t.x,t.y)},i9:function(t){this.a9().f(t.x,t.y)},i3:function(t,e,i){var n=this.a7(t);null!=n&&n.a(e,i)},i4:function(t,e){this.a1(t,e)},i5:function(){this.a3()}});var eo=function(t){eo.superClass.constructor.call(this,t)};Oe.ext(eo,to,{a5:function(t){return new eo(t)},a4:function(t,e,i){var n=new Qn(t,e);return this.ab(n,i),n},ab:function(t,e){this._c.an(t,this._c.al(e))}});var io=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this._s=!1,this._w=30,this._h=30,this._x=t-this._w/2,this._y=e-this._h/2}else{var i=arguments[0];this._s=i._s,this._w=i._w,this._h=i._h,this._x=i._x,this._y=i._y}};Oe.ext(io,Object,{m3:function(){return this.m2(this)},m4:function(){return this._x+this._w/2},m5:function(){return this._y+this._h/2},m6:function(t,e){this._x=t-this._w/2,this._y=e-this._h/2},i1:function(){return this._x},i2:function(){return this._y},i5:function(t,e){this._x=t,this._y=e},i3:function(){return this._w},i4:function(){return this._h},i6:function(t,e){var i=(this._w-t)/2,n=(this._h-e)/2;this._x+=i,this._y+=n,this._w=t,this._h=e},m1:function(t){var e,i,n,o;t.width<=0?(e=this._x,i=this._x+this._w,n=this._y,o=this._y+this._h):(e=Math.min(this._x,t.x),i=Math.max(this._x+this._w,t.x+t.width),n=Math.min(this._y,t.y),o=Math.max(this._y+this._h,t.y+t.height)),t.x=e,t.y=n,t.width=i-e,t.height=o-n}});var no=function(t){t?no.superClass.constructor.call(this,t):no.superClass.constructor.call(this,0,0)};Oe.ext(no,io,{m2:function(t){return new no(t)}});var oo={};oo.a2=function(t){var e=Ho.a2(Os.a(t.xa()));return oo.a4(t,e,oo.a3(t,e))},oo.a3=function(t,e){for(var i=t.x9();i.i1();i.i2())e.i7(i.i9(),-1);for(var n=0,o=new Co(t.xa()),s=t.x9();s.i1();s.i2()){var a=s.i9();-1===e.i2(a)&&oo.a(a,o,e,n++)}return n},oo.a6=function(t){for(var e=new wo,i=oo.a2(t),n=0;n<i.length-1;n++){var o=t.xo(i[n].x2(),i[n+1].x3());e.aa(o)}return e},oo.a4=function(t,e,i){for(var n=[],o=0;i>o;o++)n[o]=new zo;for(var s=t.x9();s.i1();s.i2())n[e.i2(s.i9())].ae(s.i9());return n},oo.a=function(t,e,i,n){for(e.c(t),i.i7(t,n);!e.a();){t=e.b();for(var o=t.ag();null!=o;o=o.a8()){var s=o.a3();-1===i.i2(s)&&(i.i7(s,n),e.c(s))}for(var a=t.ae();null!=a;a=a.a7()){var r=a.a2();-1===i.i2(r)&&(i.i7(r,n),e.c(r))}}},oo.a1=function(t,e,i){var n=new go(e,i);return n.a8(t),n._i},oo.a5=function(t,e,i){for(var n=[],o=0;i>o;o++)n[o]=new wo;for(var s=t.xf();s.i1();s.i2())n[e.i2(s.i8())].aa(s.i8());return n},oo.a7=function(t){var e=new wo,i=Ho.a3(Os.b(t.xa())),n=Ho.a4(Os.a(t.xh())),o=oo.a1(t,n,i),s=oo.a5(t,n,o);if(s.length>1){for(var a=new zo,r=0;r<s.length;r++){var h=s[r],l=null;if(1===h.ay()){var c=h.c2();1===c.a2().ad()?l=c.a2():1===c.a3().ad()&&(l=c.a3())}else{for(var d=h.c1();d.i1();d.i2()){var u=d.i8();if(i.i4(u.a2()))if(null==l)l=u.a2();else if(l!==u.a2()){l=null;break}if(i.i4(u.a3()))if(null!=l){if(l!==u.a3()){l=null;break}}else l=u.a3()}if(null!=l){var _=h.c2();l=_.a2()!==l?_.a2():_.a3()}}null!=l&&a.aa(l)}for(var g,f=a.x4();!a.ar();f=g)g=a.x4(),e.ac(t.xo(f,g))}return e};var so=function(){this._c=0,this._d=0,this._e=0,this._b=!0,this._f=!1};Oe.ext(so,Object,{a6:function(t){this._f=t},a7:function(t){this._b=t},a8:function(t){0!==t.x0()&&this.a9(t,t.x9().i9())},a9:function(t,e){if(this._xx=t.xk(),this._c=t.xl(),this._d=0,this._e=0,this.a0(e),this._b)for(var i=t.x9();i.i1();i.i2()){var n=i.i9();null==this._xx.i1(n)&&(this.a1(n),this.a0(n))}t.xi(this._xx),t.xj(this._c)},a0:function(t){var e=++this._d;this._xx.z1(t,so._B),this.a5(t,e);for(var i=this._f?t.ap():t.af();i.i1();i.i2()){var n=i.i8();if(!this._c.i4(n)){this._c.i7(n,!0);var o=n.a1(t);null==this._xx.i1(o)?(this.a3(n,o,!0),this.a0(o),this.a2(n,o)):this.a3(n,o,!1)}}this.a4(t,e,++this._e),this._xx.z1(t,so._C)},a5:function(t,e){},a4:function(t,e,i){},a3:function(t,e,i){},a2:function(t,e){},a1:function(t){}}),so._B={},so._C={};var ao=function(t){this._a=t};Oe.ext(ao,so,{a5:function(t,e){var i=this._a._ah.i2(t);this._a._ad[i].ae(t)}});var ro=function(t){this._a=t};Oe.ext(ro,so,{a2:function(t,e){var i=t.a1(e),n=this._a[i.al()],o=this._a[e.al()];o._a+1>n._a?(n._c=n._a,n._b=n._d,n._a=o._a+1,n._d=t):o._a+1>n._c&&(n._c=o._a+1,n._b=t)}});var ho=function(t){this._a=t};Oe.ext(ho,so,{a3:function(t,e,i){i&&t.a2()===e&&this._a.ac(t)}});var lo=function(){this._a=0,this._c=0};Oe.ext(lo,Object,{});var co=function(){this._a=0};Oe.ext(co,Object,{a1:function(t,e){this._a=0;for(var i=e.length-1;i>=0;i--)e[i]=-1;for(var n=t.x9();n.i1();n.i2()){var o=n.i9();if(0===o.ak()){this.a2(o,o.al(),e);break}}for(var s=t.x9();s.i1();s.i2()){var a=s.i9(),r=a.al();-1===e[r]&&this.a2(a,r,e)}},a2:function(t,e,i){i[e]=-2;for(var n=t.ag();null!=n;){var o=n.a3(),s=o.al();switch(i[s]){case-1:this.a2(o,s,i);case-2:default:n=n.a8()}}i[e]=this._a++}});var uo={};uo.a1=function(t){var e=new _o;return e.a8(t),e._n},uo.a2=function(t){var e=t.x9(),i=null,n=0;for(e.i4();e.i1();e.i2())0===e.i9().ak()&&(i=e.i9(),n++);if(1===n)return i;for(n=0,e.i4();e.i1();e.i2())0===e.i9().ao()&&(i=e.i9(),n++);return 1===n?i:uo.a8(t)},uo.a8=function(t){var e=Os.a(t.x0()),i=Ho.a2(e);return uo.a6(t,i)},uo.a6=function(t,e){var i=t.xd(),n=Os.d(1),o=Os.a(t.x0(),-1),s=uo.a4(t,i);uo.a7(i,e,n,o,-1);for(var a=s.c1();a.i1();a.i2())t.x3(a.i8());return n[0]},uo.a7=function(t,e,i,n,o){for(var s=0,a=t.ag();null!=a;a=a.a8()){var r=a.a3(),h=uo.a7(r,e,i,n,o);h>o&&(o=h),s+=n[r.al()]}for(var l=s*(t._g.xa()-1-s),c=t.ag();null!=c;c=c.a8())for(var d=c.a3(),u=c.a8();null!=u;u=u.a8()){var _=u.a3();l+=n[d.al()]*n[_.al()]}return e.i7(t,l),n[t.al()]=s+1,l>o&&(o=l,i[0]=t),o},uo.a4=function(t,e){var i=new wo,n=new ho(i);n.a6(!1),n.a9(t,e);for(var o=i.c1();o.i1();o.i2())t.x3(o.i8());return i},uo.a3=function(t){return uo.a4(t,uo.a2(t))};var _o=function(){this._n=!0,this.a6(!1)};Oe.ext(_o,so,{a3:function(t,e,i){i||(this._n=!1)},a1:function(t){this._n=!1}});var go=function(t,e){this._i=0,this._m=e,this._j=t,this._l=!1};Oe.ext(go,so,{a8:function(t){this._h=Os.a(t.x0()),this._k=Os.a(t.x0()),this._g=new Co(t.xh()),go.superClass.a8.call(this,t)},a5:function(t,e){this._k[t.al()]=this._h[t.al()]=e},a3:function(t,e,i){if(this._g.c(t),!i){var n=t.a1(e);this._h[n.al()]=Math.min(this._h[n.al()],this._k[e.al()])}},a1:function(t){this._l=!1},a2:function(t,e){var i=t.a1(e);if(this._h[e.al()]>=this._k[i.al()]){for(;this._g.d()!==t;this._j.i5(this._g.b(),this._i));this._j.i5(this._g.b(),this._i),this._i++,this._g.a()?this._l?this._m.i5(i,!0):this._l=!0:this._m.i5(i,!0)}this._h[i.al()]=Math.min(this._h[i.al()],this._h[e.al()])}});var fo=function(t,e){this._h=!1,this._i=t,this._g=e};Oe.ext(fo,Object,{z1:function(t,e){t._c[this._i]=e},i1:function(t){return t._c[this._i]},i5:function(t,e){t._c[this._i]=e},i4:function(t){return t._c[this._i]},i7:function(t,e){t._c[this._i]=e},i2:function(t){var e=t._c[this._i];return null==e?0:e},i6:function(t,e){t._c[this._i]=e},i3:function(t){var e=t._c[this._i];return null==e?0:e},c:function(){return this._h},d:function(){this._h=!0}});var vo=function(t,e){this._c=!1,this._d=t,this._b=e};Oe.ext(vo,Object,{i8:function(t,e){t._c[this._d]=e},i1:function(t){return t._c[this._d]},i7:function(t,e){t._c[this._d]=e},i4:function(t){var e=t._c[this._d];return null==e?!1:e},i5:function(t,e){t._c[this._d]=e},i2:function(t){var e=t._c[this._d];return null==e?0:e},i6:function(t,e){t._c[this._d]=e},i3:function(t){var e=t._c[this._d];return null==e?0:e},a:function(){return this._c},b:function(){this._c=!0}});var mo=function(t){this._bb=t,this.i4()};Oe.ext(mo,Object,{i1:function(){return null!=this._aa},i2:function(){this._aa=this._aa._a},i3:function(){this._aa=this._aa._b},i4:function(){this._aa=this._bb._b},i5:function(){this._aa=this._bb._c},i7:function(){return this._bb.ay()},i6:function(){return this._aa._c}});var po=function(t){po.superClass.constructor.call(this,t)};Oe.ext(po,mo,{i8:function(){return this.i6()}});var yo=function(t){if(this._id=Oe.id(),this._a=0,t)for(t.i4();t.i1();t.i2())this.ae(t.i6())};Oe.ext(yo,Object,{ac:function(t){var e=this.ag(t);return null==this._b?this._b=this._c=e:(this._b._b=e,e._a=this._b,this._b=e),this._a++,e},ae:function(t){var e=this.ag(t);return null==this._c?this._b=this._c=e:(this._c._a=e,e._b=this._c,this._c=e),this._a++,e},z1:function(t){t._b=null,t._a=null,null==this._c?this._b=this._c=t:(this._c._a=t,t._b=this._c,this._c=t),this._a++},ad:function(t){t._b=null,t._a=null,null==this._b?this._b=this._c=t:(this._b._b=t,t._a=this._b,this._b=t),this._a++},aa:function(t){return this.ae(t),!0},ab:function(t){for(;t.i1();t.i2())this.ae(t.i6())},ao:function(t,e){if(e===this._b)return this.ac(t);if(null==e)return this.ae(t);var i=this.ag(t);return this.aq(i,e),i},aq:function(t,e){if(null==e)this.ad(t);else if(e===this._b)this.ad(t);else{if(null==this._c)t._b=null,t._a=null,this._b=this._c=t;else{var i=e._b;e._b=t,t._a=e,i._a=t,t._b=i}this._a++}},ap:function(t,e){if(null==e)this.z1(t);else if(e===this._c)this.z1(t);else{if(null==this._b)t._b=null,t._a=null,this._b=this._c=t;else{var i=e._a;e._a=t,t._a=i,i._b=t,t._b=e}this._a++}},an:function(t,e){if(e===this._c)return this.ae(t);if(null==e)return this.ac(t);var i=this.ag(t);return this.ap(i,e),i},ay:function(){return this._a},ar:function(){return 0===this._a},af:function(){this._b=this._c=null,this._a=0},am:function(){return this._b._c},at:function(){var t=this.am();return this.aw(this._b),t},as:function(){return this._c._c},au:function(){return this.aw(this._c)},ak:function(t){for(var e=0,i=this._b;null!=i;){if(t===e)return i._c;i=i._a,e++}return null},aj:function(t){return null==t._a?this._b:t._a},ai:function(t){return null==t._b?this._c:t._b},aw:function(t){return t!==this._b?t._b._a=t._a:this._b=t._a,t!==this._c?t._a._b=t._b:this._c=t._b,this._a--,t._c},av:function(t){return this.aw(t._aa)},ah:function(){return new mo(this)},al:function(t){for(var e=this._b;null!=e;){if(null==e._c&&null==t)return e;if(e._c===t)return e;e=e._a}return null},a0:function(){for(var t=Os.d(this._a),e=0,i=this._b;null!=i;)t[e]=i._c,i=i._a,e++;return t},ax:function(){for(var t=this._b;null!=t;t=t._b){var e=t._a;t._a=t._b,t._b=e}var i=this._b;this._b=this._c,this._c=i},a1:function(t){var e=this.a0();e.sort(t);for(var i=0,n=this._b;null!=n;)n._c=e[i],n=n._a,i++},a2:function(){var t=this.a0();t.sort(Os.c);for(var e=0,i=this._b;null!=i;)i._c=t[e],i=i._a,e++},az:function(t){null==this._b?(this._b=t._b,this._c=t._c):null!=t._b&&(this._c._a=t._b,t._b._b=this._c,this._c=t._c),this._a+=t._a,t._b=t._c=null,t._a=0},ag:function(t){return new Eo(t)}});var wo=function(t){wo.superClass.constructor.call(this,t)};Oe.ext(wo,yo,{c1:function(){return new po(this)},c2:function(){return this.am()},c3:function(){return this.at()}});var Ao=function(){this._c=0};Oe.ext(Ao,Object,{a:function(t){this._c++,t._b=this._b,t._a=null,null!=this._b?(this._b._a=t,this._b=t):this._b=this._a=t},b:function(t,e){if(null==e)return void this.a(t);var i=e._b;null!=i?i._a=t:this._a=t,t._b=i,t._a=e,e._b=t,this._c++},c:function(t){var e=t._a,i=t._b;this._c--,null!=e?e._b=i:this._b=i,null!=i?i._a=e:this._a=e}});var xo=function(t,e){this._p=t,this._j=e,this._o=t._o[e]};Oe.ext(xo,Object,{i1:function(){return null!=this._o},i2:function(){this._o=this._o._k[this._j]},i3:function(){this._o=this._o._f[this._j]},i4:function(){this._o=this._p._o[this._j]},i5:function(){this._o=this._p._q[this._j]},i7:function(){return this._p._n[this._j]},i6:function(){return this._o},i8:function(){return this._o}});var Eo=function(t){this._c=t};Oe.ext(Eo,Object,{a:function(){return this._a},b:function(){return this._b},c:function(t){this._c=t},d:function(){return this._c}});var To=function(t,e,i,n){this._r=t,this._s=e,this._q=i,this._p=n};Oe.ext(To,Object,{i1:function(t){return this._p[t.a5()]},i3:function(t){return this._r[t.a5()]},i2:function(t){return this._s[t.a5()]},i4:function(t){return this._q[t.a5()]},i8:function(t,e){this._p[t.a5()]=e},i6:function(t,e){this._r[t.a5()]=e},i5:function(t,e){this._s[t.a5()]=e},i7:function(t,e){this._q[t.a5()]=e}});var Co=function(t){this._a=Os.d(t),this._b=-1};Oe.ext(Co,Object,{d:function(){return this._a[this._b]},b:function(){return this._a[this._b--]},c:function(t){this._a[++this._b]=t},a:function(){return this._b<0}});var bo=function(){};Oe.ext(bo,Object,{a0:function(t){this._c=Os.d(t)}});var ko=function(t,e,i,n,o,s,a){this._g=0,t.xt(this,e,i,n,o,s,a)};Oe.ext(ko,bo,{a5:function(){return this._h._u&&this._h.b1(),this._g},a2:function(){return this._d},a3:function(){return this._e},a1:function(t){return this._d!==t?this._d:this._e},a4:function(){for(var t=0;1>=t;t++)this._k[t]=null,this._f[t]=null},a8:function(){return this._k[0]},a7:function(){return this._k[1]},a6:function(t,e,i,n){this.a0(n),this._h=t,this._k=Os.d(2),this._f=Os.d(2),this._d=e,this._e=i}});var So=function(t){this._j=0,this._h=t,this.i4()};Oe.ext(So,Object,{i2:function(){this._k=this._k._k[this._j],null==this._k&&0===this._j&&(this._k=this._h._o[1],this._j=1)},i3:function(){this._k=this._k._f[this._j],null==this._k&&1===this._j&&(this._k=this._h._q[0],this._j=0)},i4:function(){this._k=this._h._o[0],null==this._k?(this._k=this._h._o[1],this._j=1):this._j=0},i5:function(){this._k=this._h._q[1],null==this._k?(this._k=this._h._q[0],this._j=0):this._j=1},i1:function(){return null!=this._k},i6:function(){return this._k},i8:function(){return this._k},i7:function(){return this._h.ad()}});var Io=function(){this._a=hs._A,this._b=hs._A,this._c=new fn};Oe.ext(Io,Object,{i1:function(){return this._c.size()},i2:function(t){return this._c.get(t)},i3:function(t,e,i){this._c.set(t,new Gn(e,i))},i4:function(t,e){this._c.add(new Gn(t,e))},i5:function(){this._c.clear()},i6:function(){return this._a},i7:function(){return this._b},i8:function(t){this._a=t},i9:function(t){this._b=t}});var Lo=function(){this._x=0,this._y=0,this._w=0,this._h=0};Oe.ext(Lo,Object,{i5:function(t,e){this._x=t,this._y=e},i6:function(t,e){this._w=t,this._h=e},i4:function(){return this._h},i3:function(){return this._w},i1:function(){return this._x},i2:function(){return this._y}});var Po=function(t,e,i,n){this._m=t,this._n=e,this._l=i,this._k=n};Oe.ext(Po,Object,{i1:function(t){return this._k[t.al()]},i3:function(t){return this._m[t.al()]},i2:function(t){return this._n[t.al()]},i4:function(t){return this._l[t.al()]},z1:function(t,e){this._k[t.al()]=e},i6:function(t,e){this._m[t.al()]=e},i7:function(t,e){this._n[t.al()]=e},i5:function(t,e){this._l[t.al()]=e}});var Ro=function(t,e){this._b=t,this._r=e,this._a=[];for(var i=this._b-1;i>=0;i--)this._a.push(i);this._c=new fn};Oe.ext(Ro,Object,{a1:function(t){var e;if(0===this._a.length){this.a2(t,this._b,this._b+this._r);for(var i=this._b+this._r-1;i>this._b;i--)this._a.push(i);e=this._b,this._b+=this._r}else e=this._a.pop();return e},b:function(t){var e=this.a1(t),i=new fo(e,this);return this._c.add(i),this.a4(t,e),i},c:function(t){var e=this.a1(t),i=new vo(e,this);return this._c.add(i),this.a4(t,e),i},a2:function(t,e,i){for(var n=t._a;null!=n;n=n._a){var o=Os.d(i);Os.f(n._c,o,e),n._c=o}},a3:function(t,e,i){var n=Os.d(i);Os.f(t._c,n,e),t._c=n},a4:function(t,e){for(var i=t._a;null!=i;i=i._a)i._c[e]=null},a5:function(t,e){if(t instanceof fo){var i=t;if(i.c())throw"Error";i.d();var n=t._i;this._a.indexOf(n)<0&&(this.a4(e,n),this._a.push(n),this._c.remove(t))}},a6:function(t,e){if(t instanceof vo){var i=t;if(i.a())throw"Error";i.b();var n=i._d;this._a.indexOf(n)<0&&(this.a4(e,n),this._a.push(n),this._c.remove(t))}}});var Do=function(t){this._id=Oe.id(),this._p=0,t.xs(this)};Oe.ext(Do,bo,{ad:function(){return this._n[0]+this._n[1]},ak:function(){return this._n[1]},ao:function(){return this._n[0]},al:function(){return this._g._y&&this._g.c(),this._p},ag:function(){return this._o[0]},ae:function(){return this._o[1]},af:function(){return new So(this)},am:function(){return new xo(this,1)},ap:function(){return new xo(this,0)},an:function(){return new Oo(this)},aq:function(){return new Mo(this,1)},aw:function(){return new Mo(this,0)},ah:function(t){for(var e=this._o[0];null!=e;e=e._k[0])if(e.a3()===t)return e;return null},ai:function(t){for(var e=this._o[1];null!=e;e=e._k[1])if(e.a2()===t)return e;return null},aj:function(t){var e=this.ah(t);return null==e&&(e=this.ai(t)),e},au:function(t){this.at(t,1,Os.d(this.ak()))},av:function(t){this.at(t,0,Os.d(this.ao()))},as:function(t,e){this.a0(e),this._g=t,this._o=Os.d(2),this._q=Os.d(2),this._n=Os.a(2)},ab:function(t,e,i,n,o){if(null==e)return void this.aa(t,i,n);var s;if(s=e._d===e._e?n:this!==e._d?1:0,0===o){var a=e._k[s];t._f[n]=e,t._k[n]=a,e._k[s]=t,null==a?this._q[i]=t:a._d===a._e?a._f[n]=t:a._f[this!==a._d?1:0]=t}else{var r=e._f[s];t._k[n]=e,t._f[n]=r,e._f[s]=t,null==r?this._o[i]=t:r._d===r._e?r._k[n]=t:r._k[this!==r._d?1:0]=t}this._n[i]++},aa:function(t,e,i){var n=this._q[e];t._k[i]=null,null==n?(this._o[e]=t,t._f[i]=null):(t._f[i]=n,n._d===n._e?n._k[i]=t:n._k[this!==n._d?1:0]=t),this._q[e]=t,this._n[e]++},ar:function(t,e,i){var n,o;n=t._k[i],o=t._f[i],null==n?this._q[e]=o:n._f[n._d!==this?1:0]=o,null==o?this._o[e]=n:o._k[o._d!==this?1:0]=n,this._n[e]--},ac:function(){for(var t=0;1>=t;t++)this._o[t]=null,this._q[t]=null,this._n[t]=0},at:function(t,e,i){if(!(this._n[e]<2)){var n,o=this._n[e],s=0;for(n=this._o[e];null!=n;n=n._k[e])i[s]=n,s++;Os.s(i,o,t);var a=this._o[e]=i[0];a._f[e]=null;for(var r=1;o>r;)n=i[r],n._f[e]=a,a._k[e]=n,r++,a=n;this._q[e]=n,n._k[e]=null}}});var Mo=function(t,e){Mo.superClass.constructor.call(this,t,e),this._h=1!==e?1:0};Oe.ext(Mo,xo,{i6:function(){return this.i9()},i9:function(){return 0!==this._h?this._o._e:this._o._d}});var Oo=function(t){Oo.superClass.constructor.call(this,t)};Oe.ext(Oo,So,{i6:function(){return this._k.a1(this._h)},i9:function(){return this._k.a1(this._h)}});var Bo=function(t){Bo.superClass.constructor.call(this,t)};Oe.ext(Bo,mo,{i9:function(){return this.i6()}});var No=function(t){this._o=t,this._c=t._a};Oe.ext(No,Object,{i1:function(){return null!=this._c},i2:function(){this._c=this._c._a},i3:function(){this._c=this._c._b},i5:function(){this._c=this._o._b},i4:function(){this._c=this._o._a},i7:function(){return this._o._c},i6:function(){return this._c},i9:function(){return this._c},i8:function(){return this._c}});var zo=function(t){if(t&&t.length){zo.superClass.constructor.call(this);for(var e=0;e<t.length;e++)this.ae(t[e])}else zo.superClass.constructor.call(this,t)};Oe.ext(zo,yo,{x1:function(){return new Bo(this)},x2:function(){return this.am()},x3:function(){return this.as()},x4:function(){return this.at()}});var Fo=function(t){this._d=t,Fo.superClass.constructor.call(this)};Oe.ext(Fo,zo,{});var Vo=function(t){this._a=t,this._b=new wo,this._c=new zo};Oe.ext(Vo,Object,{a:function(){for(var t=this._a.x9();t.i1();t.i2())this.e(t.i9())},b:function(){this.c(),this.d()},c:function(){for(;!this._c.ar();){var t=this._c.x4();this._a.xq(t)||this.g(t)}},d:function(){for(;!this._b.ar();){var t=this._b.c3();this._a.xp(t)||this.f(t)}},e:function(t){for(var e=t.af();e.i1();e.i2())this._b.ac(e.i8()),this._a.h1(e.i8());this._c.ac(t),this._a.h2(t)},f:function(t){this._a.u1(t)},g:function(t){this._a.h3(t)}}),Vo.h=function(t,e){for(e.i4();e.i1();e.i2()){var i=e.i8();t.xq(i.a2())||t.h3(i.a2()),t.xq(i.a3())||t.h3(i.a3()),t.xp(i)||t.u1(i)}},Vo.i=function(t,e){for(e.i4();e.i1();e.i2()){var i=e.i8();t.xp(i)&&t.h1(i),0===i.a2().ad()&&t.h2(i.a2()),0===i.a3().ad()&&t.h2(i.a3())}};var Uo=function(){this._g=arguments[0],this._f=this._g.xk(),this._h=this._g.xk(),this._d=new yo,this._e=0,1!==arguments.length&&this.a(arguments[1],arguments[2],arguments[3],arguments[4])};Oe.ext(Uo,Object,{a:function(t,e,i,n){for(var o=Os.d(i-e+1),s=e;i>=s;s++)o[s]=new Fo(s);for(var a=this._g.x9();a.i1();a.i2()){var r=a.i9();(null==n||n.i4(r))&&(this._f.z1(r,o[t.i2(r)-e].ac(r)),this._e++)}for(var h=0;h<o.length;h++)for(var l=o[h],c=this._d.ae(l),d=l.x1();d.i1();d.i2())this._h.z1(d.i9(),c)},c:function(){this._g.xi(this._h),this._g.xi(this._f)},e:function(){return 0===this._e},g:function(){for(;this._d.am().ar();this._d.at());this._e--;var t=this._d.am().x4();return this._h.z1(t,null),this._f.z1(t,null),t},f:function(){for(;this._d.as().ar();this._d.au());this._e--;var t=this._d.as().x4();return this._h.z1(t,null),this._f.z1(t,null),t},d:function(t){var e=this._f.i1(t),i=this._h.i1(t),n=i.d(),o=null,s=i.a();null!=s?(o=s.d(),this._h.z1(t,s)):(o=new Fo(n._d+1),this._h.z1(t,this._d.ae(o))),n.aw(e),this._f.z1(t,o.ac(t))},b:function(t){var e=this._f.i1(t),i=this._h.i1(t),n=i.d(),o=null,s=i.b();null!=s?(o=s.d(),this._h.z1(t,s)):(o=new Fo(n._d-1),this._h.z1(t,this._d.ac(o))),n.aw(e),this._f.z1(t,o.ac(t))}});var Ho={};Ho.a1=function(t){return new Po(t,null,null,null)},Ho.a2=function(t){return new Po(null,t,null,null)},Ho.a3=function(t){return new Po(null,null,t,null)},Ho.a4=function(t){return new To(null,t,null,null)},Ho.a5=function(t){return new To(null,null,t,null)},Ho.a6=function(t){return new To(null,null,null,t)};var Wo=function(){if(2===arguments.length){this._a=new yo,this._b=new yo,this._c=0;var t=arguments[0],e=arguments[1],i=new Yo(t._j2.gj(e)/2,0);this._a.ac(i),i=new Yo(t._j2.gj(e)/2,0),this._b.ac(i)}else this._a=arguments[1],this._b=arguments[2],this._c=arguments[3]};Oe.ext(Wo,Object,{});var Yo=function(t,e){this._b=t,this._a=e};Oe.ext(Yo,Object,{});var Zo=function(){this._cx=!0,this._cs=new ns,this._ct=new es,this._cw=new is};Oe.ext(Zo,Object,{i5:function(t){this._cx=t},k:function(){var t=new os(this);return this._cx&&(this._cs.w1(t),t=this._cs),this._cw.w1(t),t=this._cw,this._ct.w1(t),t=this._ct},i2:function(t){this.k().i2(t)},i1:function(t){return this.k().i1(t)}});var Go=function(){Go.superClass.constructor.call(this),this._jv=20,this._jw=40,this._jx=function(t,e){var i=t.a3(),n=e.a3(),o=i._g;return Math.floor(100*(o.g5(i)-o.g5(n)))}};Oe.ext(Go,Zo,{i4:function(t){return uo.a1(t)},i3:function(t){if(!this.i4(t))throw"Error";var e=uo.a3(t);if(this._j2=t,this._j3=new Xo(t),vs.c(t),this._jy=t.xk(),!t.xb()){this.bu();var i=this._j3.c1();this.f(i),this.b(this._j3),this.c(this._j3)}for(var n;!e.ar();t.x3(n))n=e.c3(),vs.b(t.g2(n))},bu:function(){if(null!=this._jx)for(var t=this._j2.x9();t.i1();t.i2())t.i9().av(this._jx)},c:function(t){for(var e=this.a2(t),i=Os.a(e.length),n=0;n<e.length;n++){for(var o=e[n],s=0,a=o.ah();a.i1();a.i2()){var r=a.i6();s=Math.max(s,this._j2.g9(r))}i[n]=s}for(var h=-this._jw,l=0;l<e.length;l++){h+=this._jw+i[l];for(var c=e[l],d=c.ah();d.i1();d.i2()){var u=d.i6();this._j2.s2(u,this._j2.g5(u),h-i[l]/2)}}},a2:function(t){for(var e=Os.d(t.b()),i=0,n=t.b();n>i;i++)e[i]=new yo;return t.c1(),this.a1(t.c1(),0,e),e},a1:function(t,e,i){i[e].ae(t);for(var n=t.aw();n.i1();n.i2())this.a1(n.i9(),e+1,i)},b:function(t){var e=t.c1();this._j2.s2(e,0,this._j2.g6(e)),this.g(e)},g:function(t){for(var e=t.aw();e.i1();e.i2()){var i=e.i9(),n=this._jy.i1(i);this._j2.s2(i,this._j2.g5(t)+n._c,this._j2.g6(i)),this.g(i)}},f:function(t){if(this._j3.c2(t))return void this._jy.z1(t,new Wo(this,t));var e=t.aw(),i=e.i9();e.i2(),this.f(i);var n=this._jy.i1(i),o=new Wo(this,n._a,n._b,0);if(!e.i1())return o._a.ac(new Yo(this._j2.gj(t)/2,0)),o._b.ac(new Yo(this._j2.gj(t)/2,0)),void this._jy.z1(t,o);for(;e.i1();){i=e.i9(),e.i2(),this.f(i),n=this._jy.i1(i);for(var s=o._b.ah(),a=n._a.ah(),r=2147483647,h=0,l=0;s.i1()&&a.i1();){var c=s.i6();s.i2();var d=a.i6();a.i2(),l+=c._a,h+=d._a,r=Math.min(r,h-l-c._b-d._b)}n._c=this._jv-r,h+=n._c;var u=n._b.am();if(u._a=n._c,s.i1()&&!a.i1())for(var _=l-this.a3(n._b);s.i1();_=0){var g=s.i6();s.i2(),n._b.ae(new Yo(g._b,g._a+_))}else if(!s.i1()&&a.i1()){var f=this.a3(o._a);for(f=h-f;a.i1();f=0){var v=a.i6();a.i2(),o._a.ae(new Yo(v._b,v._a+f))}}o._b=n._b}this._jy.z1(t,o);for(var m=-n._c/2,p=t.aw();p.i1();){var y=p.i9();p.i2();var w=this._jy.i1(y);w._c+=m;var A=w._b.am();A._a+=m,A=w._a.am(),A._a+=m}o._a.ac(new Yo(this._j2.gj(t)/2,0)),o._b.ac(new Yo(this._j2.gj(t)/2,0))},a3:function(t){for(var e=0,i=t.ah();i.i1();i.i2()){var n=i.i6();e+=n._a}return e}});var Xo=function(t){this._b=t,this.a()};Oe.ext(Xo,Object,{c1:function(){return null==this._a&&this.a(),this._a},b:function(){return null==this._a?-1:this.d(this._a)},d:function(t){for(var e=0,i=t.aw();i.i1();i.i2())e=Math.max(e,this.d(i.i9()));return e+1},c2:function(t){return 0===t.ao()},a:function(){for(var t=this._b.x9();t.i1();t.i2())if(0===t.i9().ak())return void(this._a=t.i9())}});var jo=function(t){this._d=0,this._e=0,this._f=0,this._a=0,this._b=0,this._g=t,this._c=new yo};Oe.ext(jo,Object,{a:function(){return this._d+this._e+this._f}});var Ko=function(){Ko.superClass.constructor.call(this),this._kl=340,this._km=360,this._kk=40,this._ko=.5};Oe.ext(Ko,Zo,{ic:function(){return this._km},ia:function(){return this._kl},i9:function(){return this._ko},i3:function(t){if(!uo.a1(t))throw"Error";this._a=t;var e=this.i8(),i=uo.a4(t,e);vs.c(t),this._kn=Os.d(t.x0());for(var n=t.x9();n.i1();n.i2()){var o=n.i9();o!==e?this.aa(o,new jo(this._kk+this.q(o.aq().i9()))):this.aa(o,new jo(this._kk))}this.s(e),t.s2(e,0,0),this.t(e);for(var s;!i.ar();t.x3(s))s=i.c3()},i4:function(t){return uo.a1(t)},i0:function(t){return this._kn[t.al()]},i8:function(){return uo.a2(this._a)},i7:function(t){for(var e,i=this.ib(t);;){if(e=this.i6(t),i>=e)break;for(var n=t.aw();n.i1();n.i2()){var o=n.i9();this.i0(o)._g*=1+this._ko}}var s=(i-e)/(2*t.ao());e=0;for(var a=t.aw();a.i1();a.i2()){var r=this.i0(a.i9());r._d+=s,r._e+=s,e+=r._d+r._e}this.id(t)},id:function(t){for(var e=Os.d(t.ao()),i=0,n=t.ap();n.i1();)e[i]=n.i8(),n.i2(),i++;var o=this;e.sort(function(t,e){var i=t.a3(),n=e.a3(),s=o.i0(i).a()-o.i0(n).a();return s>0?1:s>=0?0:-1});for(var s=0;s<e.length;s++)this._a.h1(e[s]);for(var a=0;a<e.length;a+=2)this._a.u1(e[a]);for(i=e.length-1,i%2===0&&i--;i>0;i-=2)this._a.u1(e[i])},ib:function(t){return 0===t.ak()?this._km:2===t.ao()?Math.min(180,this._kl):this._kl},i6:function(t){for(var e=0,i=t.ap();i.i1();i.i2()){for(var n,o=i.i8(),s=o.a3(),a=this.i0(s),r=-a._g,h=a._b,l=a._c,c=0,d=c+1,u=l._b,_=u.d();d>c;d=(n.y-h)/(n.x-r))n=_,u=l.ai(u),_=u.d(),c=(_.y-n.y)/(_.x-n.x);for(a._d=180*-Math.atan(d)/Math.PI,c=0,d=c-1,u=l._b,_=u.d();u.a().d().x===_.x;_=u.d())u=u.a();for(var g;c>d;d=(g.y-h)/(g.x-r))g=_,u=l.aj(u),_=u.d(),c=(_.y-g.y)/(_.x-g.x);a._e=180*Math.atan(d)/Math.PI,e+=a._d+a._e}return e},aa:function(t,e){this._kn[t.al()]=e},p:function(t){var e=this.i0(t),i=new yo,n=2*this.q(t);i.aa(new Gn(0,0)),i.aa(new Gn(0,n)),i.aa(new Gn(n,n)),i.aa(new Gn(n,0)),e._c=i,e._a=n/2,e._b=n/2},r:function(t){if(0===t.ao())this.p(t);else{var e=this.i0(t),i=this.q(t),n=new yo;n.aa(new Gn(-i,-i)),n.aa(new Gn(-i,i)),n.aa(new Gn(i,-i)),n.aa(new Gn(i,i));for(var o=t.aw();o.i1();o.i2()){var s=this.i0(o.i9());n.az(s._c)}for(var a=hs.h(n),r=Number.MAX_VALUE,h=Number.MAX_VALUE,l=Number.MIN_VALUE,c=Number.MIN_VALUE,d=a.ah();d.i1();d.i2()){var u=d.i6();u.x<r&&(r=u.x),u.x>l&&(l=u.x),u.y<h&&(h=u.y),u.y>c&&(c=u.y)}for(var _=new yo,g=a.ah();g.i1();g.i2()){var f=g.i6();_.aa(new Gn(f.x-r,f.y-h))}e._c=_,e._a=-r,e._b=-h}},s:function(t){if(0===t.ao())this.r(t);else{for(var e=t.aw();e.i1();e.i2())this.s(e.i9());this.i7(t);for(var i=0,n=t.aw();n.i1();n.i2()){var o=n.i9(),s=this.i0(o),a=180-(360-this.ib(t))/2-i-(s._e+s._f);i+=s.a(),a=a/180*Math.PI;for(var r=Math.sin(a),h=Math.cos(a),l=s._c._b;null!=l;l=l.a()){var c=l.d(),d=c.x+s._g,u=c.y-s._b,_=new Gn(d*h-r*u,d*r+h*u);l.c(_)}var g=s._a+s._g;s._a=g*h,s._b=g*r}this.r(t)}},t:function(t){var e=this._a.g4(t),i=0;if(t.ak()>0){var n=t.aq().i9(),o=this._a.g4(n);i=Math.PI+Math.atan2(o.y-e.y,o.x-e.x)}for(var s=t.aw();s.i1();s.i2()){var a=s.i9(),r=this.i0(a);if(0!==i){var h=Math.cos(i),l=Math.sin(i),c=r._a*h-l*r._b,d=r._a*l+h*r._b;r._a=c,r._b=d}this._a.s2(a,e.x+r._a,e.y+r._b),this.t(a)}},q:function(t){return 1.41*(Math.max(this._a.gj(t),this._a.g9(t))/2)}});var Jo=function(){};Oe.ext(Jo,Object,{i2:function(t){return t.ad()},i1:function(t){throw"Error"},i3:function(t){throw"Error"},i4:function(t){throw"Error"}});var qo=function(t){this._a=t};Oe.ext(qo,Object,{i2:function(t){for(var e=0,i=t.an();i.i1();i.i2())null!=this._a.i1(i.i9())&&e++;return e},i4:function(t){return null==this._a.i1(t)},i1:function(t){throw"Error"},i3:function(t){throw"Error"}});var Qo=function(){Qo.superClass.constructor.call(this),this._kq=!1,this._kp=90};Oe.ext(Qo,Ko,{a:function(t,e){this._kr=e,this._ks=t,this._kq=!0},i7:function(t){if(!this.u(t))return void Qo.superClass.i7.call(this,t);for(var e=this.i9(),i=this.ib(t),n=(360-i)/2+i,o=new wo(t.ap());;){var s=this.i6(t);s=(360-i)/2;for(var a=null,r=null,h=o._b;null!=h;h=h.a()){var l=h.d(),c=l.a3(),d=this.i0(c),u=this._ks.i3(l),_=u-(s+d._e);if(_>=0&&u+d._d>=n&&(_=s+d.a()<=n?n-s-d.a():2*(n-(u+d._d))),d._f=0,_>=0)d._f=_,a=h,r=d;else{for(-_>d._d+d._e?_=(d._d+d._e)/2:_/=-2,s-=_,n>=s&&s+d.a()>n&&(s+=_,_=s+d.a()-n,s-=_);null!=a&&_>r._f;r=this.i0(a.d().a3()))if(_-=r._f,r._f=0,a=a.b(),null==a){r=null;break}null!=a?r._f-=_:s+=_}s+=d.a()}if(n>=s){for(var g=0,f=(360-i)/2,v=t.ap();v.i1();v.i2()){var m=v.i8(),p=m.a3(),y=this._ks.i3(m),w=this.i0(p),A=f+w._f+w._e;g<Math.abs(A-y)&&(g=Math.abs(A-y)),f+=w.a()}if(g<=this._kp)break}for(var x=t.aw();x.i1();x.i2()){var E=x.i9();this.i0(E)._g*=1+e}}},ib:function(t){return this.u(t)?0===t.ak()?this.ic():this.ia():Qo.superClass.ib.call(this,t)},u:function(t){return this._kq&&0!==t.ao()?null!=this._ks.i1(t.ag()):!1}});var $o=function(t){this._a=t};Oe.ext($o,Object,{i1:function(t){return this._a.i1(t)},i2:function(t){throw"Error"},i3:function(t){throw"Error"},i4:function(t){throw"Error"}});var ts=function(){};Oe.ext(ts,Object,{w1:function(t){this._bb=t},w2:function(){return this._bb},w4:function(t){null!=this._bb&&this._bb.i2(t)},w3:function(t){return null!=this._bb?this._bb.i1(t):!0}});var es=function(){this._cg=45,this._ce=400,this._ch=400,this._cf=0};Oe.ext(es,ts,{i1:function(t){if(null!=this.w2()){for(var e=!0,i=t.xk(),n=oo.a3(t,i),o=Os.d(n),s=Os.d(n),a=0;n>a;a++)o[a]=new zo,s[a]=new wo;for(var r=t.xf();r.i1();r.i2()){var h=r.i8();s[i.i2(h.a2())].aa(h),t.h1(h)}for(var l=t.x9();l.i1();l.i2()){var c=l.i9();o[i.i2(c)].aa(c),t.h2(l.i9())}for(var d=0;n>d;d++){for(var u=o[d].x1();u.i1();u.i2())t.h3(u.i9());for(var _=s[d].c1();_.i1();_.i2())t.u1(_.i8());e=this.w3(t);for(var g=s[d].c1();g.i1();g.i2())t.h1(g.i8());for(var f=o[d].x1();f.i1();f.i2())t.h2(f.i9());if(!e)break}for(var v=0;n>v;v++)for(var m=o[v].x1();m.i1();m.i2())t.h3(m.i9());for(var p=0;n>p;p++)for(var y=s[p].c1();y.i1();y.i2())t.u1(y.i8());return t.xi(i),e}return!0},i2:function(t){if(!t.xb()){for(var e=t.xk(),i=oo.a3(t,e),n=Os.d(i),o=Os.d(i),s=Os.d(i),a=Os.d(i),r=0;i>r;r++)n[r]=new zo,o[r]=new wo;for(var h=t.xf();h.i1();h.i2()){var l=h.i8();o[e.i2(l.a2())].aa(l),t.h1(l)}for(var c=t.x9();c.i1();c.i2()){var d=c.i9();n[e.i2(d)].aa(d),t.h2(c.i9())}for(var u=0;i>u;u++){for(var _=n[u].x1();_.i1();_.i2())t.h3(_.i9());for(var g=o[u].c1();g.i1();g.i2())t.u1(g.i8());this.w4(t);var f=t.g3();s[u]=new Kn(f.x,f.y,f.width,f.height);var v={};if(a[u]=v,this._cf>0){var m=this._cg+Math.ceil((f.width+1)/this._cf)*this._cf,p=this._cg+Math.ceil((f.height+1)/this._cf)*this._cf;v.x=f.x,v.y=f.y,v.width=m,v.height=p}else v.x=f.x,v.y=f.y,v.width=f.width+this._cg,v.height=f.height+this._cg;for(var y=o[u].c1();y.i1();y.i2())t.h1(y.i8());for(var w=n[u].x1();w.i1();w.i2())t.h2(w.i9())}for(var A=0;i>A;A++)for(var x=n[A].x1();x.i1();x.i2())t.h3(x.i9());for(var E=0;i>E;E++)for(var T=o[E].c1();T.i1();T.i2())t.u1(T.i8());if(vs.a(a,null,this._ce/this._ch),this._cf<=0)for(var C=0;C<a.length;C++)this.w5(t,n[C],o[C],new Gn(a[C].x,a[C].y),s[C]);else for(var b=0;b<a.length;b++){var k=Math.floor((a[b].x-s[b].x)/this._cf)*this._cf,S=Math.floor((a[b].y-s[b].y)/this._cf)*this._cf,I=s[b].x+k,L=s[b].y+S;this.w5(t,n[b],o[b],new Gn(I,L),s[b])}t.xi(e)}},w5:function(t,e,i,n,o){for(var s=-o.x+n.x,a=-o.y+n.y,r=e.x1();r.i1();r.i2()){var h=t.ga(r.i9());t.s4(r.i9(),new Gn(h.x+s,h.y+a))}for(var l=i.c1();l.i1();l.i2()){for(var c=l.i8(),d=new fn,u=t.gp(c).c();u.i1();u.i2()){var _=u.i6();d.add(new Gn(_.x+s,_.y+a))}t.s5(c,new qn(d))}}});var is=function(){};Oe.ext(is,ts,{i1:function(t){return this.w3(t)},i2:function(t){this.w7(t),null!=this.w2()&&this.w4(t),this.w6(t)},w7:function(t){this.e(t),this.k(t),this.i(t)},e:function(t){for(var e=t.x9();e.i1();e.i2()){var i=t.g4(e.i9());t.s1(e.i9(),i)}},w6:function(t){this.l(t),this.j(t),this.f(t)},l:function(t){for(var e=t.x9();e.i1();e.i2()){var i=t.g4(e.i9());t.s1(e.i9(),i)}},j:function(t){for(var e=t.xf();e.i1();e.i2()){var i=t.g7(e.i8()),n=i.i6();i.i8(n),n=i.i7(),i.i9(n);for(var o=0;o<i.i1();o++){var s=i.i2(o);i.i3(o,s.x,s.y)}}},k:function(t){for(var e=t.xf();e.i1();e.i2()){var i=t.g7(e.i8()),n=i.i6();i.i8(n),n=i.i7(),i.i9(n);for(var o=0;o<i.i1();o++){var s=i.i2(o);i.i3(o,s.x,s.y)}}},f:function(t){null!=this._ca&&(t.x1("A",this._ca),this._ca=null,this._b6=null),null!=this._b8&&(t.x1("B",this._b8),this._b8=null,this._b9=null)},i:function(t){this._ca=t.xc("A"),null!=this._ca&&(this._b6=new $o(this._ca),t.x1("A",this._b6)),this._b8=t.xc("B"),null!=this._b8&&(this._b9=new $o(this._b8),t.x1("B",this._b9))}});var ns=function(){this._a=new wo,this._c=10};Oe.ext(ns,ts,{i2:function(t){this._b=t.xl(),this.w9(t),this.w4(t),this.c(t),this.w8(t,this._b),t.xj(this._b)},i1:function(t){if(null==this.w2())return!0;this._b=t.xl(),this.w9(t);var e=this.w3(t);return this.c(t),t.xj(this._b),e},w8:function(t,e){for(var i=t.xf();i.i1();i.i2()){var n=i.i8();if(null!=e.i1(n)){var o=e.i1(n);vs.g(t,n,o,this._c)}}},w9:function(t){for(var e=t.xk(),i=t.x9();i.i1();i.i2()){for(var n=i.i9(),o=n.af();o.i1();o.i2()){var s=o.i8(),a=s.a1(n),r=e.i1(a);if(r!==s)if(null==r)e.z1(a,s);else{null==this._b.i1(r)&&this._b.i8(r,new wo);var h=this._b.i1(r);h.aa(s),this._a.ac(s),t.h1(s)}}for(var l=n.af();l.i1();l.i2()){var c=l.i8(),d=c.a1(n);e.z1(d,null)}}t.xi(e)},c:function(t){for(;!this._a.ar();t.u1(this._a.c3()));}});var os=function(t){this._a=t};Oe.ext(os,Object,{i2:function(t){this._a.i3(t)},i1:function(t){return this._a.i4(t)}});var ss=function(){ss.superClass.constructor.call(this),this._jo=30,this._jp=new ls,this._jt=5};Oe.ext(ss,Zo,{i4:function(t){return!0},i3:function(t){this._ju=t,vs.c(t);for(var e=this._jp.i1(t),i=0,n=t.x9();n.i1();n.i2())i=Math.max(i,this.e(n.i9()));i<this._jt&&(i=this._jt),this.a(e,i)},a:function(t,e){var i=t.i7(),n=2*Math.PI/i,o=0,s=Os.a(i);t.i4();for(var a=0;i>a;)s[a]=this.e(t.i9())+this._jo,o+=s[a],a++,t.i2();var r=o/i,h=o/(2*Math.PI);e>h&&(h=e),t.i4();for(var l=0,c=0;i>c;){var d=n/r*s[c];l+=d/2;var u=Math.cos(l)*h,_=Math.sin(l)*h;l+=d/2,this._ju.s2(t.i9(),u,_),c++,t.i2()}return h},e:function(t){var e=this._ju.gj(t),i=this._ju.g9(t);return i>=e?i:e}});var as=function(){as.superClass.constructor.call(this),this._jm=new ss,this._jk=new Qo};Oe.ext(as,Zo,{i4:function(t){return!0},i3:function(t){if(!(t.x0()<2)){this._jn=t,vs.c(this._jn),vs.e(this._jn);var e=new gs(this._jn);e.a1(),e.h();var i=new Vo(this._jn);i.a();for(var n=e.x9();n.i1();n.i2()){var o=n.i9(),s=e.c2(o);if(s.ay()>1){var a=e.d1(o);Vo.h(this._jn,a.c1()),this._jm.i3(this._jn);var r=this._jn.g3();e.s7(o,r.width,r.height)}else if(1===s.ay()){var h=s.x2();e.s8(o,this._jn.gm(h)),this._jn.s2(h,0,0)}else e.s7(o,1,1);Vo.i(this._jn,this._jn.xf())}i.b();var l=this.a7(e);uo.a4(e,l);var c=e.xk(),d=e.xl();this.a2(e,d,c),this.a1(e,d),this.a3(e,l,d),this._jk.a(d,c),this._jk.i3(e),this.a5(e,l,c);for(var u=e.x9();u.i1();u.i2())for(var _=u.i9(),g=e.g4(_),f=e.c2(_).x1();f.i1();f.i2()){var v=f.i9();this._jn.s2(v,g.x+this._jn.g5(v),g.y+this._jn.g6(v))}}},a7:function(t){for(var e=-1,i=null,n=t.x9();n.i1();n.i2()){var o=n.i9();t.c2(o).ay()>e&&(i=o,e=t.c2(o).ay())}return i},a1:function(t,e){for(var i=function(t,i){var n=e.i3(t)-e.i3(i);return n>0?1:n>=0?0:-1},n=t.x9();n.i1();n.i2())n.i9().av(i)},a2:function(t,e,i){for(var n=Os.a(this._jn.x0()),o=t.x9();o.i1();o.i2())for(var s=o.i9(),a=t.c2(s),r=a.x1();r.i1();r.i2()){var h=r.i9();n[h.al()]=s.al()}var l=uo.a2(t);this.a4(t,l,n,e,i)},a3:function(t,e,i){if(t.c2(e).ay()>1){for(var n=0,o=0,s=0,a=e.ap();a.i1();a.i2()){var r=a.i8(),h=i.i3(r);h-n>o&&(o=h-n,s=(n+h)/2),n=h}360-n>o&&(s=(360+n)/2),this.a6(t,e,s);for(var l=e.ap();l.i1();l.i2()){var c=l.i8(),d=i.i3(c);for(d-=s;0>d;d+=360);i.i6(c,d)}e.av(function(t,e){var n=i.i3(t)-i.i3(e);return n>0?1:n>=0?0:-1})}},a4:function(t,e,i,n,o){for(var s=e.al(),a=o.i3(e),r=e.ap();r.i1();r.i2()){for(var h=r.i8(),l=t.b(h),c=0,d=0,u=0,_=0,g=l.c1();g.i1();g.i2()){var f=g.i8(),v=null,m=null;i[f.a2().al()]===s?(v=f.a2(),m=f.a3()):(v=f.a3(),m=f.a2()),u-=this._jn.g5(v),_+=this._jn.g6(v),c-=this._jn.g5(m),d+=this._jn.g6(m)}if(0!==u||0!==_){var p;for(p=180*Math.atan2(_,u)/Math.PI-a;0>p;p+=360);n.i6(h,p)}if(0!==c&&0!==d){var y=180*Math.atan2(d,c)/Math.PI;0>y&&(y+=360),o.i6(h.a3(),y)}this.a4(t,h.a3(),i,n,o)}},a5:function(t,e,i){for(var n=t.g4(e),o=e.ap();o.i1();o.i2()){var s=o.i8(),a=s.a3(),r=t.g4(a),h=r.x-n.x,l=r.y-n.y,c=180*Math.atan2(l,h)/Math.PI;if(null!=i.i1(a)){var d=i.i3(a);c+=d}this.a6(t,a,c),this.a5(t,a,i)}},a6:function(t,e,i){i=i/180*Math.PI;var n=t.c2(e);if(!(n.ay()<=1))for(var o=n.x1();o.i1();o.i2()){var s=o.i9(),a=this._jn.g5(s),r=this._jn.g6(s),h=Math.cos(i),l=Math.sin(i),c=a*h-l*r,d=a*l+h*r;this._jn.s2(s,c,d)}}});var rs=function(){this._a=(new Date).getTime()};Oe.ext(rs,Object,{b:function(){return(new Date).getTime()-this._a}});var hs={};hs._A=new Gn(0,0),hs.b=function(t,e,i){return hs.c(t.x,t.y,e.x,e.y,i.x,i.y)},hs.c=function(t,e,i,n,o,s){i-=t,n-=e,o-=t,s-=e;var a=o*n-s*i;return Math.abs(a)<1e-5?0:a>=0?0>=a?0:-1:1},hs.d=function(t,e,i){return hs.b(t,e,i)>0},hs.f=function(t,e,i){return hs.b(t,e,i)<0},hs.g=function(t,e,i){return 0===hs.b(t,e,i)},hs.h=function(t){return hs.i(t)},hs.i=function(t){var e=new yo(t.ah()),i=new yo;if(e.a2(),e.ar())return i;var n=e.at();for(i.ae(n);!e.ar()&&n.equals(e.am());e.at());if(e.ar())return i;n=e.at();for(var o=i.ae(n),s=e.ah();s.i1();s.i2()){var a=s.i6();if(!a.equals(n))if(n=a,2===i.ay()&&hs.g(i.am(),i.as(),a))o.c(a);else{var r;for(r=o;!hs.f(i.ai(r).d(),r.d(),a);r=i.ai(r));var h;for(h=o;!hs.d(i.aj(h).d(),h.d(),a);h=i.aj(h));for(;h!==i.aj(r);i.aw(i.aj(r)));o=i.an(a,r)}}return i},hs.j=function(){return hs.k(Number.MAX_VALUE)},hs.k=function(t){return Math.floor(Me.Util.random()*t)},hs.l=function(t,e){return Me.Util.random()*(e-t)+t};var ls=function(){};Oe.ext(ls,Object,{i1:function(t){this._b=t;var e=new wo;e=oo.a6(t),e.az(oo.a7(t));for(var i=this.a1();!e.ar();t.x5(e.c3()));return i.x1()},a1:function(){if(this._b.x0()<3)return new zo(this._b.x9());for(var t=this._b.xk(),e=this._b.xk(),i=this._b.xl(),n=new Uo(this._b,new Jo,0,this.a3(this._b)),o=this._b.x0(),s=new wo,a=new wo,r=new Vo(this._b);o>3;o--){for(var h=n.g(),l=h.an();l.i1();l.i2())t.z1(l.i9(),o),e.i5(l.i9(),!1);for(var c=h.an();c.i1();c.i2())for(var d=c.i9(),u=d.ap();u.i1();u.i2()){var _=u.i8();t.i2(_.a3())===o&&(a.aa(_),e.i5(_.a2(),!0),e.i5(_.a3(),!0))}if(a.ay()<h.ad()-1){for(var g=null,f=h.an();f.i1();f.i2()){var v=f.i9();if(t.i2(v)===o&&!e.i4(v))if(null==g)g=v;else{var m=this._b.xo(g,v);i.i7(m,!0),a.aa(m),g=null}}if(null!=g)for(var p=h.an();p.i1();p.i2()){var y=p.i9();if(y!==g&&null==y.aj(g)){var w=this._b.xo(g,y);i.i7(w,!0),a.aa(w);break}}if(a.ay()<h.ad()-1){for(var A=2147483647,x=null,E=h.an();E.i1();E.i2()){var T=E.i9();T.ad()<A&&(x=T,A=T.ad())}for(var C=h.an();C.i1();C.i2()){var b=C.i9();if(null==x.aj(b)&&x!==b){var k=this._b.xo(x,b);if(i.i7(k,!0),a.aa(k),a.ay()>=h.ad()-1)break}}}}for(var S=h.an();S.i1();S.i2())n.b(S.i9());for(var I=a.c1();I.i1();I.i2()){var L=I.i8();i.i4(L)&&(n.d(L.a2()),n.d(L.a3()))}s.az(a),r.e(h)}r.b(),n.c();for(var P=s.c1();P.i1();P.i2()){var R=P.i8();null!=R._h&&(i.i4(R)?this._b.x5(R):this._b.h1(R))}var D=this.a4(this._b),M=new zo,O=D.ak(0),B=D.ak(1),N=null;N=O.a2()===B.a2()||O.a2()===B.a3()?O.a3():O.a2(),M.aa(N);for(var z=D.c1();z.i1();z.i2()){var F=z.i8();N=F.a1(N),M.aa(N)}for(var V=s.c1();V.i1();V.i2()){var U=V.i8();i.i4(U)||null!=U._h||this._b.u1(U)}return this._b.xi(e),this._b.xj(i),this._b.xi(t),this.a2(M),M},a2:function(t){if(t.ay()<this._b.x0()){for(var e=this._b.xk(),i=t._b;null!=i;i=i.a()){var n=i.d();e.z1(n,i)}var o;for(o=new Uo(this._b,new qo(e),0,t.ay(),new qo(e));!o.e();){for(var s=o.f(),a=s.an();a.i1();a.i2()){var r=a.i9();if(null!=e.i1(r)){var h=e.i1(r),l=t.ai(h).d(),c=null;c=null!=s.aj(l)?t.ao(s,h):t.an(s,h),e.z1(s,c);break}}for(var d=s.an();d.i1();d.i2()){var u=d.i9();null==e.i1(u)&&o.d(u)}}this._b.xi(e),o.c()}},a3:function(t){for(var e=0,i=t.x9();i.i1();i.i2())e=Math.max(e,i.i9().ad());return e},a4:function(t){for(var e=[],i=0,n=t.x0();n>i;i++)e[i]=new lo;var o=new ro(e);o.a6(!1),o.a8(t);for(var s=-1,a=null,r=t.x9();r.i1();r.i2()){var h=r.i9(),l=e[h.al()];l._a+l._c>s&&(s=l._a+l._c,a=h)}for(var c=new wo,d=a,u=e[d.al()]._d;null!=u;u=e[d.al()]._d)c.ac(u),d=u.a1(d);d=a;for(var _=e[d.al()]._b;null!=_;_=e[d.al()]._d)c.ae(_),d=_.a1(d);return c}});var cs=function(){this._v=new Ao,this._x=new Ao,this._z=new Ro(3,5),this._w=new Ro(3,5),this._y=!1,this._u=!1,this._t={}};Oe.ext(cs,Object,{xm:function(){var t=new Do(this);return t},xo:function(t,e){return this.xn(t,null,e,null,0,0)},xn:function(t,e,i,n,o,s){return new ko(this,t,e,i,n,o,s)},x4:function(t){this.b3(t)},b3:function(t){for(var e;null!=(e=t._o[0]);)this.x5(e);for(;null!=(e=t._o[1]);)this.x5(e);this._v.c(t),t._g=null,this._y=!0},x5:function(t){this.a11(t)},a11:function(t){if(t._h!==this)throw"Error";var e=t.a2(),i=t.a3();this.a12(t,e,i),this._x.c(t),t._h=null,this._u=!0},x7:function(t){t._p=this._v._c,t._g=this,t.ac(),t._c.length<this._z._b&&this._z.a3(t,t._c.length,this._z._b),this._v.a(t),this._y=!0},x8:function(t){if(null!=t._h)throw"Error";t._c.length<this._w._b&&this._w.a3(t,t._c.length,this._w._b),null==t._a||t._a._h!==this?this._x.a(t):this._x.b(t,t._a),t._h=this,t.a4(),this.b2(t,t.a2(),null,t.a3(),null,0,0),this._u=!0},xr:function(t,e,i){var n=t.a2(),o=t.a3();null==t._h?(t._d=e,t._e=i):(n!==e&&(n.ar(t,0,0),t._d=e,e.ab(t,null,0,0,0)),o!==i&&(o.ar(t,1,1),t._e=i,i.ab(t,null,1,1,0)))},x3:function(t){this.xr(t,t.a3(),t.a2())},h1:function(t){this.a11(t)},u1:function(t){this.x8(t)},h2:function(t){this.x4(t)},h3:function(t){this.x7(t)},xa:function(){return this._v._c},x0:function(){return this._v._c},xh:function(){return this._x._c},xg:function(){return this._x._c},xb:function(){return 0===this._v._c},xq:function(t){return t._g===this},xp:function(t){return t._h===this},xd:function(){return this._v._a},x9:function(){return new No(this._v)},xf:function(){return new No(this._x)},x2:function(t,e){var i=Os.d(this.xh());if(null!=t&&null!=e)for(var n=this.x9();n.i1();n.i2())n.i9().at(t,1,i),n.i9().at(e,0,i);else if(null==e&&null!=t)for(var o=this.x9();o.i1();o.i2())o.i9().at(t,1,i);else if(null!=e&&null==t)for(var s=this.x9();s.i1();s.i2())s.i9().at(e,0,i)},xk:function(){return this._z.b(this._v)},xl:function(){return this._w.c(this._x)},xi:function(t){this._z.a5(t,this._v)},xj:function(t){this._w.a6(t,this._x)},xc:function(t){return this._t[t]},x1:function(t,e){this._t[t]=e},x6:function(t){delete this._t[t]},b2:function(t,e,i,n,o,s,a){e.ab(t,i,0,0,s),n.ab(t,o,1,1,a)},a12:function(t,e,i){e.ar(t,0,0),i.ar(t,1,1)},c:function(){for(var t=0,e=this.x9();e.i1();e.i2())e.i9()._p=t++;this._y=!1},b1:function(){for(var t=0,e=this.xf();e.i1();e.i2())e.i8()._g=t++;this._u=!1},xs:function(t){t.as(this,this._z._b),t._p=this._v._c,this._v.a(t)},xt:function(t,e,i,n,o,s,a){t.a6(this,e,n,this._w._b),t._g=this._x._c,this._x.a(t),this.b2(t,t.a2(),i,t.a3(),o,s,a)}});var ds=function(){ds.superClass.constructor.call(this)};Oe.ext(ds,cs,{gb:function(t){return this.g1(t)},g7:function(t){return this.g2(t)},g5:function(t){var e=this.g1(t);return e.i1()+e.i3()/2},g6:function(t){var e=this.g1(t);return e.i2()+e.i4()/2},g4:function(t){return new Gn(this.g5(t),this.g6(t))},gi:function(t){return this.g1(t).i1()},gh:function(t){return this.g1(t).i2()},ga:function(t){var e=this.g1(t);return new Gn(e.i1(),e.i2())},gj:function(t){return this.g1(t).i3()},g9:function(t){return this.g1(t).i4()},gm:function(t){return new Xn(this.gj(t),this.g9(t))},s1:function(t,e){this.s2(t,e.x,e.y)},s2:function(t,e,i){var n=this.g1(t);n.i5(e-n.i3()/2,i-n.i4()/2)},s7:function(t,e,i){this.g1(t).i6(e,i)},s8:function(t,e){this.s7(t,e.width,e.height)},s3:function(t,e,i){this.g1(t).i5(e,i)},s4:function(t,e){this.s3(t,e.x,e.y)},gp:function(t){for(var e=this.g2(t),i=new fn,n=0;n<e.i1();n++)i.add(e.i2(n));return new qn(i)},gf:function(t){for(var e=this.g2(t),i=new yo,n=0;n<e.i1();n++)i.aa(e.i2(n));return i},gc:function(t){var e=new fn;e.add(this.gs(t));for(var i=this.gp(t).d();i.i1();i.i2())e.add(i.i6());return e.add(this.gl(t)),new qn(e)},gd:function(t){var e=new yo;e.aa(this.gs(t));for(var i=this.gp(t).d();i.i1();i.i2())e.aa(i.i6());return e.aa(this.gl(t)),e},m1:function(t,e){var i=this.g2(t);i.i5();var n=e.ah(),o=n.i6();this.gx(t,o);var s=e.as();for(n.i2();n.i6()!==s;n.i2()){var a=n.i6();i.i4(a.x,a.y)}this.gy(t,s)},s5:function(t,e){var i=this.g2(t);i.i5();for(var n=e.d();n.i1();n.i2()){var o=n.i6();i.i4(o.x,o.y)}},s6:function(t,e){var i=this.g2(t);i.i5();for(var n=e.ah();n.i1();n.i2()){var o=n.i6();i.i4(o.x,o.y)}},m2:function(t,e,i){this.gx(t,e),this.gy(t,i)},gn:function(t){return this.g2(t).i6()},gk:function(t){return this.g2(t).i7()},gt:function(t,e){this.g2(t).i8(e)},gz:function(t,e){this.g2(t).i9(e)},gs:function(t){var e=this.g2(t).i6();if(null==e)return this.g4(t.a2());var i=new Gn(this.g5(t.a2())+e.x,this.g6(t.a2())+e.y);return i},gl:function(t){var e=this.g2(t).i7();if(null==e)return this.g4(t.a3());var i=new Gn(this.g5(t.a3())+e.x,this.g6(t.a3())+e.y);return i},gx:function(t,e){var i=new Gn(e.x-this.g5(t.a2()),e.y-this.g6(t.a2()));this.g2(t).i8(i)},gy:function(t,e){var i=new Gn(e.x-this.g5(t.a3()),e.y-this.g6(t.a3()));this.g2(t).i9(i)},g8:function(){for(var t=new wo,e=this.xf();e.i1();e.i2())t.aa(e.i8());return t},g3:function(){for(var t,e,i=t=Number.MAX_VALUE,n=e=Number.MIN_VALUE,o=this.x9();o.i1();o.i2()){var s=this.ga(o.i9()),a=this.gm(o.i9());i=Math.min(s.x,i),t=Math.min(s.y,t),n=Math.max(s.x+a.width,n),e=Math.max(s.y+a.height,e)}for(var r=this.xf();r.i1();r.i2())for(var h=this.gp(r.i8()).c();h.i1();h.i2()){var l=h.i6();i=Math.min(l.x,i),t=Math.min(l.y,t),n=Math.max(l.x,n),e=Math.max(l.y,e)}return{x:Math.floor(i),y:Math.floor(t),width:Math.floor(n-i),height:Math.floor(e-t)}}});var us=function(){us.superClass.constructor.call(this),this.a(new no,new eo)};Oe.ext(us,ds,{a:function(t,e){this._a3=t,this._a4=e},xo:function(t,e){return this.l2(t,e,this._a4.a6())},l2:function(t,e,i){return this.l1(t,null,e,null,0,0,i)},xn:function(t,e,i,n,o,s){return this.l1(t,e,i,n,o,s,this._a4.a6())},l1:function(t,e,i,n,o,s,a){var r=new ko(this,t,e,i,n,o,s);return r._l=a,r},xm:function(){var t=new Do(this);return t._r=this._a3.m3(),t},g3:function(){for(var t={x:0,y:0,width:-1,height:-1},e=this.x9();e.i1();e.i2())e.i9()._r.m1(t);return t},g1:function(t){return t._r},g2:function(t){return t._l},g5:function(t){return t._r.m4()},g6:function(t){return t._r.m5()},gi:function(t){return t._r.i1()},gh:function(t){return t._r.i2()},gj:function(t){return t._r.i3()},g9:function(t){return t._r.i4()},s2:function(t,e,i){t._r.m6(e,i)},s7:function(t,e,i){t._r.i6(e,i)},s3:function(t,e,i){t._r.i5(e,i)}});var _s=function(){_s.superClass.constructor.call(this),this._ap=this.xk(),this._as=this.xl()};Oe.ext(_s,ds,{g1:function(t){var e=this._ap.i1(t);return null==e&&(e=new Lo,this._ap.z1(t,e)),e},g2:function(t){var e=this._as.i1(t);return null==e&&(e=new Io,this._as.i8(t,e)),e}});var gs=function(t){gs.superClass.constructor.call(this),this._ay=t,this._a0=this.xk(),this._au=this.xl()};Oe.ext(gs,_s,{c2:function(t){var e=this._a0.i1(t);return e},a2:function(t,e){this._a0.z1(t,e)},h:function(){null==this._az&&(this._az=this.xk());for(var t=Os.a(this._ay.x0()+1),e=1,i=this.x9();i.i1();){for(var n=this.c2(i.i9()),o=n.x1();o.i1();o.i2()){var s=o.i9();t[s.al()]=e}for(var a=new wo,r=n.x1();r.i1();r.i2())for(var h=r.i9(),l=t[h.al()],c=h.ap();c.i1();c.i2()){var d=c.i8(),u=d.a3(),_=t[u.al()];_===l&&a.ac(d)}this._az.z1(i.i9(),a),i.i2(),e++}},d1:function(t){return this._az.i1(t)},b:function(t){return this._au.i1(t)},a3:function(t,e){this._au.i8(t,e)},a1:function(){var t=this._ay.xk(),e=Ho.a4(Os.a(this._ay.xh())),i=oo.a1(this._ay,e,t),n=oo.a5(this._ay,e,i);this.d2(t,n),this._ay.xi(t)},c1:function(t){for(var e=null,i=-1,n=0,o=t.length;o>n;n++){var s=t[n];s.ay()>i&&(e=s,i=s.ay())}return e},d2:function(t,e){for(var i=this._ay.xl(),n=this._ay.xk(),o=e.length,s=0;o>s;s++)for(var a=e[s],r=a.c1();r.i1();r.i2())i.i8(r.i8(),a);var h=this.c1(e);this.a4(h,t,i,new fn,n);var l={};o=e.length;for(var c=0;o>c;c++){var d=e[c];if(d.ay()>1){var u=this.xm();l[d._id]=u}}for(var _=this._ay.x9();_.i1();_.i2()){var g=_.i9();if(t.i4(g)&&null==n.i1(g)){var f=this.xm();l[g._id]=f;var v=new zo;v.aa(g),this.a2(f,v)}}var m=Os.d(2);o=e.length;for(var p=0;o>p;p++){var y=e[p];if(1===y.ay()){var w=y.c2();m[0]=w.a2(),m[1]=w.a3();for(var A=0;2>A;A++){var x=m[A];if(1===x.ad()){var E=this.xm();l[x._id]=E;var T=new zo;T.aa(x),this.a2(E,T)}}}}for(var C=this._ay.x9();C.i1();C.i2()){var b=C.i9();if(null!=n.i1(b))for(var k=n.i1(b),S=l[k._id],I=b.af();I.i1();I.i2()){var L=I.i8();if(i.i1(L)!==k){var P=l[i.i1(L)._id];if(null==P){var R=L.a1(b),D=n.i1(R);P=null!=D?l[D._id]:l[R._id]}var M=S.aj(P),O=null;null==M?(M=this.xo(S,P),O=new wo):O=this.b(M),O.aa(L),this.a3(M,O)}}else if(t.i4(b))for(var B=l[b._id],N=b.af();N.i1();N.i2()){var z=N.i8(),F=z.a1(b),V=l[F._id];if(null!=V){var U=B.aj(V);if(null==U){var H=this.xo(B,V),W=new wo;W.aa(z),this.a3(H,W)}}}}if(2===this._ay.x0()&&1===this._ay.xg()){var Y=this._ay.xf().i8(),Z=l[Y.a2()._id],G=l[Y.a3()._id];if(null!=G&&null!=Z&&null==G.aj(Z)){var X=this.xo(Z,G),j=new wo;j.aa(Y),this.a3(X,j)}}var K=Os.a(this._ay.x0()),J=1;o=e.length;for(var q=0;o>q;q++){var Q=e[q],$=l[Q._id];if(null!=$){var tt=this.c2($);null==tt&&(tt=new zo,this.a2($,tt));for(var et=Q.c1();et.i1();et.i2()){var it=et.i8(),nt=it.a2();K[nt.al()]===J||t.i4(nt)&&n.i1(nt)!==Q||(K[nt.al()]=J,tt.aa(nt)),nt=it.a3(),K[nt.al()]===J||t.i4(nt)&&n.i1(nt)!==Q||(K[nt.al()]=J,tt.aa(nt))}}}this._ay.xj(i),this._ay.xi(n)},a4:function(t,e,i,n,o){if(!n.contains(t)){n.add(t);for(var s=[],a=t.c1();a.i1();a.i2()){var r=a.i8();s[0]=r.a2(),s[1]=r.a3();for(var h=0;2>h;h++){var l=s[h];if(e.i4(l)&&null==o.i1(l)){t.ay()>1&&o.z1(l,t);for(var c=l.af();c.i1();c.i2()){var d=i.i1(c.i8());this.a4(d,e,i,n,o)}}}}}}});var fs=function(t,e,i,n,o){this._a={},fs.superClass.constructor.call(this);var s,a,r=new fn;for(s=0,a=e.size();a>s;s++){var h=e.get(s);if(h instanceof Me.Link)r.add(h);else{var l=n&&null==o&&h instanceof Un;l&&h.setExpanded(!0);var c=t.getDimension(h);if(l&&h.setExpanded(!1),null==c)continue;var d=this.xm(),u=t._repulsion;"rightleft"===i||"leftright"===i?this.s7(d,c.height*u,c.width*u):this.s7(d,c.width*u,c.height*u),d.node=h,this._a[h.getId()]=d}}for(s=0,a=r.size();a>s;s++){var _=r.get(s),g=_.getFromAgent(),f=_.getToAgent(),v=this._a[g.getId()],m=this._a[f.getId()];null!=v&&null!=m&&v!==m&&this.xo(v,m)}};Oe.ext(fs,us,{});var vs={};vs._D=new qn,vs._E=new Gn(0,0),vs.b=function(t){if(t.i1()>0){for(var e=new fn,i=t.i1()-1;i>=0;i--)e.add(t.i2(i));t.i5();for(var n=0,o=e.size();o>n;n++){var s=e.get(n);t.i4(s.x,s.y)}}var a=t.i6();t.i8(t.i7()),t.i9(a)},vs.c=function(t){vs.d(t,!0)},vs.d=function(t,e){if(e)for(var i=t.xf();i.i1();i.i2()){var n=i.i8();t.gt(n,vs._E),t.gz(n,vs._E),t.s5(n,vs._D)}else for(var o=t.xf();o.i1();o.i2())t.s5(o.i8(),vs._D)},vs.e=function(t){for(var e=new Gn(0,0),i=t.xf();i.i1();i.i2()){var n=i.i8();t.gt(n,e),t.gz(n,e)}},vs.f=function(t,e,i,n){for(var o=t.gc(e).b(),s=Os.d(o),a=0,r=t.gc(e).c();r.i1();r.i2()){var h=r.i6();(0>=a||!h.equals(s[a-1]))&&(s[a]=new Gn(h.x,h.y),a++)}if(o=a,!(2>o)){var l=new fn,c=new jn(s[1].x-s[0].x,s[1].y-s[0].y),d=vs.i(c);d.x*=n,d.y*=n;for(var u=vs.h(s[0],d),_=vs.h(s[1],d),g=new Jn(u,_),f=1;o-1>f;f++){var v=g,m=vs.i(new jn(s[f+1].x-s[f].x,s[f+1].y-s[f].y));m.x*=n,m.y*=n;var p=vs.h(s[f],m),y=vs.h(s[f+1],m);g=new Jn(p,y);var w=Jn.a6(v,g);null!=w&&l.add(new Gn(w.x,w.y))}var A=new jn(s[o-1].x-s[o-2].x,s[o-1].y-s[o-2].y);A=vs.i(A),A.x*=n,A.y*=n;var x=vs.h(s[o-1],A),E=new qn(l);e.a2()===i.a2()?(t.s5(i,E),t.m2(i,u,x)):(t.s5(i,E.a()),t.m2(i,x,u))}},vs.g=function(t,e,i,n){for(var o=n,s=i.c1();s.i1();s.i2()){var a=s.i8();vs.f(t,e,a,o),0>o&&(o-=n),o=-o}},vs.a=function(t,e,i){return vs.j(t,e,i,1)},vs.l=function(t,e,i){if(null==t||t.length<1)return null!=e&&(e.x=0,e.y=0,e.width=0,e.height=0),{width:0,height:0};for(var n=0,o=0,s=0;s<t.length;s++){var a=t[s];n=Math.max(n,a.width),o=Math.max(o,a.height)}var r,h,l=n*o*t.length,c=Math.sqrt(l/i),d=l/c,u=Math.floor(d/n),_=Math.ceil(d/n),g=Math.ceil(t.length/u),f=Math.ceil(t.length/_);_*f>u*g?(r=u,h=g):(r=_,h=f);var v,m=0,p=0,y=0,w=0;if(n>o)for(var A=0;A<t.length;A++)v=t[A],v.x=p*n,v.y=m*o,y=Math.max(y,v.x+v.width),w=Math.max(w,v.y+v.height),++p>=r&&(m++,p=0);else for(var x=0;x<t.length;x++)v=t[x],v.x=p*n,v.y=m*o,y=Math.max(y,v.x+v.width),w=Math.max(w,v.y+v.height),++m>=h&&(p++,m=0);return null!=e&&(e.x=0,e.y=0,e.width=y,e.height=w),{width:h,height:r}},vs.j=function(t,e,i,n){if(null==t||t.length<1)return null!=e&&(e.x=0,e.y=0,e.width=0,e.height=0),0;for(var o,s,a=o=t[0].width,r=s=t[0].height,h=t.length,l=1;h>l;l++){var c=t[l].width;a=Math.min(a,c),o=Math.max(o,c);var d=t[l].height;r=Math.min(r,d),s=Math.max(s,d)}if(r/s>.95&&a/o>.95)return vs.l(t,e,i).width;for(var u=new yo,_=0,g=0;h>g;g++){var f=t[g];u.aa(t[g]),_=Math.floor(_+f.width*f.height)}u.a1(function(t,e){var i=Math.floor(e.height)-Math.floor(t.height);return 0===i?Math.floor(e.width)-Math.floor(t.width):i});var v=0,m=0,p=Math.floor(i*Math.sqrt(_/i)),y=p,w=0,A=new yo;do{var x=new yo;A.aa(x);for(var E,T,C=E=T=0,b=u.ah();b.i1();b.i2()){var k=b.i6();C+k.width>y&&x.ay()>0?(T=Math.max(T,C),x=new yo,x.aa(k),A.aa(x),C=Math.floor(k.width)):(x.aa(k),C=Math.floor(C+k.width)),1===x.ay()&&(E=Math.floor(E+x.am().height))}T=Math.max(T,C),i*E>T&&w!==T&&(A.af(),y=Math.floor(1.1*y),w=T)}while(A.ar());for(var S=0,I=A.ah();I.i1();I.i2()){for(var L=0,P=I.i6(),R=P.ah();R.i1();R.i2()){var D=R.i6();D.x=L,D.y=S,L+=D.width}v=Math.max(v,L),S+=vs.k(P),m=Math.max(m,S)}return null!=e&&(e.x=0,e.y=0,e.width=v,e.height=m),A.ay()},vs.k=function(t){for(var e=0,i=t.ah();i.i1();i.i2())e=Math.max(i.i6().height,e);return e},vs.h=function(t,e){return new Gn(t.x+e.x,t.y+e.y)},vs.i=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);return new jn(-t.y/e,t.x/e)};var ms=function(t){this._a=t,this._b=!1};Oe.ext(ms,Object,{a:function(){return this._b},b:function(){return this._a},c:function(){return 1===this._a},d:function(){return 2===this._a},e:function(){return 4===this._a},f:function(){return 8===this._a},g:function(){return 0===this._a}}),ms.h=function(t,e){var i=t.xc("A");return null==i?null:i.i1(e)},ms.i=function(t,e){var i=t.xc("B");return null==i?null:i.i1(e)},ms.j=function(t){switch(t){case 1:return ms.k;case 2:return ms.l}return null},ms.k=new ms(1),ms.l=new ms(2);var ps=function(t,e,i,n,o){this._o=0,this._l=0,this._i=0,this._d=0,this._f=0,this._b=t,this._a=1e-4,this._r=e,this._p=1,this._e=(o.gj(t)+o.g9(t))/4;var s=.45*i*Math.sqrt(n);this._k=hs.l(-s,s),this._h=hs.l(-s,s),this._g=hs.l(-s,s)};Oe.ext(ps,Object,{});var ys=function(){this._a=0,this._c=0,this._b=0};Oe.ext(ys,Object,{});var ws=function(){ws.superClass.constructor.call(this),this._dj=0,this._dh=0,this._dq=0,this._dp=0,this._dt=0,this._de=0,this._d3=0,this._dr=0,this._ed=0,this._dw=.65,this._ea=1,this._dl=80,this._dx=3,this._d8=!0,this._eb=3e5,this._ee=2,this._di=2,this._df=1e3};Oe.ext(ws,Zo,{i4:function(t){return!0},i3:function(t){if(null!=t&&(this._d5=t,this.s(t))){var e=new ys,i=0,n=Math.floor(this._dx*this._dz.length*this._dz.length+20*this._dz.length);n=Math.max(n,1e4);var o=this._ea*this._ea*this._dz.length,s=this._df;try{for(;this._dj>o&&n>i;i++){var a=this.b(2147483647&i);0===s--&&(this._dy.b()>this._eb&&(i=n),s=this._df),this.h(a,e),this.d(a,e),this.i(a,e),this._d8?(this.g(a,e),this.j(a,e)):(this.f(a,e),this.c(a,e));var r=Math.sqrt(e._a*e._a+e._c*e._c+e._b*e._b);this.ac(a,e,r),this.aa(a,e,r)}}catch(t){}finally{this.r()}}},s:function(t){if(null==t||t.xa()<1)return!1;this._d5=t,this._dp=1,this._dy=new rs,this._dt=t.x0(),this._d2=Os.d(this._dt),this._df=1+1e5/this._dt,this._ed=1/(2*this._di),this._de=this._ed*this._ee/(.05*this._dl),this._d3=Math.pow(this._dl,-1)*this._ed,this._dr=Math.pow(this._dl,3)*this._ed,this._dj=0,this._du=new ys,this._dq=Math.max(20*this._dl,10);var e=Math.max(.1,Math.min(this._dw*this._dl,this._dq)),i=this._dt;vs.c(t),this._dz=Os.d(i);for(var n=t.x9();n.i1();n.i2()){var o=n.i9(),s=new ps(o,e,this._dl,this._dt,t);this._dz[--i]=s,this._dj+=s._r,this._dh+=s._r*s._r,this._du._a+=s._k,this._du._c+=s._h,this._du._b+=s._g,this._d2[o.al()]=s}return this._d8=!1,this._dz.length>0},b:function(t){var e=this._dz.length,i=e-t%e-1,n=hs.k(i+1),o=this._dz[n];return this._dz[n]=this._dz[i],this._dz[i]=o,o},f:function(t,e){for(var i,n,o=i=n=0,s=t._b.ae();null!=s;s=s.a7()){var a,r=this._d2[s.a2().al()],h=r._k-t._k,l=r._h-t._h,c=r._g-t._g,d=h*h+l*l+c*c,u=Math.sqrt(d),_=u-(r._e+t._e);0>=_||(a=_*_*this._d3/u,o+=h*a,i+=l*a,n+=c*a)}for(var g=t._b.ag();null!=g;g=g.a8()){var f,v=this._d2[g.a3().al()],m=v._k-t._k,p=v._h-t._h,y=v._g-t._g,w=m*m+p*p+y*y,A=Math.sqrt(w),x=A-(v._e+t._e);0>=x||(f=x*x*this._d3/A,o+=m*f,i+=p*f,n+=y*f)}e._a+=o,e._c+=i,e._b+=n},g:function(t,e){var i,n,o=i=n=0;this._dp++,t._f=this._dp;for(var s=t._b.ae();null!=s;s=s.a7()){var a=this._d2[s.a2().al()];a._f=this._dp;var r=a._k-t._k,h=a._h-t._h,l=a._g-t._g,c=r*r+h*h+l*l,d=Math.sqrt(c);if(0!==d){var u=Math.max(1e-6,d-(t._e+a._e)),_=-this._ef[s.a5()]/(u*u);_+=u*u*this._d1[s.a5()],_/=d,o+=r*_,i+=h*_,n+=l*_}}for(var g=t._b.ag();null!=g;g=g.a8()){var f=this._d2[g.a3().al()];f._f=this._dp;var v=f._k-t._k,m=f._h-t._h,p=f._g-t._g,y=v*v+m*m+p*p,w=Math.sqrt(y);if(0!==w){var A=Math.max(1e-6,w-(t._e+f._e)),x=-this._ef[g.a5()]/(A*A);x+=A*A*this._d1[g.a5()],x/=w,o+=v*x,i+=m*x,n+=p*x}}e._a+=o,e._c+=i,e._b+=n},j:function(t,e){for(var i,n,o=i=n=0,s=this._dt-1;s>=0;s--){var a=this._d2[s];if(a._f!==t._f){var r=t._k-a._k,h=t._h-a._h,l=t._g-a._g,c=r*r+h*h+l*l;if(0!==c){var d=Math.sqrt(c),u=Math.max(1e-6,d-(t._e+a._e)),_=this._dr/(u*u*d);o+=r*_,i+=h*_,n+=l*_}}}e._a+=o,e._c+=i,e._b+=n},c:function(t,e){for(var i,n,o=i=n=0,s=this._dt-1;s>=0;s--){var a=this._d2[s],r=t._k-a._k,h=t._h-a._h,l=t._g-a._g,c=r*r+h*h+l*l;if(0!==c){var d,u=Math.sqrt(c),_=u-(t._e+a._e);d=0>=_?this._dr/(1e-8*u):this._dr/(_*_*u),o+=r*d,i+=h*d,n+=l*d}}e._a+=o,e._c+=i,e._b+=n},i:function(t,e){var i=this._du._b/this._dt-t._g;e._b+=i*this._dl*this._dt/this._dh},d:function(t,e){if(0!==this._de){var i=this._du._a/this._dt-t._k,n=this._du._c/this._dt-t._h,o=this._du._b/this._dt-t._g;e._a+=i*this._de,e._c+=n*this._de,e._b+=o*this._de}},h:function(t,e){var i=.05*(t._r+2);i>0&&(e._a=hs.l(-i,i),e._c=hs.l(-i,i),e._b=hs.l(-i,i))},ac:function(t,e,i){if(0!==i&&0!==t._a){var n=e._a*t._o+e._c*t._l+e._b*t._i,o=n/(i*t._a);this._dh-=t._r*t._r,this._dj-=t._r,t._r+=t._p*o>0?.45*o:.15*o,t._r>this._dq?t._r=this._dq:t._r<.1&&(t._r=.1),this._dj+=t._r,this._dh+=t._r*t._r,t._p=o}},aa:function(t,e,i){if(i>0){var n=t._r/i,o=e._a*n,s=e._c*n,a=e._b*n;t._k+=o,t._h+=s,t._g+=a,this._du._a+=o,this._du._c+=s,this._du._b+=a,t._a=i,t._o=e._a,t._l=e._c,t._i=e._b}},r:function(){for(var t=this._d2.length-1;t>=0;t--){var e=this._d2[t];this._d5.s2(e._b,e._k,e._h)}}});var As=function(t,e,i,n){this._e=t,this._f=e,this._a=i,this._b=n,this._c={}};Oe.ext(As,Object,{resetGroup:function(){if(this._a&&null==this._b)for(var t in this._c){var e=this._c[t];e.group.setExpanded(this._e.isExpandGroup()?!0:e.b)}},process:function(){for(var t=new fn,e=0,i=this._f.size();i>e;e++){var n=this._f.get(e);if(n instanceof Me.Link)n.isLooped()||t.add(n);else{if(null==this._b&&n.getParent()instanceof Un)continue;(null==this._b||null!=this._b&&this._b!==n)&&t.add(n),null==this._b&&n instanceof Un&&this.layoutGroup(n)}}return t},layoutGroup:function(t){if(this._a&&null==this._c[t.getId()]&&null==this._b){this._c[t.getId()]={group:t,b:t.isExpanded()};var e=this._e.getGroupLayoutType(t);if(e){t.setExpanded(!0);for(var i,n=new fn,o=t.getChildren(),s=0,a=o.size();a>s;s++)if(i=o.get(s),i instanceof Un&&(this.layoutGroup(i),i.setExpanded(!1)),i instanceof Me.Link||n.contains(i)||n.add(i),i instanceof Fn){var r=i.getLinks();if(null!=r)for(var h=0,l=r.size();l>h;h++){var c=r.get(h);n.contains(c)||n.add(c)}}var d=new fs(this._e,n,e,this._a,this._b);try{var u=null;if("round"===e?u=new as:"symmetry"===e?u=new ws:"hierarchic"===e?u=new Ls:("topbottom"===e||"bottomtop"===e||"rightleft"===e||"leftright"===e)&&(u=new Go),null!=u){u.i2(d);var _=As.createMatrix(e),g={},f={};for(var v in d._a){var m=d._a[v],p=m.node,y=d.g4(m);if(g[v]=p.getCenterLocation(),null!=_){var w=_.transform(y);p.setCenterLocation(w.x,w.y)}else p.setCenterLocation(y.x,y.y);f[v]=p.getCenterLocation()}}}catch(t){}for(o=t.getChildren(),s=0,a=o.size();a>s;s++)i=o.get(s),i instanceof Un&&i.setExpanded(!0)}}}}),As.createMatrix=function(t){return"rightleft"===t?Ze.createMatrix(Math.PI/2,0,0):"leftright"===t?Ze.createMatrix(-Math.PI/2,0,0):"bottomtop"===t?Ze.createMatrix(Math.PI,0,0):null};var xs=function(){};Oe.ext(xs,Object,{i1:function(t,e,i){var n=this.a1(t,e);return this.a2(t,e,i),n},a1:function(t,e){var i=xs.i4(t);i.ax();for(var n=0,o=i.x1();o.i1();o.i2())e.i7(o.i9(),-1);for(var s=i.x1();s.i1();s.i2()){for(var a=s.i9(),r=-1,h=a.aq();h.i1();h.i2())r=Math.max(r,e.i2(h.i9()));e.i7(a,r+1),n=Math.max(n,r+1)}return n+1},a2:function(t,e,i){i.az(xs.i3(t,e))}}),xs.i3=function(t,e){for(var i=new wo,n=t.xf();n.i1();n.i2()){var o=n.i8();e.i2(o.a2())>e.i2(o.a3())&&(t.x3(o),i.ac(o))}return i},xs.i4=function(t){var e=Os.a(t.xa());return(new co).a1(t,e),xs.i2(t,e)},xs.i2=function(t,e){for(var i=Os.d(t.x0()),n=t.x9();n.i1();n.i2()){var o=n.i9(),s=o.al();i[e[s]]=o}return new zo(i)};var Es=function(){Es.superClass.constructor.call(this),this.c0()};Oe.ext(Es,wo,{c0:function(){this._bc=1,this._bd=0}});var Ts=function(){this._m1=20,this._m2=60,this._m3=5,this._m4=0};Oe.ext(Ts,Object,{i4:function(t){this._m3=t},i5:function(t){this._m4=t},i3:function(t){this._m1=t},i6:function(t){this._m2=t},i2:function(t){this._m5=t},t1:function(){return this._m2},a1:function(t,e){for(var i=Os.d(e.length),n=0;n<e.length;n++)i[n]=e[n].x1();this.a2(t,i)},a2:function(t,e){for(var i=Os.a(e.length),n=0,o=0;o<e.length;o++){var s=0,a=e[o];for(a.i4();a.i1();a.i2())s=Math.max(s,t.g9(a.i9()));for(i[o]=s,a.i4();a.i1();a.i2()){var r=(i[o]-t.g9(a.i9()))/2;t.s4(a.i9(),new Gn(t.gi(a.i9()),n+r))}var h=this.t1();n+=i[o]+h,a.i4()}},i1:function(t,e,i){this._m6=t,this.t2(e,i)}});var Cs=function(t,e){Cs.superClass.constructor.call(this)};Oe.ext(Cs,Ts,{t2:function(t,e){var i=this._m6;this._a=i.xc("D"),this._h=i.xc("C"),this.a1(i,t),this.tg(i,t),this.tf(t,Ho.a5(this._e),this._m5,this._l),this.tb(i,this._f[0]),this.ta(t),this.th(i,this._f[0],t),this.b(t),this.tb(i,this._f[1]),this.ta(t),this.th(i,this._f[1],t),this.b(t),this.a11(this._f[1]),this.a12(t),this.tb(i,this._f[2]),this.ta(t),this.th(i,this._f[2],t),this.b(t),this.tb(i,this._f[3]),this.ta(t),this.th(i,this._f[3],t),this.b(t),this.a11(this._f[3]),this.a12(t),this.tc(i),this.tj()},a11:function(t){for(var e=0;e<t.length;e++)t[e]=-t[e]},b:function(t){for(var e=0;e<t.length;e++){var i=t[e];i.ax()}for(var n=0;n<t.length;n++)for(var o=0,s=null,a=t[n].x1();a.i1();a.i2()){var r=a.i9(),h=r.al();this._l[h]=o++,this._b[h]=s,this._k[h]=null,null!=s&&(this._k[s.al()]=r),s=r}var l=this._a;this._a=this._h,this._h=l;for(var c=this._m6.xf();c.i1();c.i2()){var d=c.i8(),u=this._m6.gn(d);this._m6.gt(d,new Gn(-u.x,u.y));var _=this._m6.gk(d);this._m6.gz(d,new Gn(-_.x,_.y))}var g=this._l,f=function(t,e){return null==t&&null!=e?1:null!=t&&null==e?-1:null==t&&null==e?0:g[t.a2().al()]-g[e.a2().al()]},v=function(t,e){return null==t&&null!=e?1:null!=t&&null==e?-1:null==t&&null==e?0:g[t.a3().al()]-g[e.a3().al()]};this._m6.x2(f,v)},a12:function(t){for(var e=this._m6.xf();e.i1();e.i2()){var i=e.i8();this._m6.x3(i);var n=this._m6.gn(i),o=this._m6.gk(i);this._m6.gz(i,n),this._m6.gt(i,o)}for(var s=new yo,a=0;a<t.length;a++)s.ae(t[a]);for(var r=0;r<t.length;r++)t[r]=s.au();var h=this._l,l=function(t,e){return null==t&&null!=e?1:null!=t&&null==e?-1:null==t&&null==e?0:h[t.a2().al()]-h[e.a2().al()]},c=function(t,e){return null==t&&null!=e?1:null!=t&&null==e?-1:null==t&&null==e?0:h[t.a3().al()]-h[e.a3().al()]};this._m6.x2(l,c)},tg:function(t,e){var i=t.x0(),n=t.xg();this._l=Os.a(i),this._b=Os.d(i),this._k=Os.d(i),this._m=Os.d(i),this._i=Os.d(i),this._o=Os.d(i),this._f=Os.e(4,i),this._c=Os.a(i),this._g=Os.a(i),this._j=Os.a(i),this._d=Os.b(i),this._e=Os.b(n);for(var o=0;o<e.length;o++)for(var s=0,a=null,r=e[o].x1();r.i1();r.i2()){var h=r.i9(),l=h.al();this._l[l]=s++,this._b[l]=a,this._k[l]=null,null!=a&&(this._k[a.al()]=h),a=h}var c=this._l,d=function(t,e){return null==t&&null!=e?1:null!=t&&null==e?-1:null==t&&null==e?0:c[t.a2().al()]-c[e.a2().al()]},u=function(t,e){return null==t&&null!=e?1:null!=t&&null==e?-1:null==t&&null==e?0:c[t.a3().al()]-c[e.a3().al()]};t.x2(d,u)},tb:function(t,e){for(var i=t.x9();i.i1();i.i2()){var n=i.i9(),o=n.al();this._m[o]=n,this._i[o]=n,e[o]=Number.MAX_VALUE,this._o[o]=n,this._c[o]=Number.MAX_VALUE,this._d[o]=!1,this._j[o]=this._g[o]=0}},ta:function(t){for(var e=1;e<t.length;e++)for(var i=-1,n=t[e]._b;null!=n;n=n.a()){var o=n.d(),s=o.al(),a=o.ak();if(0!==a){var r,h=Math.floor((a+1)/2),l=Math.ceil((a+1)/2),c=1;for(r=o.ae();h>c;r=r.a7())c++;for(var d=!1;l>=c&&!d;c++){var u=this._m6.g2(r),_=r.a2(),g=_.al();this._i[s]===o&&!this._e[r.a5()]&&i<this._l[g]&&(i=this._l[g],this._i[g]=o,this._m[s]=this._m[g],this._i[s]=this._m[s],d=!0,this._j[g]=u.i6().x,this._g[s]=u.i7().x),r=r.a7()}}}},th:function(t,e,i){for(var n=t.x9();n.i1();n.i2()){var o=n.i9(),s=o.al();this._m[s]===o&&this.td(t,o,e)}for(var a=0;a<i.length;a++){var r=i[a].x1();if(r.i1()){var h=i[a].x1().i9(),l=h.al();this._o[this._m[l].al()]===h&&this.tk(t,h,e)}}for(var c=t.x9();c.i1();c.i2()){var d=c.i9(),u=d.al(),_=this._c[this._o[this._m[u].al()].al()];_<Number.MAX_VALUE&&(e[u]+=_)}},td:function(t,e,i){var n=e.al();if(i[n]===Number.MAX_VALUE){i[n]=0;var o=e,s=0;do{var a=o.al();if(a!==n&&(s-=this._g[a]),this._l[a]>0){var r=this._b[a],h=this._m[this._b[a].al()],l=h.al();this.td(t,h,i),this._o[n]===e&&(this._o[n]=this._o[l]),this._o[n]===this._o[l]&&(i[n]=Math.max(i[n],i[r.al()]+this.ti(t,r,o)-s))}s+=this._j[a],o=this._i[a]}while(o!==e);s=0,o=e;do{var c=o.al();c!==n&&(s-=this._g[c]),i[c]=i[n]+s,s+=this._j[c],o=this._i[c]}while(o!==e)}},tk:function(t,e,i){var n=e.al();if(!this._d[n]){this._d[n]=!0;var o=e;do{var s=o.al(),a=this._k[s];if(null!=a){var r=a.al(),h=this._o[this._m[r].al()];if(h!==this._o[n]){var l=i[r]-i[n]-this.ti(t,o,a);this._c[h.al()]!==Number.MAX_VALUE&&(l+=this._c[h.al()]),this._c[this._o[n].al()]=Math.min(this._c[this._o[n].al()],l)}else this.tk(t,this._m[r],i)}o=this._i[s]}while(o!==e)}},tc:function(t){for(var e=Os.a(4),i=Os.a(4),n=t.x9();n.i1();n.i2()){var o=n.i9(),s=o.al();i[0]+=this._f[0][s],i[1]+=this._f[1][s],i[2]+=this._f[2][s],i[3]+=this._f[3][s]}i[0]/=t.xa(),i[1]/=t.xa(),i[2]/=t.xa(),i[3]/=t.xa();for(var a=t.x9();a.i1();a.i2()){var r=a.i9(),h=r.al(),l=t.g4(r);e[0]=this._f[0][h]-i[0],e[1]=this._f[1][h]-i[1],e[2]=this._f[2][h]-i[2],e[3]=this._f[3][h]-i[3],e.sort(Os.n);var c=(e[1]+e[2])/2;t.s1(r,new Gn(c,l.y))}},ti:function(t,e,i){var n,o=t.gj(e),s=t.gj(i);return n=o>1&&s>1?this._m1+(o+s)/2:this._m3+(o+s)/2,this._l[e.al()]<this._l[i.al()]?(null!=this._a&&(n+=this._a.i3(i)),null!=this._h&&(n+=this._h.i3(e))):(null!=this._a&&(n+=this._a.i3(e)),null!=this._h&&(n+=this._h.i3(i))),n},tj:function(){this._l=null,this._b=null,this._k=null,this._e=null,this._m=null,this._i=null,this._f=null,this._c=null,this._o=null,this._d=null,this._j=null,this._g=null},tf:function(t,e,i,n){for(var o=t.length,s=2;o-1>s;s++)for(var a=-1,r=0,h=0,l=t[s].x1(),c=t[s].x1();c.i1();c.i2()){var d=c.i9(),u=null,_=!1;if(1===d.ak()&&(u=d.ae().a2(),null!=i.i1(u)&&null!=i.i1(d)&&(_=!0)),h===t[s].ay()-1||_){for(var g=_?n[u.al()]:t[s-1].ay();h>=r;r++){for(var f=l.i9(),v=f.am();v.i1();v.i2()){var m=v.i8(),p=n[m.a2().al()];(a>p||p>g)&&e.i7(v.i8(),!0)}l.i2()}a=g}h++}}});var bs=function(t,e){this._b=20,this._a=e,this._d=t,this._f={}};Oe.ext(bs,Object,{a3:function(t){this._b=t},a4:function(t,e,i,n,o){if(this.a2(t)){var s=this.b2(t);s._o=e,s._m=o,s._n=n,s._f=i}},b2:function(t){var e=this._f[t._id];return null==e&&(e=new ks,this._f[t._id]=e),e},a2:function(t){return null!=this._f[t._id]},c:function(){for(var t=Ho.a1(Os.a(this._d.xa())),e=Ho.a1(Os.a(this._d.xa())),i=this._d.x9();i.i1();i.i2()){var n=i.i9();if(this.a2(n)){var o=this.b2(n);t.i6(n,this._b*(o.c()-1)),e.i6(n,this._b*(o.b()-1))}}this._d.x1("D",t),this._d.x1("C",e)},g:function(){this._d.x6("D"),this._d.x6("C")},f:function(){for(var t=this._d.x9();t.i1();t.i2()){var e=t.i9();if(this.a2(e)){var i=this._d.gi(e),n=this._d.gh(e),o=this._d.gj(e),s=this._d.g9(e),a=this.b2(e),r=a._q.ay()+a._b.ay()+a._f,h=a._d.ay()+a._g.ay()+a._o,l=a._i.ay()+a._l.ay()+a._n,c=a._h.ay()+a._k.ay()+a._m,d=this._a.a7(o,r),u=this._a.a7(o,h),_=this._a.a7(s,c),g=this._a.a7(s,l);a.a2(this._a.a8(o,r,d),this._a.a8(o,h,u),this._a.a8(s,c,_),this._a.a8(s,l,g));for(var f=a._j.c1();f.i1();f.i2()){var v=f.i8(),m=this.a1(v),p=this.b1(v),y=new yo;m.b()===p.b()?(m.c()?(y.aa(new Gn(i+a._g._bd*u+a._c,n)),y.aa(new Gn(i+a._g._bd*u+a._c,n-this._b)),a._g._bd++,y.aa(new Gn(i+a._g._bd*u+a._c,n-this._b)),y.aa(new Gn(i+a._g._bd*u+a._c,n)),a._g._bd++,a._g._bc=Math.max(a._g._bc,2)):m.d()?(y.aa(new Gn(i+a._b._bd*d+a._p,n+s)),y.aa(new Gn(i+a._b._bd*d+a._p,n+s+this._b)),a._b._bd++,y.aa(new Gn(i+a._b._bd*d+a._p,n+s+this._b)),y.aa(new Gn(i+a._b._bd*d+a._p,n+s)),a._b._bd++,a._b._bc=Math.max(a._b._bc,2)):m.f()?(y.aa(new Gn(i,n+a._i._bd*g+a._a)),y.aa(new Gn(i-this._b,n+a._i._bd*g+a._a)),a._i._bd++,y.aa(new Gn(i-this._b,n+a._i._bd*g+a._a)),y.aa(new Gn(i,n+a._i._bd*g+a._a)),a._i._bd++,a._i._bc=Math.max(a._i._bc,2)):m.e()&&(y.aa(new Gn(i+o,n+a._h._bd*_+a._e)),y.aa(new Gn(i+o+this._b,n+a._h._bd*_+a._e)),a._h._bd++,y.aa(new Gn(i+o+this._b,n+a._h._bd*_+a._e)),y.aa(new Gn(i+o,n+a._h._bd*_+a._e)),a._h._bd++,a._h._bc=Math.max(a._h._bc,2)),this._d.m1(v,y)):m.c()||p.c()?m.e()||p.e()?(y.aa(new Gn(i+o-a._d._bd*u-a._c,n)),y.aa(new Gn(i+o-a._d._bd*u-a._c,n-this._b*a._d._bc)),y.aa(new Gn(i+o+this._b*a._h._bc,n-this._b*a._d._bc)),y.aa(new Gn(i+o+this._b*a._h._bc,n+a._h._bd*_+a._e)),y.aa(new Gn(i+o,n+a._h._bd*_+a._e)),a._d._bd++,a._d._bc++,a._h._bd++,a._h._bc++,p.c()&&y.ax(),this._d.m1(v,y)):m.f()||p.f()?(y.aa(new Gn(i+a._g._bd*u+a._c,n)),y.aa(new Gn(i+a._g._bd*u+a._c,n-this._b*a._g._bc)),y.aa(new Gn(i-this._b*a._i._bc,n-this._b*a._g._bc)),y.aa(new Gn(i-this._b*a._i._bc,n+a._i._bd*g+a._a)),y.aa(new Gn(i,n+a._i._bd*g+a._a)),a._g._bd++,a._g._bc++,a._i._bd++,a._i._bc++,p.c()&&y.ax(),this._d.m1(v,y)):(m.d()||p.d())&&(y.aa(new Gn(i+o-a._d._bd*u-a._c,n)),y.aa(new Gn(i+o-a._d._bd*u-a._c,n-this._b*a._d._bc)),y.aa(new Gn(i+o+this._b*a.b(),n-this._b*a._d._bc)),y.aa(new Gn(i+o+this._b*a.b(),n+s+this._b*a._q._bc)),y.aa(new Gn(i+o-a._q._bd*d-a._p,n+s+this._b*a._q._bc)),y.aa(new Gn(i+o-a._q._bd*d-a._p,n+s)),a._d._bd++,a._d._bc++,a._k._bc++,a._h._bc++,a._q._bc++,a._q._bd++,p.c()&&y.ax(),this._d.m1(v,y)):m.d()||p.d()?m.e()||p.e()?(y.aa(new Gn(i+o-a._q._bd*d-a._p,n+s)),y.aa(new Gn(i+o-a._q._bd*d-a._p,n+s+this._b*a._q._bc)),y.aa(new Gn(i+o+this._b*a._k._bc,n+s+this._b*a._q._bc)),y.aa(new Gn(i+o+this._b*a._k._bc,n+s-a._k._bd*_-a._e)),y.aa(new Gn(i+o,n+s-a._k._bd*_-a._e)),a._q._bd++,a._q._bc++,a._k._bd++,a._k._bc++,p.d()&&y.ax(),this._d.m1(v,y)):(m.f()||p.f())&&(y.aa(new Gn(i+a._b._bd*d+a._p,n+s)),y.aa(new Gn(i+a._b._bd*d+a._p,n+s+this._b*a._b._bc)),y.aa(new Gn(i-this._b*a._l._bc,n+s+this._b*a._b._bc)),y.aa(new Gn(i-this._b*a._l._bc,n+s-a._l._bd*g-a._a)),y.aa(new Gn(i,n+s-a._l._bd*g-a._a)),a._b._bd++,a._b._bc++,a._l._bd++,a._l._bc++,p.d()&&y.ax(),this._d.m1(v,y)):(y.aa(new Gn(i,n+s-a._l._bd*g-a._a)),y.aa(new Gn(i-this._b*a._l._bc,n+s-a._l._bd*g-a._a)),y.aa(new Gn(i-this._b*a._l._bc,n+s+this._b*a.a1())),y.aa(new Gn(i+o+this._b*a._k._bc,n+s+this._b*a.a1())),y.aa(new Gn(i+o+this._b*a._k._bc,n+s-a._k._bd*_-a._e)),y.aa(new Gn(i+o,n+s-a._k._bd*_-a._e)),a._l._bd++,a._l._bc++,a._b._bc++,a._q._bc++,a._k._bc++,a._k._bd++,p.f()&&y.ax(),this._d.m1(v,y))}}}},a5:function(t,e){for(var i=0;i<t.length;i++)for(var n=t[i],o=e[i],s=n.x1();s.i1();s.i2()){var a=s.i9();if(this.a2(a)){var r=this.b2(a);o._g=Math.max(o._g,this._b*(r.d()-1)),o._j=Math.max(o._j,this._b*(r.a1()-1))}}},a1:function(t){var e=this._d.xc("A"),i=null;if(null!=e&&(i=e.i1(t)),null==i||i.g()){var n=this._d.xc("B");if(null==n)return ms.j(1);var o=n.i1(t);if(null==o||o.g())return ms.j(1);if(o.c())return ms.j(8);if(o.f())return ms.j(1);if(o.d())return ms.j(4);if(o.e())return ms.j(2)}return i},b1:function(t){var e=this._d.xc("B"),i=null;if(null!=e&&(i=e.i1(t)),null==i||i.g()){var n=this._d.xc("A");if(null==n)return ms.j(8);var o=n.i1(t);if(null==o||o.g())return ms.j(8);if(o.c())return ms.j(8);if(o.f())return ms.j(1);if(o.d())return ms.j(4);if(o.e())return ms.j(2)}return i}});var ks=function(){this._o=0,this._f=0,this._n=0,this._m=0,this._c=0,this._p=0,this._e=0,this._a=0,this._j=new wo,this._g=new Es,this._d=new Es,this._b=new Es,this._q=new Es,this._h=new Es,this._k=new Es,this._i=new Es,this._l=new Es};Oe.ext(ks,Object,{a1:function(){return Math.max(this._q._bc,this._b._bc)},d:function(){return Math.max(this._d._bc,this._g._bc)},b:function(){return Math.max(this._k._bc,this._h._bc)},c:function(){return Math.max(this._l._bc,this._i._bc)},a2:function(t,e,i,n){this._c=e,this._a=n,this._p=t,this._e=i,this._g.c0(),this._d.c0(),this._b.c0(),this._q.c0(),this._k.c0(),this._h.c0(),this._l.c0(),this._i.c0()}});var Ss=function(t,e,i,n){this._k=20,this._r=.5,this._d=t,this._c=e,this._j=i,this._m=n,this._i=null!=t.xc("A")||null!=t.xc("B"),this._t=new Ps(t,e,i,n),this._b=new bs(t,this)};Oe.ext(Ss,Object,{a6:function(t){this._k=t,this._t.a1(t),this._b.a3(t)},g1:function(){return this._k},a9:function(t){return this.c1(),t},a5:function(t){return this.a1(),t},b3:function(t){return this.c1(),t=this.c4(t),this._b.c(),t},g2:function(t){return this._b.g(),t},e2:function(t){t=this.f(t),this._b.f()},e1:function(){this._t.d(),null!=this._n&&this._d.xi(this._n),this.a1(),this._d=null},a1:function(){this._i&&(null!=this._q&&(this._d.x1("A",this._q),this._q=null),null!=this._p&&(this._d.x1("B",this._p),this._p=null),null!=this._h&&(this._d.xj(this._h),this._h=null),null!=this._l&&(this._d.xj(this._l),this._l=null))},c1:function(){if(this._i){null==this._h&&(this._h=this._d.xl()),null==this._l&&(this._l=this._d.xl());for(var t=this._d.xf();t.i1();t.i2()){var e=t.i8(),i=null!=this._j.i1(e.a2()),n=null!=this._j.i1(e.a3());if(i&&!n){var o=this._j.i1(e.a2());this._m.i4(o)?this._l.i8(e,ms.h(this._d,o)):this._l.i8(e,ms.i(this._d,o))}else if(!i&&n){var s=this._j.i1(e.a3());this._m.i4(s)?this._h.i8(e,ms.i(this._d,s)):this._h.i8(e,ms.h(this._d,s))}else i||n||(this._m.i4(e)?(this._h.i8(e,ms.i(this._d,e)),this._l.i8(e,ms.h(this._d,e))):(this._h.i8(e,ms.h(this._d,e)),this._l.i8(e,ms.i(this._d,e))))}this._q=this._d.xc("A"),this._p=this._d.xc("B"),this._d.x1("A",this._h),this._d.x1("B",this._l)}},c4:function(t){this._n=this._d.xk(),this._a=this._d.xl(),this._g=this._d.xl();for(var e=new wo,i=new wo,n=new wo,o=new wo,s=new wo,a=new wo,r=new wo,h=new wo,l=new wo,c=this._d.xk(),d=0;d<t.length;d++)for(var u=0,_=t[d].x1();_.i1();)c.i6(_.i9(),u),_.i2(),u++;for(var g=function(t,e){var i=c.i3(t.a3())-c.i3(e.a3());return 0>=i?i>=0?0:-1:1},f=function(t,e){var i=c.i3(t.a2())-c.i3(e.a2());return 0>=i?i>=0?0:-1:1},v=0;v<t.length;v++)for(var m=t[v],p=m._b;null!=p;p=p.a()){var y=p.d();y.av(g),y.au(f);var w=0;e.af(),i.af(),n.af(),o.af(),s.af(),a.af(),r.af(),h.af(),l.af();for(var A=y.ap();A.i1();){var x=A.i8(),E=this.b1(x);null==E||E.d()||E.g()?n.aa(x):E.e()?e.aa(x):E.f()?(i.aa(x),l.aa(x)):E.c()&&(h.aa(x),l.aa(x)),A.i2(),w++}w=0;for(var T=y.am();T.i1();){var C=T.i8(),b=this.a2(C);null==b||b.c()||b.g()?o.aa(C):b.e()?e.aa(C):b.f()?(i.aa(C),l.aa(C)):b.d()&&(a.aa(C),l.aa(C)),T.i2(),w++}var k=c.i3(y);if(!l.ar())for(var S=.1/l.ay(),I=k-.4;!l.ar();I+=S){var L=l.c3();if(L.a2()===y){var P=this._d.xm();this._n.z1(P,L.a2()),this._d.s7(P,1,1),this._c.z1(P,this._c.i1(y)),c.i6(P,I),this._a.i8(L,this._d.gn(L)),this._d.gt(L,hs._A),this._d.xr(L,P,L.a3()),m.ao(P,p)}else{var R=this._d.xm();this._n.z1(R,L.a3()),this._d.s7(R,1,1),this._c.z1(R,this._c.i1(y)),c.i6(R,I),this._g.i8(L,this._d.gk(L)),this._d.gz(L,hs._A),this._d.xr(L,L.a2(),R),m.ao(R,p)}}if(!e.ar())for(var D=.1/e.ay(),M=k+.1;!e.ar();M+=D){var O=e.c3();if(O.a2()===y){var B=this._d.xm();this._n.z1(B,O.a2()),this._d.s7(B,1,1),this._c.z1(B,this._c.i1(y)),c.i6(B,M),this._a.i8(O,this._d.gn(O)),this._d.gt(O,hs._A),this._d.xr(O,B,O.a3()),p=m.an(B,p)}else{var N=this._d.xm();this._n.z1(N,O.a3()),this._d.s7(N,1,1),this._c.z1(N,this._c.i1(y)),c.i6(N,M),this._g.i8(O,this._d.gk(O)),this._d.gz(O,hs._A),this._d.xr(O,O.a2(),N),p=m.an(N,p)}}var z=Ss._z;this._b.a2(y)&&(z=this._b.b2(y));var F=z._b.ay()+a.ay()+y.ao()+s.ay()+z._q.ay();if(F>0)for(var V=this._d.g9(y)/2,U=this._d.gj(y),H=this.a7(U,F),W=-.5*U+this.a8(this._d.gj(y),F,H)+H*(z._b.ay()+a.ay()),Y=y.ap();Y.i1();Y.i2()){var Z=Y.i8();this.c2(Z)||null!=this._j.i1(Z.a2())||(this._d.g2(Z).i8(new Gn(W,V)),W+=H)}var G=this._t.a3(y),X=0,j=0,K=0,J=0;if(null!=G&&(X=G._e.ay(),j=G._c.ay(),K=G._b.ay(),J=G._d.ay()),F=z._g.ay()+X+h.ay()+y.ak()+r.ay()+j+z._d.ay(),F>0){for(var q=this._d.gj(y),Q=this.a7(q,F),$=this.a8(q,F,Q),tt=-.5*q+$+Q*(z._g.ay()+X+h.ay()),et=-this._d.g9(y)/2,it=y.am();it.i1();it.i2()){var nt=it.i8();this.d1(nt)||null!=this._j.i1(nt.a3())||(this._d.g2(nt).i9(new Gn(tt,et)),tt+=Q)}if(null!=G){for(var ot=-.5*q+$+Q*(z._g.ay()+h.ay()+G._e.ay()-1),st=G._e.c1();st.i1();st.i2()){var at=st.i8();this._d.u1(at),at.a2()!==y||this.c2(at)?this.d1(at)||(this._d.g2(st.i8()).i9(new Gn(ot,et)),ot-=Q):(this._d.g2(st.i8()).i8(new Gn(ot,et)),ot-=Q),this._d.h1(at)}ot=.5*q-$-Q*(z._d.ay()+r.ay());for(var rt=G._c.c1();rt.i1();rt.i2()){var ht=rt.i8();this._d.u1(ht),ht.a2()!==y||this.c2(ht)?this.d1(ht)||(this._d.g2(rt.i8()).i9(new Gn(ot,et)),ot-=Q):(this._d.g2(rt.i8()).i8(new Gn(ot,et)),ot-=Q),this._d.h1(ht)}}}this._b.a2(y)&&this._b.a4(y,X+h.ay()+y.ak()+r.ay()+j,a.ay()+y.ao()+s.ay(),K+i.ay(),J+e.ay())}return this._d.xi(c),t},a7:function(t,e){return 1>=e?0:t/(e-1+2*this._r)},a8:function(t,e,i){return 1>=e?.5*t:.5*(t-i*(e-1))},f:function(t){var e=this.g1();this._f=this._d.xk();for(var i=0;i<t.length;i++)for(var n=t[i],o=n._b;null!=o;){var s=o.d(),a=this._n.i1(s);if(null!=a||this._t.b2(s))o=o.a();else{var r=new zo,h=new zo,l=new zo,c=new zo,d=new zo,u=new zo,_=new wo,g=new wo,f=new Ms(r,h,l,c,d,u,_,g);this._f.z1(s,f),_.ab(s.am()),g.ab(s.ap());for(var v=o.b();null!=v&&this._n.i1(v.d())===s;v=v.b()){var m=v.d(),p=this.c3(m);p.f()?h.ac(m):p.c()?c.ac(m):p.d()&&u.ac(m)}var y;for(y=o.a();null!=y&&this._n.i1(y.d())===s;y=y.a()){var w=y.d(),A=this.c3(w);A.e()?r.aa(w):A.c()?l.aa(w):A.d()&&d.aa(w)}o=y}}for(var x=this.d2(t),E=0,T=0;T<t.length;T++){var C=x[T];T>0&&(E+=x[T-1]._j+x[T-1]._h+x[T-1]._b),E+=C._g+C._f+C._a+C._d;for(var b=t[T].x1();b.i1();b.i2()){var k=b.i9();this._d.s3(k,this._d.gi(k),this._d.gh(k)+E)}C._c+=E,C._i+=E}for(var S=0;S<t.length;S++)for(var I=t[S],L=I.x1();L.i1();L.i2()){var P=L.i9();null!=this._n.i1(P)&&I.av(L)}for(var R=this,D=function(t,e){return R.a3(t)?R.a3(e)&&R._d.gi(t)>=R._d.gi(e)?-1:1:R.a3(e)?-1:R._d.gi(t)>=R._d.gi(e)?1:-1},M=function(t,e){return R.a3(t)?R.a3(e)?R._d.gi(t)>=R._d.gi(e)?1:-1:1:R.a3(e)?-1:R._d.gi(t)>=R._d.gi(e)?-1:1},O=0;O<t.length;O++)for(var B=x[O],N=t[O].x1();N.i1();N.i2()){var z=N.i9();if(!this._t.b2(z)){var F=this._f.i1(z),V=F._d,U=F._a,H=F._b,W=F._h,Y=F._f,Z=F._c,G=F._g,X=F._e,j=0,K=0,J=0,q=0,Q=z.ao(),$=z.ak(),tt=this._d.gi(z),et=this._d.gh(z),it=this._d.gj(z),nt=this._d.g9(z),ot=this._t.a3(z),st=Ss._z;if(this._b.a2(z)&&(st=this._b.b2(z)),null!=ot){if(j=ot._d.ay(),K=ot._b.ay(),J=ot._e.ay(),q=ot._c.ay(),j>0)for(var at=st._h.ay()+V.ay()+j+st._k.ay(),rt=this.a7(nt,at),ht=this.a8(nt,at,rt),lt=et+ht+rt*(st._h.ay()+this.a4(V)),ct=ot._d.c1();ct.i1();ct.i2()){var dt=ct.i8();this._d.u1(dt),dt.a2()===z?this.c2(dt)||this._d.gx(dt,new Gn(tt+it,lt)):(this.d1(dt),this._d.gy(dt,new Gn(tt+it,lt))),lt+=rt,this._d.h1(dt)}if(K>0)for(var ut=st._i.ay()+U.ay()+K+st._l.ay(),_t=this.a7(nt,ut),gt=this.a8(nt,ut,_t),ft=et+gt+_t*(st._i.ay()+this.a4(U)),vt=ot._b.c1();vt.i1();vt.i2()){var mt=vt.i8();this._d.u1(mt),mt.a2()===z?this.c2(mt)||this._d.gx(mt,new Gn(tt,ft)):this.d1(mt)||this._d.gy(mt,new Gn(tt,ft)),ft+=_t,this._d.h1(mt)}}if(V.ay()>0){V.a1(D);for(var pt=st._h.ay()+V.ay()+j+st._k.ay(),yt=this.a7(nt,pt),wt=this.a8(nt,pt,yt),At=et+wt+yt*st._h.ay(),xt=!0;!V.ar();){var Et=V.x4();if(this.a3(Et)){xt&&(xt=!1,At+=yt*j);var Tt=Et.ag(),Ct=this._d.gd(Tt),bt=Ct.at();if(Ct.ac(new Gn(bt.x,B.b())),this.c2(Tt)){var kt=this._a.i1(Tt);Ct.ac(new Gn(bt.x,kt.y+this._d.g6(z))),Ct.ac(new Gn(kt.x+this._d.g5(z),kt.y+this._d.g6(z)))}else Ct.ac(new Gn(bt.x,At)),Ct.ac(new Gn(tt+it,At));this._d.xr(Tt,z,Tt.a3()),this._d.m1(Tt,Ct)}else{var St=Et.ae(),It=this._d.gd(St),Lt=It.au();if(It.ae(new Gn(Lt.x,B.a())),this.d1(St)){var Pt=this._g.i1(St);It.ae(new Gn(Lt.x,Pt.y+this._d.g6(z))),It.ae(new Gn(Pt.x+this._d.g5(z),Pt.y+this._d.g6(z)))}else It.ae(new Gn(Lt.x,At)),It.ae(new Gn(tt+it,At));this._d.xr(St,St.a2(),z),this._d.m1(St,It)}this._d.x4(Et),At+=yt}}if(U.ay()>0){U.a1(M);for(var Rt=st._i.ay()+U.ay()+K+st._l.ay(),Dt=this.a7(nt,Rt),Mt=this.a8(nt,Rt,Dt),Ot=et+Mt+Dt*st._i.ay(),Bt=!0;!U.ar();){var Nt=U.x4();if(this.a3(Nt)){Bt&&(Bt=!1,Ot+=Dt*K);var zt=Nt.ag(),Ft=this._d.gd(zt),Vt=Ft.at();if(Ft.ac(new Gn(Vt.x,B.b())),this.c2(zt)){var Ut=this._a.i1(zt);Ft.ac(new Gn(Vt.x,Ut.y+this._d.g6(z))),Ft.ac(new Gn(Ut.x+this._d.g5(z),Ut.y+this._d.g6(z)))}else Ft.ac(new Gn(Vt.x,Ot)),Ft.ac(new Gn(tt,Ot));this._d.xr(zt,z,zt.a3()),this._d.m1(zt,Ft)}else{var Ht=Nt.ae(),Wt=this._d.gd(Ht),Yt=Wt.au();if(Wt.ae(new Gn(Yt.x,B.a())),this.d1(Ht)){var Zt=this._g.i1(Ht);Wt.ae(new Gn(Yt.x,Zt.y+this._d.g6(z))),Wt.ae(new Gn(Zt.x+this._d.g5(z),Zt.y+this._d.g6(z)))}else Wt.ae(new Gn(Yt.x,Ot)),Wt.ae(new Gn(tt,Ot));this._d.xr(Ht,Ht.a2(),z),this._d.m1(Ht,Wt)}this._d.x4(Nt),Ot+=Dt}}var Gt=st._g.ay()+st._d.ay()+$+W.ay()+H.ay()+J+q;it=this._d.gj(z);var Xt=this.a7(it,Gt),jt=this.a8(it,Gt,Xt);Gt=st._b.ay()+st._q.ay()+Q+Z.ay()+Y.ay();var Kt=this.a7(it,Gt),Jt=this.a8(it,Gt,Kt);if(W.ay()>0)for(var qt,Qt=Xt,$t=e,te=this._d.gi(z)+jt+Qt*(st._g.ay()+W.ay()-1),ee=this._d.gh(z),ie=B._c-B._g-W.ay()*$t;!W.ar();this._d.x4(qt)){qt=W.x4();var ne=qt.ag(),oe=this._d.gd(ne),se=oe.at();if(oe.ac(new Gn(se.x,B.b())),oe.ac(new Gn(se.x,ie)),this.c2(ne)){var ae=this._a.i1(ne);oe.ac(new Gn(ae.x+this._d.g5(z),ie)),oe.ac(new Gn(ae.x+this._d.g5(z),ae.y+this._d.g6(z)))}else oe.ac(new Gn(te,ie)),oe.ac(new Gn(te,ee)),te-=Qt;ie+=$t,this._d.xr(ne,z,ne.a3()),this._d.m1(ne,oe)}if(H.ay()>0)for(var re,he=Xt,le=e,ce=this._d.gi(z)+this._d.gj(z)-jt-he*st._d.ay(),de=this._d.gh(z),ue=B._c-B._g-le;!H.ar();this._d.x4(re)){re=H.x4();var _e=re.ag(),ge=this._d.gd(_e),fe=ge.at();if(ge.ac(new Gn(fe.x,B.b())),ge.ac(new Gn(fe.x,ue)),this.c2(_e)){var ve=this._a.i1(_e);ge.ac(new Gn(ve.x+this._d.g5(z),ue)),ge.ac(new Gn(ve.x+this._d.g5(z),ve.y+this._d.g6(z)))}else ge.ac(new Gn(ce,ue)),ge.ac(new Gn(ce,de)),ce-=he;ue-=le,this._d.xr(_e,z,_e.a3()),this._d.m1(_e,ge)}if(Z.ay()>0)for(var me,pe=Kt,ye=e,we=this._d.gi(z)+Jt+pe*(st._b.ay()+Z.ay()-1),Ae=this._d.gh(z)+this._d.g9(z),xe=Ae+Z.ay()*ye;!Z.ar();this._d.x4(me)){me=Z.x4();var Ee=me.ae(),Te=this._d.gd(Ee),Ce=Te.au();if(Te.ae(new Gn(Ce.x,B.a())),Te.ae(new Gn(Ce.x,xe)),this.d1(Ee)){var be=this._g.i1(Ee);Te.ae(new Gn(be.x+this._d.g5(z),xe)),Te.ae(new Gn(be.x+this._d.g5(z),be.y+this._d.g6(z)))}else Te.ae(new Gn(we,xe)),Te.ae(new Gn(we,Ae)),we-=pe;xe-=ye,this._d.xr(Ee,Ee.a2(),z),this._d.m1(Ee,Te)}if(Y.ay()>0)for(var ke,Se=Kt,Ie=e,Le=this._d.gi(z)+this._d.gj(z)-Jt-Kt*st._q.ay(),Pe=this._d.gh(z)+this._d.g9(z),Re=Pe+Ie;!Y.ar();this._d.x4(ke)){ke=Y.x4();var De=ke.ae(),Me=this._d.gd(De),Oe=Me.au();if(Me.ae(new Gn(Oe.x,B.a())),Me.ae(new Gn(Oe.x,Re)),this.d1(De)){var Be=this._g.i1(De);Me.ae(new Gn(Be.x+this._d.g5(z),Re)),Me.ae(new Gn(Be.x+this._d.g5(z),Be.y+this._d.g6(z)))}else Me.ae(new Gn(Le,Re)),Me.ae(new Gn(Le,Pe)),Le-=Se;Re+=Ie,this._d.xr(De,De.a2(),z),this._d.m1(De,Me)}for(;!X.ar();){var Ne=X.c3(),ze=this._d.gl(Ne);B.a()+12<ze.y&&this._d.g7(Ne).i4(ze.x,B.a())}for(;!G.ar();){var Fe=G.c3(),Ve=this._d.gs(Fe);if(B.b()-12>Ve.y){var Ue=this._d.gf(Fe);Ue.ac(new Gn(Ve.x,B.b())),this._d.s6(Fe,Ue)}}}}for(var He=0;He<t.length;He++)for(var We=t[He],Ye=We._b;null!=Ye;Ye=Ye.a()){var Ze=Ye.d(),Ge=this._t.a3(Ze);null!=Ge&&null!=Ge._a&&(this._d.x4(Ge._a),We.aw(Ye.b()))}return this._d.xi(this._f),this._d.xj(this._a),this._d.xj(this._g),t},c3:function(t){return this.a3(t)?this.b1(t.ag()):this.a2(t.ae())},b1:function(t){return null==this._h?Ss.s:this._h.i1(t)},a2:function(t){return null==this._l?Ss.u:this._l.i1(t)},c2:function(t){if(null==t)return!1;var e=this.b1(t);return null!=e&&e.a()},d1:function(t){if(null==t)return!1;var e=this.a2(t);return null!=e&&e.a()},a3:function(t){return 1===t.ao()},b2:function(t){return 1===t.ak()},a4:function(t){for(var e=0,i=t._b;null!=i;i=i.a())this.b2(i.d())&&e++;return e},d2:function(t){for(var e=this._k,i=Os.d(t.length+1),n=0;n<t.length;n++){var o=t[n],s=new Rs;i[n]=s,s._c=Number.MAX_VALUE,s._i=Number.MIN_VALUE;for(var a=o.x1();a.i1();a.i2()){var r=a.i9(),h=this._d.gb(r);s._c=Math.min(s._c,h.i2()),s._i=Math.max(s._i,h.i2()+h.i4())}}this._b.a5(t,i);for(var l=0;l<t.length;l++)for(var c=i[l],d=t[l].x1();d.i1();d.i2()){var u=d.i9(),_=this._f.i1(u);null!=_&&(c._h=Math.max(c._h,Math.max(_._f.ay()*e,_._c.ay()*e)),c._f=Math.max(c._f,Math.max(_._b.ay()*e,_._h.ay()*e)))}return i}}),Ss.s=ms.j(2),Ss.u=ms.j(1),Ss._z=new ks;var Is=function(){this._af=0,this._b=0};Oe.ext(Is,Object,{ib:function(t){this._af=t},ia:function(t,e,i){this.a6(t,e,i),this.b2(!1);var n=this.g();if(this.o()&&n>0){for(var o=this.r(),s=0;20>s&&n>0&&this.o();s++){this.b2(!0);var a=this.g();n>a&&(this.a7(o),n=a)}this.b3(o),this.b1()}return this.c()},a6:function(t,e,i){this._b=(new Date).getTime(),this._ac=t,this._ah=e;var n=this;this._p=function(t,e){var i=n._n[t.al()]-n._n[e.al()];return i>0?1:i>=0?0:-1},this._ad=Os.d(i);for(var o=0;o<this._ad.length;o++)this._ad[o]=new zo;this._ab=Os.a(this._ac.x0()),this._f=Os.d(this._ac.x0()),this._n=Os.a(this._ac.x0()+1);var s=this._ab;this._o=function(t,e){if(null==t&&null!=e)return 1;if(null!=t&&null==e)return-1;if(null==t&&null==e)return 0;var i=t,n=e,o=i._h,a=i.a2(),r=n.a2(),h=s[a.al()]-s[r.al()];if(0===h){var l=Is.b(ms.h(o,i),o.gn(i)),c=Is.b(ms.h(o,n),o.gn(n)),d=l-c;if(0===d){var u=s[i.a3().al()]-s[n.a3().al()];if(0===u){var _=Is.a(ms.i(o,i),o.gk(i)),g=Is.a(ms.i(o,n),o.gk(n));return _-g}return u}return d}return h},this._l=function(t,e){if(null==t&&null!=e)return 1;if(null!=t&&null==e)return-1;if(null==t&&null==e)return 0;var i=t,n=e,o=i._h,a=i.a3(),r=n.a3(),h=s[a.al()]-s[r.al()];if(0===h){var l=Is.a(ms.i(o,i),o.gk(i)),c=Is.a(ms.i(o,n),o.gk(n)),d=l-c;if(0===d){var u=s[i.a2().al()]-s[n.a2().al()];if(0===u){var _=Is.b(ms.h(o,i),o.gn(i)),g=Is.b(ms.h(o,n),o.gn(n));return _-g}return u}return d}return h},this._z=function(t,e){if(null==t&&null!=e)return 1;if(null!=t&&null==e)return-1;if(null==t&&null==e)return 0;var i=t,n=e,o=i._h,s=Is.b(ms.h(o,i),o.gn(i)),a=Is.b(ms.h(o,n),o.gn(n));return s-a},this._e=function(t,e){if(null==t&&null!=e)return 1;if(null!=t&&null==e)return-1;if(null==t&&null==e)return 0;var i=t,n=e,o=i._h,s=Is.a(ms.i(o,i),o.gk(i)),a=Is.a(ms.i(o,n),o.gk(n));return s-a},this._ac.x2(this._e,this._z)},c:function(){this._ah=null,this._aa=null,this._f=null,this._n=null,this._p=null,this._o=null,this._l=null,this._ac=null;var t=this._ad;return this._ad=null,t},o:function(){var t=(new Date).getTime()-this._b;return t<=this._af},m:function(){for(var t=this,e=function(e,i){return Math.ceil(t._n[e.a3().al()])-Math.ceil(t._n[i.a3().al()])},i=this._ac.x9();i.i1();i.i2()){for(var n=i.i9().aw();n.i1();n.i2())this._n[n.i9().al()]=hs.j();i.i9().av(e)}},b2:function(t){for(var e=0;e<this._ad.length;e++)this._ad[e].af();if(t){this.m();for(var i=0,n=this._ab.length;n>i;i++)this._ab[i]=0;this._ac.x2(null,this._z)}var o=this._ac.xm();this._ah.i7(o,0);for(var s=this._ac.x9();s.i1();s.i2())0===s.i9().ak()&&s.i9()!==o&&this._ac.xo(o,s.i9());var a=new ao(this);a.a6(!0),a.a9(this._ac,o),this._ad[0].at(),this._ac.x4(o),this.d()},a1:function(){this._ac.x2(this._o,this._l);for(var t=0,e=1;e<this._ad.length;e++){var i=this.a2(this._ad[e-1],this._ad[e]);t+=i}var n=0;return t+=n},a2:function(t,e){var i=t.ah(),n=e.ah(),o=new yo,s=new yo;this._aa=Os.d(this._ac.x0());for(var a=0;i.i1()&&n.i1();n.i2())a+=this.a8(i.i6(),o,s,!0),a+=this.a8(n.i6(),s,o,!1),i.i2();for(;i.i1();i.i2())a+=this.a8(i.i6(),o,s,!0);for(;n.i1();n.i2())a+=this.a8(n.i6(),s,o,!1);return a},a8:function(t,e,i,n){var o=0,s=0,a=0;if(null!=this._aa[t.al()])for(var r=this._aa[t.al()].a(),h=e._b;h!==r;h=h.a()){var l=h._c;l===t?(o++,a+=s,e.aw(h)):s++}var c=o*i.ay()+a;if(n)for(var d=t.ag();null!=d;d=d.a8()){var u=d.a3();this._ab[u.al()]>=this._ab[t.al()]&&(this._aa[u.al()]=i.ae(u))}else for(var _=t.ae();null!=_;_=_.a7()){var g=_.a2();this._ab[g.al()]>this._ab[t.al()]&&(this._aa[g.al()]=i.ae(g))}return c},g:function(){for(var t=this.r(),e=this.a1(),i=!0,n=0;3>n&&this.o()&&e>0;){var o=this.k();e>o?(this.a7(t),e=o):n++,i=!i}if(this.b3(t),this.b1(),e>0){for(var s=1,a=0;1===s&&e>0;a++){this.e(),this.i();var r=this.a1();e>r?(s=1,this.a7(t)):s=-1,e=r}this.b3(t),this.b1()}return e},e:function(){for(var t=this.l(),e=this.r(),i=Os.d(this._ac.x0()),n=this._ad.length-1;n>=0;n--)for(var o=this._ad[n].ah();o.i1();o.i2()){var s=o.i6();if(1===s.ak()&&1===s.ao()){var a=t.i1(s.ag());if(null!=a&&null==i[a.al()])for(var r=this.a4(s,a),h=a.al(),l=i[h]=Os.d(r+1),c=l.length-1;c>=0;c--)l[c]=new yo}}for(var d=0;d<this._ad.length;d++)for(var u=this._ad[d].ah();u.i1();u.i2()){var _=u.i6();if(1===_.ak()&&1===_.ao()){var g=t.i1(_.ag());if(null!=g){var f=g.al(),v=this.a4(_,g)-1;i[f][v].ae(_.ae())}}else for(var m=_.ae();null!=m;m=m.a7()){var p=t.i1(m);if(null!=p){var y=p.al(),w=this.a4(_,p)-1;i[y][w].ae(m)}}}for(var A=this._ac.x9();A.i1();A.i2()){var x=A.i9();if(null!=i[x.al()])for(var E=x.ag();null!=E;E=E.a8()){var T=t.i1(E);if(null!=T)for(var C=i[T.al()];C[0].ay()>0;){for(var b,k=0;;){b=C[k].am();var S=b.a3();if(1!==S.ak()||1!==S.ao())break;k++}var I=C[k].at().a3();k--,I=b.a2(),b=C[k].at();for(var L=b.a3();k>=0;)if(e[I.al()]!==e[L.al()]&&(this._ab[I.al()]=e[L.al()]),I=I.ae().a2(),--k>=0){var P=C[k].at();L=P.a3()}}}}this.b1(),this._ac.xj(t)},i:function(){for(var t=this.f(),e=this.r(),i=Os.d(this._ac.x0()),n=0;n<this._ad.length;n++)for(var o=this._ad[n].ah();o.i1();o.i2()){var s=o.i6();if(1===s.ak()&&1===s.ao()){var a=t.i1(s.ae());if(null!=a&&null==i[a.al()])for(var r=this.a4(a,s),h=a.al(),l=i[h]=Os.d(r+1),c=l.length-1;c>=0;c--)l[c]=new yo}}for(var d=this._ad.length-1;d>=0;d--)for(var u=this._ad[d].ah();u.i1();u.i2()){var _=u.i6();if(1===_.ak()&&1===_.ao()){var g=t.i1(_.ae());if(null!=g){var f=g.al(),v=this.a4(g,_)-1;i[f][v].ae(_.ag())}}else for(var m=_.ag();null!=m;m=m.a8()){var p=t.i1(m);if(null!=p){var y=p.al(),w=this.a4(p,_)-1;i[y][w].ae(m)}}}for(var A=this._ac.x9();A.i1();A.i2()){var x=A.i9();if(null!=i[x.al()])for(var E=x.ae();null!=E;E=E.a7()){var T=t.i1(E);if(null!=T)for(var C=i[T.al()];C[0].ay()>0;){for(var b,k=0;;){b=C[k].am();var S=b.a2();if(1!==S.ak()||1!==S.ao())break;k++}var I=C[k].at().a2();k--,I=b.a3(),b=C[k].at();for(var L=b.a2();k>=0;)if(e[I.al()]!==e[L.al()]&&(this._ab[I.al()]=e[L.al()]),I=I.ag().a3(),--k>=0){var P=C[k].at();L=P.a2()}}}}this.b1(),this._ac.xj(t)},a4:function(t,e){return this._ah.i2(t)-this._ah.i2(e)},l:function(){for(var t=Ho.a6(Os.d(this._ac.xg())),e=this._ac.x9();e.i1();e.i2()){var i=e.i9();if(i.ao()>1){for(var n=0,o=i.ag();null!=o;o=o.a8()){var s=o.a3();1===s.ak()&&1===s.ao()&&n++}if(n>1)for(var a=i.ag();null!=a;a=a.a8()){var r=a,h=r.a3();if(1===h.ak()&&1===h.ao()){for(;1===h.ak()&&1===h.ao();h=r.a3())t.i8(r,i),r=h.ag();t.i8(r,i)}}}}return t},f:function(){for(var t=Ho.a6(Os.d(this._ac.xg())),e=this._ac.x9();e.i1();e.i2()){var i=e.i9();if(i.ak()>1){for(var n=0,o=i.ae();null!=o;o=o.a7()){var s=o.a2();1===s.ak()&&1===s.ao()&&n++}if(n>1)for(var a=i.ae();null!=a;a=a.a7()){var r=a,h=r.a2();if(1===h.ak()&&1===h.ao()){for(;1===h.ak()&&1===h.ao();h=r.a2())t.i8(r,i),r=h.ae();t.i8(r,i)}}}}return t},k:function(){for(var t=1;t<this._ad.length;t++){for(var e=this._ad[t],i=e.ah();i.i1();i.i2()){var n=i.i6();this._n[n.al()]=this.a5(n,e.ay(),n.am(),this._ad[t-1].ay()),this._n[n.al()]+=this._ab[n.al()]/(3*this._ad[t-1].ay())}this.a3(e,this._p)}return this.a1()},a5:function(t,e,i,n){var o=0;if(0===i.i7())o=n*this._ab[t.al()]/e;else{for(;i.i1();i.i2()){var s=i.i8();o+=s.a2()===t?this._ab[s.a3().al()]:this._ab[s.a2().al()]}o/=i.i7()}return o},a7:function(t){Os.f(this._ab,t,t.length)},b3:function(t){Os.f(t,this._ab,t.length)},r:function(){var t=Os.a(this._ab.length);return this.a7(t),t},d:function(){for(var t=0;t<this._ad.length;t++)for(var e=0,i=this._ad[t].ah();i.i1();)this._ab[i.i6().al()]=e,i.i2(),e++},b1:function(){for(var t=0;t<this._ad.length;t++){for(var e=this._ad[t],i=e._b;null!=i;i=i.a()){var n=i.d();this._f[this._ab[n.al()]]=n}for(var o=0,s=e._b;null!=s;)s.c(this._f[o]),s=s.a(),o++}},a3:function(t,e){for(var i=t.ah(),n=0;n<t.ay();i.i2())this._f[n]=i.i6(),n++;Os.s(this._f,t.ay(),e);for(var o=0,s=t._b;null!=s;)s.c(this._f[o]),this._ab[this._f[o].al()]=o,s=s.a(),o++}}),Is.b=function(t,e){if(null==t)return 0;var i=t.a()?Math.floor(e.x):0,n=t.a()?Math.floor(e.y):0;return t.e()?1e4-n:t.f()?-1e4+n:t.c()?-2e4-i:i},Is.a=function(t,e){if(null==t)return 0;var i=t.a()?Math.floor(e.x):0,n=t.a()?Math.floor(e.y):0;return t.e()?1e4+n:t.f()?-1e4-n:t.d()?-2e4-i:i};var Ls=function(){Ls.superClass.constructor.call(this),this._i6=0,this._i3=2147483647,this._i0=60,this._iz=20,this._i2=20,this._i4=20,this.i5(!1),this._i7=new xs,this._i1=new Is,this._i8=new Cs};Oe.ext(Ls,Zo,{j2:function(){return this._i2},i4:function(t){return!0},i3:function(t){this._i6=(new Date).getTime(),vs.d(t,!1);var e=t.xk(),i=t.xk(),n=t.xl(),o=new wo,s=new Ss(t,e,i,n);s.a6(this.j2()),this._i8.i3(this._iz),this._i8.i6(this._i0),this._i8.i4(this._i2),this._i8.i5(this._i4),this._i8.i2(i);for(var a=this._i7.i1(t,e,o),r=o.c1();r.i1();r.i2()){var h=r.i8();n.i7(h,!0);var l=t.gn(h);t.gt(h,t.gk(h)),t.gz(h,l)}this.a2(t,e,i),a=s.a9(a);var c=this.j1(t,e,a);c=s.a5(c),c=s.b3(c),this._i8.i1(t,c,e),c=s.g2(c),s.e2(c),this.b(t,i),this.w(t),this.a1(t,o),s.e1(),t.xj(n),t.xi(i),t.xi(e)},j1:function(t,e,i){if(this._i1 instanceof Is){var n=this._i1,o=(new Date).getTime()-this._i6;n.ib(this._i3-o)}var s=this._i1.ia(t,e,i);return s},a1:function(t,e){for(var i=e.c1();i.i1();i.i2()){var n=i.i8(),o=t.gs(n),s=t.gl(n);t.x3(n);var a=t.gp(n);t.s5(n,a.a()),t.gy(n,o),t.gx(n,s)}},b:function(t,e){for(var i=t.x9();i.i1();i.i2()){var n=i.i9(),o=e.i1(n);if(null!=o&&!t.xp(o)){for(var s=n.am().i8().a2();null!=e.i1(s);s=n.am().i8().a2())n=s;t.u1(o);for(var a=n.ae(),r=new yo;null!=e.i1(a.a3());a=a.a3().ag()){var h=t.gs(a);r.aa(h),r.az(t.gf(a));var l=t.gl(a);l.equals(h)||r.aa(l)}var c=t.gs(a);r.aa(c),r.az(t.gf(a));var d=t.gl(a);d.equals(c)||r.aa(d),t.m1(o,r)}}for(var u=t.x9();u.i1();u.i2())null!=e.i1(u.i9())&&t.x4(u.i9())},w:function(t){for(var e=t.xf();e.i1();e.i2()){var i=e.i8(),n=t.g2(i);if(n.i1()>0){var o=new fn,s=t.gc(i),a=s.c(),r=a.i6();a.i2();var h=r.x,l=r.y;if(a.i1()){var c=a.i6(),d=c.x,u=c.y;for(a.i2();a.i1();a.i2()){var _=a.i6(),g=_.x,f=_.y,v=(h-g)*(u-f)/(l-f)+g;Math.abs(v-d)>=1&&(o.add(c),h=d,l=u),c=_,d=g,u=f}}o.size()<n.i1()&&t.s5(i,new qn(o))}}},a2:function(t,e,i){var n=t.g8().c1();for(n.i5();n.i1();n.i3()){var o=n.i8().a2(),s=n.i8().a3(),a=e.i2(s)-e.i2(o);if(a>1){for(var r=null,h=null,l=o;a>1;a--)r=t.xm(),t.s7(r,1,1),t.s4(r,hs._A),h=t.xo(l,r),l===o&&t.gt(h,t.gn(n.i8())),e.i7(r,e.i2(l)+1),i.z1(r,n.i8()),l=r;h=t.xo(r,s),t.gz(h,t.gk(n.i8())),t.h1(n.i8())}}}});var Ps=function(t,e,i,n){this._i=20,this._j=t,this._g=e,this._a=i,this._h=n};Oe.ext(Ps,Object,{a1:function(t){this._i=t},b2:function(t){return null==this._e?!1:this._e.i4(t)},a3:function(t){return null==this._f?null:this._f.i1(t)},d:function(){this._j.xi(this._f),this._j.xi(this._e)}});var Rs=function(){this._c=0,this._i=0,this._g=0,this._j=0,this._f=0,this._h=0,this._d=0,this._e=0,this._a=0,this._b=0};Oe.ext(Rs,Object,{a:function(){return this._c-this._g-this._f-this._a},b:function(){return this._i+this._j+this._h+this._b}});var Ds=function(){this._d=new wo,this._b=new wo,this._c=new wo,this._e=new wo};Oe.ext(Ds,Object,{});var Ms=function(t,e,i,n,o,s,a,r){this._d=t,this._a=e,this._b=i,this._h=n,this._f=o,this._c=s,this._e=a,this._g=r};Oe.ext(Ms,Object,{});var Os={};Os.a=function(t,e){for(var i=[],n=0;t>n;n++)i[n]=e||0;return i},Os.b=function(t){for(var e=[],i=0;t>i;i++)e[i]=!1;return e},Os.c=function(t,e){if(t instanceof Gn)return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y<=e.y?0:1;if(t instanceof Xn)return e.width>t.width?-1:e.width<t.width?1:e.height>t.height?-1:e.height>=t.height?0:1;if(t instanceof Kn)return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:e.width>t.width?-1:e.width<t.width?1:e.height>t.height?-1:e.height>=t.height?0:1;throw"Unkown Type: "+t},Os.d=function(t){for(var e=[],i=0;t>i;i++)e[i]=null;return e},Os.e=function(t,e){for(var i=[],n=0;t>n;n++)i[n]=Os.a(e);return i},Os.f=function(t,e,i){for(var n=0;i>n;n++)e[n]=t[n]},Os.s=function(t,e,i){var n=[];Os.f(t,n,e),n.sort(i),Os.f(n,t,e)},Os.n=function(t,e){return t-e};var Bs=t.make={},Ns={},zs={},Fs=[],Vs={};Bs.Default={path:"./",resPath:"",getImagePath:function(t){return this.path+this.resPath+"res/images/"+(t||"")},register:function(t,e,i){i=i||{},i.name=i.name||t,i.modelDefaultParameters=i.modelDefaultParameters||{},i.description=i.description||i.name,Ns[t]&&console.log(t," already exist"),Ns[t]=e;var n=i.category||"",o=zs[n]||{};o[t]=e,zs[n]=o,Vs[t]=i,-1==Fs.indexOf(n)&&Fs.push(n),this.checkModelDefaultParameters(i.modelDefaultParameters)},checkModelDefaultParameters:function(t){if(t)for(var i in t){var n=t[i];n instanceof Object||(n={value:n},t[i]=n),n.propertyName=i,n.hidden=!!n.hidden,n.propertyType=n.propertyType||Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,n.type=n.type||Bs.Default.PARAMETER_TYPE_STRING,n.category=n.category||Bs.Default.PARAMETER_CATEGORY_DETAIL,n.editable=n.editable===e?!0:!!n.editable,n.index=n.index===e?100:parseInt(n.index)}},remove:function(t){if(Ns[t]){Ns[t]=e,delete Ns[t];var i=Bs.Default.getCategory(t),n=zs[i];delete n[t];var o=0;for(var s in n)s&&o++;if(0==o)for(var s=0;s<Fs.length;s++){var a=Fs.indexOf(i);a>=0&&Fs.splice(a,1)}delete Vs[t]}else console.log(t," not exist")},getCategories:function(){return Fs},getCreatorsForCategory:function(t){return zs[t]},getCreator:function(t){return Ns[t]},getIds:function(t){var e=[];for(var i in Ns)(!t||t&&t(this.getParameters(i)))&&e.push(i);return e},getModelDefaultParameters:function(t){var e=this.getParameters(t);return e.modelDefaultParameters},getDescription:function(t){var e=this.getParameters(t);return e.description},getName:function(t){var e=this.getParameters(t);return e.name},getIcon:function(t){var e=this.getParameters(t);return this.path+e.icon},isAsync:function(t){var e=this.getParameters(t);return e.async},isCombo:function(t){var e=this.getParameters(t);return e.combo},getCategory:function(t){var e=this.getParameters(t);return e.category},getOrder:function(t){var e=this.getParameters(t);return e.order||0},getType:function(t){var e=this.getParameters(t);return e.type},getOtherParameter:function(t,e){var i=this.getParameters(t);return i[e]},registerIcon:function(t,e){var i=this.getParameters(t);if(i)return i.icon=e,i.icon},registerDescription:function(t,e){var i=this.getParameters(t);return i.description=e,i.description},registerName:function(t,e){var i=this.getParameters(t);return i.name=e,i.name},registerOther:function(t,e,i){var n=o[e],o=this.getParameters(t);return o[e]=i,"modelDefaultParameters"===e&&(console.warn("rewrite modelDefaultParameters: id={0}, oldValue={}, newValue={}",t,n,i),this.checkModelDefaultParameters(i)),n},appendModelDefaultParameter:function(t,e,i,n,o,s,a){},getParameters:function(t){return Vs[t]||{}},load:function(t,e,i){var n,i=i||{},o=i.isRelation;if(e){var s=e;e=function(e){o&&t instanceof Array&&t.length>1&&e instanceof Array&&e.length>1&&this._relation(t,e),s(e)}}if(t instanceof Array){var a={};if(e){var r=function(i,n){var o=t.length;return function(t){i.datas=i.datas||[],i.datas.push(t),i._total===o&&e(i.datas)}(n)};a._total=0;for(var h=0;h<t.length;h++){var l=t[h];this.load(l,function(t){a._total++,r(a,t)})}return null}n=[];for(var h=0;h<t.length;h++){var l=t[h],c=this.load(l);c&&n.push(c)}}else{var d={};"string"==typeof t?d.id=t:d=t,d=this.filterJson(d),e?this._load(d,e):n=this._load(d)}return o&&n instanceof Array&&n.length>1&&this._relation(t,n),n},_relation:function(t,e){var i={};e.forEach(function(t){t.getId&&(i[t.getId()]=t)}),t.forEach(function(t){t.objectId&&t.parentId&&i[t.objectId]&&i[t.parentId]&&i[t.objectId].setParent&&i[t.objectId].setParent(i[t.parentId])})},_load:function(t,e){var i=t.id,n=this.getCreator(i);if(!n)return console.log("unknown id: ",i),null;if(!e){var o=n(t);return Bs.Default._setObjectClientId(o,i),o}n(t,function(t){Bs.Default._setObjectClientId(t,i),e&&e(t)})},_setObjectClientId:function(t,e){t&&t.setClient&&t.setClient("id",e)},copyArray:function(t,e,i){if(e=[],t)for(var n,o=0,s=t.length;s>o;o++)n={},this.copyProperties(t[o],n),e.push(n);return e},copyProperties:function(t,i,n){if(t&&i)for(var o in t)n&&n.indexOf(o)>=0||0==o.indexOf("_")||(i[o]===e&&(i[o]=t[o]instanceof Array?[]:t[o]instanceof Function?t[o]:t[o]instanceof Object?{}:t[o]),!(t[o]instanceof Function)&&t[o]instanceof Object&&i[o]instanceof Object&&Bs.Default.copyProperties(t[o],i[o]))},getModelDefaultParametersValues:function(t,e){var i=this.getModelDefaultParameters(t),n={};for(var o in i){var s=i[o];e&&e(s)||(s.propertyType==Bs.Default.PARAMETER_PROPERTY_TYPE_CLIENT?(n.client=n.client||{},n.client[o]=s.value):s.propertyType==Bs.Default.PARAMETER_PROPERTY_TYPE_STYLE?(n.style=n.style||{},n.style[o]=s.value):n[o]=s.value)}return n},getModelDefaultParameterProperties:function(t){var e=this,i=[],n=this.getModelDefaultParameters(t);if(!n)return i;n.id||(n.id={propertyName:"id",name:"模型ID",category:Bs.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:Bs.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-2}),n.objectId||(n.objectId={propertyName:"objectId",name:"实例ID",category:Bs.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:Bs.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-1});for(var o in n)i.push(n[o]);return i.sort(function(t,e){return t.index-e.index}),i=i.map(function(t){return e.modelParameterToProperty(t)})},_getNameFromPropertyName:function(t){for(var e=t.split("."),i="",n=0;n<e.length;n++)e[n].length>0&&(i+=e[n].substring(0,1).toUpperCase()+e[n].substring(1,e[n].length)),n<e.length-1&&(i+=" ");return i},modelParameterToProperty:function(t){var e=new Me.Property;return e.setCategoryName(t.category),t.name||(t.name=this._getNameFromPropertyName(t.propertyName)),e.setName(t.name),e.setEditable(t.editable),e.setPropertyType(t.propertyType),e.setPropertyName(t.propertyName),e.setValueType(t.type),e.setEnumInfo(t.enumInfo),e.isVisible=function(){return!t.hidden},e},filterJson:function(t){var i=this.getModelDefaultParameters(t.id);for(var n in i){var o=i[n].propertyType||"client",s=i[n].value;o==Bs.Default.PARAMETER_PROPERTY_TYPE_STYLE?t.style&&t.style[n]!==e||(t.style=t.style||{},t.style[n]=s):o==Bs.Default.PARAMETER_PROPERTY_TYPE_CLIENT?t.client&&t.client[n]!==e||(t.client=t.client||{},t.client[n]=s):t[n]===e&&(t[n]=s)}return t},UNIT_HEIGHT:4.445,EQUIPMENT_WIDTH:45.5,RACK_OFFSET_X:7.25,RACK_OFFSET_Y:6.655,RACK_WIDTH:60,getUnitHeight:function(){return this.UNIT_HEIGHT},getEquipmentWidth:function(){return this.EQUIPMENT_WIDTH},getEquipmentHeight:function(t){return parseInt(t)>0||console.error("method getEquipmentHeight's first argument scale value is zero"),this.UNIT_HEIGHT*t},getRackWidth:function(){return this.RACK_WIDTH},getRackHeight:function(t){return parseInt(t)>0||console.error("method getRackHeight's first argument scale value is zero"),this.RACK_OFFSET_Y+this.UNIT_HEIGHT*parseInt(t)+this.RACK_OFFSET_Y}},Bs.Default.toJson=function(t,e){if(t&&t.getClient){var i=t.getClient("id"),n=Bs.Default.getModelDefaultParameters(i),o={},s=null,a=null;for(var r in n)if(n[r].exportable!==!1){var h=n[r].propertyType,a=n[r].value;h==Bs.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR?(s=t[Oe.getter(r)](),Bs.Default.equals(s,a)||(o[r]=s)):h==Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD?(s=t[r],Bs.Default.equals(s,a)||(o[r]=s)):h==Bs.Default.PARAMETER_PROPERTY_TYPE_STYLE?(s=t.getStyle(r),Bs.Default.equals(s,a)||(o.style=o.style||{},o.style[r]=s)):h==Bs.Default.PARAMETER_PROPERTY_TYPE_CLIENT&&(s=t.getClient(r),Bs.Default.equals(s,a)||(o.client=o.client||{},o.client[r]=s))}return o.id=i,Bs.Default.EXPORT_OBJECT_ID&&(o.objectId=t.getId()),e&&(o=e(o)),o}return e&&(t=e(t)),t},Bs.Default.copy=function(t,e,i,n,o){var s=function(t,e,i,n,o){o=o||{};var s={},a={},r=Bs.Default.getParameters(e);Bs.Default.copyProperties(r,a),n instanceof Function?s=n(a)||{}:Bs.Default.copyProperties(n,s),o.copyDefaultParamCoverage&&delete a.modelDefaultParameters,o.copyParamCoverage||Bs.Default.copyProperties(a,s),Bs.Default.register(t,function(t,n){var o={id:e};i instanceof Function?i(t):Bs.Default.copyProperties(i,o),Bs.Default.copyProperties(t,o);var s=Bs.Default.load(o,n);return s},s)};s(t,e,i,n,o)},Bs.Default.PARAMETER_CATEGORY_BASIC="BASIC",Bs.Default.PARAMETER_CATEGORY_DETAIL="Detail",Bs.Default.PARAMETER_TYPE_STRING="string",Bs.Default.PARAMETER_TYPE_BOOLEAN="boolean",Bs.Default.PARAMETER_TYPE_COLOR="color",Bs.Default.PARAMETER_TYPE_INT="int",Bs.Default.PARAMETER_TYPE_NUMBER="number",Bs.Default.PARAMETER_TYPE_IMAGE="image",Bs.Default.PARAMETER_TYPE_ARRAY_STRING="array.string",Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER="array.number",Bs.Default.PARAMETER_TYPE_ARRAY_INT="array.int",Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD="field",Bs.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR="accessor",Bs.Default.PARAMETER_PROPERTY_TYPE_STYLE="style",Bs.Default.PARAMETER_PROPERTY_TYPE_CLIENT="client",String.prototype.replaceAll=function(t,e,i){return RegExp.prototype.isPrototypeOf(t)?this.replace(t,e):this.replace(new RegExp(t,i?"gi":"g"),e)},String.prototype.formatTT=function(t){var e=this;if(arguments.length>1){for(var i=[],n=0;n<arguments.length;n++)i.push(arguments[n]);t=i}if(t){if(t instanceof Array)t.forEach(function(t,i){t instanceof Object&&(t=JSON.stringify(t)),e=e.replaceAll("{"+i+"}",t)});else{if(!(t instanceof Object))return e.replaceAll("{}",t);for(var o in t){var s=t[o];s instanceof Object&&(s=JSON.stringify(s)),e=e.replaceAll("{"+o+"}",s)}}}return e},Bs.Default.getId=function(t){return t.getClient("id")},Bs.Default.objectWrapper=function(t,e,i,n){t.__defineGetter__(e,function(){var n=t["___"+e];return i&&(n=i.call(t,n,t,e)),n}),t.__defineSetter__(e,function(i){var o=t[e];n&&(i=n.call(t,i,t,e)),o!==i&&(t["___"+e]=i,this.firePropertyChange&&this.firePropertyChange(e,o,i))})},Bs.Default.equals=function(t,e){return t instanceof Object&&e instanceof Object?JSON.stringify(t)==JSON.stringify(e):t==e},Bs.Default.EXPORT_OBJECT_ID=!0,Bs.Utils2D={create2dShapeNode:function(t){var e=t.position||[0,0,0],i=t.data,n=t.image,o=(t.objType,t.objectId),s=t.closed,a=new Bs.Default.WallShapeNode(o);"innerWall"==t.objType?a=new Bs.Default.InnerWallShapeNode(o):"floor"==t.objType?a=new Bs.Default.FloorShapeNode(o):"cable"==t.objType&&(a=new Bs.Default.LineWidthShapeNode(o));var r=Bs.Default.create2dShapePath(i,e);return Bs.Default.objectWrapper(a,"id",function(){return this.getClient("id")}),Bs.Default.objectWrapper(a,"objectId",function(){return this.getId()}),a.setSegments(r.segments),a.setPoints(r.points),s&&a.setClient("closed",!0),n&&a.setClient("imageSrc",n),Bs.Default.setObject2dCSProps(a,t),a},create2dShapePath:function(t,e){var i=new Me.List,n=new Me.List;if(t.length>0)if(i.add("moveto"),t[0]instanceof Array){n.add({x:parseFloat(t[0][0])+parseFloat(e[0]),y:parseFloat(t[0][1])+parseFloat(e[2])});for(var o=1;o<t.length;o++){var s=t[o];"c"==s[0]?(i.add("quadto"),n.add({x:parseFloat(s[1])+parseFloat(e[0]),y:parseFloat(s[2])+parseFloat(e[2])}),n.add({x:parseFloat(s[3])+parseFloat(e[0]),y:parseFloat(s[4])+parseFloat(e[2])})):(i.add("lineto"),n.add({x:parseFloat(s[0])+parseFloat(e[0]),y:parseFloat(s[1])+parseFloat(e[2])}))}}else{n.add({x:parseFloat(t[0])+parseFloat(e[0]),y:parseFloat(t[1])+parseFloat(e[2])});for(var o=2;o<t.length;o+=2)i.add("lineto"),n.add({x:parseFloat(t[o])+parseFloat(e[0]),y:parseFloat(t[o+1])+parseFloat(e[2])})}return{segments:i,points:n}},setObject2dCSProps:function(t,e){var i=e.style,n=e.client;if(i)for(var o in i)t.setStyle(o,i[o]);if(n)for(var o in n)t.setClient(o,n[o])},createBlockObject:function(t,e){var i=t.objectId,n=new Bs.Default.Block(i);"door"==e?n=new Bs.Default.Door(i):"window"==e&&(n=new Bs.Default.Window(i)),t.width&&n.setClient("length",t.width);var o=t.client||{};return n.setClient("edgeIndex",o.edgeIndex||1),n.setClient("offset",o.offset||0),Bs.Default.setObject2dCSProps(n,t),n},createNode:function(t){var e=t.position||[0,0,0],i=t.rotation||[0,0,0],n=t.width||50,o=t.depth||50,s=t.image,a=t.objectId,r=new Me.Follower(a),h=t.color||"#CCCCFF";return Bs.Default.objectWrapper(r,"id",function(){return this.getClient("id")}),Bs.Default.objectWrapper(r,"objectId",function(){return this.getId()}),r.setSize(parseFloat(n),parseFloat(o)),r.setCenterLocation({x:parseFloat(e[0]),y:parseFloat(e[2])}),r.setAngle(i[1]),r.setClient("positionY",e[1]),"string"==typeof s?r.setImageUrl(s):"object"==typeof s?r.setImage(s):(r.setStyle("body.type","vector"),r.setStyle("vector.shape","rectangle"),r.setStyle("vector.fill.color",h)),r.setStyle("select.style","border"),r.setStyle("select.color","#F07819"),r.setStyle("select.width",.7),r.setStyle("vector.outline.width",1),r.setStyle("vector.outline.color","#BEC9BE"),r.setStyle("label.position","center"),Bs.Default.setObject2dCSProps(r,t),r},createFollower:function(t){var e=t,t={};Bs.Default.copyProperties(e,t),t.id=t.objectId||Oe.id(),t.scale=t.scale||1,t.depth=t.depth||5,t.position=t.position||[0,0,0],t.rotation=t.rotation||[0,0,0];var i=new Me.Follower(t);return Bs.Default.objectWrapper(i,"id",function(){return i.getClient("id")}),Bs.Default.objectWrapper(i,"objectId",function(){return i.getId()}),Bs.Default.objectWrapper(i,"depth"),Bs.Default.objectWrapper(i,"position",null,function(t){return this.setLocation({x:t[0],y:t[1]}),t}),Bs.Default.objectWrapper(i,"rotation",null,function(t){return this.setAngle(t[2]),t}),Bs.Default.objectWrapper(i,"scale",null,function(t){var e=this.getSize();e.width=e.width*t,e.height=e.height*t,this.setSize(e);var n=this.getLocation();return n.x=n.x*t,n.y=n.y*t,i.setLocation(n),t}),i.depth=t.depth,i.position=t.position,i.rotation=t.rotation,i.scale=t.scale,i.addPropertyChangeListener(function(t){var e=t.property,i=t.source;"location"==e?(i.position[0]=t.newValue.x,i.position[1]=t.newValue.y):"angle"==e&&(i.rotation[2]=t.newValue)},i),t.x&&i.setX(t.x),t.y&&i.setY(t.y),i.z=t.z,t.location&&i.setLocation(t.location instanceof Array?{x:t.location[0],y:t.location[1]}:t.location),t.centerLocation&&i.setCenterLocation(t.centerLocation instanceof Array?{x:t.centerLocation[0],y:t.centerLocation[1]}:t.centerLocation),t.size&&i.setSize(t.size),t.angle&&i.setAngle(t.angle),i.setStyle("select.style","border"),i.setStyle("select.color","#F07819"),i.setStyle("select.width",.7),i.setStyle("vector.outline.color","#BEC9BE"),Bs.Default.setObject2dCSProps(i,t),i},align:function(t,e){if(e&&t&&!(t.size()<2)){var i=this["_align_"+e];i&&i.call(this,t)}},_align_up:function(t){for(var e=t.get(0).getLocation().y,i=1;i<t.size();i++)e=Math.min(e,t.get(i).getLocation().y);t.forEach(function(t){t.setY(e)})},_align_down:function(t){for(var e=t.get(0).getLocation().y+t.get(0).getSize().height,i=1;i<t.size();i++)e=Math.max(e,t.get(i).getLocation().y+t.get(i).getSize().height);t.forEach(function(t){t.setY(e-t.getSize().height)})},_align_left:function(t){for(var e=t.get(0).getLocation().x,i=1;i<t.size();i++)e=Math.min(e,t.get(i).getLocation().x);t.forEach(function(t){t.setX(e)})},_align_right:function(t){for(var e=t.get(0).getLocation().x+t.get(0).getSize().width,i=1;i<t.size();i++)e=Math.max(e,t.get(i).getLocation().x+t.get(i).getSize().width);t.forEach(function(t){t.setX(e-t.getSize().width)})},_align_center:function(t){for(var e=0,i=0;i<t.size();i++)e+=t.get(i).getCenterLocation().y;var n=e/t.size();t.forEach(function(t){t.setY(n-t.getSize().height/2)})},_align_middle:function(t){for(var e=0,i=0;i<t.size();i++)e+=t.get(i).getCenterLocation().x;var n=e/t.size();t.forEach(function(t){t.setX(n-t.getSize().width/2)})},flow:function(t,e,i){if(e&&t&&!(t.size()<2)){var n=this["_flow_"+e];n&&n.call(this,t,i)}},_flow_hor:function(t,e){this.sort(t,function(t,e){return t.getLocation().y-e.getLocation().y}),this.sort(t,function(t,e){return t.getLocation().x-e.getLocation().x});for(var i=t.get(0),n=1;n<t.size();n++){var o=t.get(n),s=i.getLocation().x;o.setX(s+e),i=o}},_flow_ver:function(t,e){this.sort(t,function(t,e){return t.getLocation().x-e.getLocation().x}),this.sort(t,function(t,e){return t.getLocation().y-e.getLocation().y});for(var i=t.get(0),n=1;n<t.size();n++){var o=t.get(n),s=i.getLocation().y;o.setY(s+e),i=o}},sort:function(t,e){for(var i,n,o,s,a=t.size(),r=0;a>r;r++){i=t.get(r);for(var h=r+1;a>h;h++)n=t.get(h),o=e?e(i,n):0,o>0&&(s=n,n=i,i=s,t.set(r,i),t.set(h,n))}},wrapper:function(t,e){Bs.Default.objectWrapper(t,"id",function(){return this.getClient("id")}),Bs.Default.objectWrapper(t,"objectId",function(){return this.getId()}),Bs.Default.objectWrapper(t,"width"),Bs.Default.objectWrapper(t,"height"),Bs.Default.objectWrapper(t,"depth"),Bs.Default.objectWrapper(t,"px"),Bs.Default.objectWrapper(t,"py"),Bs.Default.objectWrapper(t,"pz"),Bs.Default.objectWrapper(t,"rx"),Bs.Default.objectWrapper(t,"ry"),Bs.Default.objectWrapper(t,"rz"),Bs.Default.objectWrapper(t,"position"),Bs.Default.objectWrapper(t,"rotation"),e&&e.forEach(function(e){Bs.Default.objectWrapper(t,e)})}},Bs.Default.register("twaver.cube.top",function(t,e){var i=Bs.Utils2D.createNode(t);return e&&e(i),i});for(var mi in Bs.Utils2D)Bs.Default[mi]=Bs.Utils2D[mi];Bs.Utils3D={positionFloor:"floor-top",_objMap:{},_objObject:{},_envMaps:{envmap1:"envmap1.jpg",envmap2:"envmap2.jpg",envmap3:"envmap3.jpg",envmap4:"envmap4.jpg",envmap5:"envmap5.jpg"},getEnvMap:function(t){var e=Bs.Default.getImagePath()+Bs.Default._envMaps[t];return[e,e,e,e,e,e]},getOBjPath:function(t){return t?t.indexOf("http")>=0?t:this.path+t:this.path+"obj/"},createFloorForWall:function(t){var e={type:"twaver.floor",data:t.getClient("data")},i=this.getCreator(e.type);if(i){var n=this.loadData(e);n.setParent(t)}},createCombo:function(t,e){var i=[],n=[],o=[],s=[];!t||t instanceof Array||(t=[t]);for(var a=0;a<t.length;a++){var r=t[a],h=r.op||"+",l=r.style,c=r.client,d=r.position||[0,0,0],u=r.rotation||[0,0,0],_=r.scale||[1,1,1],g=null;if("cube"===r.type&&(g=this.createCube(r)),"cylinder"===r.type&&(g=this.createCylinder(r)),"sphere"===r.type&&(g=this.createSphere(r)),"polygon"===r.type&&(g=this.createPolygon(r)),"torus"===r.type&&(g=this.createTorus(r)),"path"===r.type&&(g=this.createPathCube(r)),"pathNode"===r.type&&(g=this.createPathNode(r)),"shapeNode"===r.type&&(g=this.createShapeNode(r)),g){if(u&&!r.rotationAnchor&&g.setRotation(u[0],u[1],u[2]),r.rotationAnchor){var f=g.getPosition();d=[d[0]+f.x,d[1]+f.y,d[2]+f.z]}g.setPosition(d[0],d[1],d[2]),g.setScale(_[0],_[1],_[2]),l&&g.s(l),c&&g.c(c),r.op?(g.getChildren().size()>0&&(i=i.concat(g.getChildren().toArray())),i.push(g),g.getChildren().size()>0?g.getChildren().forEach(function(){o.push(h)}):i.length>1&&o.push(h),s.push(g.getId())):n.push(g)}}if(i.length>0){var v;return v=e?new mono.ComboNode(i,o,!1,e):new mono.ComboNode(i,o),v.setNames(s),v}return 1==n.length?n[0]:n},setMainObject:function(t){function e(t,e){if(t){var i=t.getBoundingBox(),n=e.getBoundingBox(),o=i.min,s=i.max,a=n.min,r=n.max;(s.x-o.x<r.x-a.x||s.z-o.z<r.z-a.z)&&(t=e)}else t=e;return t}var i=null;if(t instanceof Array){for(var n=0;n<t.length;n++){var o=t[n];o instanceof mono.Entity&&(i=e(i,o))}for(var n=0;n<t.length;n++){var o=t[n];o instanceof mono.Entity&&i!=o&&t[n].setParent(i)}}else i=t;return i&&i.setClient("main",!0),i},createCube:function(t){var e,i=t.width,n=t.height,o=t.depth,s=t.color,a=(t.position||[0,0,0],t.rotation||[0,0,0]),r=t.rotationAnchor,h=t.topColor||s,l=t.repeatX||1,c=t.repeatY||1,d=t.image,u=t.frontImage,_=t.wrapMode;if(e=t.objectId?new mono.Cube({id:t.objectId,width:i,height:n,depth:o}):new mono.Cube(i,n,o),s&&e.s({"m.color":s,"m.ambient":s}),h&&e.s({"top.m.color":h,"top.m.ambient":h,"bottom.m.color":h,"bottom.m.ambient":h}),d&&e.s({"m.texture.image":d,"m.texture.repeat":new mono.Vec2(l,c),"m.texture.anisotropy":15}),u&&e.setStyle("front.m.texture.image",u),_&&e.setWrapMode(_),r){var g,f;"left"===r&&(g=new mono.Vec3(i/2,0,0),f=new mono.Vec3(0,1,0)),"right"===r&&(g=new mono.Vec3(-i/2,0,0),f=new mono.Vec3(0,1,0)),e.rotateFromAxis(f.clone(),g.clone(),a[1])}else e.setRotation(a[0]/180*Math.PI,a[1]/180*Math.PI,a[2]/180*Math.PI);return Bs.Default.setObject3dCSProps(e,t),e},createCylinder:function(t){var e=t.radius,i=t.topRadius||e,n=t.bottomRadius||e,o=t.height,s=t.color,a=t.image,r=new mono.Cylinder(i,n,o);return r.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":s,"m.ambient":s,"side.m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),a&&r.setStyle("m.texture.image",a),r},createSphere:function(t){var e=t.radius,i=t.color||"#F5F5F5",n=t.image,o=new mono.Sphere(e);return o.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":i,"m.ambient":i,"m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),n&&o.setStyle("m.texture.image",n),o},createPolygon:function(t){var e=t.radius||100,i=t.topRadius||e,n=t.bottomRadius||e,o=t.height||200,s=t.radialSegments||3,a=t.color||"#F5F5F5",r=t.topColor||a,h=t.smooth||!0,l=t.image,c=new mono.Cylinder(i,n,o,s,h);return c.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":a,"m.ambient":a,"top.m.color":r,"top.m.ambient":r,"bottom.m.color":r,"bottom.m.ambient":r,"side.m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),l&&c.setStyle("m.texture.image",l),c},createTorus:function(t){var e=t.radius||50,i=t.tube||30,n=t.tubularSegments||3,o=t.radialSegments||6,s=t.color||"#F5F5F5",a=t.image,r=new mono.Torus(e,i,n,o);return r.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":s,"m.ambient":s,"m.lightmap.image":this.getImagePath("outside_lightmap.jpg")}),a&&r.setStyle("m.texture.image",a),r},createBillboard:function(t){var e=t.position||[0,0,0],i=t.scale||[1,1,1],n=t.image||this.getImagePath("outside_lightmap.jpg"),o=new mono.Billboard;return o.s({"m.texture.image":n,"m.alignment":mono.BillboardAlignment.bottomCenter,"m.depthTest":!1}),o.setScale(i[0],i[1],i[2]),o.p(e[0],e[1],e[2]),o},createPathNodePath:function(t){var e;if(t[0]&&t[0]instanceof Array)for(var i=0;i<t.length;i++){var n=t[i];e?"c"===n[0]?e.quadraticCurveTo(n[1],n[2],n[3],n[4],n[5],n[6]):e.lineTo(n[0],0,n[1]):(e=new mono.Path,e.moveTo(n[0],0,n[1]))}else for(var i=0;i<t.length;i+=2)e?e.lineTo(t[i],0,t[i+1]):(e=new mono.Path,e.moveTo(t[i],0,t[i+1]));return e},createPathNode:function(t){var e,i=t.radius,n=t.pathImage,o=t.repeat||50,s=t.offset||new mono.Vec2(0,0),a=t.startCap||"plain",r=t.endCap||"plain",h=t.pathWidth,l=t.pathHeight,c=h/2,d=l/2,u=[{x:c,y:-d},{x:c,y:d},{x:-c,y:d},{x:-c,y:-d}],_=this.createPathNodePath(t.data),g=_.getLength();return h&&l?e=new mono.PathNode({path:_,shape:u,segments:10,segmentsR:5}):(_=mono.PathNode.prototype.adjustPath(_,i,2),e=new mono.PathNode({path:_,radius:i})),e.s({"m.texture.image":n,"m.texture.repeat":new mono.Vec2(g/o,1),"m.texture.offset":s}),a&&e.setStartCap(a),r&&e.setEndCap(r),Bs.Default.setObject3dCSProps(e,t),e},createShapeNodePath:function(t){var e;if(t[0]&&t[0]instanceof Array)for(var i=0;i<t.length;i++){var n=t[i];e?"c"===n[0]?e.quadraticCurveTo(n[1],-n[2],0,n[3],-n[4],0):e.lineTo(n[0],-n[1],0):(e=new mono.Path,e.moveTo(n[0],-n[1],0))}else for(var i=0;i<t.length;i+=2)e?e.lineTo(t[i],-t[i+1],0):(e=new mono.Path,e.moveTo(t[i],-t[i+1],0));return e},createShapeNode:function(t){var i=t.repeat||100,n=t.amount||2,o=!0;(null!==t.vertical||t.vertical!=e)&&(o=t.vertical);var s,a=this.createShapeNodePath(t.data);return s=new mono.ShapeNode(t.id?{id:t.id,path:a}:a),t.curveSegments&&s.setCurveSegments(t.curveSegments),s.setAmount(n),s.setVertical(o),s.setRepeat(i),s},createPathCube:function(t){var e=t.width,i=t.height,n=t.data,o=t.insideColor,s=t.outsideColor,a=t.asideColor,r=t.zsideColor,h=t.topColor,l=t.bottomColor,c=t.insideImage||t.image,d=t.outsideImage||t.image,u=t.insideMap,_=t.outsideMap,g=t.repeat||t.height,f=t.closed,v=this.createShapeNodePath(n);f&&v.closePath();var m=new mono.PathCube(v,e,i);return m.s({"outside.m.color":s,"inside.m.type":"basic","inside.m.color":o,"aside.m.color":a||s,"zside.m.color":r||s,"top.m.color":h,"bottom.m.color":l||h,"inside.m.lightmap.image":u,"outside.m.lightmap.image":_,"aside.m.lightmap.image":_,"zside.m.lightmap.image":_,"inside.m.texture.image":c,"outside.m.texture.image":d}),m.setRepeat(g),m},getPicInfo:function(t,e){var i={};"string"==typeof e&&(e=[e]);for(var n=0;n<e.length;n++){var o=e[n],s=o.substring(0,o.indexOf(".")).toLowerCase();o=t+o,i[s]=o}return i},getRByD:function(t){return t*Math.PI/180},getDByR:function(t){return 180*t/Math.PI},getRsByDs:function(t){var e;if(t&&t.length>0){e=[];for(var i=0;i<t.length;i++)e.push(Bs.Default.getRByD(t[i]))}return e},setObject3dCSProps:function(t,e){e.client&&t.c(e.client),e.style&&t.s(e.style)},setObject3dCommonProps:function(t,e){var i=Bs.Default.getRsByDs(e.rotation)||[0,0,0],n=e.scale||[1,1,1],o=e.position||[0,0,0];t.setRotation(i[0],i[1],i[2]),t.setScale(n[0],n[1],n[2]),t.setPosition(o[0],0,o[2]),Bs.Default.setPositionY(t,o[1]),Bs.Default.setObject3dCSProps(t,e)},cloneObjElement:function(t,e){var i=Bs.Default.getRsByDs(t.rotation)||[0,0,0],n=t.scale||[1,1,1],o=t.position||[0,0,0];o[1]=parseFloat(o[1])||0;var s=this._objObject[t.name],a=s.getBoundingBoxWithChildren(),r=(a.max.y-a.min.y)/2,h=s.clonePrefab();if(t._id&&(h._id=t._id),t.client)for(var l in t.client)h.setClient(l,t.client[l]);return t.s&&h.s(t.s),h.setClient("type",t.name),h.setClient("showShadow",t.showShadow),t.showShadow&&h.setClient("shadowImage",t.shadowImage),t.shadowType&&h.setClient("shadowType",t.shadowType),"function"==typeof t.interepter&&t.interepter.call(this,h),h.setClient("json",t),h.setScale(n[0],n[1],n[2]),h.setPosition(o[0],o[1]+r*n[1],o[2]),h.setRotation(i[0],i[1],i[2]),e&&e(h),h},setDefaultEnvMap:function(t){var e=this.getEnvMap("envmap5");t.setStyle("m.envmap.image",e);var i=t.getDescendants();return i.forEach(function(t){t.setStyle("m.envmap.image",e)}),t},setShadowImage:function(t,e){t.setClient("shadowImage",e),Me.Util.registerImageByUrl(e,e)},createObj:function(t,e){var i=this;if(this._objObject[t.name]){var n=this.getOBjPath(t.path),o=t.shadowImage=n+t.name+"S.png";return this.cloneObjElement(t,e)}if(!this._objMap[t.name]){this._objMap[t.name]=[];{var n=this.getOBjPath(t.path),s=n+t.name+".obj",a=n+t.name+".mtl";t.scale||[1,1,1]}if(t.showShadow){var o=t.shadowImage=n+t.name+"S.png";Me.Util.registerImageByUrl(o,o)}var r=new mono.OBJMTLLoader;r.load(s,a,null,function(e){t.merged&&(e=mono.Utils.mergeElements(e.getDescendants())),i._objObject[t.name]=e,i._objMap[t.name].forEach(function(t){return i.cloneObjElement(t.json,t.callback)})})}this._objMap[t.name].push({json:t,callback:e})},getTextSize:function(t,e){var i=Ve.createElement("canvas"),n=i.getContext("2d"),o=t.split("\n"),s=0;n.font=e;for(var a=0;a<o.length;a++){var r=o[a],h=n.measureText(r).width;h>s&&(s=h)}var l=n.measureText("e").width*o.length*3+4,c={w:s,h:l};return c},generateTextCanvas:function(t,e,i,n,o){var s=Ve.createElement("canvas"),i=i||"bold 80px 微软雅黑,sans-serif",a=s.getContext("2d"),r=t.split("\n"),h=Bs.Default.getTextSize(t,i),l=h.w,c=h.h,d={width:l,height:c};s.height=mono.Utils.nextPowerOfTwo(h.h),s.width=mono.Utils.nextPowerOfTwo(h.w),n&&(a.save(),a.globalAlpha=1,a.fillStyle=o||"#FE642E",a.beginPath(),a.moveTo(0,0),a.lineTo(l,0),a.lineTo(l,c),a.lineTo(0,c),a.closePath(),a.fill()),a.restore(),a.fillStyle=e||"white",a.textBaseline="middle",a.textAlign="center",a.font=i,a.shadowColor="#585858",a.shadowBlur=25,a.shadowOffsetX=10,a.shadowOffsetY=10;for(var u=a.measureText("o").width,_=2.5*u,g=0;g<r.length;g++){var f=l/2,v=_*g+_/2+(s.height-d.height);a.fillText(r[g],f,v)}return s.drawRect=d,s},generateShadowNode:function(t,e){var i=null,n=t.getDescendants();if(n.forEach(function(t){t instanceof mono.Entity&&t.getClient("type")&&"floor"==t.getClient("type")&&(i=t)}),i){var o=i.getBoundingBox(),s=(o.max.z-o.min.z,o.max.x-o.min.x,t.getRotation());t.setRotation(0,0,0);var a=Bs.Default.createShadowImage(t,i,e);return i.setStyle("top.m.lightmap.image",a),i.invalidateTexture(),Bs.Default.canvas=Bs.Default.canvas||a,t.setRotation(s),i}},_getWorldRotation:function(t){var e=(new mono.Mat4).extractRotation(t.worldMatrix),i=new mono.Vec3;return i.setEulerFromRotationMatrix(e),i},createShadowImage:function(t,e,i){var n=e.getBoundingBox(),o=n.max.z-n.min.z,s=n.max.x-n.min.x,a=Math.max(2048,Math.max(s,o)),r=a/2048,h=Bs.Default.canvas||Ve.createElement("canvas"),l=mono.Utils.nextPowerOfTwo(s/r),c=mono.Utils.nextPowerOfTwo(o/r),d=s/l,u=o/c;h.width=l,h.height=c;var _=h.getContext("2d");_.clearRect(0,0,l,c),_.fillStyle="white",_.fillRect(0,0,l,c),_.beginPath();var g,f=t.getPosition(),v=t?t.getBoundingBox():null,m=-(v.max.x+v.min.x)/2-f.x,p=-(v.max.z+v.min.z)/2-f.z,y=t.getDescendants();if(y.forEach(function(t){return t.getClient&&"wallCombos"==t.getClient("id")?void(g=t):void 0}),g){var w=g.getClient("combos");w.forEach(function(t){if(t.getClient&&!t.getClient("resetPos")){var e=t.getPosition();t.p(e.x+parseFloat(f.x),e.y+parseFloat(f.y),e.z+parseFloat(f.z)),t.setClient("resetPos",!0)}y.push(t)})}var A;if(y.forEach(function(t){return t.getClient&&"columnCombos"==t.getClient("id")?void(A=t):void 0}),A){var w=A.getClient("combos");w.forEach(function(t){if(t.getClient&&!t.getClient("resetPos")){var e=t.getPosition();t.p(e.x+parseFloat(f.x),e.y+parseFloat(f.y),e.z+parseFloat(f.z)),t.setClient("resetPos",!0)}y.push(t)})}return y.push(t),y.forEach(function(t){var e=t.getWorldPosition(),n=l/2+e.x/d,o=c/2+e.z/u,a=Bs.Default._getWorldRotation(t),r=t.getClient("type");if("wall"==r||"inner_wall"==r||"glass_wall"==r){var h=t.getClient("data");if(_.save(),_.translate(n,o),_.beginPath(),h[0]&&h[0]instanceof Array){for(var g=0;g<h.length;g++)0==g?_.moveTo(h[g][0]/d+m/d,h[g][1]/u+p/u):_.lineTo(h[g][0]/d+m/d,h[g][1]/u+p/u);"wall"==r&&_.lineTo(h[0][0]/d+m/d,h[0][1]/u+p/u)}else{for(var g=0;g<h.length;g+=2)0==g?_.moveTo(h[g]/d+m/d,h[g+1]/u+p/u):_.lineTo(h[g]/d+m/d,h[g+1]/u+p/u);"wall"==r&&_.lineTo(h[0]/d+m/d,h[1]/u+p/u)}_.lineWidth=20/d,_.strokeStyle="#ccc",_.shadowColor="#000";var f=Math.min(parseInt(s/15),300);_.shadowBlur=parseInt(f/d),("inner_wall"==r||"glass_wall"==r)&&(_.translate(n,o),_.lineWidth=10/d,_.shadowBlur=parseInt(f/d)),_.shadowOffsetX=0,_.shadowOffsetY=0,_.stroke(),_.stroke(),parseInt(s/15)>200&&(_.stroke(),_.stroke()),_.restore()}var v=t.getClient("showShadow");i&&(v=v&&i(t));var y=t.getClient("shadowImage"),w=t.getClient("shadowType")||0,A=t.getClient("shadowRatio")||.99,x=t.getClient("shadowWeight")||2;if(v){var E=t.getBoundingBox(),T=E.size(),C=T.x/d*A,b=depth=T.z/u*A;if(a.y%(Math.PI/2)==0&&(C=T.x/u*A,b=depth=T.z/d*A),a.y%Math.PI==0&&(C=T.x/d*A,b=depth=T.z/u*A),1==w){var k=Math.min(T.x,T.z);C=k/d*A,b=depth=k/u*A,a.y%(Math.PI/2)==0&&(C=k/u*A,b=depth=k/d*A),a.y%Math.PI==0&&(C=k/d*A,b=depth=k/u*A)}if(y){a=t.getRotation();var S=Me.Util.getImageAsset(y);if(!S)return;_.save(),_.translate(n+m/d,o+p/u),_.rotate(-a.y);var I,L,P,R,D=.3*Math.max(C,depth);a.y%(Math.PI/2)==0&&(I=-C/2-D/2,L=-depth/2-D/2,P=C+D,R=depth+D),a.y%Math.PI==0&&(I=-C/2-D/2,L=-depth/2-D/2,P=C+D,R=depth+D),_.drawImage(S.getImage(),I,L,P,R),_.drawImage(S.getImage(),I,L,P,R),_.restore()}else if(0==w){_.save(),_.translate(n+m/d,o+p/u),_.rotate(-a.y),_.beginPath(),_.moveTo(-C/2,0),_.lineTo(C/2,0),_.lineWidth=b,_.strokeStyle="gray",_.shadowColor="#333";var M=Math.min(C,depth);_.shadowBlur=2*M,_.shadowOffsetX=0,_.shadowOffsetY=0,1==x?(_.shadowBlur=3*M,_.stroke()):2==x&&(_.stroke(),_.stroke()),_.restore()}else if(1==w){var n=n+m/d,o=o+p/u,O=t.getClient("shadowRadius");O?O/=u:O=Math.sqrt(C*C+depth*depth)/2,_.save(),_.beginPath(),_.arc(n,o,O,0,2*Math.PI,!1),_.fillStyle="gray",_.shadowColor="black",_.shadowBlur=2*O,_.shadowOffsetX=0,_.shadowOffsetY=0,1==x?(_.shadowBlur=3*O,_.fill()):2==x&&(_.fill(),_.fill()),_.restore()}}}),h},getRelativePosition:function(t,e){var i,n;i=(new mono.Mat4).getInverse(t.worldMatrix.clone()),n=(new mono.Mat4).multiplyMatrices(i,e.worldMatrix.clone());var o=main.position=(new mono.Vec3).getPositionFromMatrix(n);return o},getPathBoundingBox:function(t){var e={},i={centerPoint:{x:0,y:0},min:{x:0,y:0},max:{x:0,y:0},size:{x:0,y:0}};if(0==t.length)return i;var n,o,s,a;if(t[0]instanceof Array){n=t[0][0],o=t[0][0],s=-t[0][1],a=-t[0][1];for(var r=1;r<t.length;r++)n=Math.min(n,t[r][0]),o=Math.max(o,t[r][0]),s=Math.min(s,-t[r][1]),a=Math.max(a,-t[r][1])}else{if(t.length<2)return i;n=t[0],o=t[0],s=-t[1],a=-t[1];for(var r=2;r<t.length;r+=2)n=Math.min(n,t[r]),o=Math.max(o,t[r]),s=Math.min(s,-t[r+1]),a=Math.max(a,-t[r+1])}return e.centerPoint={x:(n+o)/2,y:(s+a)/2},e.min={x:n,y:s},e.max={x:o,y:a},e.size={x:o-n,y:a-s},e},setPositionY:function(t,e){if("number"==typeof e)t.setPositionY(e);else if(e==Bs.Default.positionFloor){var i=t.getBoundingBox().size();t.setPositionY(i.y/2)}},playAnimation:function(t,e,i){var n=e.split(":");if("move"===n[0]){var o=n[1],s=n[2],a=parseInt(n[3])||1e3,r=parseInt(n[4]),h=n[5];this.animateMove(t,o,s,a,r,h,i)}if("rotation"===n[0]){var l=n[1],c=n[2],a=parseInt(n[3])||1e3,r=parseInt(n[4]),h=n[5];this.animateRotate(t,l,c,a,r,h,i)}},animateMove:function(t,e,i,n,o,s,a){var r=t.getBoundingBox().size().multiply(t.getScale()),i=i||.8,h=new mono.Vec3(0,0,1),l=0;"right"===e&&(h=new mono.Vec3(1,0,0),l=r.x),"left"===e&&(h=new mono.Vec3(-1,0,0),l=r.x),"top"===e&&(h=new mono.Vec3(0,1,0),l=r.y),"bottom"===e&&(h=new mono.Vec3(0,-1,0),l=r.y),"front"===e&&(h=new mono.Vec3(0,0,1),l=r.z),"back"===e&&(h=new mono.Vec3(0,0,-1),l=r.z),l*=i,t.getClient("animated")&&(h=h.negate());var c=t.getPosition().clone();t.setClient("animated",!t.getClient("animated")),new Me.Animate({from:0,to:1,dur:n,easing:s,delay:o,onUpdate:function(e){t.setPosition(c.clone().add(h.clone().multiplyScalar(l*e)))},onDone:function(){a&&a()}}).play()},animateRotate:function(t,i,n,o,s,a,r){a=a||"easeInStrong";var h=t.getBoundingBox().size().multiply(t.getScale()),l=0,c=1;t.getClient("animated")&&(c=-1),t.setClient("animated",!t.getClient("animated"));var d,u;if("left"===i){d=new mono.Vec3(-h.x/2,0,0);var u=new mono.Vec3(0,1,0)}if("right"===i){d=new mono.Vec3(h.x/2,0,0);var u=new mono.Vec3(0,1,0)}if("center-z"===i){d=new mono.Vec3(0,0,0);var u=new mono.Vec3(0,0,1)}var _=new Me.Animate({from:l,to:c,dur:o,delay:s,easing:a,onUpdate:function(i){this.lastValue===e&&(this.lastValue=0),t.rotateFromAxis(u.clone(),d.clone(),Math.PI/180*-n*(i-this.lastValue)),this.lastValue=i},onDone:function(){delete this.lastValue,r&&r()}});_.play()},animateCameraPosition:function(t,e,i,n){var o=t.getPosition(),s=new Me.Animate({from:0,to:1,dur:i,easing:"easeBoth",onUpdate:function(i){var n=o.x+(e.x-o.x)*i,s=o.y+(e.y-o.y)*i,a=o.z+(e.z-o.z)*i,r=new mono.Vec3(n,s,a);t.setPosition(r)}});return s.onDone=n,s}};for(var mi in Bs.Utils3D)Bs.Default[mi]=Bs.Utils3D[mi];Bs.Default.register("twaver.cube",function(t,e){t.image&&t.image.indexOf("http")<0&&(t.image=Bs.Default.path+t.image);var i=Bs.Default.createCube(t);return 0==t.visible&&i.setStyle("m.visible",!1),Bs.Default.setObject3dCommonProps(i,t),e&&e(i),i},{category:"基本模型",type:"mono.Element",name:"立方体",icon:"model/idc/icons/cube.png",description:"立方体是make里面提供的最基本的模型，可以用这种模型扩展出各种立方体形状的模型，比如箱子，柱子，盒子等。支持更改长，宽，高，贴图等基本参数",modelDefaultParameters:{width:{name:"宽",value:100,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:100,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},depth:{name:"深",value:100,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"white",type:Bs.Default.PARAMETER_TYPE_COLOR,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:e,type:Bs.Default.PARAMETER_TYPE_IMAGE,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),Bs.Default.register("twaver.cylinder",function(t,e){var i=Bs.Default.createCylinder(t),n=t.position||[0,0,0];return i.p(n[0],0,n[2]),Bs.Default.setPositionY(i,n[1]),e&&e(i),i},{category:"基本模型",type:"mono.Element",name:"圆柱体",icon:"model/idc/icons/cylinder.png",description:"圆柱体是make中提供的最基本模型，支持更改半径，高度的参数。可以更改这些参数扩展出各个圆柱体形状的模型，比如圆形柱子，桌子腿，瓶子，圆筒等",modelDefaultParameters:{topRadius:{name:"顶半径",value:60,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},bottomRadius:{name:"底半径",value:60,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:100,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"white",type:Bs.Default.PARAMETER_TYPE_COLOR,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:e,type:Bs.Default.PARAMETER_TYPE_IMAGE,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),Bs.Default.register("twaver.sphere",function(t,e){var i=Bs.Default.createSphere(t),n=t.position||[0,0,0];return i.p(n[0],0,n[2]),i.setClient("showShadow",!0),i.setClient("shadowType",1),i.setClient("shadowRatio",.3),Bs.Default.setPositionY(i,n[1]),e&&e(i),i},{category:"基本模型",type:"mono.Element",name:"球体",icon:"model/idc/icons/sphere.png",description:"球体是make中提供的最基本模型，支持更改半径的参数。可以更改这些参数扩展出各个球体形状的模型，比如圆球等",modelDefaultParameters:{radius:{name:"半径",value:80,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"#F5F5F5",type:Bs.Default.PARAMETER_TYPE_COLOR,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:e,type:Bs.Default.PARAMETER_TYPE_IMAGE,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),Bs.Default.register("twaver.polygon",function(t,e){var i=Bs.Default.createPolygon(t),n=t.position||[0,0,0];return i.p(n[0],0,n[2]),Bs.Default.setPositionY(i,n[1]),e&&e(i),i},{category:"基本模型",type:"mono.Element",name:"多边形",icon:"model/idc/icons/polygon.png",description:"多边形是make中提供的最基本模型，支持更改半径，高度，边数的参数。可以更改这些参数扩展出各个多边形状的模型，比如多边形柱子，多边形箱子，各种支架等",modelDefaultParameters:{color:{name:"颜色",value:"white",type:Bs.Default.PARAMETER_TYPE_COLOR,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:e,type:Bs.Default.PARAMETER_TYPE_IMAGE,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},topRadius:{name:"顶半径",value:100,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},bottomRadius:{name:"底半径",value:100,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:200,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},radialSegments:{name:"边数",value:3,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),Bs.Default.register("twaver.torus",function(t,e){var i=Bs.Default.createTorus(t),n=t.position||[0,0,0];return i.p(n[0],0,n[2]),Bs.Default.setPositionY(i,n[1]),e&&e(i),i},{category:"基本模型",type:"mono.Element",name:"圆环",icon:"model/idc/icons/torus.png",description:"圆环体是make中提供的最基本模型，支持更改半径，高度，扁平程度，管半径的参数。可以更改这些参数扩展出各个圆环体形状的模型，比如轮胎等",modelDefaultParameters:{color:{name:"颜色",value:"white",type:Bs.Default.PARAMETER_TYPE_COLOR,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:e,type:Bs.Default.PARAMETER_TYPE_IMAGE,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},radius:{name:"半径",value:50,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},tube:{name:"内外径差",value:30,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},tubularSegments:{name:"扁平程度",value:3,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},radialSegments:{name:"边数",value:6,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}});var Us=0;Bs.Default.register("twaver.combo",function(t,e){var i="pack_"+Us++,n=t.data;if(n&&mono.Utils.isArray(n)){for(var o=null,s=null,a=[],r=[],h=0;h<n.length;h++){if(s=Bs.Default.load(n[h]),o){var l=s.getClient("type");"inner_wall"==l||"glass_wall"==l?(a.push(s),s.getChildren().size()>0&&s.getChildren().forEachReverse(function(t){t.setParent(o)})):"column"==l?r.push(s):s.setParent(o)}else o=s;s.setClient?s.setClient("pack",i):(s.client=s.client||{},s.client.pack=i)}if(a&&a.length>0){var c=new mono.ComboNode(a);c.setClient("id","wallCombos"),c.setClient("combos",c.getCombos()),c.setParent(o)}if(r&&r.length>0){var c=new mono.ComboNode(r);c.setClient("id","columnCombos"),c.setClient("combos",c.getCombos()),c.setParent(o)}return e&&e(o),o}},{icon:"model/idc/icons/combo.png",category:"基本模型",type:"mono.Element",name:"组合模型",description:"组合模型，可以把多个不同的模型组合在一块，组成一个新的模型，传如参数是一个数组"}),Bs.Default.registerObj=function(t,e,i,n,o,s,a){n=n||{},n.async=!0;var r=function(t,r){return t.name=e,t.path=i,t.showShadow=o,s&&(t.shadowType=s),t.merged=a,null==t.merged&&(t.merged=!0),t.interepter=n.interepter,Bs.Default.createObj(t,r)};Bs.Default.register(t,r,n)},Bs.Default.register("twaver.loader",function(t,e){return Bs.Default.load(t.data,e)}),Bs.Utils3D.getRectOfPoints=function(t){if(!t||t.length/2<2)return null;var e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,s=0,a=t.length,r=[],h=function(t,s){n=Math.min(n,t),o=Math.max(o,t),e=Math.min(e,s),i=Math.max(i,s),r.push({x:t,y:s})};if(a>0&&t[s]instanceof Array)for(;a>s;s++){var l=t[s];2==l.length?h(l[0],l[1]):5==l.length&&"c"==l[0]&&h(l[3],l[4])}else for(;a>s;s+=2)h(t[s],t[s+1]);return{min:{x:n,y:e},max:{x:o,y:i},center:function(){return{x:(this.min.x+this.max.x)/2,y:(this.min.y+this.max.y)/2}},width:o-n,height:i-e,points:r}};var Bs=t.make={},Ns={},zs={},Fs=[],Vs={};Bs.Default={path:"./",resPath:"",getImagePath:function(t){return this.path+this.resPath+"res/images/"+(t||"")},register:function(t,e,i){i=i||{},i.name=i.name||t,i.modelDefaultParameters=i.modelDefaultParameters||{},i.description=i.description||i.name,Ns[t]&&console.log(t," already exist"),Ns[t]=e;var n=i.category||"",o=zs[n]||{};o[t]=e,zs[n]=o,Vs[t]=i,-1==Fs.indexOf(n)&&Fs.push(n),this.checkModelDefaultParameters(i.modelDefaultParameters)},checkModelDefaultParameters:function(t){if(t)for(var i in t){var n=t[i];n instanceof Object||(n={value:n},t[i]=n),n.propertyName=i,n.hidden=!!n.hidden,n.propertyType=n.propertyType||Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,n.type=n.type||Bs.Default.PARAMETER_TYPE_STRING,n.category=n.category||Bs.Default.PARAMETER_CATEGORY_DETAIL,n.editable=n.editable===e?!0:!!n.editable,n.index=n.index===e?100:parseInt(n.index)}},remove:function(t){if(Ns[t]){Ns[t]=e,delete Ns[t];var i=Bs.Default.getCategory(t),n=zs[i];delete n[t];var o=0;for(var s in n)s&&o++;if(0==o)for(var s=0;s<Fs.length;s++){var a=Fs.indexOf(i);a>=0&&Fs.splice(a,1)}delete Vs[t]}else console.log(t," not exist")},getCategories:function(){return Fs},getCreatorsForCategory:function(t){return zs[t]},getCreator:function(t){return Ns[t]},getIds:function(t){var e=[];for(var i in Ns)(!t||t&&t(this.getParameters(i)))&&e.push(i);return e},getModelDefaultParameters:function(t){var e=this.getParameters(t);return e.modelDefaultParameters},getDescription:function(t){var e=this.getParameters(t);return e.description},getName:function(t){var e=this.getParameters(t);return e.name},getIcon:function(t){var e=this.getParameters(t);return this.path+e.icon},isAsync:function(t){var e=this.getParameters(t);return e.async},isCombo:function(t){var e=this.getParameters(t);return e.combo},getCategory:function(t){var e=this.getParameters(t);return e.category},getOrder:function(t){var e=this.getParameters(t);return e.order||0},getType:function(t){var e=this.getParameters(t);return e.type},getOtherParameter:function(t,e){var i=this.getParameters(t);return i[e]},registerIcon:function(t,e){var i=this.getParameters(t);if(i)return i.icon=e,i.icon},registerDescription:function(t,e){var i=this.getParameters(t);return i.description=e,i.description},registerName:function(t,e){var i=this.getParameters(t);return i.name=e,i.name},registerOther:function(t,e,i){var n=o[e],o=this.getParameters(t);return o[e]=i,"modelDefaultParameters"===e&&(console.warn("rewrite modelDefaultParameters: id={0}, oldValue={}, newValue={}",t,n,i),this.checkModelDefaultParameters(i)),n},appendModelDefaultParameter:function(t,e,i,n,o,s,a){},getParameters:function(t){return Vs[t]||{}},load:function(t,e,i){var n,i=i||{},o=i.isRelation;if(e){var s=e;e=function(e){o&&t instanceof Array&&t.length>1&&e instanceof Array&&e.length>1&&this._relation(t,e),s(e)}}if(t instanceof Array){var a={};if(e){var r=function(i,n){var o=t.length;return function(t){i.datas=i.datas||[],i.datas.push(t),i._total===o&&e(i.datas)}(n)};a._total=0;for(var h=0;h<t.length;h++){var l=t[h];this.load(l,function(t){a._total++,r(a,t)})}return null}n=[];for(var h=0;h<t.length;h++){var l=t[h],c=this.load(l);c&&n.push(c)}}else{var d={};"string"==typeof t?d.id=t:d=t,d=this.filterJson(d),e?this._load(d,e):n=this._load(d)}return o&&n instanceof Array&&n.length>1&&this._relation(t,n),n},_relation:function(t,e){var i={};e.forEach(function(t){t.getId&&(i[t.getId()]=t)}),t.forEach(function(t){t.objectId&&t.parentId&&i[t.objectId]&&i[t.parentId]&&i[t.objectId].setParent&&i[t.objectId].setParent(i[t.parentId])})},_load:function(t,e){var i=t.id,n=this.getCreator(i);if(!n)return console.log("unknown id: ",i),null;if(!e){var o=n(t);return Bs.Default._setObjectClientId(o,i),o}n(t,function(t){Bs.Default._setObjectClientId(t,i),e&&e(t)})},_setObjectClientId:function(t,e){t&&t.setClient&&t.setClient("id",e)},copyArray:function(t,e,i){if(e=[],t)for(var n,o=0,s=t.length;s>o;o++)n={},this.copyProperties(t[o],n),e.push(n);return e},copyProperties:function(t,i,n){if(t&&i)for(var o in t)n&&n.indexOf(o)>=0||o.startsWith("_")||(i[o]===e&&(i[o]=t[o]instanceof Array?[]:t[o]instanceof Function?t[o]:t[o]instanceof Object?{}:t[o]),!(t[o]instanceof Function)&&t[o]instanceof Object&&i[o]instanceof Object&&Bs.Default.copyProperties(t[o],i[o]))},getModelDefaultParametersValues:function(t,e){var i=this.getModelDefaultParameters(t),n={};for(var o in i){var s=i[o];e&&e(s)||(s.propertyType==Bs.Default.PARAMETER_PROPERTY_TYPE_CLIENT?(n.client=n.client||{},n.client[o]=s.value):s.propertyType==Bs.Default.PARAMETER_PROPERTY_TYPE_STYLE?(n.style=n.style||{},n.style[o]=s.value):n[o]=s.value)}return n},getModelDefaultParameterProperties:function(t){var e=this,i=[],n=this.getModelDefaultParameters(t);if(!n)return i;n.id||(n.id={propertyName:"id",name:"模型ID",category:Bs.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:Bs.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-2}),n.objectId||(n.objectId={propertyName:"objectId",name:"实例ID",category:Bs.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:Bs.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-1});for(var o in n)i.push(n[o]);return i.sort(function(t,e){return t.index-e.index}),i=i.map(function(t){return e.modelParameterToProperty(t)})},_getNameFromPropertyName:function(t){for(var e=t.split("."),i="",n=0;n<e.length;n++)e[n].length>0&&(i+=e[n].substring(0,1).toUpperCase()+e[n].substring(1,e[n].length)),n<e.length-1&&(i+=" ");return i},modelParameterToProperty:function(t){var e=new Me.Property;return e.setCategoryName(t.category),t.name||(t.name=this._getNameFromPropertyName(t.propertyName)),e.setName(t.name),e.setEditable(t.editable),e.setPropertyType(t.propertyType),e.setPropertyName(t.propertyName),e.setValueType(t.type),e.setEnumInfo(t.enumInfo),e.isVisible=function(){return!t.hidden},e},filterJson:function(t){var i=this.getModelDefaultParameters(t.id);for(var n in i){var o=i[n].propertyType||"client",s=i[n].value;o==Bs.Default.PARAMETER_PROPERTY_TYPE_STYLE?t.style&&t.style[n]!==e||(t.style=t.style||{},t.style[n]=s):o==Bs.Default.PARAMETER_PROPERTY_TYPE_CLIENT?t.client&&t.client[n]!==e||(t.client=t.client||{},t.client[n]=s):t[n]===e&&(t[n]=s)}return t},UNIT_HEIGHT:4.445,EQUIPMENT_WIDTH:45.5,RACK_OFFSET_X:7.25,RACK_OFFSET_Y:6.655,RACK_WIDTH:60,getUnitHeight:function(){return this.UNIT_HEIGHT},getEquipmentWidth:function(){return this.EQUIPMENT_WIDTH},getEquipmentHeight:function(t){return parseInt(t)>0||console.error("method getEquipmentHeight's first argument scale value is zero"),this.UNIT_HEIGHT*t},getRackWidth:function(){return this.RACK_WIDTH},getRackHeight:function(t){return parseInt(t)>0||console.error("method getRackHeight's first argument scale value is zero"),this.RACK_OFFSET_Y+this.UNIT_HEIGHT*parseInt(t)+this.RACK_OFFSET_Y}},Bs.Default.toJson=function(t,e){if(t&&t.getClient){var i=t.getClient("id"),n=Bs.Default.getModelDefaultParameters(i),o={},s=null,a=null;for(var r in n)if(n[r].exportable!==!1){var h=n[r].propertyType,a=n[r].value;h==Bs.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR?(s=t[Oe.getter(r)](),Bs.Default.equals(s,a)||(o[r]=s)):h==Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD?(s=t[r],Bs.Default.equals(s,a)||(o[r]=s)):h==Bs.Default.PARAMETER_PROPERTY_TYPE_STYLE?(s=t.getStyle(r),Bs.Default.equals(s,a)||(o.style=o.style||{},o.style[r]=s)):h==Bs.Default.PARAMETER_PROPERTY_TYPE_CLIENT&&(s=t.getClient(r),Bs.Default.equals(s,a)||(o.client=o.client||{},o.client[r]=s))}return o.id=i,Bs.Default.EXPORT_OBJECT_ID&&(o.objectId=t.getId()),e&&(o=e(o)),o}return e&&(t=e(t)),t},Bs.Default.copy=function(t,e,i,n,o){var s=function(t,e,i,n,o){o=o||{};var s={},a={},r=Bs.Default.getParameters(e);Bs.Default.copyProperties(r,a),n instanceof Function?s=n(a)||{}:Bs.Default.copyProperties(n,s),o.copyDefaultParamCoverage&&delete a.modelDefaultParameters,o.copyParamCoverage||Bs.Default.copyProperties(a,s),Bs.Default.register(t,function(t,n){var o={id:e};i instanceof Function?i(t):Bs.Default.copyProperties(i,o),Bs.Default.copyProperties(t,o);var s=Bs.Default.load(o,n);return s},s)};s(t,e,i,n,o)},Bs.Default.PARAMETER_CATEGORY_BASIC="BASIC",Bs.Default.PARAMETER_CATEGORY_DETAIL="Detail",Bs.Default.PARAMETER_TYPE_STRING="string",Bs.Default.PARAMETER_TYPE_BOOLEAN="boolean",Bs.Default.PARAMETER_TYPE_COLOR="color",Bs.Default.PARAMETER_TYPE_INT="int",Bs.Default.PARAMETER_TYPE_NUMBER="number",Bs.Default.PARAMETER_TYPE_IMAGE="image",Bs.Default.PARAMETER_TYPE_ARRAY_STRING="array.string",Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER="array.number",Bs.Default.PARAMETER_TYPE_ARRAY_INT="array.int",Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD="field",Bs.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR="accessor",Bs.Default.PARAMETER_PROPERTY_TYPE_STYLE="style",Bs.Default.PARAMETER_PROPERTY_TYPE_CLIENT="client",String.prototype.replaceAll=function(t,e,i){return RegExp.prototype.isPrototypeOf(t)?this.replace(t,e):this.replace(new RegExp(t,i?"gi":"g"),e)},String.prototype.formatTT=function(t){var e=this;if(arguments.length>1){for(var i=[],n=0;n<arguments.length;n++)i.push(arguments[n]);t=i}if(t){if(t instanceof Array)t.forEach(function(t,i){t instanceof Object&&(t=JSON.stringify(t)),e=e.replaceAll("{"+i+"}",t)});else{if(!(t instanceof Object))return e.replaceAll("{}",t);for(var o in t){var s=t[o];s instanceof Object&&(s=JSON.stringify(s)),e=e.replaceAll("{"+o+"}",s)}}}return e},Bs.Default.getId=function(t){return t.getClient("id")},Bs.Default.objectWrapper=function(t,e,i,n){t.__defineGetter__(e,function(){var n=t["___"+e];return i&&(n=i.call(t,n,t,e)),n}),t.__defineSetter__(e,function(i){var o=t[e];n&&(i=n.call(t,i,t,e)),o!==i&&(t["___"+e]=i,this.firePropertyChange&&this.firePropertyChange(e,o,i))})},Bs.Default.equals=function(t,e){return t instanceof Object&&e instanceof Object?JSON.stringify(t)==JSON.stringify(e):t==e},Bs.Default.EXPORT_OBJECT_ID=!0,Bs.Utils2D={create2dShapeNode:function(t){var e=t.position||[0,0,0],i=t.data,n=t.image,o=(t.objType,t.objectId),s=t.closed,a=new Bs.Default.WallShapeNode(o);"innerWall"==t.objType?a=new Bs.Default.InnerWallShapeNode(o):"floor"==t.objType?a=new Bs.Default.FloorShapeNode(o):"cable"==t.objType&&(a=new Bs.Default.LineWidthShapeNode(o));var r=Bs.Default.create2dShapePath(i,e);return Bs.Default.objectWrapper(a,"id",function(){return this.getClient("id")}),Bs.Default.objectWrapper(a,"objectId",function(){return this.getId()}),a.setSegments(r.segments),a.setPoints(r.points),s&&a.setClient("closed",!0),n&&a.setClient("imageSrc",n),Bs.Default.setObject2dCSProps(a,t),a},create2dShapePath:function(t,e){var i=new Me.List,n=new Me.List;if(t.length>0)if(i.add("moveto"),t[0]instanceof Array){n.add({x:parseFloat(t[0][0])+parseFloat(e[0]),y:parseFloat(t[0][1])+parseFloat(e[2])});for(var o=1;o<t.length;o++){var s=t[o];"c"==s[0]?(i.add("quadto"),n.add({x:parseFloat(s[1])+parseFloat(e[0]),y:parseFloat(s[2])+parseFloat(e[2])}),n.add({x:parseFloat(s[3])+parseFloat(e[0]),y:parseFloat(s[4])+parseFloat(e[2])})):(i.add("lineto"),n.add({x:parseFloat(s[0])+parseFloat(e[0]),y:parseFloat(s[1])+parseFloat(e[2])}))}}else{n.add({x:parseFloat(t[0])+parseFloat(e[0]),y:parseFloat(t[1])+parseFloat(e[2])});for(var o=2;o<t.length;o+=2)i.add("lineto"),n.add({x:parseFloat(t[o])+parseFloat(e[0]),y:parseFloat(t[o+1])+parseFloat(e[2])})}return{segments:i,points:n}},setObject2dCSProps:function(t,e){var i=e.style,n=e.client;if(i)for(var o in i)t.setStyle(o,i[o]);if(n)for(var o in n)t.setClient(o,n[o])},createBlockObject:function(t,e){var i=t.objectId,n=new Bs.Default.Block(i);"door"==e?n=new Bs.Default.Door(i):"window"==e&&(n=new Bs.Default.Window(i)),t.width&&n.setClient("length",t.width);var o=t.client||{};return n.setClient("edgeIndex",o.edgeIndex||1),n.setClient("offset",o.offset||0),Bs.Default.setObject2dCSProps(n,t),n},createNode:function(t){var e=t.position||[0,0,0],i=t.rotation||[0,0,0],n=t.width||50,o=t.depth||50,s=t.image,a=t.objectId,r=new Me.Follower(a),h=t.color||"#CCCCFF";return Bs.Default.objectWrapper(r,"id",function(){return this.getClient("id")}),Bs.Default.objectWrapper(r,"objectId",function(){return this.getId()}),r.setSize(parseFloat(n),parseFloat(o)),r.setCenterLocation({x:parseFloat(e[0]),y:parseFloat(e[2])}),r.setAngle(i[1]),r.setClient("positionY",e[1]),"string"==typeof s?r.setImageUrl(s):"object"==typeof s?r.setImage(s):(r.setStyle("body.type","vector"),r.setStyle("vector.shape","rectangle"),r.setStyle("vector.fill.color",h)),r.setStyle("select.style","border"),r.setStyle("select.color","#F07819"),r.setStyle("select.width",.7),r.setStyle("vector.outline.width",1),r.setStyle("vector.outline.color","#BEC9BE"),r.setStyle("label.position","center"),Bs.Default.setObject2dCSProps(r,t),r},createFollower:function(t){var e=t,t={};Bs.Default.copyProperties(e,t),t.id=t.objectId||Oe.id(),t.sacle=t.sacle||1,t.depth=t.depth||5,t.position=t.position||[0,0,0],t.rotation=t.rotation||[0,0,0];var i=new Me.Follower(t);return Bs.Default.objectWrapper(i,"id",function(){return i.getClient("id")}),Bs.Default.objectWrapper(i,"objectId",function(){return i.getId()}),Bs.Default.objectWrapper(i,"depth"),Bs.Default.objectWrapper(i,"position",null,function(t){return this.setLocation({x:t[0],y:t[1]}),t}),Bs.Default.objectWrapper(i,"rotation",null,function(t){return this.setAngle(t[2]),t}),Bs.Default.objectWrapper(i,"scale",null,function(t){var e=this.getSize();e.width=e.width*t,e.height=e.height*t,this.setSize(e);var n=this.getLocation();return n.x=n.x*t,n.y=n.y*t,i.setLocation(n),t}),i.depth=t.depth,i.position=t.position,i.rotation=t.rotation,i.scale=t.scale,i.addPropertyChangeListener(function(t){var e=t.property,i=t.source;"location"==e?(i.position[0]=t.newValue.x,i.position[1]=t.newValue.y):"angle"==e&&(i.rotation[2]=t.newValue)},i),t.x&&i.setX(t.x),t.y&&i.setY(t.y),i.z=t.z,t.location&&i.setLocation(t.location instanceof Array?{x:t.location[0],y:t.location[1]}:t.location),t.centerLocation&&i.setCenterLocation(t.centerLocation instanceof Array?{x:t.centerLocation[0],y:t.centerLocation[1]}:t.centerLocation),t.size&&i.setSize(t.size),t.angle&&i.setAngle(t.angle),i.setStyle("select.style","border"),i.setStyle("select.color","#F07819"),i.setStyle("select.width",.7),i.setStyle("vector.outline.color","#BEC9BE"),Bs.Default.setObject2dCSProps(i,t),i},align:function(t,e){if(e&&t&&!(t.size()<2)){var i=this["_align_"+e];i&&i.call(this,t)}},_align_up:function(t){for(var e=t.get(0).getLocation().y,i=1;i<t.size();i++)e=Math.min(e,t.get(i).getLocation().y);t.forEach(function(t){t.setY(e)})},_align_down:function(t){for(var e=t.get(0).getLocation().y+t.get(0).getSize().height,i=1;i<t.size();i++)e=Math.max(e,t.get(i).getLocation().y+t.get(i).getSize().height);t.forEach(function(t){t.setY(e-t.getSize().height)})},_align_left:function(t){for(var e=t.get(0).getLocation().x,i=1;i<t.size();i++)e=Math.min(e,t.get(i).getLocation().x);t.forEach(function(t){t.setX(e)})},_align_right:function(t){for(var e=t.get(0).getLocation().x+t.get(0).getSize().width,i=1;i<t.size();i++)e=Math.max(e,t.get(i).getLocation().x+t.get(i).getSize().width);t.forEach(function(t){t.setX(e-t.getSize().width)})},_align_center:function(t){for(var e=0,i=0;i<t.size();i++)e+=t.get(i).getCenterLocation().y;var n=e/t.size();t.forEach(function(t){t.setY(n-t.getSize().height/2)})},_align_middle:function(t){for(var e=0,i=0;i<t.size();i++)e+=t.get(i).getCenterLocation().x;var n=e/t.size();t.forEach(function(t){t.setX(n-t.getSize().width/2)})},flow:function(t,e,i){if(e&&t&&!(t.size()<2)){var n=this["_flow_"+e];n&&n.call(this,t,i)}},_flow_hor:function(t,e){this.sort(t,function(t,e){return t.getLocation().y-e.getLocation().y}),this.sort(t,function(t,e){return t.getLocation().x-e.getLocation().x});for(var i=t.get(0),n=1;n<t.size();n++){var o=t.get(n),s=i.getLocation().x;o.setX(s+e),i=o}},_flow_ver:function(t,e){this.sort(t,function(t,e){return t.getLocation().x-e.getLocation().x}),this.sort(t,function(t,e){return t.getLocation().y-e.getLocation().y});for(var i=t.get(0),n=1;n<t.size();n++){var o=t.get(n),s=i.getLocation().y;o.setY(s+e),i=o}},sort:function(t,e){for(var i,n,o,s,a=t.size(),r=0;a>r;r++){i=t.get(r);for(var h=r+1;a>h;h++)n=t.get(h),o=e?e(i,n):0,o>0&&(s=n,n=i,i=s,t.set(r,i),t.set(h,n))}},wrapper:function(t,e){Bs.Default.objectWrapper(t,"id",function(){return this.getClient("id")}),Bs.Default.objectWrapper(t,"objectId",function(){return this.getId()}),Bs.Default.objectWrapper(t,"width"),Bs.Default.objectWrapper(t,"height"),Bs.Default.objectWrapper(t,"depth"),Bs.Default.objectWrapper(t,"px"),Bs.Default.objectWrapper(t,"py"),Bs.Default.objectWrapper(t,"pz"),Bs.Default.objectWrapper(t,"rx"),Bs.Default.objectWrapper(t,"ry"),Bs.Default.objectWrapper(t,"rz"),Bs.Default.objectWrapper(t,"position"),Bs.Default.objectWrapper(t,"rotation"),e&&e.forEach(function(e){Bs.Default.objectWrapper(t,e)})}},Bs.Default.register("twaver.cube.top",function(t,e){var i=Bs.Utils2D.createNode(t);return e&&e(i),i});for(var mi in Bs.Utils2D)Bs.Default[mi]=Bs.Utils2D[mi];Bs.Utils3D={positionFloor:"floor-top",_objMap:{},_objObject:{},_envMaps:{envmap1:"envmap1.jpg",envmap2:"envmap2.jpg",envmap3:"envmap3.jpg",envmap4:"envmap4.jpg",envmap5:"envmap5.jpg"},getEnvMap:function(t){var e=Bs.Default.getImagePath()+Bs.Default._envMaps[t];return[e,e,e,e,e,e]},getOBjPath:function(t){return t?t.indexOf("http")>=0?t:this.path+t:this.path+"obj/"},createFloorForWall:function(t){var e={type:"twaver.floor",data:t.getClient("data")},i=this.getCreator(e.type);if(i){var n=this.loadData(e);n.setParent(t)}},createCombo:function(t,e){var i=[],n=[],o=[],s=[];!t||t instanceof Array||(t=[t]);for(var a=0;a<t.length;a++){var r=t[a],h=r.op||"+",l=r.style,c=r.client,d=r.position||[0,0,0],u=r.rotation||[0,0,0],_=r.scale||[1,1,1],g=null;if("cube"===r.type&&(g=this.createCube(r)),"cylinder"===r.type&&(g=this.createCylinder(r)),"sphere"===r.type&&(g=this.createSphere(r)),"polygon"===r.type&&(g=this.createPolygon(r)),"torus"===r.type&&(g=this.createTorus(r)),"path"===r.type&&(g=this.createPathCube(r)),"pathNode"===r.type&&(g=this.createPathNode(r)),"shapeNode"===r.type&&(g=this.createShapeNode(r)),g){if(u&&!r.rotationAnchor&&g.setRotation(u[0],u[1],u[2]),r.rotationAnchor){var f=g.getPosition();d=[d[0]+f.x,d[1]+f.y,d[2]+f.z]}g.setPosition(d[0],d[1],d[2]),g.setScale(_[0],_[1],_[2]),l&&g.s(l),c&&g.c(c),r.op?(g.getChildren().size()>0&&(i=i.concat(g.getChildren().toArray())),i.push(g),g.getChildren().size()>0?g.getChildren().forEach(function(){o.push(h)}):i.length>1&&o.push(h),s.push(g.getId())):n.push(g)}}if(i.length>0){var v;return v=e?new mono.ComboNode(i,o,!1,e):new mono.ComboNode(i,o),v.setNames(s),v}return 1==n.length?n[0]:n},setMainObject:function(t){function e(t,e){if(t){var i=t.getBoundingBox(),n=e.getBoundingBox(),o=i.min,s=i.max,a=n.min,r=n.max;(s.x-o.x<r.x-a.x||s.z-o.z<r.z-a.z)&&(t=e)}else t=e;return t}var i=null;if(t instanceof Array){for(var n=0;n<t.length;n++){var o=t[n];o instanceof mono.Entity&&(i=e(i,o))}for(var n=0;n<t.length;n++){var o=t[n];o instanceof mono.Entity&&i!=o&&t[n].setParent(i)}}else i=t;return i&&i.setClient("main",!0),i},createCube:function(t){var e,i=t.width,n=t.height,o=t.depth,s=t.color,a=(t.position||[0,0,0],t.rotation||[0,0,0]),r=t.rotationAnchor,h=t.topColor||s,l=t.repeatX||1,c=t.repeatY||1,d=t.image,u=t.frontImage,_=t.wrapMode;if(e=t.objectId?new mono.Cube({id:t.objectId,width:i,height:n,depth:o}):new mono.Cube(i,n,o),s&&e.s({"m.color":s,"m.ambient":s}),h&&e.s({"top.m.color":h,"top.m.ambient":h,"bottom.m.color":h,"bottom.m.ambient":h}),d&&e.s({"m.texture.image":d,"m.texture.repeat":new mono.Vec2(l,c),"m.texture.anisotropy":15}),u&&e.setStyle("front.m.texture.image",u),_&&e.setWrapMode(_),r){var g,f;"left"===r&&(g=new mono.Vec3(i/2,0,0),f=new mono.Vec3(0,1,0)),"right"===r&&(g=new mono.Vec3(-i/2,0,0),f=new mono.Vec3(0,1,0)),e.rotateFromAxis(f.clone(),g.clone(),a[1])}else e.setRotation(a[0]/180*Math.PI,a[1]/180*Math.PI,a[2]/180*Math.PI);return Bs.Default.setObject3dCSProps(e,t),e},createCylinder:function(t){var e=t.radius,i=t.topRadius||e,n=t.bottomRadius||e,o=t.height,s=t.color,a=t.image,r=new mono.Cylinder(i,n,o);return r.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":s,"m.ambient":s,"side.m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),a&&r.setStyle("m.texture.image",a),r},createSphere:function(t){var e=t.radius,i=t.color||"#F5F5F5",n=t.image,o=new mono.Sphere(e);return o.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":i,"m.ambient":i,"m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),n&&o.setStyle("m.texture.image",n),o},createPolygon:function(t){var e=t.radius||100,i=t.topRadius||e,n=t.bottomRadius||e,o=t.height||200,s=t.radialSegments||3,a=t.color||"#F5F5F5",r=t.topColor||a,h=t.smooth||!0,l=t.image,c=new mono.Cylinder(i,n,o,s,h);return c.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":a,"m.ambient":a,"top.m.color":r,"top.m.ambient":r,"bottom.m.color":r,"bottom.m.ambient":r,"side.m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),l&&c.setStyle("m.texture.image",l),c},createTorus:function(t){var e=t.radius||50,i=t.tube||30,n=t.tubularSegments||3,o=t.radialSegments||6,s=t.color||"#F5F5F5",a=t.image,r=new mono.Torus(e,i,n,o);return r.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":s,"m.ambient":s,"m.lightmap.image":this.getImagePath("outside_lightmap.jpg")}),a&&r.setStyle("m.texture.image",a),r},createBillboard:function(t){var e=t.position||[0,0,0],i=t.scale||[1,1,1],n=t.image||this.getImagePath("outside_lightmap.jpg"),o=new mono.Billboard;return o.s({"m.texture.image":n,"m.alignment":mono.BillboardAlignment.bottomCenter,"m.depthTest":!1}),o.setScale(i[0],i[1],i[2]),o.p(e[0],e[1],e[2]),o},createPathNodePath:function(t){var e;if(t[0]&&t[0]instanceof Array)for(var i=0;i<t.length;i++){var n=t[i];e?"c"===n[0]?e.quadraticCurveTo(n[1],n[2],n[3],n[4],n[5],n[6]):e.lineTo(n[0],0,n[1]):(e=new mono.Path,e.moveTo(n[0],0,n[1]))}else for(var i=0;i<t.length;i+=2)e?e.lineTo(t[i],0,t[i+1]):(e=new mono.Path,e.moveTo(t[i],0,t[i+1]));return e},createPathNode:function(t){var e,i=t.radius,n=t.pathImage,o=t.repeat||50,s=t.offset||new mono.Vec2(0,0),a=t.startCap||"plain",r=t.endCap||"plain",h=t.pathWidth,l=t.pathHeight,c=h/2,d=l/2,u=[{x:c,y:-d},{x:c,y:d},{x:-c,y:d},{x:-c,y:-d}],_=this.createPathNodePath(t.data),g=_.getLength();return h&&l?e=new mono.PathNode({path:_,shape:u,segments:10,segmentsR:5}):(_=mono.PathNode.prototype.adjustPath(_,i,2),e=new mono.PathNode({path:_,radius:i})),e.s({"m.texture.image":n,"m.texture.repeat":new mono.Vec2(g/o,1),"m.texture.offset":s}),a&&e.setStartCap(a),r&&e.setEndCap(r),Bs.Default.setObject3dCSProps(e,t),e},createShapeNodePath:function(t){var e;if(t[0]&&t[0]instanceof Array)for(var i=0;i<t.length;i++){var n=t[i];e?"c"===n[0]?e.quadraticCurveTo(n[1],-n[2],0,n[3],-n[4],0):e.lineTo(n[0],-n[1],0):(e=new mono.Path,e.moveTo(n[0],-n[1],0))}else for(var i=0;i<t.length;i+=2)e?e.lineTo(t[i],-t[i+1],0):(e=new mono.Path,e.moveTo(t[i],-t[i+1],0));return e},createShapeNode:function(t){var i=t.repeat||100,n=t.amount||2,o=!0;(null!==t.vertical||t.vertical!=e)&&(o=t.vertical);var s,a=this.createShapeNodePath(t.data);return s=new mono.ShapeNode(t.id?{id:t.id,path:a}:a),t.curveSegments&&s.setCurveSegments(t.curveSegments),s.setAmount(n),s.setVertical(o),s.setRepeat(i),s},createPathCube:function(t){var e=t.width,i=t.height,n=t.data,o=t.insideColor,s=t.outsideColor,a=t.asideColor,r=t.zsideColor,h=t.topColor,l=t.bottomColor,c=t.insideImage||t.image,d=t.outsideImage||t.image,u=t.insideMap,_=t.outsideMap,g=t.repeat||t.height,f=t.closed,v=this.createShapeNodePath(n);f&&v.closePath();var m=new mono.PathCube(v,e,i);return m.s({"outside.m.color":s,"inside.m.type":"basic","inside.m.color":o,"aside.m.color":a||s,"zside.m.color":r||s,"top.m.color":h,"bottom.m.color":l||h,"inside.m.lightmap.image":u,"outside.m.lightmap.image":_,"aside.m.lightmap.image":_,"zside.m.lightmap.image":_,"inside.m.texture.image":c,"outside.m.texture.image":d}),m.setRepeat(g),m},getPicInfo:function(t,e){var i={};"string"==typeof e&&(e=[e]);for(var n=0;n<e.length;n++){var o=e[n],s=o.substring(0,o.indexOf(".")).toLowerCase();o=t+o,i[s]=o}return i},getRByD:function(t){return t*Math.PI/180},getDByR:function(t){return 180*t/Math.PI},getRsByDs:function(t){var e;if(t&&t.length>0){e=[];for(var i=0;i<t.length;i++)e.push(Bs.Default.getRByD(t[i]))}return e},setObject3dCSProps:function(t,e){e.client&&t.c(e.client),e.style&&t.s(e.style)},setObject3dCommonProps:function(t,e){var i=Bs.Default.getRsByDs(e.rotation)||[0,0,0],n=e.scale||[1,1,1],o=e.position||[0,0,0];t.setRotation(i[0],i[1],i[2]),t.setScale(n[0],n[1],n[2]),t.setPosition(o[0],0,o[2]),Bs.Default.setPositionY(t,o[1]),Bs.Default.setObject3dCSProps(t,e)},cloneObjElement:function(t,e){var i=Bs.Default.getRsByDs(t.rotation)||[0,0,0],n=t.scale||[1,1,1],o=t.position||[0,0,0];o[1]=parseFloat(o[1])||0;var s=this._objObject[t.name],a=s.getBoundingBoxWithChildren(),r=(a.max.y-a.min.y)/2,h=s.clonePrefab();if(t._id&&(h._id=t._id),t.client)for(var l in t.client)h.setClient(l,t.client[l]);return t.s&&h.s(t.s),h.setClient("type",t.name),h.setClient("showShadow",t.showShadow),t.showShadow&&h.setClient("shadowImage",t.shadowImage),t.shadowType&&h.setClient("shadowType",t.shadowType),"function"==typeof t.interepter&&t.interepter.call(this,h),h.setClient("json",t),h.setScale(n[0],n[1],n[2]),h.setPosition(o[0],o[1]+r*n[1],o[2]),h.setRotation(i[0],i[1],i[2]),e&&e(h),h},setDefaultEnvMap:function(t){var e=this.getEnvMap("envmap5");t.setStyle("m.envmap.image",e);var i=t.getDescendants();return i.forEach(function(t){t.setStyle("m.envmap.image",e)}),t},setShadowImage:function(t,e){t.setClient("shadowImage",e),Me.Util.registerImageByUrl(e,e)},createObj:function(t,e){var i=this;if(this._objObject[t.name]){var n=this.getOBjPath(t.path),o=t.shadowImage=n+t.name+"S.png";return this.cloneObjElement(t,e)}if(!this._objMap[t.name]){this._objMap[t.name]=[];{var n=this.getOBjPath(t.path),s=n+t.name+".obj",a=n+t.name+".mtl";t.scale||[1,1,1]}if(t.showShadow){var o=t.shadowImage=n+t.name+"S.png";Me.Util.registerImageByUrl(o,o)}var r=new mono.OBJMTLLoader;r.load(s,a,null,function(e){t.merged&&(e=mono.Utils.mergeElements(e.getDescendants())),i._objObject[t.name]=e,i._objMap[t.name].forEach(function(t){return i.cloneObjElement(t.json,t.callback)})})}this._objMap[t.name].push({json:t,callback:e})},getTextSize:function(t,e){var i=Ve.createElement("canvas"),n=i.getContext("2d"),o=t.split("\n"),s=0;n.font=e;for(var a=0;a<o.length;a++){var r=o[a],h=n.measureText(r).width;h>s&&(s=h)}var l=n.measureText("e").width*o.length*3+4,c={w:s,h:l};return c},generateTextCanvas:function(t,e,i,n,o){var s=Ve.createElement("canvas"),i=i||"bold 80px 微软雅黑,sans-serif",a=s.getContext("2d"),r=t.split("\n"),h=Bs.Default.getTextSize(t,i),l=h.w,c=h.h,d={width:l,height:c};s.height=mono.Utils.nextPowerOfTwo(h.h),s.width=mono.Utils.nextPowerOfTwo(h.w),n&&(a.save(),a.globalAlpha=1,a.fillStyle=o||"#FE642E",a.beginPath(),a.moveTo(0,0),a.lineTo(l,0),a.lineTo(l,c),a.lineTo(0,c),a.closePath(),a.fill()),a.restore(),a.fillStyle=e||"white",a.textBaseline="middle",a.textAlign="center",a.font=i,a.shadowColor="#585858",a.shadowBlur=25,a.shadowOffsetX=10,a.shadowOffsetY=10;for(var u=a.measureText("o").width,_=2.5*u,g=0;g<r.length;g++){var f=l/2,v=_*g+_/2+(s.height-d.height);a.fillText(r[g],f,v)}return s.drawRect=d,s},generateShadowNode:function(t,e){var i=null,n=t.getDescendants();if(n.forEach(function(t){t instanceof mono.Entity&&t.getClient("type")&&"floor"==t.getClient("type")&&(i=t)}),i){var o=i.getBoundingBox(),s=(o.max.z-o.min.z,o.max.x-o.min.x,t.getRotation());t.setRotation(0,0,0);var a=Bs.Default.createShadowImage(t,i,e);return i.setStyle("top.m.lightmap.image",a),i.invalidateTexture(),Bs.Default.canvas=Bs.Default.canvas||a,t.setRotation(s),i}},_getWorldRotation:function(t){var e=(new mono.Mat4).extractRotation(t.worldMatrix),i=new mono.Vec3;return i.setEulerFromRotationMatrix(e),i},createShadowImage:function(t,e,i){var n=e.getBoundingBox(),o=n.max.z-n.min.z,s=n.max.x-n.min.x,a=Math.max(2048,Math.max(s,o)),r=a/2048,h=Bs.Default.canvas||Ve.createElement("canvas"),l=mono.Utils.nextPowerOfTwo(s/r),c=mono.Utils.nextPowerOfTwo(o/r),d=s/l,u=o/c;h.width=l,h.height=c;var _=h.getContext("2d");_.clearRect(0,0,l,c),_.fillStyle="white",_.fillRect(0,0,l,c),_.beginPath();var g,f=t.getPosition(),v=t?t.getBoundingBox():null,m=-(v.max.x+v.min.x)/2-f.x,p=-(v.max.z+v.min.z)/2-f.z,y=t.getDescendants();if(y.forEach(function(t){return t.getClient&&"wallCombos"==t.getClient("id")?void(g=t):void 0}),g){var w=g.getClient("combos");w.forEach(function(t){if(t.getClient&&!t.getClient("resetPos")){var e=t.getPosition();t.p(e.x+parseFloat(f.x),e.y+parseFloat(f.y),e.z+parseFloat(f.z)),t.setClient("resetPos",!0)}y.push(t)})}var A;if(y.forEach(function(t){return t.getClient&&"columnCombos"==t.getClient("id")?void(A=t):void 0}),A){var w=A.getClient("combos");w.forEach(function(t){if(t.getClient&&!t.getClient("resetPos")){var e=t.getPosition();t.p(e.x+parseFloat(f.x),e.y+parseFloat(f.y),e.z+parseFloat(f.z)),t.setClient("resetPos",!0)}y.push(t)})}return y.push(t),y.forEach(function(t){var e=t.getWorldPosition(),n=l/2+e.x/d,o=c/2+e.z/u,a=Bs.Default._getWorldRotation(t),r=t.getClient("type");if("wall"==r||"inner_wall"==r||"glass_wall"==r){var h=t.getClient("data");if(_.save(),_.translate(n,o),_.beginPath(),h[0]&&h[0]instanceof Array){for(var g=0;g<h.length;g++)0==g?_.moveTo(h[g][0]/d+m/d,h[g][1]/u+p/u):_.lineTo(h[g][0]/d+m/d,h[g][1]/u+p/u);"wall"==r&&_.lineTo(h[0][0]/d+m/d,h[0][1]/u+p/u)}else{for(var g=0;g<h.length;g+=2)0==g?_.moveTo(h[g]/d+m/d,h[g+1]/u+p/u):_.lineTo(h[g]/d+m/d,h[g+1]/u+p/u);"wall"==r&&_.lineTo(h[0]/d+m/d,h[1]/u+p/u)}_.lineWidth=20/d,_.strokeStyle="#ccc",_.shadowColor="#000";var f=Math.min(parseInt(s/15),300);_.shadowBlur=parseInt(f/d),("inner_wall"==r||"glass_wall"==r)&&(_.translate(n,o),_.lineWidth=10/d,_.shadowBlur=parseInt(f/d)),_.shadowOffsetX=0,_.shadowOffsetY=0,_.stroke(),_.stroke(),parseInt(s/15)>200&&(_.stroke(),_.stroke()),_.restore()}var v=t.getClient("showShadow");i&&(v=v&&i(t));var y=t.getClient("shadowImage"),w=t.getClient("shadowType")||0,A=t.getClient("shadowRatio")||.99,x=t.getClient("shadowWeight")||2;if(v){var E=t.getBoundingBox(),T=E.size(),C=T.x/d*A,b=depth=T.z/u*A;if(a.y%(Math.PI/2)==0&&(C=T.x/u*A,b=depth=T.z/d*A),a.y%Math.PI==0&&(C=T.x/d*A,b=depth=T.z/u*A),1==w){var k=Math.min(T.x,T.z);C=k/d*A,b=depth=k/u*A,a.y%(Math.PI/2)==0&&(C=k/u*A,b=depth=k/d*A),a.y%Math.PI==0&&(C=k/d*A,b=depth=k/u*A)}if(y){a=t.getRotation();var S=Me.Util.getImageAsset(y);if(!S)return;_.save(),_.translate(n+m/d,o+p/u),_.rotate(-a.y);var I,L,P,R,D=.3*Math.max(C,depth);a.y%(Math.PI/2)==0&&(I=-C/2-D/2,L=-depth/2-D/2,P=C+D,R=depth+D),a.y%Math.PI==0&&(I=-C/2-D/2,L=-depth/2-D/2,P=C+D,R=depth+D),_.drawImage(S.getImage(),I,L,P,R),_.drawImage(S.getImage(),I,L,P,R),_.restore()}else if(0==w){_.save(),_.translate(n+m/d,o+p/u),_.rotate(-a.y),_.beginPath(),_.moveTo(-C/2,0),_.lineTo(C/2,0),_.lineWidth=b,_.strokeStyle="gray",_.shadowColor="#333";var M=Math.min(C,depth);_.shadowBlur=2*M,_.shadowOffsetX=0,_.shadowOffsetY=0,1==x?(_.shadowBlur=3*M,_.stroke()):2==x&&(_.stroke(),_.stroke()),_.restore()}else if(1==w){var n=n+m/d,o=o+p/u,O=t.getClient("shadowRadius");O?O/=u:O=Math.sqrt(C*C+depth*depth)/2,_.save(),_.beginPath(),_.arc(n,o,O,0,2*Math.PI,!1),_.fillStyle="gray",_.shadowColor="black",_.shadowBlur=2*O,_.shadowOffsetX=0,_.shadowOffsetY=0,1==x?(_.shadowBlur=3*O,_.fill()):2==x&&(_.fill(),_.fill()),_.restore()}}}),h},getRelativePosition:function(t,e){var i,n;i=(new mono.Mat4).getInverse(t.worldMatrix.clone()),n=(new mono.Mat4).multiplyMatrices(i,e.worldMatrix.clone());var o=main.position=(new mono.Vec3).getPositionFromMatrix(n);return o},getPathBoundingBox:function(t){var e={},i={centerPoint:{x:0,y:0},min:{x:0,y:0},max:{x:0,y:0},size:{x:0,y:0}};if(0==t.length)return i;var n,o,s,a;if(t[0]instanceof Array){n=t[0][0],o=t[0][0],s=-t[0][1],a=-t[0][1];for(var r=1;r<t.length;r++)n=Math.min(n,t[r][0]),o=Math.max(o,t[r][0]),s=Math.min(s,-t[r][1]),a=Math.max(a,-t[r][1])}else{if(t.length<2)return i;n=t[0],o=t[0],s=-t[1],a=-t[1];for(var r=2;r<t.length;r+=2)n=Math.min(n,t[r]),o=Math.max(o,t[r]),s=Math.min(s,-t[r+1]),a=Math.max(a,-t[r+1])}return e.centerPoint={x:(n+o)/2,y:(s+a)/2},e.min={x:n,y:s},e.max={x:o,y:a},e.size={x:o-n,y:a-s},e},setPositionY:function(t,e){if("number"==typeof e)t.setPositionY(e);else if(e==Bs.Default.positionFloor){var i=t.getBoundingBox().size();t.setPositionY(i.y/2)}},playAnimation:function(t,e,i){var n=e.split(":");if("move"===n[0]){var o=n[1],s=n[2],a=parseInt(n[3])||1e3,r=parseInt(n[4]),h=n[5];this.animateMove(t,o,s,a,r,h,i)}if("rotation"===n[0]){var l=n[1],c=n[2],a=parseInt(n[3])||1e3,r=parseInt(n[4]),h=n[5];this.animateRotate(t,l,c,a,r,h,i)}},animateMove:function(t,e,i,n,o,s,a){var r=t.getBoundingBox().size().multiply(t.getScale()),i=i||.8,h=new mono.Vec3(0,0,1),l=0;"right"===e&&(h=new mono.Vec3(1,0,0),l=r.x),"left"===e&&(h=new mono.Vec3(-1,0,0),l=r.x),"top"===e&&(h=new mono.Vec3(0,1,0),l=r.y),"bottom"===e&&(h=new mono.Vec3(0,-1,0),l=r.y),"front"===e&&(h=new mono.Vec3(0,0,1),l=r.z),"back"===e&&(h=new mono.Vec3(0,0,-1),l=r.z),l*=i,t.getClient("animated")&&(h=h.negate());var c=t.getPosition().clone();t.setClient("animated",!t.getClient("animated")),new Me.Animate({from:0,to:1,dur:n,easing:s,delay:o,onUpdate:function(e){t.setPosition(c.clone().add(h.clone().multiplyScalar(l*e)))},onDone:function(){a&&a()}}).play()},animateRotate:function(t,i,n,o,s,a,r){a=a||"easeInStrong";var h=t.getBoundingBox().size().multiply(t.getScale()),l=0,c=1;t.getClient("animated")&&(c=-1),t.setClient("animated",!t.getClient("animated"));var d,u;if("left"===i){d=new mono.Vec3(-h.x/2,0,0);var u=new mono.Vec3(0,1,0)}if("right"===i){d=new mono.Vec3(h.x/2,0,0);var u=new mono.Vec3(0,1,0)}if("center-z"===i){d=new mono.Vec3(0,0,0);var u=new mono.Vec3(0,0,1)}var _=new Me.Animate({from:l,to:c,dur:o,delay:s,easing:a,onUpdate:function(i){this.lastValue===e&&(this.lastValue=0),t.rotateFromAxis(u.clone(),d.clone(),Math.PI/180*-n*(i-this.lastValue)),this.lastValue=i},onDone:function(){delete this.lastValue,r&&r()}});_.play()},animateCameraPosition:function(t,e,i,n){var o=t.getPosition(),s=new Me.Animate({from:0,to:1,dur:i,easing:"easeBoth",onUpdate:function(i){var n=o.x+(e.x-o.x)*i,s=o.y+(e.y-o.y)*i,a=o.z+(e.z-o.z)*i,r=new mono.Vec3(n,s,a);t.setPosition(r)}});return s.onDone=n,s}};for(var mi in Bs.Utils3D)Bs.Default[mi]=Bs.Utils3D[mi];Bs.Default.register("twaver.cube",function(t,e){t.image&&t.image.indexOf("http")<0&&(t.image=Bs.Default.path+t.image);var i=Bs.Default.createCube(t);return 0==t.visible&&i.setStyle("m.visible",!1),Bs.Default.setObject3dCommonProps(i,t),e&&e(i),i},{category:"基本模型",type:"mono.Element",name:"立方体",icon:"model/idc/icons/cube.png",description:"立方体是make里面提供的最基本的模型，可以用这种模型扩展出各种立方体形状的模型，比如箱子，柱子，盒子等。支持更改长，宽，高，贴图等基本参数",modelDefaultParameters:{width:{name:"宽",value:100,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:100,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},depth:{name:"深",value:100,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"white",type:Bs.Default.PARAMETER_TYPE_COLOR,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:e,type:Bs.Default.PARAMETER_TYPE_IMAGE,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),Bs.Default.register("twaver.cylinder",function(t,e){var i=Bs.Default.createCylinder(t),n=t.position||[0,0,0];return i.p(n[0],0,n[2]),Bs.Default.setPositionY(i,n[1]),e&&e(i),i},{category:"基本模型",type:"mono.Element",name:"圆柱体",icon:"model/idc/icons/cylinder.png",description:"圆柱体是make中提供的最基本模型，支持更改半径，高度的参数。可以更改这些参数扩展出各个圆柱体形状的模型，比如圆形柱子，桌子腿，瓶子，圆筒等",modelDefaultParameters:{topRadius:{name:"顶半径",value:60,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},bottomRadius:{name:"底半径",value:60,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:100,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"white",type:Bs.Default.PARAMETER_TYPE_COLOR,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:e,type:Bs.Default.PARAMETER_TYPE_IMAGE,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),Bs.Default.register("twaver.sphere",function(t,e){var i=Bs.Default.createSphere(t),n=t.position||[0,0,0];return i.p(n[0],0,n[2]),i.setClient("showShadow",!0),i.setClient("shadowType",1),i.setClient("shadowRatio",.3),Bs.Default.setPositionY(i,n[1]),e&&e(i),i},{category:"基本模型",type:"mono.Element",name:"球体",icon:"model/idc/icons/sphere.png",description:"球体是make中提供的最基本模型，支持更改半径的参数。可以更改这些参数扩展出各个球体形状的模型，比如圆球等",modelDefaultParameters:{radius:{name:"半径",value:80,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"#F5F5F5",type:Bs.Default.PARAMETER_TYPE_COLOR,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:e,type:Bs.Default.PARAMETER_TYPE_IMAGE,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),Bs.Default.register("twaver.polygon",function(t,e){var i=Bs.Default.createPolygon(t),n=t.position||[0,0,0];return i.p(n[0],0,n[2]),Bs.Default.setPositionY(i,n[1]),e&&e(i),i},{category:"基本模型",type:"mono.Element",name:"多边形",icon:"model/idc/icons/polygon.png",description:"多边形是make中提供的最基本模型，支持更改半径，高度，边数的参数。可以更改这些参数扩展出各个多边形状的模型，比如多边形柱子，多边形箱子，各种支架等",modelDefaultParameters:{color:{name:"颜色",value:"white",type:Bs.Default.PARAMETER_TYPE_COLOR,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:e,type:Bs.Default.PARAMETER_TYPE_IMAGE,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},topRadius:{name:"顶半径",value:100,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},bottomRadius:{name:"底半径",value:100,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:200,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},radialSegments:{name:"边数",value:3,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),Bs.Default.register("twaver.torus",function(t,e){var i=Bs.Default.createTorus(t),n=t.position||[0,0,0];return i.p(n[0],0,n[2]),Bs.Default.setPositionY(i,n[1]),e&&e(i),i},{category:"基本模型",type:"mono.Element",name:"圆环",icon:"model/idc/icons/torus.png",description:"圆环体是make中提供的最基本模型，支持更改半径，高度，扁平程度，管半径的参数。可以更改这些参数扩展出各个圆环体形状的模型，比如轮胎等",modelDefaultParameters:{color:{name:"颜色",value:"white",type:Bs.Default.PARAMETER_TYPE_COLOR,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:e,type:Bs.Default.PARAMETER_TYPE_IMAGE,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},radius:{name:"半径",value:50,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},tube:{name:"内外径差",value:30,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},tubularSegments:{name:"扁平程度",value:3,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},radialSegments:{name:"边数",value:6,type:Bs.Default.PARAMETER_TYPE_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Bs.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Bs.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}});var Us=0;Bs.Default.register("twaver.combo",function(t,e){var i="pack_"+Us++,n=t.data;if(n&&mono.Utils.isArray(n)){for(var o=null,s=null,a=[],r=[],h=0;h<n.length;h++){if(s=Bs.Default.load(n[h]),o){var l=s.getClient("type");"inner_wall"==l||"glass_wall"==l?(a.push(s),s.getChildren().size()>0&&s.getChildren().forEachReverse(function(t){t.setParent(o)})):"column"==l?r.push(s):s.setParent(o)}else o=s;s.setClient?s.setClient("pack",i):(s.client=s.client||{},s.client.pack=i)}if(a&&a.length>0){var c=new mono.ComboNode(a);c.setClient("id","wallCombos"),c.setClient("combos",c.getCombos()),c.setParent(o)}if(r&&r.length>0){var c=new mono.ComboNode(r);c.setClient("id","columnCombos"),c.setClient("combos",c.getCombos()),c.setParent(o)}return e&&e(o),o}},{icon:"model/idc/icons/combo.png",category:"基本模型",type:"mono.Element",name:"组合模型",description:"组合模型，可以把多个不同的模型组合在一块，组成一个新的模型，传如参数是一个数组"}),Bs.Default.registerObj=function(t,e,i,n,o,s,a){n=n||{},n.async=!0;var r=function(t,r){return t.name=e,t.path=i,t.showShadow=o,s&&(t.shadowType=s),t.merged=a,null==t.merged&&(t.merged=!0),t.interepter=n.interepter,Bs.Default.createObj(t,r)};Bs.Default.register(t,r,n)},Bs.Default.register("twaver.loader",function(t,e){return Bs.Default.load(t.data,e)}),Bs.Utils3D.getRectOfPoints=function(t){if(!t||t.length/2<2)return null;var e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,s=0,a=t.length,r=[],h=function(t,s){n=Math.min(n,t),o=Math.max(o,t),e=Math.min(e,s),i=Math.max(i,s),r.push({x:t,y:s})};if(a>0&&t[s]instanceof Array)for(;a>s;s++){var l=t[s];2==l.length?h(l[0],l[1]):5==l.length&&"c"==l[0]&&h(l[3],l[4])}else for(;a>s;s+=2)h(t[s],t[s+1]);return{min:{x:n,y:e},max:{x:o,y:i},center:function(){return{x:(this.min.x+this.max.x)/2,y:(this.min.y+this.max.y)/2}},width:o-n,height:i-e,points:r}}}(this);