!function(a){var b,c;if("function"==typeof define&&define.amd)define(["leaflet","proj4"],a);else if("undefined"!=typeof module)b=require("leaflet"),c=require("proj4"),module.exports=a(b,c);else{if("undefined"==typeof window.L||"undefined"==typeof window.proj4)throw"Leaflet and proj4 must be loaded first";a(window.L,window.proj4)}}(function(a,b){return"undefined"==typeof a&&(a=window.L),a.Proj={},a.Proj._isProj4Obj=function(a){return"undefined"!=typeof a.inverse&&"undefined"!=typeof a.forward},a.Proj.ScaleDependantTransformation=function(a){this.scaleTransforms=a},a.Proj.ScaleDependantTransformation.prototype.transform=function(a,b){return this.scaleTransforms[b].transform(a,b)},a.Proj.ScaleDependantTransformation.prototype.untransform=function(a,b){return this.scaleTransforms[b].untransform(a,b)},a.Proj.Projection=a.Class.extend({initialize:function(c,d){if(a.Proj._isProj4Obj(c))this._proj=c;else{var e=this._code=c;if(d)b.defs(e,d);else if(void 0===b.defs[e]){var f=e.split(":");if(f.length>3&&(e=f[f.length-3]+":"+f[f.length-1]),void 0===b.defs[e])throw"No projection definition for code "+e}this._proj=b(e)}},project:function(b){if("EPSG:3857"===this._code){var c=this.forwardMercatorX(b.lng),d=this.forwardMercatorY(b.lat);return new a.Point(c,d)}var e=this._proj.forward([b.lng,b.lat]);return new a.Point(e[0],e[1])},unproject:function(b,c){if("EPSG:3857"===this._code){var d=this.inverseMercatorLon(b.x),e=this.inverseMercatorLat(b.y);return new a.LatLng(e,d,c)}var f=this._proj.inverse([b.x,b.y]);return new a.LatLng(f[1],f[0],c)},forwardMercatorX:function(a){return 20037508.34*a/180},forwardMercatorY:function(a){var b=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return b=20037508.34*b/180},inverseMercatorLon:function(a){return a/20037508.34*180},inverseMercatorLat:function(a){var b=a/20037508.34*180;return b=180/Math.PI*(2*Math.atan(Math.exp(b*Math.PI/180))-Math.PI/2)}}),a.Proj.CRS=a.Class.extend({includes:a.CRS,options:{transformation:new a.Transformation(1,0,-1,0)},initialize:function(b,c,d){var e,f,g,h;if(a.Proj._isProj4Obj(b)?(f=b,e=f.srsCode,h=c||{},this.projection=new a.Proj.Projection(f)):(e=b,g=c,h=d||{},this.projection=new a.Proj.Projection(e,g)),this.projection.bounds=h.bounds,a.Util.setOptions(this,h),this.code=e,this.transformation=this.options.transformation,this.options.origin&&(this.transformation=new a.Transformation(1,-this.options.origin[0],-1,this.options.origin[1])),this.options.scales)this._scales=this.options.scales;else if(this.options.resolutions){this._scales=[];for(var i=this.options.resolutions.length-1;i>=0;i--)this.options.resolutions[i]&&(this._scales[i]=1/this.options.resolutions[i])}},scale:function(a){return this._scales[a]},getSize:function(b){var c,d,e,f=this.options.bounds;return f?(c=this.scale(b),d=this.transformation.transform(f.min,c),e=this.transformation.transform(f.max,c),a.point(Math.abs(e.x-d.x),Math.abs(e.y-d.y))):(c=256*Math.pow(2,b),a.point(c,c))}}),a.Proj.CRS.TMS=a.Proj.CRS.extend({options:{tileSize:256},initialize:function(b,c,d,e){var f,g,h,i,j;a.Proj._isProj4Obj(b)?(h=b,i=c,j=d||{},j.origin=[i[0],i[3]],a.Proj.CRS.prototype.initialize.call(this,h,j)):(f=b,g=c,i=d,j=e||{},j.origin=[i[0],i[3]],a.Proj.CRS.prototype.initialize.call(this,f,g,j)),this.projectedBounds=i,this._sizes=this._calculateSizes()},_calculateSizes:function(){var b,c,d=[],e=this.projectedBounds;for(c=this._scales.length-1;c>=0;c--)this._scales[c]&&(b=this.options.tileSize/this._scales[c],d[c]=a.point((e[2]-e[0])*this._scales[c],Math.ceil((e[3]-e[1])/b)*b*this._scales[c]));return d},getSize:function(a){return this._sizes[a]}}),a.Proj.TileLayer={},a.Proj.TileLayer.TMS=a.TileLayer.extend({options:{continuousWorld:!0},initialize:function(b,c,d){var e,f,g,h,i=!0;if(!(c instanceof a.Proj.CRS.TMS))throw"CRS is not L.Proj.CRS.TMS.";for(a.TileLayer.prototype.initialize.call(this,b,d),this.options.tms=!1,this.crs=c,g=this.crs.projectedBounds,h=this.options.minZoom;h<this.options.maxZoom&&i;h++){var j=(g[3]-g[1])/this._projectedTileSize(h);i=Math.abs(j-Math.round(j))>.001}if(!i){for(e={},h=this.options.minZoom;h<this.options.maxZoom;h++)f=g[1]+Math.ceil((g[3]-g[1])/this._projectedTileSize(h))*this._projectedTileSize(h),e[this.crs.scale(h)]=new a.Transformation(1,-g[0],-1,f);this.crs=new a.Proj.CRS.TMS(this.crs.projection._proj,g,this.crs.options),this.crs.transformation=new a.Proj.ScaleDependantTransformation(e)}},getTileUrl:function(b){var c=this._map.getZoom(),d=Math.ceil((this.crs.projectedBounds[3]-this.crs.projectedBounds[1])/this._projectedTileSize(c));return a.Util.template(this._url,a.Util.extend({s:this._getSubdomain(b),z:this._getZoomForUrl(),x:b.x,y:d-b.y-1},this.options))},_projectedTileSize:function(a){return this.options.tileSize/this.crs.scale(a)}}),a.Proj.GeoJSON=a.GeoJSON.extend({initialize:function(b,c){var d;if(b.crs&&"name"===b.crs.type)d=new a.Proj.CRS(b.crs.properties.name);else{if(!b.crs||!b.crs.type)throw"GeoJSON should have CRS defined.";d=new a.Proj.CRS(b.crs.type+":"+b.crs.properties.code)}void 0!==d&&(c=c||{},c.coordsToLatLng=function(b){var c=a.point(b[0],b[1]);return d.projection.unproject(c)}),a.GeoJSON.prototype.initialize.call(this,b,c)}}),a.Proj.geoJson=function(b,c){return new a.Proj.GeoJSON(b,c)},"undefined"!=typeof a.CRS&&(a.CRS.proj4js=function(){return function(b,c,d,e){return e=e||{},d&&(e.transformation=d),new a.Proj.CRS(b,c,e)}}()),a.Proj});
/*!最后修改于： 2015-12-08 */