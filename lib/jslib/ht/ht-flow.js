!function(v){"use strict";var I="ht",f=v[I],L=f.Default,j=Math,O=j.PI,X=2*O,n=j.sin,A=j.cos,R=j.atan2,m=j.sqrt,M=j.max,Q=j.floor,J=(j.round,j.ceil),H=j.abs,t=f.Shape,u=f.Edge,G=f.List,D=f.Style,T=f.graph,Y=L.getInternal(),E=Y.ui(),o=null,c="__segmentLengths",S="__lineTotalLength",$="__linePoints",V="__distance0",w="flow.count",z="flow.step",a="flow.element.max",K="flow.element.count",B="flow.element.min",C="flow.element.space",q="flow.element.autorotate",d="flow.element.background",g="flow.element.shadow.max",Z="flow.element.shadow.min",k="flow.element.shadow.begincolor",r="flow.element.shadow.endcolor",y="flow.element.shadow.visible",N="flow.element.image",F="flow",x="prototype",l=function(T){return document.createElement(T)},W=function(l){for(var c=0,w=l.length-1,j=0;w>j;j++){var D=l[j],K=l[j+1],R=K.x-D.x,B=K.y-D.y,W=m(R*R+B*B);c+=W}return c},p=function(S,k){for(var Z=0,C=0,g=0,l=S.length-1,v=0;l>v;v++){var r=S[v],i=S[v+1],F=i.x-r.x,w=i.y-r.y;if(g=m(F*F+w*w),Z+=g,Z>k){Z-=g,C=v;break}}var D=S[C],j=S[C+1],L=R(j.y-D.y,j.x-D.x),H=k-Z,w=n(L)*H,F=A(L)*H;return{x:D.x+F,y:D.y+w}},s=function(x,D,C,U){var r=A(U),S=n(U),d=r*D-S*C,I=S*D+r*C;return x?{x:x.x+d,y:x.y+I}:{x:d,y:I}},e=function(r,F){r[c]=r[S]=r[$]=F[V]=o},h=function(C,r,F,I,L,u){var E,P,e,V,B,l,q,h,N,R,Q,D=[];if(H(I)>X&&(I=X),B=J(H(I)/(O/4)),E=I/B,P=-E,e=-F,B>0){l=C+A(F)*L,q=r+n(-F)*u,D.push({x:l,y:q});for(var U=0;B>U;U++)e+=P,V=e-P/2,h=C+A(e)*L,N=r+n(e)*u,R=C+A(V)*(L/A(P/2)),Q=r+n(V)*(u/A(P/2)),D.push({x:R,y:Q}),D.push({x:h,y:N})}return D},i=function(D){var y,N,j=D._data;if(j instanceof t){if(y=j.getPoints(),N=j.getSegments(),(!N||0===N.size())&&y){N=new f.List([1]);for(var H=1;H<y.size();H++)N.add(2)}}else if(j instanceof u){var O=D._78o;if(O){var T=O.type,e=O.points,o=O.segments,K=O._4O;if(!T||e){var w=O._69o,U=w.x,R=w.y,r=O._70o,P=r.x,A=r.y;if(T)o?(y=new G({x:U,y:R}),y.addAll(e),y.add({x:P,y:A}),N=new G(o._as)):(y=new G({x:U,y:R}),N=new G([1]),e.each(function(t){y.add(t),N.add(2)}),y.add({x:P,y:A}),N.add(2));else if(O.looped){y=new G(h(U,R,0,X,O.radius,O.radius)),N=new G([1]);for(var H=0;H<(y.size()-1)/2;H++)N.add(3)}else y=new G,O.center?(y.add({x:O.c1.x,y:O.c1.y}),y.add({x:U,y:R}),y.add({x:P,y:A}),y.add({x:O.c2.x,y:O.c2.y}),N=new G([1,2,2,2])):(y.add({x:U,y:R}),y.add({x:P,y:A}),N=new G([1,2]))}else if(K)if(y=new G(K.points._as),K.segments)N=new G(K.segments._as);else{N=new G([1]);for(var H=1;H<K.points.size();H++)N.add(2)}}}if(y&&N){for(var I=Y.toPointsArray(y._as,N._as,50),k=I.length,Q=[],H=0;k>H;H++){var J=I[H];J.length>1&&Q.push(I[H])}j.s("flow.reverse")&&(Q.reverse(),Q.forEach(function(p){p.reverse()}));for(var q=0,m=[],B=Q.length,H=0;B>H;H++){var J=Q[H],n=W(J);q+=n,m.push(n)}if(j[c]=m,j[S]=q,j[$]=Q,j instanceof u){var g=L.unionPoint(Q),V=g.x+g.width/2,l=g.y+g.height/2;j.$10e={x:V,y:l}}b(D,!0)}},b=function(W,N){var r=W._data,F=r[S],u=r.s(w),i=r.s(z),$=0,M=r[c],U=r.s(a),O=r.s(B),l=r.s(K),d=(U-O)/(l-1),m=[];if(M){if(1===l)m.push(U);else if(2===l)m.push(U),m.push(O);else{if(!(l>2))return;m.push(U);for(var k=l-2;k>0;k--)m.push(O+d*k);m.push(O)}var b=0,x=0;m.forEach(function(E){l-1>b&&(x+=r.getFlowElementSpace(E)),b++}),x+=(U+O)/2,$=(F-u*x+x)/u;var L=W[V];for(null==L&&(L=0),N||(L+=i);L>F+x;){var G=W._overCount;G?G++:G=1,G>=u&&(G=null),W._overCount=G,r.s("flow.autoreverse")?G?L-=$+x:(L=0,r.s("flow.reverse",!r.s("flow.reverse"))):L-=$+x}W[V]=L}},_=function(d){var P=d.data,u=this.dm();if(P&&"add"===d.kind){var y=u.$3e;y&&P.s(F)&&y.indexOf(P)<0&&y.push(P)}"clear"===d.kind&&(u.$3e=[])},U=function(A){var M=A.property,P=A.data,v=A.newValue,J=this.dm().$3e;if(J&&"s:flow"===M)if(v)J.indexOf(P)<0&&J.push(P);else for(var V=J.length,y=0;V>y;y++)if(J[y]===P){J.splice(y,1);break}},P=function(z,F){for(var y=0,x=F.length,l=0;x>l;l++){var b=F[l];if(y+=b,y>z)return l}return l},Wk=function(l){var O=this,n=O._data,E=n[S],j=n[c],U=n[$],M=n.s(w),I=0,f=O[V],y=n.s(a),F=n.s(B),u=n.s(K),N=n.s(Z),i=n.s(g),X=n.s(q),L=(i-N)/(u-1),v=(y-F)/(u-1),h=n.getRotation?n.getRotation():0,T=n.getPosition?n.p():n.$10e,D=[],z=[];if(f!=o){if(1===u)D.push(y);else if(2===u)D.push(y),D.push(F);else{if(!(u>2))return;D.push(y);for(var e=u-2;e>0;e--)D.push(F+v*e);D.push(F)}if(1===u)z.push(i);else if(2===u)z.push(i),z.push(N);else{if(!(u>2))return;z.push(i);for(var e=u-2;e>0;e--)z.push(N+L*e);z.push(N)}var Y=0,x=0;D.forEach(function(o){u-1>Y&&(x+=n.getFlowElementSpace(o)),Y++}),x+=(y+F)/2,I=(E-M*x+x)/M,l.save();for(var e=0;M>e;e++){var J=f,r=0,k=O._overCount,_=0;n.s("flow.autoreverse")&&k&&k>M-(e+1)||(J-=e*(I+x),Y=0,D.forEach(function(S){var V=J-r;if(V>=0&&E>V){var k=!0,t=P(V,j);_=0;for(var A=0;t>A;A++)_+=j[A];if(V-=_,k){var y=p(U[t],V),f=h;if(X){for(var G=U[t],M=0,u=0,v=0;v<G.length-1;v++){var N=G[v],Q=G[v+1],B=Q.x-N.x,o=Q.y-N.y,W=m(B*B+o*o);if(M+=W,M>V){u=v;break}}var C=G[u];f+=R(y.y-C.y,y.x-C.x)}h&&(y=s(T,y.x-T.x,y.y-T.y,h)),O.$5e(l,y,S,z[Y],f)}}r+=n.getFlowElementSpace(D[Y]),Y++}))}l.restore()}},Wm=T.GraphView[x],lb=f.Data[x],In=E.DataUI[x],vi=E.ShapeUI[x],lj=E.EdgeUI[x],di=f.DataModel[x],Km=vi._80o,qr=lj._80o,Gj=di.prepareRemove,es=lj._79o,kp=vi._79o,vf=Wm.setDataModel,ub=function(){var H=this,N=H._data,$=N.s(a),w=!1,h=o;if(H._6I||(w=!0),h=N instanceof u?es.call(H):kp.call(H),N.s(F)&&w){var D=N.s(g),k=N.s(y);k&&D>$&&($=D),$>0&&L.grow(h,J($/2)),i(H)}return!N.s(F)&&w&&e(N,H),h};lb.getFlowElementSpace=function(){return this.s(C)},vi._79o=ub,lj._79o=ub,D[a]==o&&(D[a]=7),D[B]==o&&(D[B]=0),D[w]==o&&(D[w]=1),D[z]==o&&(D[z]=3),D[K]==o&&(D[K]=10),D[C]==o&&(D[C]=3.5),D[q]==o&&(D[q]=!1),D[d]==o&&(D[d]="rgba(255, 255, 114, 0.4)"),D[k]==o&&(D[k]="rgba(255, 255, 0, 0.3)"),D[r]==o&&(D[r]="rgba(255, 255, 0, 0)"),D[y]==o&&(D[y]=1),D[g]==o&&(D[g]=22),D[Z]==o&&(D[Z]=4),di.prepareRemove=function(d){Gj.call(this,d);var m=d._dataModel,V=m.$3e;if(V)for(var C=V.length,e=0;C>e;e++)if(V[e]===d){V.splice(e,1);break}},Wm.setDataModel=function(X){var J=this,e=J._dataModel;if(e!==X){e&&(e.umm(_,J),e.umd(U,J),e.$3e=[]),X.mm(_,J),X.md(U,J);var O=X.$3e=[];X.each(function(V){V.s(F)&&O.indexOf(V)<0&&O.push(V)}),vf.call(J,X)}},Wm.setFlowInterval=function(W){var T=this,N=T.$11e;T.$11e=W,T.fp("flowInterval",N,W),T.$7e!=o&&(clearInterval(T.$7e),delete T.$7e,T.enableFlow(W))},Wm.getFlowInterval=function(){return this.$11e},Wm.$9e=function(){var t,V,o,n=this,q=n.tx(),u=n.ty(),g=n.getZoom(),c=n.getWidth(),$=n.getHeight(),v={x:-q/g,y:-u/g,width:c/g,height:$/g},Z=n.dm().$3e,r=n._56I,H=new G;if(Z.forEach(function(d){r[d.getId()]&&(t=n.getDataUI(d),t&&(o=t._79o(),o&&H.add(o)))}),0!==H.size()&&(H.each(function(x){L.intersectsRect(v,x)&&(V=L.unionRect(V,x))}),V&&(V&&(L.grow(V,M(1,1/g)),V.x=Q(V.x*g)/g,V.y=Q(V.y*g)/g,V.width=J(V.width*g)/g,V.height=J(V.height*g)/g,V=L.intersection(v,V)),V))){var x=n._canvas.getContext("2d");x.save(),x.lineCap=L.lineCap,x.lineJoin=L.lineJoin,Y.translateAndScale(x,q,u,g),x.beginPath(),x.rect(V.x,V.y,V.width,V.height),x.clip(),x.clearRect(V.x,V.y,V.width,V.height),n.$6e(x,V),x.restore()}},Wm.$6e=function(N,B){var U,x,S=this;S._93db(N),S.each(function(O){S._56I[O._id]&&(U=S.getDataUI(O),U&&(x=U._79o(),(!B||L.intersectsRect(B,x))&&U._42(N)))}),S._92db(N)},Wm.enableFlow=function(L){var g=this,C=g.dm(),B=C.$3e;g.$7e==o&&(B.forEach(function(O){var e=g.getDataUI(O);i(e)}),g.$7e=setInterval(function(){C.$3e.forEach(function(I){b(g.getDataUI(I))}),g.$9e()},L||g.$11e||50))},Wm.disableFlow=function(){var h=this;clearInterval(h.$7e),delete h.$7e;var k=h.dm().$3e;k&&h.$9e()},In.$5e=function(E,J,c,w,_){var q=this,u=q._data,C=q.gv,Q=u.s(d),b=u.s(k),t=u.s(r),U=u.s(y),H=C.$8e,a=u.s(N);if(H==o&&(H=C.$8e={}),E.beginPath(),a!=o){var S=L.getImage(a),T=c/2;E.translate(J.x,J.y),E.rotate(_),E.translate(-J.x,-J.y),L.drawImage(E,S,J.x-T,J.y-T,c,c,u),E.translate(J.x,J.y),E.rotate(-_),E.translate(-J.x,-J.y)}else E.fillStyle=Q,E.arc(J.x,J.y,c/2,0,X,!0),E.fill();if(U){var W=22,R=W+"_"+b+"_"+t,s=H[R];if(s==o){var n=l("canvas");Y.setCanvas(n,W,W);var j=n.getContext("2d"),i=W/2,x=i,h=i;Y.translateAndScale(j,0,0,1),j.beginPath();var G=j.createRadialGradient(x,h,0,x,x,i);G.addColorStop(0,b),G.addColorStop(1,t),j.fillStyle=G,j.arc(x,h,i,0,X,!0),j.fill(),s=H[R]=n}var T=w/2;L.drawImage(E,s,J.x-T,J.y-T,w,w,u)}},lj._80o=function(C){qr.call(this,C);var H=this,c=H._data,l=H.gv;c.s(F)&&l.$7e!=o&&Wk.call(H,C)},vi._80o=function(z){Km.call(this,z);var T=this,N=T._data,Y=T.gv;N.s(F)&&Y.$7e!=o&&Wk.call(T,z)}}(this,Object);