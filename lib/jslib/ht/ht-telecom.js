!function(b,$){"use strict";var T=ht.AlarmSeverity=function(E,n,y,g,B){this.value=E,this.name=n,this.nickName=y,this.color=g,this.displayName=B};ht.Default.def("ht.AlarmSeverity",$,{toString:function(){return this.displayName||this.name}}),function(){T.severities=new ht.List,T._vm={},T._nm={},T._cp=function(p,w){if(p&&w){var v=p.value-w.value;return v>0?1:0>v?-1:0}return p&&!w?1:!p&&w?-1:0},T.each=function(d,$){T.severities.each(d,$)},T.getSortFunction=function(){return T._cp},T.setSortFunction=function(W){T._cp=W,T.severities.sort(W)},T.add=function(P,f,i,E,z){var I=new T(P,f,i,E,z);return T._vm[P]=I,T._nm[f]=I,T.severities.add(I),T.severities.sort(T._cp),I},T.remove=function(C){var z=T._nm[C];return z&&(delete T._nm[C],delete T._vm[z.value],T.severities.remove(z)),z},T.CRITICAL=T.add(500,"Critical","C","#FF0000"),T.MAJOR=T.add(400,"Major","M","#FFA000"),T.MINOR=T.add(300,"Minor","m","#FFFF00"),T.WARNING=T.add(200,"Warning","W","#00FFFF"),T.INDETERMINATE=T.add(100,"Indeterminate","N","#C800FF"),T.CLEARED=T.add(0,"Cleared","R","#00FF00"),T.isClearedAlarmSeverity=function(S){return S?0===S.value:!1},T.getByName=function(g){return T._nm[g]},T.getByValue=function(P){return T._vm[P]},T.clear=function(){T.severities.clear(),T._vm={},T._nm={}},T.compare=function(S,m){return T._cp(S,m)}}();var u=ht.AlarmState=function(U){this._d=U,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",$,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var K=null;for(var w in this._am)w=T.getByName(w),T.isClearedAlarmSeverity(w)||0!==this.getAcknowledgedAlarmCount(w)&&(K=K?T.compare(K,w)>0?K:w:w);this._haa=K},_c2:function(){var r=null;for(var n in this._nm)n=T.getByName(n),T.isClearedAlarmSeverity(n)||0!==this.getNewAlarmCount(n)&&(r=r?T.compare(r,n)>0?r:n:n);this._hna=r},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var W in this._nm)if(W=T.getByName(W),!T.isClearedAlarmSeverity(W)&&0!==this.getNewAlarmCount(W)&&T.compare(this._hna,W)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var N=this._haa,M=this._hna,o=this._ps;this._hoa=N,T.compare(M,this._hoa)>0&&(this._hoa=M),T.compare(o,this._hoa)>0&&(this._hoa=o)},_c5:function(){var o=this._haa,A=this._hna;this._hta=o,T.compare(A,this._hta)>0&&(this._hta=A)},increaseAcknowledgedAlarm:function(n,M){if(0!==M){M=M||1;var G=this._am[n.name]||0;G+=M,this._am[n.name]=G,this._f()}},increaseNewAlarm:function(X,O){if(0!==O){O=O||1;var d=this._nm[X.name]||0;d+=O,this._nm[X.name]=d,this._f()}},decreaseAcknowledgedAlarm:function(F,w){if(0!==w){w||(w=1);var t=this._am[F.name]||0;if(t-=w,0>t)throw"Alarm count can not be negative";this._am[F.name]=t,this._f()}},decreaseNewAlarm:function(t,k){if(0!==k){k||(k=1);var J=this._nm[t.name]||0;if(J-=k,0>J)throw"Alarm count can not be negative";this._nm[t.name]=J,this._f()}},acknowledgeAlarm:function(S){this.decreaseNewAlarm(S,1),this.increaseAcknowledgedAlarm(S,1)},acknowledgeAllAlarms:function(W){if(W){var h=this.getNewAlarmCount(W);this.decreaseNewAlarm(W,h),this.increaseAcknowledgedAlarm(W,h)}else for(var Q in this._nm)this.acknowledgeAllAlarms(T.getByName(Q))},_c6:function(){this._aac=0;for(var q in this._am)q=T.getByName(q),this._aac+=this.getAcknowledgedAlarmCount(q)},getAcknowledgedAlarmCount:function(V){return V?this._am[V.name]||0:this._aac},getAlarmCount:function(u){return this.getAcknowledgedAlarmCount(u)+this.getNewAlarmCount(u)},_c7:function(){this._nac=0;for(var q in this._nm)this._nac+=this.getNewAlarmCount(T.getByName(q))},getNewAlarmCount:function(H){return H?this._nm[H.name]||0:this._nac},setNewAlarmCount:function(T,U){this._nm[T.name]=U,this._f()},removeAllNewAlarms:function(W){W?delete this._nm[W]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(p,u){this._am[p.name]=u,this._f()},removeAllAcknowledgedAlarms:function(F){F?delete this._am[F.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(z){if(this._ep||(z=null),this._ps!==z){var R=this._ps;this._ps=z,this._f(),this._d.fp("propagateSeverity",R,z)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(N){var K=this._ep;this._ep=N,this._d.fp("enablePropagation",K,N)&&(N||this.setPropagateSeverity(null))}});var m=ht.AlarmStatePropagator=function(L){this._dataModel=L,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",$,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(W){this._enable!==W&&(this._enable=W,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(w){this.propagate(w)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(g){g.data&&this.propagate(g.data)},handleDataPropertyChange:function($){if("alarmState"===$.property||"enablePropagation"===$.property)this.propagate($.data);else if("parent"===$.property){var j=$.oldValue;j&&this.propagate(j),this.propagate($.data)}},propagate:function(c){c&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(c),this._isPropagating=!1)},propagateToTop:function(m){for(this.propagateToParent(null,m);m&&m.getParent();)this.propagateToParent(m,m.getParent()),m=m.getParent()},propagateToParent:function(l,Y){var g=null;Y.getChildren().each(function(V){var Z=V.getAlarmState().getHighestOverallAlarmSeverity();T.compare(Z,g)>0&&(g=Z)}),Y.getAlarmState().setPropagateSeverity(g)}}),ht.AlarmStateStatistics=function(g){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(g)},ht.Default.def("ht.AlarmStateStatistics",$,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(l){var F=this._dataModel;F!==l&&(F&&(F.umd(this.handleDataPropertyChange,this),F.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=l,this.reset(),l.md(this.handleDataPropertyChange,this),l.mm(this.handleDataModelChange,this),this.fp("dataModel",F,l))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(X){"alarmState"===X.property&&(this.increase(X.data),this.fireAlarmStateChange())},handleDataModelChange:function(d){"add"===d.kind?(this.increase(d.data),this.fireAlarmStateChange()):"remove"===d.kind?(this.decrease(d.data),this.fireAlarmStateChange()):"clear"===d.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,T.each(function(f){var _=this.getSumInfo(f);this.sumAcked+=_.ackedCount,this.sumNew+=_.newCount,this.sumTotal+=_.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(u){if(!u)return this.sumNew;var j=this.getSumInfo(u);return j.newCount},getAcknowledgedAlarmCount:function(A){if(!A)return this.sumAcked;var o=this.getSumInfo(A);return o.ackedCount},getTotalAlarmCount:function(g){if(!g)return this.sumTotal;var q=this.getSumInfo(g);return q.totalCount},getSumInfo:function(y){var O=this.severtiyMap[y.name];return O||(O={},O.newCount=0,O.ackedCount=0,O.totalCount=0,this.severtiyMap[y.name]=O),O},decrease:function(w){var H=this.dataMap[w.getId()];H&&(delete this.dataMap[w.getId()],T.each(function(T){var S=H[T.name],P=this.getSumInfo(T);P.newCount=P.newCount-S.newCount,P.ackedCount=P.ackedCount-S.ackedCount,P.totalCount=P.totalCount-S.totalCount},this))},increase:function(S){if(this.decrease(S),!this._filterFunc||this._filterFunc(S)){var J={},q=S.getAlarmState();this.dataMap[S.getId()]=J,T.each(function(n){var F={};F.newCount=q.getNewAlarmCount(n),F.ackedCount=q.getAcknowledgedAlarmCount(n),F.totalCount=q.getAlarmCount(n),J[n.name]=F;var Y=this.getSumInfo(n);Y.newCount=Y.newCount+F.newCount,Y.ackedCount=Y.ackedCount+F.ackedCount,Y.totalCount=Y.totalCount+F.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(o){var v=this._filterFunc;this._filterFunc=o,this.reset(),this.firePropertyChange("filterFunc",v,o)},getFilterFunc:function(){return this._filterFunc}});var L=ht.Data.prototype;L.getAlarmState=function(){return this._alarmState||(this._alarmState=new u(this))},L=ht.DataModel.prototype,L.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},L.setEnableAlarmStatePropagator=function(N){N!=this.isEnableAlarmStatePropagator()&&(N?(this._alarmStatePropagator=new m(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},L=ht.graph.GraphView.prototype,L.getNote2=function(l){var U=l.getAlarmState().getHighestNewAlarmSeverity();if(U){var y=l.getAlarmState().getNewAlarmCount(U)+U.nickName;return l.getAlarmState().hasLessSevereNewAlarms()&&(y+="+"),y}return l.s("note2")},L.getNote2Background=function(H){var j=H.getAlarmState().getHighestNewAlarmSeverity();return j?j.color:H.s("note2.background")},L.getBodyColor=function(Z){var E=Z.getAlarmState().getHighestNativeAlarmSeverity();return E?E.color:Z.s("body.color")},L.getBorderColor=function(P){var r=P.getAlarmState().getPropagateSeverity();return r?r.color:P.s("border.color")},L=ht.widget.TreeView.prototype,L.getBorderColor=function(Y){var t=Y.getAlarmState().getPropagateSeverity();return t?t.color:Y.s("border.color")},L.getIcon=function(R){return R.getIcon()?"__alarmIcon__":null},L=ht.widget.TreeTableView.prototype,L.getBorderColor=function(U){var p=U.getAlarmState().getPropagateSeverity();return p?p.color:U.s("border.color")},L.getIcon=function(h){return h.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(W){return W.getIcon()}},color:{func:function(l){var S=l.getAlarmState().getHighestNativeAlarmSeverity();return S?S.color:l.s("body.color")}},rect:[0,0,16,16]}]});var B=ht.Style;B["note2.expanded"]=!0,B["note2.color"]="#000"}(this,Object);