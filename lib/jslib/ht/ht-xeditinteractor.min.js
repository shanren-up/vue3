!function(D,h,x){"use strict";var L="ht",m=D[L],w=m.Default,b=m.graph,F=w.getInternal(),U=F.ui(),Y=U.NodeUI.prototype,N=U.ShapeUI.prototype,C=b.GraphView,T=C.prototype,R=U.EdgeUI.prototype,d=m.Node,l=m.Shape,r=m.Edge,z=m.Group,J=w.isTouchable,k=w.preventDefault,Q=D.setTimeout,$=w.grow,c=w.isDragging,v=w.getDistance,X=null,i=m.List,K="undefined"!=typeof Float32Array?Float32Array:Array,y=Math,a=y.PI,f="Crossing",E="No Crossing",p=a/2,W=2*a,O=y.atan2,_=y.sqrt,M=y.pow,e=y.sin,s=y.cos,H=y.min,Z=y.max,n=y.abs,j=y.ceil,u=y.round,B=w.unionPoint,S=w.unionRect,I=w.containsPoint,V=w.clone,P="rgb(52, 152, 219)",q="red",A={northwest:0,north:1,northeast:2,west:7,east:3,southwest:6,south:5,southeast:4},o={width:400,height:100,comps:[{type:"shape",points:{func:function(){for(var W=[10,8,162,36,314,37,269,2,398,49,268,98,314,58,161,60,9,91,103,49,10,8],p=0;p<W.length;p++){var N=W[p];N=0===p%2?N/400*o.width:N/100*o.height,W[p]=N}return o.width>120&&(W[4]=o.width-26,W[6]=o.width-40,W[10]=o.width-40,W[12]=o.width-26,W[18]=33),W}},segments:[1,3,2,2,2,2,3,2,2],background:"white",gradient:"linear.east",gradientColor:"red"}]},t={width:300,height:300,comps:[{type:"circle",rect:[20,0,120,120],background:P,rotation:.61},{type:"circle",rect:[200,120,70,70],background:P,rotation:.61},{type:"circle",rect:[200,220,70,70],background:P,rotation:.61},{type:"shape",points:[80,60,80,155,200,155],borderWidth:20,borderColor:P},{type:"shape",points:[80,60,80,255,200,255],borderWidth:20,borderColor:P}]},g={width:300,height:300,comps:[{type:"shape",points:[114,239,115,106,112,73,149,73,149,73,175,73,177,105,179,261,178,302,147,307,98,308,83,307,72,276,73,260,72,81,74,29,115,21,191,21,221,22,224,53,223,238],segments:[1,2,3,2,3,2,3,2,4,2,3,2,3,2],borderWidth:20,borderColor:q,rotation:.61}]},G={width:300,height:300,comps:[{type:"circle",rect:[210,0,90,90],background:P},{type:"circle",rect:[0,210,90,90],background:P},{type:"shape",points:[255,45,45,255],borderWidth:20,borderColor:P}]},Qf={width:300,height:300,comps:[{type:"shape",points:[20,20,280,280],borderWidth:30,borderColor:q},{type:"shape",points:[280,20,20,280],borderWidth:30,borderColor:q}]},Rb={width:300,height:300,comps:[{type:"shape",points:[270,30,30,150,270,270],borderWidth:40,borderColor:P}]},pk={width:300,height:300,comps:[{type:"shape",points:[30,30,270,150,30,270],borderWidth:40,borderColor:q}]},Fh={width:300,height:300,comps:[{type:"rect",rect:[125.58,52.76,40,231.96],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[27.87,61.06,150,30],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000",rotation:5.5},{type:"rect",rect:[113.36,61,150,30],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000",rotation:.79}]},vo={width:300,height:300,author:"",note:"",comps:[{type:"rect",rect:[135.15,38.76,28.63,82.84],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"triangle",rect:[94.69,2.35,110,44.77],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[31.71,115.72,240,15],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[31.71,167.62,240,15],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[135.15,177.33,28.63,82.84],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"triangle",rect:[94.69,251.39,110,44.77],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000",rotation:3.14}]},cg=function(h){var v=h.touches[0];return v?v:h.changedTouches[0]},el=function(c,z,D,k){return O(k-z,D-c)},Ed=function(X,m){return{x:X.x*m,y:X.y*m}},ge=function(M,Q){var h,s,w,T,k=M._layers,U=M.sm().getSelection()._as,e=U.length;if(k)for(h=0;h<k.length;h++){T=k[h];for(var f=0;e>f;f++)if(s=U[f],s._layer===T&&(w=Q(s),w===!1))return}else for(h=0;e>h;h++)if(s=U[h],w=Q(s),w===!1)return},ai=function(N,T,m){var u,M,Q,Z,U,o=this,I=T,J=o.gv;if(N instanceof l){Q=N.getSegments();var G=J.getDataUI(N);U=G._55O.$15l,Q||(Q=Lp(U)),N.isClosePath()&&Q.indexOf(5)<0&&(Q=new i(Q._as),Q.add(5)),u=yf(N,G,I),M=U[u]}else{var z=J.getDataUI(N);U=Yd(z,N.s("edge.points")),Q=N.s("edge.segments"),Q||(Q=Lp(U)),U=U._as,u=yf(N,z,I),M=U[u]}if(Q&&(Z=Q.get(I)),2===Z||1===Z||5===Z){var k=U[u+1];5===Z&&(k=U[0]);var W=Xd(M,m,k);return W}return m},mg=function(Q,h){var z,r,U,n,o=Q._layers,R=Q.sm().getSelection()._as,W=R.length;if(o)for(z=o.length-1;z>=0;z--){n=o[z];for(var B=W-1;B>=0;B--)if(r=R[B],r._layer===n&&(U=h(r),U===!1))return}else for(z=W-1;z>=0;z--)if(r=R[z],U=h(r),U===!1)return},yd=function(k,h,S,c){var w=h/2,j=S/2,x=Ih(k,-w,-j,c),N=Ih(k,w,-j,c),o=Ih(k,-w,j,c),E=Ih(k,w,j,c),d=Ih(k,0,-j,c),Y=Ih(k,w,0,c),y=Ih(k,0,j,c),P=Ih(k,-w,0,c);return[x,N,o,E,d,Y,y,P]},Xd=function(y,n,m){var j={x:n.x-y.x,y:n.y-y.y},G={x:m.x-y.x,y:m.y-y.y},D=_(M(m.x-y.x,2)+M(m.y-y.y,2)),B={x:G.x/D,y:G.y/D},Q=j.x*B.x+j.y*B.y,e={x:B.x*Q,y:B.y*Q};return{x:y.x+e.x,y:y.y+e.y}},Ih=function(j,d,p,l){var y=s(l)*d-e(l)*p,T=e(l)*d+s(l)*p;return j?{x:j.x+y,y:j.y+T}:{x:y,y:T}},Km=function(h,x){return x>2*h?h:x/2},Wl=function(p,X,D,r){var Q=v(p,X);return D=r?H(D,Q):Km(D,Q),Q?D/=Q:D=0,{x:p.x+(X.x-p.x)*D,y:p.y+(X.y-p.y)*D}},Zd=function(A,L,w,S,Y){return L?(w=F.getPosition(w,F.getNodeRect(A,L)),w.x+=S||0,w.y+=Y||0,w):X},od=function(q,l){var C,Y,c=q.gv,G=q._data,J=G._40I,U=G._41I,X=G.s("edge.offset"),p=G.s("edge.source.position"),k=G.s("edge.target.position"),B=G.s("edge.source.offset.x"),s=G.s("edge.source.offset.y"),S=G.s("edge.target.offset.x"),j=G.s("edge.target.offset.y");if(l?(C=Zd(c,J,p,B,s),Y=Zd(c,U,k,S,j)):(C=Zd(c,J,p),Y=Zd(c,U,k)),"points"===G.s("edge.type")&&X&&!G.s("edge.center")&&C){var K=G.s("edge.points")||new i,D=K.size(),f=Wl(C,D?K.get(0):Y,X,D),r=Wl(Y,D?K.get(D-1):C,X,D);C=f,Y=r}return[C,Y]},Yd=function(n,G,z){var y=n._78o,C=n._data,Q=C.s("edge.type"),N=[y._69o,y._70o];return"points"===Q?z&&(N=od(n)):N=y.center?Q?z?od(n):od(n,!0):z?od(n):[y.c1,y.c2]:z?od(n):od(n,!0),G=new i(G?G._as:X),G.add(N[0],0),G.add(N[1]),G},Jk=function(s){return s=new i(s._as),s.removeAt(0),s.removeAt(s.size()-1),s},Lp=function(w){w._as||(w=new i(w));var t=new i;t.add(1);for(var c=1;c<w.size();c++)t.add(2);return t},Uq=function(M,W){return{x:(M.x+W.x)/2,y:(M.y+W.y)/2}},Un=function(R,u){return{x:R.x+1*(u.x-R.x)/4,y:R.y+1*(u.y-R.y)/4}},cn=function(o,F){return{x:o.x+3*(F.x-o.x)/4,y:o.y+3*(F.y-o.y)/4}},jh=function(g,W,w,X){var u=W.x+W.width/2,S=W.y+W.height/2,P=_(u*u+S*S),E=O(S,u)+w;return{x:X.x+P*s(E),y:X.y+P*e(E)}},Rc=T.validateImpl,Ug=T.isRectEditable,ss=T.isPointEditable,Vc=T._42,zf=N._79o,Hg=R._79o,xl=N._48O,qn=N._47O,$d=Y._48O,lh=Y._80o,Ur=N._80o,bq=Y._2o,Gf=Y._47O,Qo=R._47O,Xj=T.isEditable,rj=["northwest","north","northeast","east","southeast","south","southwest","west"],Dd=function(M,i,R,s,_,g,r,E,y,o){var S=M.x,I=M.y,m=M.width,t=M.height,d={x:S+m/2,y:I+t/2};s=s||0,i=Ih(d,i.x-d.x,i.y-d.y,-s),r&&!E&&(i.x+=y,i.y+=o);var f=.01;if("northwest"===R?(i.x+_>S+m-f&&(i.x=S+m-_-f),i.y+_>I+t-f&&(i.y=I+t-_-f),M=B(i,{x:S+m,y:I+t})):"north"===R?(i.y+_>I+t-f&&(i.y=I+t-_-f),M=B({x:S,y:i.y},{x:S+m,y:I+t})):"northeast"===R?(i.x<S+_+f&&(i.x=S+_+f),i.y+_>I+t-f&&(i.y=I+t-_-f),M=B({x:S,y:i.y},{x:i.x,y:I+t})):"west"===R?(i.x+_>S+m-f&&(i.x=S+m-_-f),M=B({x:i.x,y:I},{x:S+m,y:I+t})):"east"===R?(i.x<S+_+f&&(i.x=S+_+f),M=B({x:S,y:I},{x:i.x,y:I+t})):"southwest"===R?(i.x+_>S+m-f&&(i.x=S+m-_-f),i.y<I+_+f&&(i.y=I+_+f),M=B({x:i.x,y:I},{x:S+m,y:i.y})):"south"===R?(i.y<I+_+f&&(i.y=I+_+f),M=B({x:S,y:I},{x:S+m,y:i.y})):"southeast"===R&&(i.x<S+_+f&&(i.x=S+_+f),i.y<I+_+f&&(i.y=I+_+f),M=B({x:S,y:I},i)),"keepRatio"===g&&(!r&&E||r&&!E)&&("northeast"===R||"southeast"===R||"northwest"===R||"southwest"===R)){var v=M.width,Y=M.height,c=v/m,h=Y/t,z=H(c,h);M.width=m*z,M.height=t*z,"northeast"===R?M.y=I+(t-M.height):"northwest"===R?(M.y=I+(t-M.height),M.x=S+(m-M.width)):"southwest"===R&&(M.x=S+(m-M.width))}M.x-=d.x,M.y-=d.y;var D=jh(X,M,s,d);return M.x=D.x-M.width/2,M.y=D.y-M.height/2,M},Gi=function(r,T,I,J){var N=r.getRotation(),U=T,V=U.x,X=U.y,k=U.width,H=U.height,E={x:V+U.width/2,y:X+U.height/2};J=Ih(E,J.x-E.x,J.y-E.y,-N),"northwest"===I?U=B(J,{x:V+k,y:X+H}):"north"===I?U=B({x:V,y:J.y},{x:V+k,y:X+H}):"northeast"===I?U=B({x:V,y:J.y},{x:J.x,y:X+H}):"west"===I?U=B({x:J.x,y:X},{x:V+k,y:X+H}):"east"===I?U=B({x:V,y:X},{x:J.x,y:X+H}):"southwest"===I?U=B({x:J.x,y:X},{x:V+k,y:J.y}):"south"===I?U=B({x:V,y:X},{x:V+k,y:J.y}):"southeast"===I&&(U=B({x:V,y:X},J)),r.setRect(U),U.x-=E.x,U.y-=E.y;var c=jh(r,U,N,E);r.p(c.x,c.y)},Gl=function(H,w,j,p,Q,B,T,m){var v=X;B?(v=Ih(X,Q.x-w.x,Q.y-w.y,-j),v.x-=T.x,v.y-=T.y):v=Ih(X,Q.x-w.x,Q.y-w.y,0);var U={x:w.x+v.x,y:w.y+v.y};m&&(U=m(U.x,U.y)),U.e=H.getPoints().get(p).e,H.setPoint(p,U);var r=H.getWidth(),q=H.getHeight(),J=H.p().x-r/2,W=H.p().y-q/2;J-=w.x,W-=w.y;var R=jh(H,{x:J,y:W,width:r,height:q},j,w);H.p(R.x,R.y)},yf=function(b,B,T){var a,d;if(b instanceof l?(a=b.getPoints(),d=b.getSegments()):b instanceof r&&"points"===b.s("edge.type")&&(a=b.s("edge.points"),d=b.s("edge.segments"),a=Yd(B,a)),d||(d=Lp(a)),b instanceof l&&b.isClosePath()&&d.indexOf(5)<0&&(d=new i(d._as),d.add(5)),d)for(var w=-1,A=0;A<d.size();A++){if(A===T)return w;var L=d.get(A);1===L?w+=1:2===L?w+=1:3===L?w+=2:4===L&&(w+=3)}},df=function(O,B,w){var X,E;if(O instanceof l?(X=O.getPoints(),E=O.getSegments()):O instanceof r&&"points"===O.s("edge.type")&&(X=O.s("edge.points"),E=O.s("edge.segments"),X=Yd(B,X)),E||(E=Lp(X)),E)for(var R=-1,j=0;j<E.size();j++){var c=E.get(j);if(1===c?R+=1:2===c?R+=1:3===c?R+=2:4===c&&(R+=3),R===w)return j}},je=function(s,T){var w=[s[0]-T[0],s[1]-T[1],s[2]-T[2]];return w},Vl=function(){var I=new K(16);return I[0]=1,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=1,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[10]=1,I[11]=0,I[12]=0,I[13]=0,I[14]=0,I[15]=1,I},jj=function(m,r){var G=m[0],Y=m[1],i=m[2];return m[0]=r[0]*G+r[4]*Y+r[8]*i+r[12],m[1]=r[1]*G+r[5]*Y+r[9]*i+r[13],m[2]=r[2]*G+r[6]*Y+r[10]*i+r[14],m},Bh=function(J,H){if(H){var D=e(H),r=s(H),C=J[0],h=J[1],F=J[2],E=J[3],i=J[8],z=J[9],p=J[10],I=J[11];J[0]=C*r-i*D,J[1]=h*r-z*D,J[2]=F*r-p*D,J[3]=E*r-I*D,J[8]=C*D+i*r,J[9]=h*D+z*r,J[10]=F*D+p*r,J[11]=E*D+I*r}},On=function(k,W){for(var d=k.s("grid.row.count"),X=k.s("grid.column.count"),e=0;d>e;e++)for(var R=0;X>R;R++){var n=k.getCellRect(e,R);if(I(n,W))return{rowIndex:e,columnIndex:R,rect:n,grid:k}}return null},di=function(i,S,T,u,G,N){var Q={},b=T-i,$=u-S,j=y.sqrt(b*b+$*$),H=b/j,o=$/j,P=(-i+G)*H+(-S+N)*o;return 0>=P?(Q.x=i,Q.y=S):P>=j?(Q.x=T,Q.y=u):(Q.x=i+P*H,Q.y=S+P*o),b=G-Q.x,$=N-Q.y,Q.z=y.sqrt(b*b+$*$),Q},cr=function(g,U){var K,P,I,F,z,$,A,G,q=g.getPoints(),B=g.getSegments(),n=g.p(),a=g.getRotation();if(!B||!(B.indexOf(3)>0||B.indexOf(4)>0)){for(G=0;G<=q.size()-1;G++)if(G===q.size()-1?(z=q.get(0),F=q.get(G)):(F=q.get(G),z=q.get(G+1)),F=Ih(n,F.x-n.x,F.y-n.y,a),z=Ih(n,z.x-n.x,z.y-n.y,a),$=di(F.x,F.y,z.x,z.y,U.x,U.y),A=$.z,A<(g.s("shape.border.width")||10)){P=F,I=z,K=G;break}if(K!=X){var k=di(P.x,P.y,I.x,I.y,U.x,U.y),y=v(P,k);return{attachIndex:K,attachOffset:y}}}},_q=function(y){for(var C=y._data,Y=C.p(),p=C.getRotation(),i=C.getPoints(),k=X,D=[],B=0;B<i.size();B++)k=i.get(B),D.push(Ih(Y,k.x-Y.x,k.y-Y.y,p));y._55O.$15l=D};T._editPointSize=J?24:9,T._edgeHelpers=["parent","remove","source","target"],T._leftTopHelpers=["parent"],T._rightTopHelpers=["host"],T._leftBottomHelpers=["edge"],T._rightBottomHelpers=["remove"],rj=rj.concat(rj).concat(rj),R._79o=function(){var Q=this,e=Q.gv,F=e.getZoom(),l=e._editInteractor,x=Hg.call(Q),d=od(Q,!0),w=d[0],P=d[1],j={x:x.x,y:x.y,width:x.width,height:x.height},D=B(w,P);if(l instanceof b.XEditInteractor){j=S(j,D);var O=Q._55O,T=e.getEditPointSize()/F+2,Z=0;O&&O._43O&&(Z+=T/2,$(j,Z))}return j},R._47O=function(E){var d=this,$=d.gv,X=$._editInteractor;X instanceof b.XEditInteractor||Qo.call(d,E)},R.rectIntersects=function(F){var A=this,n=A._data,T=A.gv,D=T.getZoom(),_=A._55O,R=T._editInteractor;if(R instanceof b.XEditInteractor&&T.isEditable(n)&&_&&_._43O&&"points"===n.s("edge.type")){var N=n.s("edge.points"),j=n.s("edge.segments");N=Yd(A,N),j||(j=Lp(N)),N=N._as;var q=!1,W=J?5:1,Z=F.x+W,h=F.y+W,p={x:Z,y:h};if(R._edge===n&&R._hoverSegmentIndex>=0){var O=T._editInteractor._hoverSegmentIndex,a=j.get(O),B=yf(n,A,O),k=X;if(B!=X&&B>=0){var d=N[B],y=T.getSegmentHoverWidth()/D;if(2===a||1===a){var E=N[B+1];k=Xl(new pe(d.x,d.y),new pe(E.x,E.y),new pe(p.x-y,p.y-y),new pe(p.x+2*y,p.y+2*y)),k.$62l===f&&(q=!0)}else if(3===a){var $=N[B+1],E=N[B+2];k=dg(new pe(d.x,d.y),new pe($.x,$.y),new pe(E.x,E.y),new pe(p.x-y,p.y-y),new pe(p.x+2*y,p.y+2*y)),k.$62l===f&&(q=!0)}else if(4===a){var e=N[B+1],Q=N[B+2];E=N[B+3],k=Td(new pe(d.x,d.y),new pe(e.x,e.y),new pe(Q.x,Q.y),new pe(E.x,E.y),new pe(p.x-y,p.y-y),new pe(p.x+2*y,p.y+2*y)),k.$62l===f&&(q=!0)}}}if(q)return!0}return X},N._47O=function(B){var D=this,r=D.gv,h=r._editInteractor;h instanceof b.XEditInteractor||qn.call(D,B)},N.rectIntersects=function(s){var y=this,j=y._data,U=y.gv,N=U.getZoom(),R=y._55O,k=U._editInteractor;if(k instanceof b.XEditInteractor&&U.isEditable(j)&&R&&R._43O){var e=R.$15l,x=!1,w=J?5:1,c=s.x+w,F=s.y+w,L={x:c,y:F};if(e&&e.length===j.getPoints().size()||(_q(y),e=R.$15l),k._shape===j&&k._hoverSegmentIndex>=0){var g=j.getSegments();g||(g=Lp(e));var I=U._editInteractor._hoverSegmentIndex,r=g.get(I),W=yf(j,y,I),z=X;if(W!=X&&W>=0){var v=e[W],S=U.getSegmentHoverWidth()/N;if(2===r||1===r){var d=e[W+1];z=Xl(new pe(v.x,v.y),new pe(d.x,d.y),new pe(L.x-S,L.y-S),new pe(L.x+2*S,L.y+2*S)),z.$62l===f&&(x=!0)}else if(3===r){var T=e[W+1],d=e[W+2];z=dg(new pe(v.x,v.y),new pe(T.x,T.y),new pe(d.x,d.y),new pe(L.x-S,L.y-S),new pe(L.x+2*S,L.y+2*S)),z.$62l===f&&(x=!0)}else if(4===r){var t=e[W+1],A=e[W+2];d=e[W+3],z=Td(new pe(v.x,v.y),new pe(t.x,t.y),new pe(A.x,A.y),new pe(d.x,d.y),new pe(L.x-S,L.y-S),new pe(L.x+2*S,L.y+2*S)),z.$62l===f&&(x=!0)}}}if(x)return!0}return X},N._48O=function(){var S=this,T=S.gv,G=T._editInteractor;G instanceof b.XEditInteractor?(Y._48O.call(S),S._55O._43O&&_q(S)):xl.call(S)},N._79o=function(){var y=this,x=y.gv,C=x.getZoom(),w=x._editInteractor,Q=zf.call(y);if(Q){var f={x:Q.x,y:Q.y,width:Q.width,height:Q.height};if(w instanceof b.XEditInteractor){var h=y._55O,H=x.getEditPointSize()/C+2,t=0;h&&h._43O&&(t+=H/2,$(f,t))}return f}},Y._47O=function(N){var H=this,_=H.gv,x=_._editInteractor;if(x instanceof b.XEditInteractor);else{var L=H._55O;L&&L._98o&&Gf.call(H,N)}},Y._2o=function(){var d=this,h=d.gv,M=h._editInteractor,K=d._data;return h.isEditable(K)&&M instanceof b.XEditInteractor?0:bq.call(d)},Y._80o=function(F){var h=this,v=h.gv._editInteractor;if(lh.call(h,F),v&&v._debug){F.save(),F.beginPath(),F.lineWidth=1,F.strokeStyle="green";var k=h._79o();k&&(F.rect(k.x,k.y,k.width,k.height),F.stroke()),F.restore()}},N._80o=function($){var y=this,W=y.gv._editInteractor;if(Ur.call(y,$),W&&W._debug){$.save(),$.beginPath(),$.lineWidth=1,$.strokeStyle="green";var k=y._79o();$.rect(k.x,k.y,k.width,k.height),$.stroke(),$.restore()}},Y._48O=function(){var d=this,e=d.gv,n=d._data,y=e._editInteractor,l=d._55O,U=n.p(),P=n.getRotation();if(y instanceof b.XEditInteractor){if(l._42O){var A=yd(U,n.getWidth(),n.getHeight(),P),J=A[0],u=A[1],m=A[2],Y=A[3],x=A[4],C=A[5],h=A[6],O=A[7];l.$45l=[J,x,u,C,Y,h,m,O]}}else $d.call(d)},T.getResizeMode=function(){return this.$25l||"normal"},T.setResizeMode=function(f){var x=this.$25l;this.$25l=f,this.fp("resizeMode",x,f)},T.getSnapAngle=function(){return this.$26l||Math.PI/36},T.setSnapAngle=function(d){var r=this.$26l;this.$26l=d,this.fp("snapAngle",r,d)},T.getSnapSpacing=function(){return this.$27l},T.setSnapSpacing=function(i){var $=this.$27l;this.$27l=i,this.fp("snapSpacing",$,i)},T.getPointSnapSpacing=function(){return this._pointSnapSpacing},T.setPointSnapSpacing=function(L){var G=this._pointSnapSpacing;this._pointSnapSpacing=L,this.fp("pointSnapSpacing",G,L)},T.setHelperEditableFunc=function(M){var t=this._helperEditableFunc;this._helperEditableFunc=M,this.fp("helperEditableFunc",t,M)},T.getHelperEditableFunc=function(){return this._helperEditableFunc},T.setLeftTopHelpers=function(v){var u=this._leftTopHelpers;this._leftTopHelpers=v,this.fp("leftTopHelpers",u,v)},T.getLeftTopHelpers=function(){return this._leftTopHelpers},T.setLeftTopHelpersAlign=function(y){var Q=this._leftTopHelpersAlign;this._leftTopHelpersAlign=y,this.fp("leftTopHelpersAlign",Q,y)},T.getLeftTopHelpersAlign=function(){return this._leftTopHelpersAlign},T.setRightTopHelpers=function(E){var K=this._rightTopHelpers;this._rightTopHelpers=E,this.fp("rightTopHelpers",K,E)},T.getRightTopHelpers=function(){return this._rightTopHelpers},T.setRightTopHelpersAlign=function(G){var n=this._rightTopHelpersAlign;this._rightTopHelpersAlign=G,this.fp("rightTopHelpersAlign",n,G)},T.getRightTopHelpersAlign=function(){return this._rightTopHelpersAlign},T.setLeftBottomHelpers=function(u){var $=this._leftBottomHelpers;this._leftBottomHelpers=u,this.fp("leftBottomHelpers",$,u)},T.getLeftBottomHelpers=function(){return this._leftBottomHelpers},T.setLeftBottomHelpersAlign=function(p){var i=this._leftBottomHelpersAlign;this._leftBottomHelpersAlign=p,this.fp("leftBottomHelpersAlign",i,p)},T.getLeftBottomHelpersAlign=function(){return this._leftBottomHelpersAlign},T.setRightBottomHelpers=function(Y){var s=this._rightBottomHelpers;this._rightBottomHelpers=Y,this.fp("rightBottomHelpers",s,Y)},T.getRightBottomHelpers=function(){return this._rightBottomHelpers},T.setRightBottomHelpersAlign=function(D){var q=this._rightBottomHelpersAlign;this._rightBottomHelpersAlign=D,this.fp("rightBottomHelpersAlign",q,D)},T.getRightBottomHelpersAlign=function(){return this._rightBottomHelpersAlign},T.setEdgeHelpers=function(U){var k=this._edgeHelpers;this._edgeHelpers=U,this.fp("edgeHelpers",k,U)},T.getEdgeHelpers=function(){return this._edgeHelpers},T.isHelperEditable=function(A,V){return A instanceof r&&("host"===V||"edge"===V||"elevation"===V||"tall"===V)?!1:A instanceof d&&("source"===V||"target"===V)?!1:"pointElevation"===V?this._helperEditableFunc?this._helperEditableFunc(A,V):!1:this._helperEditableFunc?this._helperEditableFunc(A,V):!0},T.getEditHelperSize=function(){return this._editHelperSize||(J?28:16)},T.setEditHelperSize=function(p){var _=this._editHelperSize;this._editHelperSize=p,this.fp("editHelperSize",_,p)},T.getEditRectBorderColor=function(){return this.$28l||"rgb(0, 168, 255)"},T.setEditRectBorderColor=function(x){var U=this.$28l;this.$28l=x,this.fp("editRectBorderColor",U,x)},T.getNodeBorderColor=function(){return this.$29l||"#1ABC9C"},T.setNodeBorderColor=function(c){var Q=this.$29l;this.$29l=c,this.fp("nodeBorderColor",Q,c)},T.getEditRectBorderStyle=function(){return this.$30l||"dashed"},T.setEditRectBorderStyle=function(P){var y=this.$30l;this.$30l=P,this.fp("editRectBorderStyle",y,P)},T.getControlPointBackground=function(){return this.$31l||"#ff0"},T.setControlPointBackground=function(o){var L=this.$31l;this.$31l=o,this.fp("controlPointBackground",L,o)},T.getControlPointBorderColor=function(){return this.$32l||this._editPointBorderColor},T.setControlPointBorderColor=function(W){var U=this.$32l;this.$32l=W,this.fp("controlPointBorderColor",U,W)},T.getJoinPointBackground=function(){return this.$33l||this._editPointBackground},T.setJoinPointBackground=function(o){var $=this.$33l;this.$33l=o,this.fp("joinPointBackground",$,o)},T.getJoinPointBorderColor=function(){return this.$34l||this._editPointBorderColor},T.setJoinPointBorderColor=function(S){var B=this.$34l;this.$34l=S,this.fp("joinPointBorderColor",B,S)},T.getDirectionLineColor=function(){return this.$35l||"#888"},T.setDirectionLineColor=function(m){var t=this.$35l;this.$35l=m,this.fp("directionLineColor",t,m)},T.getSegmentHoverColor=function(){return this.$36l||"rgba(255, 0, 0, 0.3)"},T.setSegmentHoverColor=function(r){var m=this.$36l;this.$36l=r,this.fp("segmentHoverColor",m,r)},T.getSegmentHoverWidth=function(){return this.$22l||(J?16:8)},T.setSegmentHoverWidth=function(U){var G=this.$22l;this.$22l=U,this.fp("segmentHoverWidth",G,U)},T.getSnapPointBorderColor=function(){return this.$38l||"#f00"},T.setSnapPointBorderColor=function(k){var N=this.$38l;this.$38l=k,this.fp("snapPointBorderColor",N,k)},T.getEditRectPadding=function(){return this.$39l!=X?this.$39l:6},T.setEditRectPadding=function(t){var B=this.$39l;this.$39l=t,this.fp("editRectPading",B,t)},T.isRectEditable=function(B){var I=this,i=I._editInteractor;return i instanceof b.XEditInteractor?I._rectEditableFunc?I._rectEditableFunc(B):!0:Ug.call(I,B)},T.isPointEditable=function(v){var S=this,C=S._editInteractor;return C instanceof b.XEditInteractor?S._pointEditableFunc?S._pointEditableFunc(v):!0:ss.call(S,v)},T.validateImpl=function(){var N=this,V=N.$14l,z=N._editInteractor;if(V){var M=N.getWidth(),v=N.getHeight();(M!==V.clientWidth||v!==V.clientHeight)&&(z&&(z._68I=1),F.setCanvas(V,M,v),N._32I=1)}Rc.call(this)},T.isEditable=function(h){var i=Xj.call(this,h),v=this._editInteractor;if(v instanceof b.XEditInteractor&&h instanceof r){h.getSource()==h.getTarget()&&(i=!1);var _=this.getEditableFunc();i=_?_(h):!0}return i},T._42=function(h,B){var G=this,z=G._editInteractor;Vc.call(G,h,B),z instanceof b.XEditInteractor&&z._68I&&z._42()},T.isSnapPoint=function(){return!0};var Wm=function(A){arguments.length>0&&this.$58l(A)},Yf=Wm.prototype;Yf.$58l=function(q){this.$62l=q,this.points=new Array},Yf.$56l=function(v){this.points.push(v)},Yf.$57l=function(r){this.points=this.points.concat(r)};var pe=function(X,w){arguments.length>0&&this.$58l(X,w)},Ep=pe.prototype;Ep.$58l=function(Z,t){this.x=Z,this.y=t},Ep.add=function(B){return new pe(this.x+B.x,this.y+B.y)},Ep.addEquals=function(U){return this.x+=U.x,this.y+=U.y,this},Ep.$55l=function(R){return new pe(this.x*R,this.y*R)},Ep.eq=function(W){return this.x==W.x&&this.y==W.y},Ep.lt=function(p){return this.x<p.x&&this.y<p.y},Ep.lte=function(Y){return this.x<=Y.x&&this.y<=Y.y},Ep.gt=function(l){return this.x>l.x&&this.y>l.y},Ep.gte=function(W){return this.x>=W.x&&this.y>=W.y},Ep.lerp=function(L,B){return new pe(this.x+(L.x-this.x)*B,this.y+(L.y-this.y)*B)},Ep.distanceFrom=function(P){var V=this.x-P.x,W=this.y-P.y;return _(V*V+W*W)},Ep.min=function(n){return new pe(H(this.x,n.x),H(this.y,n.y))},Ep.max=function(q){return new pe(Z(this.x,q.x),Z(this.y,q.y))},Ep.toString=function(){return this.x+","+this.y};var Ir=function(){this.$58l(arguments)},Ff=Ir.prototype;Ir.TO=1e-6,Ir.AC=6,Ff.$58l=function(z){this.co=new Array;for(var G=z.length-1;G>=0;G--)this.co.push(z[G])},Ff.$55l=function(B){for(var L=new Ir,e=0;e<=this.$50l()+B.$50l();e++)L.co.push(0);for(var e=0;e<=this.$50l();e++)for(var P=0;P<=B.$50l();P++)L.co[e+P]+=this.co[e]*B.co[P];return L},Ff.$59l=function(){for(var a=this.$50l();a>=0&&n(this.co[a])<=Ir.TO;a--)this.co.pop()},Ff.$50l=function(){return this.co.length-1},Ff.$51l=function(){var n;switch(this.$59l(),this.$50l()){case 0:n=new Array;break;case 1:n=this.$52l();break;case 2:n=this.$53l();break;case 3:n=this.$54l();break;case 4:n=this.$63l();break;default:n=new Array}return n},Ff.$52l=function(){var y=new Array,w=this.co[1];return 0!=w&&y.push(-this.co[0]/w),y},Ff.$53l=function(){var A=new Array;if(2==this.$50l()){var u=this.co[2],W=this.co[1]/u,v=this.co[0]/u,o=W*W-4*v;if(o>0){var O=_(o);A.push(.5*(-W+O)),A.push(.5*(-W-O))}else 0==o&&A.push(.5*-W)}return A},Ff.$63l=function(){var q=new Array;if(4==this.$50l()){var s=this.co[4],S=this.co[3]/s,r=this.co[2]/s,J=this.co[1]/s,b=this.co[0]/s,j=new Ir(1,-r,S*J-4*b,-S*S*b+4*r*b-J*J).$54l(),E=j[0],Z=S*S/4-r+E;if(n(Z)<=Ir.TO&&(Z=0),Z>0){var L=_(Z),C=3*S*S/4-L*L-2*r,Y=(4*S*r-8*J-S*S*S)/(4*L),g=C+Y,w=C-Y;if(n(g)<=Ir.TO&&(g=0),n(w)<=Ir.TO&&(w=0),g>=0){var t=_(g);q.push(-S/4+(L+t)/2),q.push(-S/4+(L-t)/2)}if(w>=0){var t=_(w);q.push(-S/4+(t-L)/2),q.push(-S/4-(t+L)/2)}}else if(0>Z);else{var Y=E*E-4*b;if(Y>=-Ir.TO){if(0>Y&&(Y=0),Y=2*_(Y),C=3*S*S/4-2*r,C+Y>=Ir.TO){var D=_(C+Y);q.push(-S/4+D/2),q.push(-S/4-D/2)}if(C-Y>=Ir.TO){var D=_(C-Y);q.push(-S/4+D/2),q.push(-S/4-D/2)}}}}return q},Ff.$54l=function(){var F=new Array;if(3==this.$50l()){var c=this.co[3],x=this.co[2]/c,w=this.co[1]/c,N=this.co[0]/c,A=(3*w-x*x)/3,r=(2*x*x*x-9*w*x+27*N)/27,t=x/3,f=r*r/4+A*A*A/27,P=r/2;if(n(f)<=Ir.TO&&(f=0),f>0){var y,u,D=_(f);y=-P+D,u=y>=0?M(y,1/3):-M(-y,1/3),y=-P-D,y>=0?u+=M(y,1/3):u-=M(-y,1/3),F.push(u-t)}else if(0>f){var J=_(-A/3),T=O(_(-f),-P)/3,S=s(T),q=e(T),o=_(3);F.push(2*J*S-t),F.push(-J*(S+o*q)-t),F.push(-J*(S-o*q)-t)}else{var y;y=P>=0?-M(P,1/3):M(-P,1/3),F.push(2*y-t),F.push(-y-t)}}return F};var sg=function(u,v){arguments.length>0&&this.$58l(u,v)},vi=sg.prototype;vi.$58l=function(l,s){this.x=l,this.y=s},vi.length=function(){return _(this.x*this.x+this.y*this.y)},vi.$60l=function(J){return this.x*J.x+this.y*J.y};var gh=function(R,m,X,z){var U,d=(z.x-X.x)*(R.y-X.y)-(z.y-X.y)*(R.x-X.x),a=(m.x-R.x)*(R.y-X.y)-(m.y-R.y)*(R.x-X.x),i=(z.y-X.y)*(m.x-R.x)-(z.x-X.x)*(m.y-R.y);if(0!=i){var b=d/i,o=a/i;b>=0&&1>=b&&o>=0&&1>=o?(U=new Wm(f),U.points.push(new pe(R.x+b*(m.x-R.x),R.y+b*(m.y-R.y)))):U=new Wm(E)}else U=0==d||0==a?new Wm("C"):new Wm("P");return U},jp=function(J,T,k,e,I){var l,X,h,Y,M,y,P,v=e.min(I),V=e.max(I),C=new Wm(E);l=T.$55l(-2),h=J.add(l.add(k)),l=J.$55l(-2),X=T.$55l(2),Y=l.add(X),M=new pe(J.x,J.y),P=new sg(e.y-I.y,I.x-e.x),y=e.x*I.y-I.x*e.y;for(var A=new Ir(P.$60l(h),P.$60l(Y),P.$60l(M)+y).$51l(),z=0;z<A.length;z++){var c=A[z];if(c>=0&&1>=c){var N=J.lerp(T,c),U=T.lerp(k,c),t=N.lerp(U,c);e.x==I.x?v.y<=t.y&&t.y<=V.y&&(C.$62l=f,C.$56l(t)):e.y==I.y?v.x<=t.x&&t.x<=V.x&&(C.$62l=f,C.$56l(t)):t.gte(v)&&t.lte(V)&&(C.$62l=f,C.$56l(t))}}return C},dg=function(n,A,Z,d,z){var h=d.min(z),X=d.max(z),Y=new pe(X.x,h.y),i=new pe(h.x,X.y),K=jp(n,A,Z,h,Y),g=jp(n,A,Z,Y,X),t=jp(n,A,Z,X,i),J=jp(n,A,Z,i,h),W=new Wm(E);return W.$57l(K.points),W.$57l(g.points),W.$57l(t.points),W.$57l(J.points),W.points.length>0&&(W.$62l=f),W},mk=function(I,A,l,Y,P,N){var C,Q,q,S,_,G,T,Z,D,m,r=P.min(N),$=P.max(N),y=new Wm(E);C=I.$55l(-1),Q=A.$55l(3),q=l.$55l(-3),S=C.add(Q.add(q.add(Y))),_=new sg(S.x,S.y),C=I.$55l(3),Q=A.$55l(-6),q=l.$55l(3),S=C.add(Q.add(q)),G=new sg(S.x,S.y),C=I.$55l(-3),Q=A.$55l(3),q=C.add(Q),T=new sg(q.x,q.y),Z=new sg(I.x,I.y),m=new sg(P.y-N.y,N.x-P.x),D=P.x*N.y-N.x*P.y;for(var x=new Ir(m.$60l(_),m.$60l(G),m.$60l(T),m.$60l(Z)+D).$51l(),c=0;c<x.length;c++){var e=x[c];if(e>=0&&1>=e){var M=I.lerp(A,e),z=A.lerp(l,e),J=l.lerp(Y,e),K=M.lerp(z,e),a=z.lerp(J,e),w=K.lerp(a,e);P.x==N.x?r.y<=w.y&&w.y<=$.y&&(y.$62l=f,y.$56l(w)):P.y==N.y?r.x<=w.x&&w.x<=$.x&&(y.$62l=f,y.$56l(w)):w.gte(r)&&w.lte($)&&(y.$62l=f,y.$56l(w))}}return y},Td=function(H,s,Q,r,w,A){var X=w.min(A),J=w.max(A),e=new pe(J.x,X.y),j=new pe(X.x,J.y),K=mk(H,s,Q,r,X,e),Z=mk(H,s,Q,r,e,J),z=mk(H,s,Q,r,J,j),y=mk(H,s,Q,r,j,X),F=new Wm(E);return F.$57l(K.points),F.$57l(Z.points),F.$57l(z.points),F.$57l(y.points),F.points.length>0&&(F.$62l=f),F},Xl=function(l,j,e,h){var B=e.min(h),F=e.max(h),C=new pe(F.x,B.y),H=new pe(B.x,F.y),U=gh(B,C,l,j),S=gh(C,F,l,j),r=gh(F,H,l,j),o=gh(H,B,l,j),P=new Wm(E);return P.$57l(U.points),P.$57l(S.points),P.$57l(r.points),P.$57l(o.points),P.points.length>0&&(P.$62l=f),P},Vb=b.XEditInteractor=function(p){var d=this,T=d._view=document.createElement("canvas");T.className="editCanvas",T.style.position="absolute",Vb.superClass.constructor.call(d,p)};w.def(Vb,b.Interactor,{ms_edit:1,setUp:function(){var M=this,o=M.gv,T=o.getView(),t=M._view;Vb.superClass.setUp.call(M),o.setEditInteractor(M),o.$14l=t,o._79O?T.insertBefore(t,o._79O):T.appendChild(t);var q=M.$49l=M.$11l.bind(M);o.dm().md(q),o.sm().ms(q),o.mp(q)},tearDown:function(){var m=this,C=m.gv,r=C.getView(),k=m.$49l;Vb.superClass.tearDown.call(m),C.setEditInteractor(X),C.$14l=X,r.removeChild(m._view),C.dm().umd(k),C.sm().ums(k),C.ump(k)},clear:function(){var B=this,R=B.gv;delete B._hoverSegmentIndex,delete B._edge,delete B._shape,delete R._editing,delete B.$10l,delete B.$13l,delete B.$9l,delete B._removePointIndex,delete B._lp,B.$12l="",delete B.$40l,delete B.$67l,delete B.$72l,delete B.$73l,delete B.$75l,delete B.$1l,delete B.$3l,delete B.$2l,delete B.$92l,delete B.$93l,delete B.$94l,B.clearDragging()},handle_keydown:function(v){this.$48l!==v.shiftKey&&(this.$48l=v.shiftKey,this.handle_mousemove(v,x,!0))},handle_keyup:function(Z){this.$48l!==Z.shiftKey&&(this.$48l=Z.shiftKey,this.handle_mousemove(Z,x,!0))},handle_touchstart:function(v){this.handle_mousemove(v),this.handle_mousedown(v)},handle_mousedown:function(S){k(S);var n=this,u=n.$13l,X=n.gv,P=X.dm(),p=P.getHistoryManager(),Z=X.sm(),L=X.getZoom(),l=X.lp(S),e=w.isDoubleClick(S),a=w.isLeftButton(S),b=n.$7l,h=n._shape,y=n._hoverSegmentIndex,K=n._edge,c=n.$87l,B=n.$88l,i=function(){n._68I||c===n.$87l&&B===n.$88l||n.$43l()};if(7!==n.$67l&&(delete n.$87l,delete n.$88l),a&&(h||K)&&y>=0&&e&&(h&&Z.contains(h)||K&&Z.contains(K))){var I=ai.call(n,h||K,y,l);return n.addShapePoint(h||K,y,I),Q(function(){n.handle_mousemove(S)},40),void 0}if(a&&(h||K)&&n._removePointIndex>=0&&e)return n.removeShapePoint(),n.$5l=1,Q(function(){n.handle_mousemove(S)},40),void 0;if(!a||!X._editing)return i(),void 0;if(h&&u>=0){var J=h.getPoints().get(u),F=h.p(),t=Ih(F,J.x-F.x,J.y-F.y,-b+h.getRotation());D=Ih(F,l.x-F.x,l.y-F.y,-b),n.$24l={x:D.x-t.x,y:D.y-t.y},n.startDragging(S),p&&p.beginInteraction(),n.fi({kind:"beginEditPoint",event:S,data:h,index:u}),n.$88l=u,n.$87l=h}else if(n.$10l){var _=X.sm().getSelection(),g=n.$6l,o=n.$1l={},H=n.$3l={},j=n.$16l[A[n.$10l]],E={x:g.x,y:g.y},r={x:g.x+g.width/2,y:g.y+g.height/2};n.$24l={x:l.x-j.x/L,y:l.y-j.y/L},n.$2l=V(n.$8l),n.$4l=V(g),_.each(function(y){if(y instanceof d){var v=y.p(),j=y.getWidth(),M=y.getHeight(),W=Ih(r,v.x-r.x,v.y-r.y,-b);o[y.getId()]={x:v.x-j/2,y:v.y-M/2,width:j,height:M},H[y.getId()]={x:(W.x-E.x)/g.width,y:(W.y-E.y)/g.height}}}),n.startDragging(S),p&&p.beginInteraction(),n.fi({kind:"beginEditRect",event:S,direction:n.$10l})}else if(K&&u>=0){var x=Yd(X.getDataUI(K),K.s("edge.points")),J=x.get(u);n.$24l={x:l.x-J.x,y:l.y-J.y},n.startDragging(S),p&&p.beginInteraction(),n.fi({kind:"beginEditPoint",event:S,data:K,index:u}),n.$88l=u,n.$87l=K}else if(n.$40l){var g=n.$6l,r={x:g.x+g.width/2,y:g.y+g.height/2},O=V(n.$23l);O.x/=L,O.y/=L;var s=Ih(r,O.x-r.x,O.y-r.y,-b),D=Ih(r,l.x-r.x,l.y-r.y,-b);n.$24l={x:D.x-s.x,y:D.y-s.y},n.startDragging(S),p&&p.beginInteraction(),n.fi({kind:"beginEditRotation",event:S,data:n._rotationNode})}else if([1,2,3,5,6,7,8,9].indexOf(n.$67l)>=0)n.startDragging(S);else if(n.$71l&&e&&n.$79l(n.$71l,l)){var C=Z.toSelection();p&&p.beginInteraction(),C.each(function(h){P.remove(h)}),p&&p.endInteraction()}i()},$11l:function(){var L=this,F=L.gv;F._editing&&(L.$13l==X||L._shape==X&&L._edge==X)&&(L.$73l==X||1!==L.$67l&&5!==L.$67l&&6!==L.$67l)||(L.$5l=1),L._68I=1},$46l:function(M){var P=this,L=P.gv,O=L.lp(M),_=[];return mg(L,function(l){var R=L.getDataUI(l);if(R){var H=R._79o();I(H,O)&&_.push(l)}}),_},$47l:function(I){var B=this,v=B.$13l,s=B.gv.dm(),t=s.getHistoryManager();B.$10l?(B.fi({kind:"endEditRect",event:I,direction:B.$10l}),t&&t.endInteraction()):B._shape&&v>=0?(B.fi({kind:"endEditPoint",event:I,data:B._shape,index:v}),t&&t.endInteraction()):B._edge&&v>=0?(B.fi({kind:"endEditPoint",event:I,data:B._edge,index:v}),t&&t.endInteraction()):B.$23l&&B.$40l&&(B.fi({kind:"endEditRotation",event:I}),t&&t.endInteraction())},handleWindowTouchEnd:function($){this.handleWindowMouseUp($)},handleWindowMouseUp:function(D){var z=this,P=z.gv,U=P.dm(),B=U.getHistoryManager(),F=z._shape,k=z._edge,g=z.$13l,j=z.$40l,Y=z.$9l,c=z.$10l,O=z.$67l;if((F||k)&&g>=0&&Y>=0){var A,C;if(F){var b=F.p(),I=F.getRotation();A=F.getPoints(),C=A.get(Y),Gl(F,b,I,g,C,!1)}else if(A=Yd(P.getDataUI(k),k.s("edge.points"),!0),C=A.get(Y),0===g){var w=A.get(0);k.s("edge.source.offset.x",C.x-w.x),k.s("edge.source.offset.y",C.y-w.y)}else if(g===A.size()-1){var o=A.get(A.size()-1);k.s("edge.target.offset.x",C.x-o.x),k.s("edge.target.offset.y",C.y-o.y)}else"points"===k.s("edge.type")&&(A.set(g,C),k.s("edge.points",Jk(A)))}z.$47l(D);var W=z.$73l;1===O?(B&&B.beginInteraction(),W?P.sm().each(function(V){if(V.setHost&&P.isHelperEditable(V,"host")){V.setHost(W);var D=z.$75l,t=z.$74l;D&&(V.s("attach.row.index",D.rowIndex),V.s("attach.column.index",D.columnIndex)),t&&(V.s("attach.index",t.attachIndex),V.s("attach.offset",t.attachOffset),V.s("attach.offset.relative",!1),V.s("attach.offset.opposite",!1))
}}):P.sm().each(function(_){_.setHost&&P.isHelperEditable(_,"host")&&(_.setHost(X),_.s("attach.row.index",x),_.s("attach.column.index",x),_.s("attach.index",x),_.s("attach.offset",x),_.s("attach.offset.relative",!1),_.s("attach.offset.opposite",!1))}),B&&B.endInteraction()):2===O?(B&&B.beginInteraction(),W?P.sm().each(function(U){U.setParent&&P.isHelperEditable(U,"parent")&&U.setParent(W)}):P.sm().each(function(i){i.setParent&&P.isHelperEditable(i,"parent")&&i.setParent(X)}),B&&B.endInteraction()):3===O?W&&(B&&B.beginInteraction(),P.sm().each(function(g){if(P.isHelperEditable(g,"edge")&&g instanceof d&&W instanceof d){var C=new m.Edge;U.add(C),C.setSource(g),C.setTarget(W),z.onEdgeCreated&&z.onEdgeCreated(D,C)}}),B&&B.endInteraction()):(5===O||6===O)&&W&&(B&&B.beginInteraction(),P.sm().each(function(n){n instanceof r&&W instanceof d&&(5===O&&P.isHelperEditable(n,"source")?n.setSource(W):6===O&&P.isHelperEditable(n,"source")&&n.setTarget(W))}),B&&B.endInteraction()),(c||j)&&z.$43l(!0),J?(z.clear(),delete z.$64l,z._68I||z.$43l()):(z.handle_mousemove(D,!0),O&&!z._68I&&z.$43l())},handleWindowTouchMove:function(J){this.handleWindowMouseMove(J)},handleWindowMouseMove:function(c){this._78I(c)},handle_mousemove:function(w,L,I){if(!this._pause){if(!I){var Z=J?cg(w):w;this.$61l={clientX:Z.clientX,clientY:Z.clientY}}if(L===!0||!c()){var v=this,l=v.gv,z=!1,G=X;v.clear(),l.sm().size()>0&&(G=l.lp(I?v.$61l:w),z=v._79I(w,G)),z&&(l._editing=1),v.$12l!==v.$65l&&(v.$65l=v.$12l,v.setCursor(v.$12l)),v.$40l!==v.$64l&&(v.$64l=v.$40l,v._68I||v.$43l()),v._hoverSegmentIndex!==v.$66l&&(v.$66l=v._hoverSegmentIndex,v._68I||v.$43l())}}},_78I:function(R){this.autoScroll(R);var F=this,P=F.gv,Z=P.lp(R),A=P.getZoom(),i=F.$13l;if((F._shape||F._edge)&&i>=0){var x,z,c,K=F._shape,q=F._edge,D=F.$24l,$=P.getPointSnapSpacing(),o=function(d,F){return $==X||isNaN($)?{x:d,y:F}:{x:u(d/$)*$,y:u(F/$)*$}};if(K){x=K.getPoints();var g=K.p(),V=K.getRotation(),Y=0;z=Ih(g,Z.x-g.x,Z.y-g.y,-V),Gl(K,g,V,i,Z,!0,D,o),F.fi({kind:"betweenEditPoint",event:R,data:K,index:i})}else if(q){x=Yd(P.getDataUI(q),q.s("edge.points"),!0),Z.x-=D.x,Z.y-=D.y,z=Z;var J,H;if(0===i){var e=x.get(0);J=Z.x-e.x,H=Z.y-e.y,c=o(J,H),q.s("edge.source.offset.x",c.x),q.s("edge.source.offset.y",c.y)}else if(i===x.size()-1){var S=x.get(x.size()-1);J=Z.x-S.x,H=Z.y-S.y,c=o(J,H),q.s("edge.target.offset.x",c.x),q.s("edge.target.offset.y",c.y)}else"points"===q.s("edge.type")&&(c=o(Z.x,Z.y),c.e=x.get(i).e,x.set(i,c),q.s("edge.points",Jk(x)));F.fi({kind:"betweenEditPoint",event:R,data:q,index:i})}if(delete F.$9l,P.isSnapPoint(K)||P.isSnapPoint(q))for(Y=0;Y<x.size();Y++)if(Y!==i){var t=x.get(Y);if(v(t,z)<P.getEditPointSize()/A){F.$9l=Y;break}}}else if(F.$10l){var D=F.$24l;Z.x-=D.x,Z.y-=D.y;var b=P.sm().getSelection(),U=F.$1l,j=F.$7l,B=F.$10l,G=F.$4l,L=F.$2l,C=P.getEditRectPadding()/A,h=2*C,M=P.getSnapSpacing(),f=M!=X&&!isNaN(M),T=Dd(L,Z,B,j,2*C,P.getResizeMode(),f,!0),m=F.$6l;if(f){var E=T.width-h,N=T.height-h,I=u(E/M)*M,k=u(N/M)*M,y=I-E,s=k-N;("west"===B||"northwest"===B||"southwest"===B)&&(y=-y),("north"===B||"northwest"===B||"northeast"===B)&&(s=-s),T=Dd(L,Z,B,j,2*C,P.getResizeMode(),f,!1,y,s)}F.$8l=T,m.x=T.x+C,m.y=T.y+C,m.width=T.width-h,m.height=T.height-h;var Tn=T.x+T.width/2,Bb=T.y+T.height/2,$n=m.x,Ti=m.y,zf=m.width/G.width,Tk=m.height/G.height;b.each(function(y){if(y instanceof d&&P.isEditable(y)&&P.isRectEditable(y)){var O=U[y.getId()],r=F.$3l[y.getId()],i={x:O.x+O.width/2,y:O.y+O.height/2},l=0,I=0,J=B,b=180*n(j-y.getRotation())/a;"northeast"===B?b>=315||45>b?(l=O.width*zf+O.x,I=O.height*(1-Tk)+O.y,J="northeast"):b>=45&&135>b?(l=O.width*(1-Tk)+O.x,I=O.height*(1-zf)+O.y,J="northwest"):b>=135&&225>b?(l=O.width*(1-zf)+O.x,I=O.height*Tk+O.y,J="southwest"):(l=O.width*Tk+O.x,I=O.height*zf+O.y,J="southeast"):"north"===B?b>=315||45>b?(I=O.height*(1-Tk)+O.y,J="north"):b>=45&&135>b?(l=O.width*(1-Tk)+O.x,J="west"):b>=135&&225>b?(I=O.height*Tk+O.y,J="south"):(l=O.width*Tk+O.x,J="east"):"northwest"===B?b>=315||45>b?(l=O.width*(1-zf)+O.x,I=O.height*(1-Tk)+O.y,J="northwest"):b>=45&&135>b?(l=O.width*(1-Tk)+O.x,I=O.height*zf+O.y,J="southwest"):b>=135&&225>b?(l=O.width*zf+O.x,I=O.height*Tk+O.y,J="southeast"):(l=O.width*Tk+O.x,I=O.height*(1-zf)+O.y,J="northeast"):"west"===B?b>=315||45>b?(l=O.width*(1-zf)+O.x,J="west"):b>=45&&135>b?(I=O.height*zf+O.y,J="south"):b>=135&&225>b?(l=O.width*zf+O.x,J="east"):(I=O.height*(1-zf)+O.y,J="north"):"southwest"===B?b>=315||45>b?(l=O.width*(1-zf)+O.x,I=O.height*Tk+O.y,J="southwest"):b>=45&&135>b?(l=O.width*Tk+O.x,I=O.height*zf+O.y,J="southeast"):b>=135&&225>b?(l=O.width*zf+O.x,I=O.height*(1-Tk)+O.y,J="northeast"):(l=O.width*(1-Tk)+O.x,I=O.height*(1-zf)+O.y,J="northwest"):"east"===B?b>=315||45>b?(l=O.width*zf+O.x,J="east"):b>=45&&135>b?(I=O.height*(1-zf)+O.y,J="north"):b>=135&&225>b?(l=O.width*(1-zf)+O.x,J="west"):(I=O.height*zf+O.y,J="south"):"south"===B?b>=315||45>b?(I=O.height*Tk+O.y,J="south"):b>=45&&135>b?(l=O.width*Tk+O.x,J="east"):b>=135&&225>b?(I=O.height*(1-Tk)+O.y,J="north"):(l=O.width*(1-Tk)+O.x,J="west"):"southeast"===B&&(b>=315||45>b?(l=O.width*zf+O.x,I=O.height*Tk+O.y,J="southeast"):b>=45&&135>b?(l=O.width*Tk+O.x,I=O.height*(1-zf)+O.y,J="northeast"):b>=135&&225>b?(l=O.width*(1-zf)+O.x,I=O.height*(1-Tk)+O.y,J="northwest"):(l=O.width*(1-Tk)+O.x,I=O.height*zf+O.y,J="southwest"));var k=Ih(i,l-i.x,I-i.y,y.getRotation());Gi(y,O,J,{x:k.x,y:k.y});var Q=$n+m.width*r.x,A=Ti+m.height*r.y,E={x:Q,y:A};E=Ih({x:Tn,y:Bb},E.x-Tn,E.y-Bb,j),y.p(E.x,E.y)}}),F.fi({kind:"betweenEditRect",event:R,direction:B})}else if(F.$23l&&F.$40l){var de=F.$8l,Xl=de.width,En=de.height,g={x:de.x+Xl/2,y:de.y+En/2},D=F.$24l,mq=F.$23l,ae=mq.x/A-g.x,Lc=mq.y/A-g.y,rh=_(ae*ae+Lc*Lc),bb=Math.asin(D.x/rh),lq=P.sm().getSelection(),gh=p+O(Z.y-g.y,Z.x-g.x)-bb,Ri=P.getSnapAngle(),gh=u(gh/Ri)*Ri;0>gh&&(gh+=W);var bo=gh-F.$7l,Vn=[g.x,0,g.y];lq.each(function(I){if(P.isEditable(I)&&P.isRotationEditable(I)&&P.isVisible(I)){var x=je(I.p3(),Vn),B=Vl();Bh(B,-bo),I.setRotation(I.getRotation()+bo),jj(x,B),I.p3(Vn[0]+x[0],Vn[1]+x[1],Vn[2]+x[2])}}),F.$7l=gh,F.fi({kind:"betweenEditRotation",event:R})}else if([1,2,3,5,6].indexOf(F.$67l)>=0)F.$72l=R,F.$78l||(F.$78l=1,Q(function(){w.isDragging()&&F.$43l(),delete F.$78l},12));else if(7===F.$67l){if(F.$87l instanceof l){var K=F.$87l,wf=F.$88l,sj=w.clone(K.getPoints().get(wf)),nc=Z.y-sj.y;sj.e||(sj.e=0),F.$92l||(F.$92l=sj.e),sj.e=F.$92l-nc,K.setPoint(wf,sj)}else if(F.$87l instanceof r){var q=F.$87l,wf=F.$88l,x=Yd(P.getDataUI(q),q.s("edge.points")),sj=x.get(wf),nc=Z.y-sj.y;sj.e||(sj.e=0),F.$92l||(F.$92l=sj.e),sj.e=F.$92l-nc,x.set(wf,sj),q.s("edge.points",Jk(x))}}else if(8===F.$67l){var lq=P.sm().getSelection(),fh=F.$93l;fh||(fh=F.$93l={}),lq.each(function(N){if(N.p3){var m=N.p3(),j=fh[N.getId()];j==X&&(j=fh[N.getId()]=m[1]),N.p3([m[0],j-(Z.y-F.$90l.y/A),m[2]])}})}else if(9===F.$67l){var lq=P.sm().getSelection(),Dl=F.$94l;Dl||(Dl=F.$94l={}),lq.each(function(M){if(M.s3){var W=M.s3(),V=Dl[M.getId()];V==X&&(V=Dl[M.getId()]=W[1]);var f=V-(Z.y-F.$91l.y/A);0>f&&(f=.01),M.s3([W[0],f,W[2]])}})}},$79l:function(k,P){var E=this,A=E.gv,y=A.getZoom(),s=A.getEditHelperSize(),V=k.x/y,G=k.y/y,J=s/y,F=J/2;return I({x:V-F,y:G-F,width:J,height:J},P)?!0:void 0},_79I:function(m,c){var y=this,j=y.gv,A=j.getZoom(),o=j.getEditPointSize(),K=o/A,Q=K/2;if(y.$16l){var b,M=y.$16l,F=M[3].x-M[7].x,L=M[3].y-M[7].y,U=_(F*F+L*L),X=M[1].x-M[5].x,k=M[1].y-M[5].y,s=_(X*X+k*k),D={x:c.x*A,y:c.y*A};if(y._80I(D,0,M[0],"northwest",U,s)||y._80I(D,1,M[1],"north",U,s)||y._80I(D,2,M[2],"northeast",U,s)||y._80I(D,7,M[7],"west",U,s)||y._80I(D,3,M[3],"east",U,s)||y._80I(D,6,M[6],"southwest",U,s)||y._80I(D,5,M[5],"south",U,s)||y._80I(D,4,M[4],"southeast",U,s))return!0}if(y.$23l){var T=y.$23l,W=T.x/A,e=T.y/A;if(I({x:W-Q,y:e-Q,width:K,height:K},c))return y.$40l=1,y.$12l="crosshair",!0}if(y.$68l&&y.$79l(y.$68l,c))return y.$67l=1,y.$12l="crosshair",!0;if(y.$69l&&y.$79l(y.$69l,c))return y.$67l=2,y.$12l="crosshair",!0;if(y.$70l&&y.$79l(y.$70l,c))return y.$67l=3,y.$12l="crosshair",!0;if(y.$71l&&y.$79l(y.$71l,c))return y.$67l=4,y.$12l="crosshair",!0;if(y.$82l&&y.$79l(y.$82l,c))return y.$67l=5,y.$12l="crosshair",!0;if(y.$83l&&y.$79l(y.$83l,c))return y.$67l=6,y.$12l="crosshair",!0;if(y._pointElevationHelperPoint&&y.$79l(y._pointElevationHelperPoint,c))return y.$67l=7,y.$12l="crosshair",!0;if(y.$90l&&y.$79l(y.$90l,c))return y.$67l=8,y.$12l="crosshair",!0;if(y.$91l&&y.$79l(y.$91l,c))return y.$67l=9,y.$12l="crosshair",!0;for(var d=y.$46l(m),G=0;G<d.length;G++){var b,$,x=d[G],f=j.getDataUI(x);if(f&&f._55O){var O=f._55O;if(O._43O&&x instanceof r){if(b=x.s("edge.points"),b=Yd(f,b),$=x.s("edge.segments"),$||($=Lp(b)),y.$42l(x,c,b._as,$,"edge"))return!0;"points"===x.s("edge.type")&&y.$41l(x,c,b._as,$,"edge")}if(O._43O&&x instanceof l&&O.$15l&&O.$15l.length===x.getPoints().size()){if(b=O.$15l,$=x.getSegments(),$||($=Lp(b)),y.$42l(x,c,b,$,"shape"))return!0;y.$41l(x,c,b,$,"shape")}}}return!1},_80I:function(r,q,_,j,B,l){var Y=this,H=Y.gv,O=H.getEditPointSize(),D=O/2,X=H.sm(),J=H.isDirectionEditable;if(J&&1===X.size()){var Z=X.ld();if(J=J.bind(H),Z instanceof d){if(!J(Z,j))return!1;if("east"===j){if(J(Z,"northeast")&&J(Z,"southeast")&&2*O>=l)return!1}else if("west"===j){if(J(Z,"northwest")&&J(Z,"southwest")&&2*O>=l)return!1}else if("north"===j){if(J(Z,"northwest")&&J(Z,"northeast")&&2*O>=B)return!1}else if("south"===j&&J(Z,"southwest")&&J(Z,"southeast")&&2*O>=B)return!1}}else{if(2*O>=B&&("north"===j||"south"===j))return!1;if(2*O>=l&&("east"===j||"west"===j))return!1}if(I({x:_.x-D,y:_.y-D,width:O,height:O},r)){if(Y.$10l!==j){var n=180*Y.$7l/a,v="";n>=337.5||22.5>n?v="north":n>=22.5&&67.5>n?v="northeast":n>=67.5&&112.5>n?v="east":n>=112.5&&157.5>n?v="southeast":n>=157.5&&202.5>n?v="south":n>=202.5&&247.5>n?v="southwest":n>=247.5&&292.5>n?v="west":n>=292.5&&337.5>n&&(v="northwest");var w=rj.indexOf(v),v=rj[q-(1-w)+8];switch(v){case"northwest":Y.$12l="nwse-resize";break;case"northeast":Y.$12l="nesw-resize";break;case"southwest":Y.$12l="nesw-resize";break;case"southeast":Y.$12l="nwse-resize";break;case"north":Y.$12l="ns-resize";break;case"east":Y.$12l="ew-resize";break;case"south":Y.$12l="ns-resize";break;case"west":Y.$12l="ew-resize"}Y.$10l=j}return!0}return!1},$42l:function(a,Z,x,q,p){var y,K=this,b=K.gv,S=b.getEditPointSize(),B=S/b.getZoom(),D=-1,w={x:Z.x,y:Z.y,width:0,height:0},A=function(W){"shape"===p?K._shape=a:K._edge=a,K._removePointIndex=W},J=function(v){"shape"===p?K._shape=a:K._edge=a,K.$13l=v,K.$12l="crosshair"};for($(w,B/2),D=x.length-1,y=q.size()-1;y>=0;y--){var k=q.get(y);if(1===k||2===k)D-=1;else if(3===k){var n=x[D-1];if(I(w,n))return J(D-1),!0;D-=2}else if(4===k){var W=x[D-1],f=x[D-2];if(I(w,W))return J(D-1),!0;if(I(w,f))return J(D-2),!0;D-=3}}for(D=x.length-1,y=q.size()-1;y>=0;y--){var k=q.get(y),G=x[D];if(I(w,G))return A(D),J(D),!0;1===k||2===k?D-=1:3===k?D-=2:4===k&&(D-=3)}return!1},$41l:function(_,O,t,j,n){var G=this,v=G.gv,B=-1,w=0,Y={x:O.x,y:O.y,width:0,height:0},Q=function(l,g){G._hoverSegmentIndex=g,G._lp=O,"shape"===n?G._shape=_:G._edge=_};for($(Y,v.getSegmentHoverWidth()/2/v.getZoom()),_ instanceof l&&_.isClosePath()&&j.indexOf(5)<0&&(j=new i(j._as),j.add(5));w<j.size();w++){var N=j.get(w);if(1===N){var P=t[B],x=t[B+1];if(P){var L=Xl(new pe(P.x,P.y),new pe(x.x,x.y),new pe(Y.x,Y.y),new pe(Y.x+Y.width,Y.y+Y.height));if(L.$62l===f&&L.points.length>0)return Q(L,w),!0}B+=1}else if(2===N){var P=t[B],x=t[B+1],L=Xl(new pe(P.x,P.y),new pe(x.x,x.y),new pe(Y.x,Y.y),new pe(Y.x+Y.width,Y.y+Y.height));if(L.$62l===f&&L.points.length>0)return Q(L,w),!0;B+=1}else if(3===N){var P=t[B],V=t[B+1],e=t[B+2],L=dg(new pe(P.x,P.y),new pe(V.x,V.y),new pe(e.x,e.y),new pe(Y.x,Y.y),new pe(Y.x+Y.width,Y.y+Y.height));if(L.$62l===f)return Q(L,w),!0;B+=2}else if(4===N){var P=t[B],A=t[B+1],a=t[B+2],e=t[B+3],L=Td(new pe(P.x,P.y),new pe(A.x,A.y),new pe(a.x,a.y),new pe(e.x,e.y),new pe(Y.x,Y.y),new pe(Y.x+Y.width,Y.y+Y.height));if(L.$62l===f)return Q(L,w),!0;B+=3}else if(5===N){var P=t[B],x=t[0];if(P){var L=Xl(new pe(P.x,P.y),new pe(x.x,x.y),new pe(Y.x,Y.y),new pe(Y.x+Y.width,Y.y+Y.height));if(L.$62l===f&&L.points.length>0)return Q(L,w),!0}}}return!1},addShapePoint:function(q,v,d){var e=this,u=e.gv,U=u.dm(),y=U.getHistoryManager();if(y&&y.beginInteraction(),0===arguments.length&&(q=e._shape||e._edge,v=e._hoverSegmentIndex,d=e._lp),q instanceof l||q instanceof r){var F=yf(q,u.getDataUI(q),v);if(!isNaN(v)&&d&&!isNaN(F)){var x=d;if(q instanceof l){var G=q.p(),t=q.getRotation(),B=q.toSegments();B||(B=Lp(q.getPoints())),q.isClosePath()&&B.indexOf(5)<0&&(B=new i(B._as),B.add(5));var E=B.get(v),Z="addPoint",w="removePointAt";if(2===E||1===E){var X={x:x.x,y:x.y};B.add(E,v),X=Ih(G,X.x-G.x,X.y-G.y,-t),q[Z](X,F+1)}else if(3===E){var R=q.getPoints(),C=R.get(F),K=R.get(F+2),X={x:x.x,y:x.y};X=Ih(G,X.x-G.x,X.y-G.y,-t);var D=Uq(C,X),V=Uq(X,K);B.removeAt(v),B.add(3,v),B.add(3,v),q.setPoint(F+1,X),q[Z](V,F+2),q[Z](D,F+1)}else if(4===E){var R=q.getPoints(),C=R.get(F),K=R.get(F+3),X={x:x.x,y:x.y};X=Ih(G,X.x-G.x,X.y-G.y,-t);var D=Un(C,X),V=cn(C,X),m=Un(X,K),z=cn(X,K);B.removeAt(v),B.add(4,v),B.add(4,v),q[w](F+1),q[w](F+1),q[Z](X,F+1),q[Z](z,F+2),q[Z](m,F+2),q[Z](V,F+1),q[Z](D,F+1)}else if(5===E){var X={x:x.x,y:x.y};B.add(2,v),X=Ih(G,X.x-G.x,X.y-G.y,-t),q[Z](X,F+1)}q.isClosePath()&&B.remove(5),q.setSegments(B);var M=q.getWidth(),J=q.getHeight(),o=q.p().x-M/2,I=q.p().y-J/2;o-=G.x,I-=G.y;var A=jh(q,{x:o,y:I,width:M,height:J},t,G);q.p(A.x,A.y)}else if(q instanceof r){if("points"!==q.s("edge.type"))return y&&y.endInteraction(),void 0;var R=q.s("edge.points");B=q.s("edge.segments"),R=Yd(u.getDataUI(q),R),B||(B=Lp(R)),B=new i(B._as.slice(0)),R=new i(R._as.slice(0));var E=B.get(v);if(2===E||1===E){var X={x:x.x,y:x.y};B.add(E,v),R.add(X,F+1)}else if(3===E){var C=R.get(F),K=R.get(F+2),X={x:x.x,y:x.y},D=Uq(C,X),V=Uq(X,K);B.removeAt(v),B.add(3,v),B.add(3,v),R.set(F+1,X),R.add(V,F+2),R.add(D,F+1)}else if(4===E){var C=R.get(F),K=R.get(F+3),X={x:x.x,y:x.y},D=Un(C,X),V=cn(C,X),m=Un(X,K),z=cn(X,K);B.removeAt(v),B.add(4,v),B.add(4,v),R.removeAt(F+1),R.removeAt(F+1),R.add(X,F+1),R.add(z,F+2),R.add(m,F+2),R.add(V,F+1),R.add(D,F+1)}q.s("edge.points",Jk(R)),q.s("edge.segments",B)}}}y&&y.endInteraction()},removeShapePoint:function(o,O){var d=this,J="removeAt",Y=d.gv,R=Y.dm(),j=R.getHistoryManager();if(j&&j.beginInteraction(),0===arguments.length&&(o=d._shape||d._edge,O=d._removePointIndex),O>=0&&(o instanceof l||o instanceof r)){var H=df(o,d.gv.getDataUI(o),O),F=O;if(o instanceof l){var W=o.p(),c=o.toSegments();c||(c=Lp(o.getPoints()));var L=c.get(H),z="removePointAt";if(1===L&&0===F)if(o.getPoints().size()>1){var u=c.get(H+1);c[J](H+1),3===u?o[z](F+1):4===u&&(o[z](F+2),o[z](F+1)),o[z](F)}else o.dm().remove(o);else 2===L||1===L?(c[J](H),o[z](F)):3===L?(c[J](H),o[z](F),o[z](F-1)):4===L&&(c[J](H),o[z](F),o[z](F-1),o[z](F-2));o.setSegments(c);var $=o.getWidth(),_=o.getHeight(),U=o.p().x-$/2,X=o.p().y-_/2;U-=W.x,X-=W.y;var G=jh(o,{x:U,y:X,width:$,height:_},o.getRotation(),W);o.p(G.x,G.y)}else if(o instanceof r){if("points"!==o.s("edge.type"))return j&&j.endInteraction(),void 0;var Q=o.s("edge.points");if(c=o.s("edge.segments"),Q&&(Q=Yd(d.gv.getDataUI(o),Q),c||(c=Lp(Q))),0===O||O===Q.size()-1)return j&&j.endInteraction(),void 0;c=new i(c._as.slice(0)),Q=new i(Q._as.slice(0));var L=c.get(H);2===L||1===L?(c[J](H),Q[J](F)):3===L?(c[J](H),Q[J](F),Q[J](F-1)):4===L&&(c[J](H),Q[J](F),Q[J](F-1),Q[J](F-2)),o.s("edge.segments",c),o.s("edge.points",Jk(Q))}}j&&j.endInteraction()},changeShapeSegment:function(g,m,D){var v=this,a=v.gv,N=a.dm(),J=N.getHistoryManager();if(J&&J.beginInteraction(),1!==arguments.length||isNaN(g)||(D=g,g=v._shape||v._edge,m=v._hoverSegmentIndex),g instanceof l||g instanceof r){var o=yf(g,v.gv.getDataUI(g),m);if(!isNaN(m)&&!isNaN(o))if(g instanceof l){var X=g.p(),F=g.toSegments();F||(F=Lp(g.getPoints()));var W=F.get(m),C=g.toPoints();if(1===D||2===D)1===W||2===W?F.set(m,D):3===W?(F.set(m,D),C.removeAt(o+1)):4===W&&(F.set(m,D),C.removeAt(o+1),C.removeAt(o+1));else if(3===D){var e=function(){var r=C.get(o),z=C.get(o+1),l=Uq(r,z);F.set(m,3),C.add(l,o+1)};2===W||1===W?e():4===W&&(C.removeAt(o+1),C.removeAt(o+1),e())}else if(4===D){var w=function(){var H=C.get(o),E=C.get(o+1),l=Un(H,E),G=cn(H,E);F.set(m,4),C.add(l,o+1),C.add(G,o+2)};2===W||1===W?w():3===W&&(C.removeAt(o+1),w())}g.setSegments(F),g.setPoints(C);var O=g.getWidth(),Q=g.getHeight(),T=g.p().x-O/2,U=g.p().y-Q/2;T-=X.x,U-=X.y;var V=new jh(g,{x:T,y:U,width:O,height:Q},g.getRotation(),X);g.p(V.x,V.y)}else if(g instanceof r){if("points"!==g.s("edge.type"))return J&&J.endInteraction(),void 0;var C=g.s("edge.points");F=g.s("edge.segments"),C&&(C=Yd(v.gv.getDataUI(g),C),F||(F=Lp(C))),F=new i(F._as.slice(0)),C=new i(C._as.slice(0));var W=F.get(m);if(1===D||2===D)1===W||2===W?F.set(m,D):3===W?(F.set(m,D),C.removeAt(o+1)):4===W&&(F.set(m,D),C.removeAt(o+1),C.removeAt(o+1));else if(3===D){var e=function(){var I=C.get(o),W=C.get(o+1),v=Uq(I,W);F.set(m,3),C.add(v,o+1)};2===W||1===W?e():4===W&&(C.removeAt(o+1),C.removeAt(o+1),e())}else if(4===D){var w=function(){var v=C.get(o),E=C.get(o+1),l=Un(v,E),W=cn(v,E);F.set(m,4),C.add(l,o+1),C.add(W,o+2)};2===W||1===W?w():3===W&&(C.removeAt(o+1),w())}g.s("edge.points",Jk(C)),g.s("edge.segments",F)}}J&&J.endInteraction()},getDefaultSegments:function(F){var o=this.gv,t=o.getDataUI(F);if(F instanceof r){var j=F.s("edge.points");return j=Yd(t,j),Lp(j)}if(F instanceof l){var j=F.getPoints(),U=F.getSegments();return U&&U.size()>0?U:Lp(j)}},$43l:function(f){var G=this;f&&(G.$5l=1),G._68I=1,G._42()},_42:function(){var Z=this;if(Z._68I){delete Z._68I;var x=Z.gv,Q=Z.$5l,u=x.getZoom(),E=x.getEditPointSize(),L=E/2,h=new i,D=Z._view,H=Z._edge,U=Z._shape,n=D.getContext("2d"),s=x.tx(),I=x.ty(),A=X,O=x.getEditPointBackground(),b=x.getControlPointBackground(),c=x.getControlPointBorderColor(),C=x.getEditPointBorderColor(),T=x.getEditRectBorderColor(),g=x.getDirectionLineColor(),t=x.getSegmentHoverColor(),R=x.getSnapPointBorderColor(),v=x.getJoinPointBackground(),M=x.getJoinPointBorderColor(),K=x.getSegmentHoverWidth(),N=[5,5],y=x.getEditRectBorderStyle();ge(x,function(O){x.isSelected(O)&&x.isVisible(O)&&h.add(O)}),n.clearRect(0,0,j(D.width),j(D.height)),n.save(),F.translateAndScale(n,s,I,1);var a=X,f={x:0,y:0,width:0,height:0},e=0,p=0,G=0,Y=0,J=0,k=0,Rc=0,hm=0,Zr=0,$g=0,we=[];if(Q?(delete Z.$6l,delete Z.$8l,delete Z.$7l,delete Z.$16l,delete Z.$23l):(a=Z.$6l,A=Z.$7l),delete Z.$68l,delete Z.$69l,delete Z.$71l,delete Z.$70l,delete Z.$82l,delete Z.$83l,delete Z._pointElevationHelperPoint,delete Z.$90l,delete Z.$91l,delete Z.$75l,delete Z.$74l,h.each(function(a){var v=x.getDataUI(a);if(v){var w=v._55O;if(x.isEditable(a))w._56O&&a instanceof d&&p++,we.push(a),w._42O&&a instanceof d&&e++,x.isHelperEditable(a,"host")&&Y++,x.isHelperEditable(a,"parent")&&G++,x.isHelperEditable(a,"remove")&&J++,x.isHelperEditable(a,"edge")&&k++,x.isHelperEditable(a,"source")&&Rc++,x.isHelperEditable(a,"target")&&hm++,x.isHelperEditable(a,"elevation")&&Zr++,x.isHelperEditable(a,"tall")&&$g++;else if(a instanceof z&&a.isExpanded()){var Z=!0,f=x.getEditableFunc();f&&(Z=f(a)),Z&&(x.isHelperEditable(a,"host")&&Y++,x.isHelperEditable(a,"parent")&&G++,x.isHelperEditable(a,"remove")&&J++,x.isHelperEditable(a,"edge")&&k++,x.isHelperEditable(a,"source")&&Rc++,x.isHelperEditable(a,"target")&&hm++,x.isHelperEditable(a,"elevation")&&Zr++,x.isHelperEditable(a,"tall")&&$g++,we.push(a))}}}),n.beginPath(),n.lineWidth=1,n.strokeStyle=x.getNodeBorderColor(),we.forEach(function(i){var H=x.getDataUI(i),o=H._55O;if(Q)if(A==X&&(A=i instanceof r?0:i instanceof z&&i.isExpanded()?0:i.getRotation(),Z.$7l=A),a==X){var N,U,C;if(i instanceof z&&i.isExpanded()||i instanceof r){var _=x.getDataUIBounds(i);U=_.width,C=_.height,N={x:_.x+U/2,y:_.y+C/2}}else N=i.p(),U=i.getWidth(),C=i.getHeight();a={x:N.x,y:N.y,width:0,height:0},f.x=N.x-U/2,f.y=N.y-C/2,f.width=U,f.height=C,a=S(a,f)}else{var N,U,C,$,y=a.x+a.width/2,k=a.y+a.height/2,l={x:y,y:k};if(i instanceof z&&i.isExpanded()||i instanceof r){$=0;var _=x.getDataUIBounds(i);U=_.width,C=_.height,N={x:_.x+U/2,y:_.y+C/2}}else N=i.p(),U=i.getWidth(),C=i.getHeight(),$=i.getRotation();var G={x:N.x-U/2,y:N.y-C/2,width:U,height:C},h={x:G.x,y:G.y},E={x:G.x+G.width,y:G.y},D={x:G.x,y:G.y+G.height},p={x:G.x+G.width,y:G.y+G.height},h=Ih(N,h.x-N.x,h.y-N.y,$),D=Ih(N,D.x-N.x,D.y-N.y,$),p=Ih(N,p.x-N.x,p.y-N.y,$),E=Ih(N,E.x-N.x,E.y-N.y,$),s=-A,V=Ih(l,h.x-l.x,h.y-l.y,s),J=Ih(l,E.x-l.x,E.y-l.y,s),T=Ih(l,D.x-l.x,D.y-l.y,s),M=Ih(l,p.x-l.x,p.y-l.y,s),R=B([V,J,T,M]);a=S(a,R),a.x-=y,a.y-=k;var P=jh(X,a,A,l);a.x=P.x-a.width/2,a.y=P.y-a.height/2}if(e>1&&x.isEditable(i)&&x.isRectEditable(i)&&i instanceof d){var K=i.getRect(),b=o.$45l,W=Ed(b[0],u),q=Ed(b[2],u),O=Ed(b[4],u),g=Ed(b[6],u);i.getRotation()?(n.moveTo(W.x,W.y),n.lineTo(q.x,q.y),n.lineTo(O.x,O.y),n.lineTo(g.x,g.y),n.lineTo(W.x,W.y)):n.rect(K.x*u,K.y*u,K.width*u,K.height*u)}}),n.stroke(),h.each(function(O){var G=x.getDataUI(O);if(G){var D,h,I=G._55O,f=G._78o;if(I&&I._43O&&O instanceof l?(D=I.$15l,h=O.getSegments(),h||(h=Lp(D)),O.isClosePath()&&h.indexOf(5)<0&&(h=new i(h._as),h.add(5))):I&&f&&I._43O&&(D=O.s("edge.points"),h=O.s("edge.segments"),D=Yd(G,D),h||(h=Lp(D)),D&&(D=D._as)),D&&h){var a=0,k=h.size(),s=Z._hoverSegmentIndex;D=D.slice(0);for(var V=0;V<D.length;V++)D[V]=Ed(D[V],u);n.beginPath(),n.strokeStyle=g,n.lineWidth=1,a=0;for(var V=0;k>V;V++){var $=h.get(V);if(1===$||2===$)a++;else if(3===$){var p=D[a-1],e=D[a],S=D[a+1];n.moveTo(p.x,p.y),n.lineTo(e.x,e.y),n.lineTo(S.x,S.y),a+=2}else if(4===$){var p=D[a-1],w=D[a],j=D[a+1],S=D[a+2];n.moveTo(p.x,p.y),n.lineTo(w.x,w.y),n.moveTo(j.x,j.y),n.lineTo(S.x,S.y),a+=3}}if(n.stroke(),U===O||H===O&&"points"===H.s("edge.type")){n.beginPath(),a=0,n.strokeStyle=t,n.lineWidth=K;for(var V=0;k>V;V++){var $=h.get(V);if(1===$||2===$){if(s===V){var p=D[a-1],S=D[a];n.moveTo(p.x,p.y),n.lineTo(S.x,S.y);break}a++}else if(3===$){if(s===V){var p=D[a-1],e=D[a],S=D[a+1];n.moveTo(p.x,p.y),n.quadraticCurveTo(e.x,e.y,S.x,S.y);break}a+=2}else if(4===$){if(s===V){var p=D[a-1],w=D[a],j=D[a+1],S=D[a+2];n.moveTo(p.x,p.y),n.bezierCurveTo(w.x,w.y,j.x,j.y,S.x,S.y);break}a+=3}else if(5===$&&s===V){var p=D[a-1],S=D[0];n.moveTo(p.x,p.y),n.lineTo(S.x,S.y);break}}n.stroke()}n.beginPath(),a=0,n.strokeStyle=M,n.lineWidth=1,n.fillStyle=v;for(var V=0;k>V;V++){var $=h.get(V);if(1===$||2===$){var S=D[a];n.moveTo(S.x+L,S.y),n.arc(S.x,S.y,L,0,W,!0),a++}else if(3===$){var S=D[a+1];n.moveTo(S.x+L,S.y),n.arc(S.x,S.y,L,0,W,!0),a+=2}else if(4===$){var S=D[a+2];n.moveTo(S.x+L,S.y),n.arc(S.x,S.y,L,0,W,!0),a+=3}}n.fill(),n.stroke(),n.beginPath(),a=0,n.strokeStyle=c,n.lineWidth=1,n.fillStyle=b;for(var V=0;k>V;V++){var $=h.get(V);if(1===$||2===$)a++;else if(3===$){var e=D[a];n.moveTo(e.x+L,e.y),n.arc(e.x,e.y,L,0,W,!0),a+=2}else if(4===$){var w=D[a],j=D[a+1];n.moveTo(w.x+L,w.y),n.arc(w.x,w.y,L,0,W,!0),n.moveTo(j.x+L,j.y),n.arc(j.x,j.y,L,0,W,!0),a+=3}}if(n.fill(),n.stroke(),n.beginPath(),a=0,n.strokeStyle=R,n.lineWidth=2,(U===O||H===O)&&Z.$9l!=X){var S=D[Z.$9l];n.moveTo(S.x+L,S.y),n.arc(S.x,S.y,L,0,W,!0),n.stroke()}}}}),a){Z.$6l=V(a),$(a,x.getEditRectPadding()/u);var sl={x:a.x+a.width/2,y:a.y+a.height/2},yl=yd(sl,a.width,a.height,A),nn=yl[0],$h=yl[1],Ni=yl[2],fp=yl[3],Lj=yl[4],gn=yl[5],Wo=yl[6],ze=yl[7];if(nn=Ed(yl[0],u),$h=Ed(yl[1],u),Ni=Ed(yl[2],u),fp=Ed(yl[3],u),Lj=Ed(yl[4],u),gn=Ed(yl[5],u),Wo=Ed(yl[6],u),ze=Ed(yl[7],u),Z.$8l=a,e>0&&(Z.$16l=[nn,Lj,$h,gn,fp,Wo,Ni,ze],n.beginPath(),n.lineWidth=1,n.strokeStyle=T,"dashed"===y&&n.setLineDash&&n.setLineDash(N),n.moveTo(nn.x,nn.y),n.lineTo($h.x,$h.y),n.lineTo(fp.x,fp.y),n.lineTo(Ni.x,Ni.y),n.lineTo(nn.x,nn.y),n.stroke(),"dashed"===y&&n.setLineDash&&n.setLineDash([])),n.beginPath(),n.lineWidth=1,n.fillStyle=O,n.strokeStyle=C,e>0){var $p=gn.x-ze.x,Tb=gn.y-ze.y,er=_($p*$p+Tb*Tb),Zm=Lj.x-Wo.x,Tk=Lj.y-Wo.y,kq=_(Zm*Zm+Tk*Tk),hr=2*E;if(x.isDirectionEditable&&1===we.length){var Oj=we[0],To=x.getDataUI(Oj),Ch=To._55O,zr=x.isDirectionEditable.bind(x);if(Ch._42O){var Tg,Af,xh,lb;zr(Oj,"northwest")&&(Tg=!0,n.rect(nn.x-L,nn.y-L,E,E)),zr(Oj,"northeast")&&(Af=!0,n.rect($h.x-L,$h.y-L,E,E)),zr(Oj,"southwest")&&(xh=!0,n.rect(Ni.x-L,Ni.y-L,E,E)),zr(Oj,"southeast")&&(lb=!0,n.rect(fp.x-L,fp.y-L,E,E)),zr(Oj,"north")&&(Tg&&Af?er>hr&&n.rect(Lj.x-L,Lj.y-L,E,E):n.rect(Lj.x-L,Lj.y-L,E,E)),zr(Oj,"south")&&(lb&&xh?er>hr&&n.rect(Wo.x-L,Wo.y-L,E,E):n.rect(Wo.x-L,Wo.y-L,E,E)),zr(Oj,"west")&&(xh&&Tg?kq>hr&&n.rect(ze.x-L,ze.y-L,E,E):n.rect(ze.x-L,ze.y-L,E,E)),zr(Oj,"east")&&(lb&&Af?kq>hr&&n.rect(gn.x-L,gn.y-L,E,E):n.rect(gn.x-L,gn.y-L,E,E))}}else er>hr&&(n.rect(Lj.x-L,Lj.y-L,E,E),n.rect(Wo.x-L,Wo.y-L,E,E)),kq>hr&&(n.rect(gn.x-L,gn.y-L,E,E),n.rect(ze.x-L,ze.y-L,E,E)),n.rect(nn.x-L,nn.y-L,E,E),n.rect($h.x-L,$h.y-L,E,E),n.rect(Ni.x-L,Ni.y-L,E,E),n.rect(fp.x-L,fp.y-L,E,E)}if(p>0){var di=Z.$23l=Ih(Lj,0,2*-E,A);n.moveTo(di.x+L,di.y),n.arc(di.x,di.y,L,0,W,!1)}n.fill(),n.stroke(),Z.$40l&&Z.$44l(n,a,A);var Cr,Of,qd=x.getLeftTopHelpers(),dl=x.getRightTopHelpers(),Nf=x.getLeftBottomHelpers(),cf=x.getRightBottomHelpers(),gg=x.getEdgeHelpers(),hj=x.getEditHelperSize(),he=hj/2,Se=function(g,z,h,P){"leftTop"===z?(Cr=a.x*u-hj-L-("h"===P?h*(hj+L):0)-1,Of=a.y*u-hj-L-("v"===P?h*(hj+L):0)-1):"rightTop"===z?(Cr=(a.x+a.width)*u+L+("h"===P?h*(hj+L):0)+1,Of=a.y*u-hj-L-("v"===P?h*(hj+L):0)-1):"leftBottom"===z?(Cr=a.x*u-hj-L-("h"===P?h*(hj+L):0)-1,Of=(a.y+a.height)*u+L+("v"===P?h*(hj+L):0)+1):"rightBottom"===z&&(Cr=(a.x+a.width)*u+L+("h"===P?h*(hj+L):0)+1,Of=(a.y+a.height)*u+L+("v"===P?h*(hj+L):0)+1);var I=Cr+he,f=Of+he,H=(a.x+a.width/2)*u,j=(a.y+a.height/2)*u,$=Ih({x:H,y:j},I-H,f-j,A);if("host"===g){if(Y>0)return Z.$77l(n,A,$),!0}else if("edge"===g){if(k>0)return Z.$80l(n,A,$),!0}else if("remove"===g){if(J>0)return we&&1===we.length&&we[0]instanceof r?Z.$81l(n,A,{x:H+hj/2+5,y:j}):Z.$81l(n,A,$),!0}else if("parent"===g){if(G>0)return we&&1===we.length&&we[0]instanceof r?Z.$76l(n,A,{x:H-hj/2-5,y:j}):Z.$76l(n,A,$),!0}else if("elevation"===g){if(Zr>0)return Z.$85l(n,A,$),!0}else if("tall"===g){if($g>0)return Z.$86l(n,A,$),!0}else if("source"===g||"target"===g){var W=we[0],Q=x.getDataUI(W),q=od(Q,!0),O=q[0],F=q[1];if(Rc&&"source"===g)return Z.$84l(n,a,O,!0,W.isLooped(),z,h,P),!0;if(hm&&"target"===g)return Z.$84l(n,a,F,!1,W.isLooped(),z,h,P),!0}};if(qd&&qd.length>0){var _o=0;qd.forEach(function(l){Se(l,"leftTop",_o,x.getLeftTopHelpersAlign()||"h")&&_o++})}if(dl&&dl.length>0){var _o=0;dl.forEach(function(s){Se(s,"rightTop",_o,x.getRightTopHelpersAlign()||"h")&&_o++})}if(Nf&&Nf.length>0){var _o=0;Nf.forEach(function(Y){Se(Y,"leftBottom",_o,x.getLeftBottomHelpersAlign()||"h")&&_o++})}if(cf&&cf.length>0){var _o=0;cf.forEach(function(c){Se(c,"rightBottom",_o,x.getRightBottomHelpersAlign()||"h")&&_o++})}if(gg&&gg.length>0&&((Rc||hm)&&we&&1===we.length&&we[0]instanceof r?!0:!1)){var _o=0;gg.forEach(function(H){Se(H,"edge",_o,"h")&&_o++})}if(Z.$72l){var uf,yj=Z.$67l,jl=Z.$68l,Gk=Z.$69l,gp=(Z.$71l,Z.$70l),li=Z.$82l,Uf=Z.$83l;if(1===yj?uf=jl:2===yj?uf=Gk:3===yj?uf=gp:5===yj?uf=li:6===yj&&(uf=Uf),uf){var pf=x.lp(Z.$72l),Ig=x.getDataAt(Z.$72l);if(Ig&&Ig instanceof d){var Mj,fs,yh;if(Z.$73l=Ig,1===yj)if(Ig instanceof m.Grid)Mj=Z.$75l=On(Ig,pf);else if(Ig instanceof m.Shape){yh=Z.$74l=cr(Ig,pf);var on=Ig.getPoints();if(yh){var iq=yh.attachIndex,Ug=yf(Ig,x.getDataUI(Ig),iq)+1,bn=Ug+1>=on.size()?0:Ug+1,fn=on.get(Ug),lr=on.get(bn),Sh=Ig.p(),Ud=Ig.getRotation();fn=Ih(Sh,fn.x-Sh.x,fn.y-Sh.y,Ud),lr=Ih(Sh,lr.x-Sh.x,lr.y-Sh.y,Ud),n.beginPath(),n.strokeStyle=t,n.lineWidth=K,n.moveTo(fn.x*u,fn.y*u),n.lineTo(lr.x*u,lr.y*u),n.stroke()}}Mj?fs=Mj.rect:(fs=w.clone(x.getDataUIBounds(Ig)),w.grow(fs,2)),n.beginPath(),n.rect(fs.x*u,fs.y*u,fs.width*u,fs.height*u),n.strokeStyle=1===yj||4===yj||6===yj?q:P,n.lineWidth=2,n.setLineDash&&n.setLineDash([8,8]),n.stroke()}else delete Z.$73l;pf.x=pf.x*u,pf.y=pf.y*u;var fb=el(uf.x,uf.y,pf.x,pf.y),Lq=Ih(uf,pf.x-uf.x,pf.y-uf.y,-fb),cg=Lq.x-uf.x;n.translate(uf.x,uf.y),n.rotate(fb),o.width=cg,o.height=40;var kr=P;(1===yj||4===yj||6===yj)&&(kr=q),o.comps[0].gradientColor=kr,w.drawImage(n,o,0,-20,cg,40)}}}if(Z.$87l&&x.sm().contains(Z.$87l)){var sb,Dg=Z.$87l,Uk=Z.$88l,hj=x.getEditHelperSize(),he=hj/2;if(x.isHelperEditable(Dg,"pointElevation"))if(Dg instanceof l){var Hd=Dg.getPosition();sb=w.clone(Dg.getPoints().get(Uk)),sb=Ih({x:Hd.x,y:Hd.y},sb.x-Hd.x,sb.y-Hd.y,Dg.getRotation()),sb.x*=u,sb.y*=u,n.translate(sb.x,sb.y),w.drawImage(n,Fh,he,-he,hj,hj),n.translate(-sb.x,-sb.y),Z._pointElevationHelperPoint={x:sb.x+hj,y:sb.y}}else if(Dg instanceof r){var yc=Yd(x.getDataUI(Dg),Dg.s("edge.points")),sb=w.clone(yc.get(Uk));sb.x*=u,sb.y*=u,n.translate(sb.x,sb.y),w.drawImage(n,Fh,he,-he,hj,hj),n.translate(-sb.x,-sb.y),Z._pointElevationHelperPoint={x:sb.x+hj,y:sb.y}}}n.restore(),Z.$5l=0}},$89l:function(V,I,h,f){V.save();var X=this,y=X.gv,C=y.getEditHelperSize(),m=C/2;V.beginPath(),V.translate(h.x,h.y),V.rotate(I),w.drawImage(V,f,-m,-m,C,C),V.restore()},$85l:function(L,F,M){var C=this;C.$90l=M,C.$89l(L,F,M,Fh)},$86l:function(X,U,c){var D=this;D.$91l=c,D.$89l(X,U,c,vo)},$77l:function(p,F,D){var w=this;w.$68l=D,w.$89l(p,F,D,g)},$80l:function(T,f,S){var i=this;i.$70l=S,i.$89l(T,f,S,G)},$81l:function(d,W,l){var I=this;I.$71l=l,I.$89l(d,W,l,Qf)},$76l:function(F,T,N){var n=this;n.$69l=N,n.$89l(F,T,N,t)},$84l:function(y,r,C,o,m){var Z,S=this,v=S.gv,c=v.getZoom(),H=v.getEditHelperSize(),x=H/2;C.x*=c,C.y*=c,m&&(o?C.x-=x+5:C.x+=x+5),C.y-=H-2,o?(S.$82l=C,Z=Rb):(S.$83l=C,Z=pk),y.beginPath(),y.translate(C.x,C.y),w.drawImage(y,Z,-x,-x,H,H),y.translate(-C.x,-C.y)},$44l:function(y,i,z){y.save();var I=this.gv.getZoom(),d=_(M(i.width,2)+M(i.height,2))/2*I+10,v=d,P=v+8,S=v+18,X=z,F=i.x+i.width/2,c=i.y+i.height/2;y.translate(F*I,c*I),y.beginPath(),y.strokeStyle="rgb(150, 150, 150)";for(var w=0,Y=0,B=0,r=0,g=0,U=0;360>U;U++)w=U*a/180,0===U%5&&(Y=s(w)*v,B=e(w)*v,r=s(w)*P,g=e(w)*P,y.moveTo(Y,B),y.lineTo(r,g)),0===U%45&&(Y=s(w)*v,B=e(w)*v,r=s(w)*S,g=e(w)*S,y.moveTo(Y,B),y.lineTo(r,g));y.stroke(),y.beginPath(),y.rotate(-p),y.beginPath(),y.fillStyle="rgba(255, 0, 0, 0.1)",y.strokeStyle="rgb(157, 157, 157)",y.moveTo(0,0),y.arc(0,0,S,0,z,!1),y.fill(),y.beginPath(),y.moveTo(0+S,0),y.arc(0,0,S,0,z,!1),y.stroke(),y.rotate(p),y.font="bold 12px Verdana, Arial";var $=20*e(X),j=20*s(X),b=u(180*X/a)+"°";y.textAlign="center",y.textBaseline="middle",y.beginPath();var O=y.measureText("365.°").width;y.fillStyle="white",y.rect($-O/2,-j-10,O,20),y.fill(),y.beginPath(),y.fillStyle="rgb(79,79,79)",y.fillText(b,$,-j),y.restore()}})}(this,Object);