!function(a,b,c){"use strict";var d=Math.cos,e=Math.sin,f=ht.Default,g=Math.PI,h=function(a,b,c,f){var g=e(f),h=d(f),i=h*b-g*c,j=g*b+h*c;return a?{x:a.x+i,y:a.y+j}:{x:i,y:j}},i=function(){var a=ht.Default.isIsolating||ht.Default.getInternal().isIsolating;if(!a()){var b=this,c=this.getHost();if(c instanceof k||c instanceof j){var d;d=c instanceof j?c.getPipeHoleBoundsByHoleIndex(b.getHoleIndex()):c.getPipeCellBoundsByCellIndex(b.getCellIndex());var e=c.getPosition(),f=c.getWidth(),g=c.getHeight(),i=c.getRotation();if(null!=d)if(b.setSize(d.width,d.height),b.setRotation(i),i){var l=h(e,d.x-f/2+d.width/2,d.y-g/2+d.height/2,i);b.setPosition(l.x,l.y)}else b.setPosition(e.x-f/2+d.x+d.width/2,e.y-g/2+d.y+d.height/2)}}};ht.IsGetter.centerHole=1,ht.IsGetter.horizonal=1,ht.IsGetter.reverse=1;var j=ht.RoundPipeNode=function(){j.superClass.constructor.apply(this),this.s("shape3d","cylinder"),this.setHoleCount(6),this.setReverse(!1)};f.def(j,ht.Node,{ms_ac:["reverse","holeCount","centerHole","holeIndex"],handleHostPropertyChange:function(a){var b=this.getHost(),c=this.getHoleIndex();c<b.getHoleCount()?a&&"attaches"!==a.property&&i.call(this,a):j.superClass.handleHostPropertyChange.call(this,a)},validateHoles:function(){for(var a=this,b={width:{func:function(a){return a._width||10}},height:{func:function(a){return a._height||10}},comps:[{type:"circle",rect:{func:function(b){var c=b.getWidth(),d=b.getHeight(),e=Math.min(c,d),f=a.s("shape.border.width")||0;return[c/2-e/2+f/2,d/2-e/2+f/2,0>=e-f?1:e-f,0>=e-f?1:e-f]}},pattern:{func:"style@shape.pattern"},background:"rgba(203, 203, 203, 0.1)",borderWidth:{func:"style@shape.border.width"},borderColor:{func:"style@shape.border.color"},gradient:"radial.northwest",gradientColor:"#FFF"}]},c=0;c<a.getHoleCount();c++){var d={type:"circle",rect:{func:function(a){return function(b){var c=b.getPipeHoleBoundsByHoleIndex(a);return[c.x,c.y,c.width,c.height]}}(c)},background:null,borderWidth:1,borderColor:"rgb(0, 185, 30)",gradient:"radial.northwest",gradientColor:"#FFF"};b.comps.push(d)}a.setImage(b)},onPropertyChanged:function(a){var b=this;j.superClass.onPropertyChanged.call(b,a),"reverse"===a.property||"holeCount"===a.property||"centerHole"===a.property?b.validateHoles():("holeIndex"===a.property||"host"===a.property)&&i.call(b)},getAttachByHoleIndex:function(a){var b=this.getAttaches();if(b)for(var c=0;c<b.size();c++){var d=b.get(c);if(d.getHoleIndex()===a)return d}},getHoleIndexByPoint:function(a,b){for(var c=this,d=c.getHoleCount(),e={x:a-c.getPosition().x+c.getWidth()/2,y:b-c.getPosition().y+c.getHeight()/2},g=0;d>g;g++){var h=c.getPipeHoleBoundsByHoleIndex(g);if(f.containsPoint(h,e))return g}},removeHole:function(a){var b=this.getAttaches(),c=this._holeCount;if(b){for(var d,e=0;e<b.size();e++){var f=b.get(e);f.getHoleIndex()===a?d=f:f.getHoleIndex()>a&&f.setHoleIndex(f.getHoleIndex()-1)}d&&(d.setHost(null),this._dataModel.remove(d))}this.setHoleCount(c-1)},removeHoleByPoint:function(a,b){var c=this.getHoleIndexByPoint(a,b);c>=0&&this.removeHole(c)},getPipeHoleBoundsByHoleIndex:function(a){var b=this;if(b._holeCount&&!(0>a||a>=b._holeCount)){var c=!1;b._reverse&&(c=!c),b._dataModel&&b._dataModel._mirror&&(c=!c);var f,h=2*(b.s("shape.border.width")||0),i=b.getWidth()-h<=0?1:b.getWidth()-h,j=b.getHeight()-h<=0?1:b.getHeight()-h,k=b._centerHole,l=b._holeCount,m=Math.min(i,j)/2,n=b.getWidth()/2,o=b.getHeight()/2,p=k?l-1:l,q=g/p,r=m*e(q)/(1+e(q)),s=(m-r)*e(2*-q*(a+1)+g/p),t=(m-r)*d(2*-q*(a+1)+g/p);return c&&(s=(m-r)*e(2*q*(a+1)-g/p),t=(m-r)*d(2*q*(a+1)-g/p)),1===l?f={x:n-m/2,y:o-m/2,width:m,height:m}:k&&a==l-1?(r=m-2*r,f={x:n-r,y:o-r,width:2*r,height:2*r}):f={x:n+s-r,y:o+t-r,width:2*r,height:2*r},f}},getClassName:function(){return"ht.RoundPipeNode"},getSerializableProperties:function(){var a=j.superClass.getSerializableProperties.call(this);return a.holeCount=1,a.holeIndex=1,a.centerHole=1,a.reverse=1,delete a.image,a}});var k=ht.RectPipeNode=function(){k.superClass.constructor.apply(this),this._horizonal=!0,this.setCellCount(new ht.List([3,4,5,4,3])),this.setReverse(!1)};f.def(k,ht.Node,{ms_ac:["reverse","horizonal","cellIndex","cellCount"],handleHostPropertyChange:function(a){var b=this.getHost(),c=this.getCellIndex();c<b.getAllCellCount()?a&&"attaches"!==a.property&&i.call(this,a):k.superClass.handleHostPropertyChange.call(this,a)},validateCells:function(){var a=this,b={width:{func:function(a){return a._width||10}},height:{func:function(a){return a._height||10}},comps:[{type:"rect",rect:{func:function(a){var b=a.getWidth(),c=a.getHeight(),d=1;return[d/2,d/2,0>=b-d?1:b-d,0>=c-d?1:c-d]}},pattern:{func:"style@shape.pattern"},background:"rgba(203,203,203,0.1)",borderWidth:1,borderColor:"rgb(0, 185, 30)",gradient:"radial.northwest",gradientColor:"#FFF"}]},c=this.getAllCellCount();if(c>0)for(var d=0;c>d;d++){var e={type:"rect",rect:{func:function(a){return function(b){var c=b.getPipeCellBoundsByCellIndex(a);return[c.x,c.y,c.width,c.height]}}(d)},background:null,borderWidth:1,borderColor:"rgb(0, 185, 30)"};b.comps.push(e)}a.setImage(b)},onPropertyChanged:function(a){var b=this;k.superClass.onPropertyChanged.call(b,a),"reverse"===a.property||"horizonal"===a.property||"cellCount"===a.property?b.validateCells():("cellIndex"===a.property||"host"===a.property)&&i.call(b)},setCellCount:function(a){if(a){a._as||(a=new ht.List(a));var b=this;null==b._cellCount&&(b._cellCount=new ht.List);var c=b._cellCount;b._cellCount=a,b.fp("cellCount",c,a)}},getAllCellCount:function(){for(var a=0,b=this._cellCount,c=0;c<b.size();c++){var d=b.get(c);a+=d}return a},getCellIndexByPoint:function(a,b){for(var c=this.getRowIndexByPoint(a,b),d=this.getColumnIndexByPoint(a,b),e=this._cellCount,f=0,g=0;c>g;g++)f+=e.get(g);return f+=d},getRowIndexByPoint:function(a,b){a=a-this.getPosition().x+this.getWidth()/2,b=b-this.getPosition().y+this.getHeight()/2;for(var c=this.getAllCellCount(),d=0;c>d;d++){var e=this.getPipeCellBoundsByCellIndex(d);if(f.containsPoint(e,{x:a,y:b}))return this.getRowIndexByCellIndex(d)}return-1},getRowIndexByCellIndex:function(a){if(0>a||a>=this.getAllCellCount())return-1;for(var b=0,c=this._cellCount,d=0;d<c.size();d++){var e=c.get(d);if(b+=e,b>=a+1)return this.isHorizonal()?d:e-(b-a)}return-1},removeCell:function(a){var b=this.getAllCellCount(),c=this._cellCount;if(!(0>a||a>=b)){var d=this.getRowIndexByCellIndex(a),e=this.getAttaches();if(e){for(var f,g=0;g<e.size();g++){var h=e.get(g);h.getCellIndex()===a?f=h:h.getCellIndex()>a&&h.setCellIndex(h.getCellIndex()-1)}f&&(f.setHost(null),this._dataModel.remove(f))}var i=c._as.slice(0);i[d]--,i[d]<=0&&i.splice(d,1),this.setCellCount(new ht.List(i))}},removeCellByPoint:function(a,b){var c=this.getCellIndexByPoint(a,b);c>=0&&this.removeCell(c)},getColumnIndexByPoint:function(a,b){a=a-this.getPosition().x+this.getWidth()/2,b=b-this.getPosition().y+this.getHeight()/2;for(var c=this.getAllCellCount(),d=0;c>d;d++){var e=this.getPipeCellBoundsByCellIndex(d);if(f.containsPoint(e,{x:a,y:b}))return this.getColumnIndexByCellIndex(d)}return-1},getColumnIndexByCellIndex:function(a){if(0>a||a>=this.getAllCellCount())return-1;for(var b=0,c=this._cellCount,d=0;d<c.size();d++){var e=c.get(d);if(b+=e,b>=a+1)return this.isHorizonal()?e-(b-a):d}return-1},getPipeCellBoundsByCellIndex:function(a){if(!(0>a||a>=this.getAllCellCount())){var b=this.getRowIndexByCellIndex(a),c=this.getColumnIndexByCellIndex(a);if(!(0>b||0>c)){var d=!1;if(this._reverse&&(d=!d),this._dataModel&&this._dataModel._mirror&&(d=!d),d){var e=this._cellCount.get(b);c=e-c-1}var g=0,h=0,i=1,j=g+i,k=h+i,l=this.getWidth()-2*i,m=this.getHeight()-2*i,n={};if(this.isHorizonal()){var e=this._cellCount.get(b);n.width=l/e,n.height=m/this._cellCount.size(),n.x=j+c*l/e,n.y=k+b*m/this._cellCount.size()}else{var o=this._cellCount.get(c);n.width=l/this._cellCount.size(),n.height=m/o,n.x=j+c*l/this._cellCount.size(),n.y=k+b*m/o}return f.grow(n,-3),n}}},getAttachByCellIndex:function(a){var b=this.getAttaches();if(b)for(var c=0;c<b.size();c++){var d=b.get(c);if(d.getCellIndex()===a)return d}},getClassName:function(){return"ht.RectPipeNode"},getSerializableProperties:function(){var a=k.superClass.getSerializableProperties.call(this);return a.horizonal=1,a.cellCount=1,a.cellIndex=1,a.reverse=1,delete a.image,a}})}(this,Object);
/*!最后修改于： 2015-12-08 */