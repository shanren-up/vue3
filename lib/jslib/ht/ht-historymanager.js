!function(j,B){"use strict";var G="ht",_=j[G],s=_.Default,o=s.def,O="add",i="remove",Z=s.getInternal(),g="propertyChange";_.HistoryManager=function(t){this._histories=[],this.setDataModel(t)},o(_.HistoryManager,B,{ms_ac:["dataModel","histories","historyIndex","maxHistoryCount"],ms_fire:1,_historyIndex:-1,$4p:0,$8p:0,_maxHistoryCount:10,beginInteraction:function(){var O=this;O.$4p++,1===O.$4p&&(O.$3p=[])},endInteraction:function(){var j=this,D=j._histories,d=j._historyIndex,o=j.$3p;j.$4p--,0===j.$4p&&(delete j.$3p,o.length&&(D=D.slice(0,d+1),D.push(o),D.length>j._maxHistoryCount&&(D=D.slice(D.length-j._maxHistoryCount)),j.setHistories(D),j.setHistoryIndex(D.length-1,!0)))},beginTransient:function(){this.$4p||this.$8p++},endTransient:function(){this.$4p||this.$8p--},setDataModel:function(P){var T=this,I=T._dataModel;I!==P&&(I&&(delete I._historyManager,I.umm(T.$5p,T),I.umd(T.$6p,T)),T._dataModel=P,P._historyManager=T,P.mm(T.$5p,T),P.md(T.$6p,T),T.fp("dataModel",I,P),T.clear())},setHistoryIndex:function(G,v){var K=this,y=K._historyIndex,X=K._histories.length;if(-1>G?G=-1:G>=X&&(G=X-1),y!==G){if(!v){var I=G-y;I>0?K.$2p(I):0>I&&K.$1p(-I)}K._historyIndex=G,K.fp("historyIndex",y,G)}},setMaxHistoryCount:function(L){var o=this,D=o._histories,F=o._maxHistoryCount;(!L||0>=L)&&(L=10),F!==L&&(o._maxHistoryCount=L,o.fp("maxHistoryCount",F,L),D.length>L&&o.clear())},$5p:function(H){if(!this.$7p&&!this.$8p){var $,u,p=this,Z=p._histories,Y=H.kind,E=H.property,_=p._historyIndex;if(Y===O||Y===i?u={type:H.kind,data:H.data}:E&&"children"!==E&&"attaches"!==E&&"shape"!==E&&(u={type:g,data:H.data,property:E,oldValue:H.oldValue,newValue:H.newValue}),u)if(p.$4p){$=p.$3p;var j=!1;if(u.type===g)for(var o=$.length-1;o>=0;o--){var K=$[o];if(K.type!==g)break;u.property===K.property&&K.property&&u.data===K.data&&(u.oldValue=K.oldValue,$[o]=u,j=!0)}j||$.push(u)}else $=[u],Z=Z.slice(0,_+1),Z.push($),Z.length>p._maxHistoryCount&&(Z=Z.slice(Z.length-p._maxHistoryCount)),p.setHistories(Z),p.setHistoryIndex(Z.length-1,!0)}},$6p:function(Y){this.$5p(Y)},undo:function(N){(!N||0>=N)&&(N=1),this.setHistoryIndex(this._historyIndex-N)},$1p:function(P){var x,w=this,o=w._dataModel,c=w._histories,f=w._historyIndex;for(w.$7p=1,s.setIsolating(!0);P>0;){if(f>=0&&f<c.length){x=c[f],f--;for(var z=x.length-1;z>=0;z--){var R=x[z],X=R.type,M=R.data,k=R.property,J=R.oldValue;if(X===O)o.remove(M);else if(X===i)o.add(M);else{var _=null;0===k.indexOf("a:")?(_="attr",k=k.replace("a:","")):0===k.indexOf("s:")&&(_="style",k=k.replace("s:","")),Z.setPropertyValue(M,_,k,J)}}}P--}s.setIsolating(!1),delete w.$7p},redo:function(i){(!i||0>=i)&&(i=1),this.setHistoryIndex(this._historyIndex+i)},$2p:function(r){var e,S=this,M=S._dataModel,g=S._histories,D=S._historyIndex;for(S.$7p=1,s.setIsolating(!0);r>0;){if(D>=-1&&D<g.length-1){D++,e=g[D];for(var a=0;a<e.length;a++){var Q=e[a],t=Q.type,V=Q.data,f=Q.property,p=Q.newValue;if(t===O)M.add(V);else if(t===i)M.remove(V);else{var d=null;0===f.indexOf("a:")?(d="attr",f=f.replace("a:","")):0===f.indexOf("s:")&&(d="style",f=f.replace("s:","")),Z.setPropertyValue(V,d,f,p)}}}r--}s.setIsolating(!1),delete S.$7p},clear:function(){this.setHistories([]),this.setHistoryIndex(-1,!0),this.$4p=0,delete this.$3p}})}(this,Object);